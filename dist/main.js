/*! For license information please see main.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}(self,(()=>(()=>{var t={946:(t,e,n)=>{"use strict";n.d(e,{A:()=>a});var i=n(354),o=n.n(i),r=n(314),s=n.n(r)()(o());s.push([t.id,'/**\n * OpenSeadragon paperjs overlay plugin based on paper.js\n * @version 0.4.13\n * \n * Includes additional open source libraries which are subject to copyright notices\n * as indicated accompanying those segments of code.\n * \n * Original code:\n * Copyright (c) 2022-2024, Thomas Pearce\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n * \n * * Redistributions of source code must retain the above copyright notice, this\n *   list of conditions and the following disclaimer.\n * \n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * \n * * Neither the name of osd-paperjs-annotation nor the names of its\n *   contributors may be used to endorse or promote products derived from\n *   this software without specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n * \n */\n.annotation-ui-noselect{\n    user-select:none;\n}\n.ui-dialog{\n    font-size:14px;\n}\n.ui-dialog, .ui-dialog-content {\n    box-sizing: content-box;\n}\n.flex-row{\n    display:flex;\n    flex-direction:row;\n}\n.annotation-ui-mainwindow .templates{\n    display:none;\n}\n.annotation-ui-mainwindow{\n    height:100%;\n    width:16em;\n    min-width:12em;\n    color:black;\n    overflow:hidden;\n    display:grid;\n    grid-template-rows: auto auto minmax(4em, 1fr) auto;\n    border:thin gray solid;\n    padding:2px;\n    box-sizing:border-box;\n}\n.annotation-visibility-controls{\n    display:flex;\n    flex-grow:0;\n    flex-shrink:0;\n    border-bottom:thin gray solid;\n    padding-bottom:2px;\n    margin-bottom:2px;\n}\n.annotation-visibility-controls .visibility-buttons{\n    flex-grow:0;\n    display:flex;\n    margin-right:5px;\n}\n.annotation-visibility-controls .annotation-opacity-container{\n    flex-grow:1;\n}\n.annotation-ui-mainwindow button.btn{\n    padding:0 3px;\n}\n.file-button{\n    padding:0.1em 0.5em;\n    margin-right:0.3em;\n}\n.annotation-ui label{\n    margin:0;\n}\n.annotation-ui-feature-collections{\n    overflow:auto;\n    border-bottom:thin gray solid;\n}\n.annotation-ui-feature-collections:empty::before {\n    content: \'Click below to begin a new feature collection\';\n    color: gray;\n}\n.feature-collection{\n    border: thin transparent solid;\n    padding:2px;\n    opacity:0.1;\n}\n.annotation-ui-feature-collections .feature-collection{\n    transition: opacity 1s;\n}\n.annotation-ui-feature-collections .feature-collection.inserted:not(.trashed):not(.draganddrop-dragging){\n    opacity:1;\n}\n.annotation-ui-feature-collections .feature-collection:not(.trashed).selected{\n    border:thin black solid;\n    background-color:azure;\n} \n.annotation-ui-feature-collections\n    .feature-collection:not(.trashed,.annotation-hidden,.selected):hover, \n    .feature-collection.svg-hovered:not(.trashed):not(.annotation-hidden){\n    background-color:lightgoldenrodyellow;\n    border:thin black solid;\n}\n.feature-collection.annotation-hidden [data-action="hide"]{\n    display:none;\n}\n.feature-collection:not(.annotation-hidden) [data-action="show"]{\n    display:none;\n}\n.feature-collection.annotation-hidden .features{\n    pointer-events:none;\n    opacity:50%;\n}\n.annotation-ui-feature-collections .name{\n    font-weight:bold;\n}\n.annotation-details{\n    flex-grow:1;\n}\n.feature-item{\n    margin-left:1em;\n}\n\n.feature-collection [data-action], .feature [data-action]{\n    margin-left:0.2em;\n}\n.hoverable-actions:not(:hover) .onhover{\n    visibility:hidden;\n}\n.hoverable-actions:hover .editablecontent .onhover {\n    visibility:visible;\n}\n.feature-collection.trashed{\n    background-color:darkred;\n    opacity:0.3;\n    pointer-events:none;\n}\n.annotation-header{\n    display:grid;\n    grid-template-columns:auto 1fr auto auto auto;\n}\n.feature-collection.trashed .annotation-header [data-action="trash"]{\n    pointer-events:all;\n    visibility:visible;\n}\n.feature-collection .toggle-list{\n    flex-grow:0\n}\n.feature-collection .features{\n    flex-grow:1;\n}\n.features.collapsed .features-list{\n    display:none;\n}\n.features:not(.collapsed) .features-summary{\n    display:none;\n}\n.features.collapsed [data-action="collapse-up"]{\n    display:none;\n}\n.features:not(.collapsed) [data-action="collapse-down"]{\n    display:none;\n}\n.features-summary:not([data-num-elements="1"]) .pluralize::before{\n    content:\'s\';\n}\n.feature.selected{\n    background-color:green;\n}\n.feature{\n    cursor:default;\n}\n.annotation-ui-mainwindow.disabled .disable-when-annotations-hidden{\n    opacity:0.5;\n    pointer-events:none;\n    cursor:not-allowed;\n}\n.annotation-ui-mainwindow.deactivated .disable-when-deactivated{\n    opacity:0.5;\n    pointer-events:none;\n    cursor:not-allowed;\n}\n\n.annotation-ui-grid{\n    display: grid;\n    grid-template-rows: auto 1fr auto;\n    grid-template-columns: auto 1fr auto;\n    width: 100%;\n    height: 100%;\n    background-color:white;\n}\n.annotation-ui-grid .center{\n    grid-column: 2 / 3;\n    grid-row: 2 / 3;\n    position:relative;\n    z-index:0; /* reset the z-index basis for this container so children can be manipulated independently of siblings */\n}\n.annotation-ui-grid .top {\n    grid-column: 1 / 3;\n    grid-row: 1 / 2;\n    text-align:center;\n    border-bottom:thin gray solid;\n}\n.annotation-ui-grid .bottom {\n    grid-column: 1 / 3;\n    grid-row: 3 / 4;\n}\n.annotation-ui-grid .left {\n    grid-column: 1 / 2;\n    grid-row: 2 / 3;\n}\n.annotation-ui-grid .right {\n    grid-column: 3 / 4;\n    grid-row: 1 / 4;\n    position:relative;\n}\n.annotation-ui-grid .resize-right{\n    width: 15px;\n    left: -15px;\n    position: absolute;\n    background-color: rgb(196, 196, 196);\n    cursor: grab;\n    text-align:center;\n    user-select:none;\n    top:50%;\n    transform: translate(0, -50%);\n    padding:10px 0;\n    border-top-left-radius: 5px;\n    border-bottom-left-radius: 5px;\n}\n.annotation-ui-grid .resize-right::before{\n    content:\'||\';\n}\n.annotation-ui-grid .resize-right.resizing{\n    cursor:grabbing;\n}\n.annotation-ui-grid .right:not(:hover) .resize-right{\n    display:none;\n}\n\n.annotation-ui-drawing-toolbar .pseudohidden, .annotation-ui-drawing-toolbar .invisible{\n    visibility:hidden;\n    width: 0;\n    height: 0;\n    overflow: hidden;\n    padding:0;\n    border:none;\n}\n.annotation-ui-drawing-toolbar{\n    background-color:lightgray;\n    display: inline-block;\n    max-width:100%;\n    text-align:left;\n}\n.annotation-ui-drawing-toolbar button[disabled]{\n    pointer-events:none;\n    cursor:not-allowed;\n    border:thin solid transparent;\n}\n.annotation-ui-drawing-toolbar button:not([disabled]){\n    border:thin rgb(195, 195, 195) solid;\n}\n.annotation-ui-drawing-toolbar button:not([disabled]):hover{\n    border:thin rgb(41, 41, 41) solid;\n    z-index:2;\n}\n.annotation-ui-drawing-toolbar .dropdowns>*:not(.active){\n    display:none;\n}\n.annotation-ui-buttonbar>.btn.active{\n    color:black;\n    background-color:darkgray;\n}\n.annotation-ui-buttonbar>.btn:not(.active){\n    color:rgb(62, 62, 62);\n    background-color:lightgrey;\n}\n.dropdowns-container{\n    position:relative;\n    background-color:inherit;\n}\n.dropdowns{\n    color:black;\n    position:absolute;\n    background-color:inherit;\n    min-width:100%;\n}\n.dropdown{\n    width:100%;\n    display:grid;\n    vertical-align: middle;\n    column-gap:1em;\n    grid-template-columns:auto;\n}\n/* brush-toolbar styles */\n.dropdown.brush-toolbar{\n    grid-template-columns: auto 1fr auto auto;    \n}\n/* end brush-toolbar styles */\n\n/* polygon-toolbar styles */\n.dropdown.polygon-toolbar{\n    grid-template-columns: 1fr auto auto auto auto auto;    \n}\n.dropdown.polygon-toolbar button[data-action="simplify"]{\n    margin-right:0.2em;\n}\n/* end polygon-toolbar styles */\n\n/* linestring-toolbar styles */\n.dropdown.linestring-toolbar{\n    grid-template-columns: auto 1fr auto auto;\n}\n/* end linestring-toolbar styles */\ncanvas.selectable-layer{\n    cursor:pointer;\n}\ncanvas.point-tool-grab{\n    cursor:grab;\n}\ncanvas.point-tool-grabbing{\n    cursor:grabbing;\n}\ncanvas.rectangle-tool-move{\n    cursor: move;\n}\ncanvas.rectangle-tool-resize{\n    cursor:nesw-resize;\n}\ncanvas.transform-tool-move{\n    cursor: move;\n}\ncanvas.transform-tool-resize{\n    cursor:nesw-resize;\n}\ncanvas.transform-tool-rotate{\n    cursor: pointer;\n}\n.tool-action[data-tool-action="segment"]{\n    cursor:move;\n}\n.tool-action[data-tool-action="stroke"]{\n    cursor:copy;\n}\n.tool-action[data-tool-action="segment-erase"]{\n    cursor:not-allowed;\n}\n.tool-action[data-tool-action="colorpicker"]{\n    cursor:none;\n}\n\n/* wand-toolbar styles */\n.dropdown.wand-toolbar{\n    grid-template-columns: 5em 1fr auto auto;\n}\n\n.wand-toolbar .threshold-container{\n    display:flex;\n    flex-direction:column;\n}\n.wand-toolbar .threshold-container label, .wand-toolbar .label{\n    margin-bottom:0;\n    font-size:0.8em;\n}\n/* .wand-toolbar .toggle .btn{\n    padding:auto 4px;\n    line-height:1;\n} */\n/* .wand-toolbar .toggle.btn-primary{\n    margin-bottom:0;\n} */\n.wand-toolbar .toggles{\n    display:grid;\n    column-gap:2px;\n    grid-template-columns:7em 5em 8em;\n}\n.wand-toolbar .option-toggle{\n    display:grid;\n    grid-template-rows:auto auto;\n    cursor: pointer;\n    user-select: none;\n    -webkit-user-select:none;\n}\n.wand-toolbar .option-toggle:hover .option{\n    background-color:darkgray;\n}\n.wand-toolbar .option-toggle .option:not(.selected){\n    display:none;\n}\n/* End wand-toolbar styles */\n\n.viewer-controls-topleft{\n    display:flex;\n}\n\n/* style-toolbar styles */\n\n.style-toolbar .style-row{\n    display:grid;\n    grid-template-columns:auto auto auto auto;\n    column-gap:0.5em;\n    align-items:center;\n}\n.style-toolbar .style-item{\n    display:inline-block;\n    width:7em;\n    white-space: nowrap;\n    overflow:hidden;\n    text-overflow:ellipsis;\n    padding-left:0.5em;\n    cursor:pointer;\n}\n.style-toolbar .style-item.selected{\n    outline:medium lightskyblue solid;\n}\n.style-toolbar .hierarchy-up{\n    cursor:pointer;\n    padding:0 0.5em;\n}\n.style-toolbar input[type="number"]{\n    width:3.5em;\n}\n.style-toolbar .colorpicker-row.hidden{\n    display:none;\n}\n.style-toolbar .colorpicker-row{\n    display:grid;\n    grid-template-columns:repeat(4,auto)\n}\n.style-toolbar .preview{\n    position:relative;\n    display:block;\n    background: repeating-conic-gradient(#d0d0d0 0% 25%, white 0% 50%) \n              50% / 20px 20px\n}\n.style-toolbar .preview::after{\n    /* This is just so the height is set correctly since children are absolute positioned */\n    content:\'Preview\';\n    visibility:hidden;\n}\n.style-toolbar .preview .bg{\n    display:block;\n    position:absolute;\n    outline:thin solid black;\n    top:0;\n    left:0;\n    bottom:0;\n    right:0;\n}\n.style-toolbar .preview .text{\n    display:block;\n    position:absolute;\n    padding:0 0.2em;\n}\n.style-toolbar input[type="range"]{\n    display:inline-block;\n}\n\n/* end style-toolbar styles */\n\n\n.new-feature,.new-feature-collection{\n    cursor:pointer;\n}\n.new-feature:hover,.new-feature-collection:hover{\n    background-color:antiquewhite;\n    outline:thin gray solid;\n}\n/* Annotation UI File Dialog Styles*/\n.annotation-ui-filedialog{\n    display:grid;\n    grid-template-columns: auto auto auto;\n}\n.annotation-ui-filedialog>div{\n    padding: 0 0.3em;\n}\n.annotation-ui-filedialog .featurecollection-selection{\n    border-right:thin gray solid;\n    border-left:thin gray solid;\n    width:15em;\n    overflow-x:hidden;\n}\n.annotation-ui-filedialog .featurecollection-list{\n    display:flex;\n    flex-direction:column;\n    overflow:auto;\n}\n.annotation-ui-filedialog .localstorage-key-list::before{\n    content:\'Saved in local storage:\';\n    display:block;\n    color:gray;\n}\n.annotation-ui-filedialog .localstorage-key-list:empty::after{\n    content:\'No items were found in local storage\';\n    font-style:italic;\n    color:gray;\n}\n.annotation-ui-filedialog .localstorage-key{\n    cursor:pointer;\n}\n.annotation-ui-filedialog .localstorage-key:hover{\n    background-color:lightgoldenrodyellow;\n}\n.annotation-ui-filedialog .localstorage-key-test.key-exists::after{\n    content: \'(overwrite)\';\n    font-weight:bold;\n    background-color:rgb(190, 99, 66);\n    color:white;\n    padding:0 0.2em;\n}\n.annotation-ui-filedialog .finalize-panel{\n    width:15em;\n    overflow-x:hidden;\n}\n.annotation-ui-filedialog .header{\n    white-space: nowrap;\n    border-bottom:thin gray solid;\n    padding-bottom:2px;\n    margin-bottom:2px;\n}\n.annotation-ui-filedialog button{\n    display:block;\n}\n\n.annotation-ui-filedialog .file-actions{\n    display:flex;\n    flex-direction:column;\n}\n.annotation-ui-filedialog .file-actions hr{\n    margin: 5px 0;\n}\n\nbutton[disabled]{\n    opacity:0.3;\n}\n\n.dropdown button[data-action="erase"].active{\n    background-color:rgb(187, 86, 86);\n\n}\n.feature .bounding-element{\n    margin-right:-1.2em;\n}\n.feature .bounding-element:not(.active){\n    visibility:visible;\n    color:lightgray;\n}\n.feature .bounding-element.active{\n    visibility:visible;\n    color:black;\n}\n.feature:not(:hover) .bounding-element:not(.active){\n    visibility:hidden;\n}\n\n.hidden{\n    display:none;\n}\n\n.draganddrop-dragging{\n    opacity:0.3;\n}\n.draganddrop-hide{\n    display:none;\n}\n.draganddrop-drop-target{\n    outline:thick rgb(112, 111, 111) solid;\n}\n.draganddrop-drop-target:hover{\n    outline-color:black;\n}\n.draganddrop-drop-target>*>*{\n    pointer-events:none;\n}\n.draganddrop-placeholder{\n    border: thin black solid;\n    border-radius:2px;\n}\n.draganddrop-placeholder>*{\n    visibility:hidden;\n}\n\n/* From bootstrap */\ninput[type=range] {\n    display: block;\n    width: 100%;\n}\n.btn {\n    display: inline-block;\n    padding: 2px 8px;\n    margin-bottom: 0;\n    font-size: 14px;\n    /* font-weight: 400; */\n    /* line-height: 1.42857143; */\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    /* -ms-touch-action: manipulation;\n    touch-action: manipulation; */\n    cursor: pointer;\n    /* -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none; */\n    user-select: none;\n    background-image: none;\n    border: 1px solid transparent;\n    /* border-radius: 4px; */\n}\n.btn.btn-sm{\n    font-size:12px;\n}\n\n.icon {\n    width: 1em;\n    height: 1em;\n    vertical-align: -0.125em;\n}\n/* Items with [data-action] are supposed to be clickable but if the sub-object gets the click it doesn\'t work, so stop pointer events on children */\n[data-action]>*{\n    pointer-events:none;\n}\n\n.rotate-by{\n    transform:rotate(var(--rotate-angle));\n}',"",{version:3,sources:["webpack://./src/css/annotationui.css"],names:[],mappings:"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAoCE;AACF;IACI,gBAAgB;AACpB;AACA;IACI,cAAc;AAClB;AACA;IACI,uBAAuB;AAC3B;AACA;IACI,YAAY;IACZ,kBAAkB;AACtB;AACA;IACI,YAAY;AAChB;AACA;IACI,WAAW;IACX,UAAU;IACV,cAAc;IACd,WAAW;IACX,eAAe;IACf,YAAY;IACZ,mDAAmD;IACnD,sBAAsB;IACtB,WAAW;IACX,qBAAqB;AACzB;AACA;IACI,YAAY;IACZ,WAAW;IACX,aAAa;IACb,6BAA6B;IAC7B,kBAAkB;IAClB,iBAAiB;AACrB;AACA;IACI,WAAW;IACX,YAAY;IACZ,gBAAgB;AACpB;AACA;IACI,WAAW;AACf;AACA;IACI,aAAa;AACjB;AACA;IACI,mBAAmB;IACnB,kBAAkB;AACtB;AACA;IACI,QAAQ;AACZ;AACA;IACI,aAAa;IACb,6BAA6B;AACjC;AACA;IACI,wDAAwD;IACxD,WAAW;AACf;AACA;IACI,8BAA8B;IAC9B,WAAW;IACX,WAAW;AACf;AACA;IACI,sBAAsB;AAC1B;AACA;IACI,SAAS;AACb;AACA;IACI,uBAAuB;IACvB,sBAAsB;AAC1B;AACA;;;IAGI,qCAAqC;IACrC,uBAAuB;AAC3B;AACA;IACI,YAAY;AAChB;AACA;IACI,YAAY;AAChB;AACA;IACI,mBAAmB;IACnB,WAAW;AACf;AACA;IACI,gBAAgB;AACpB;AACA;IACI,WAAW;AACf;AACA;IACI,eAAe;AACnB;;AAEA;IACI,iBAAiB;AACrB;AACA;IACI,iBAAiB;AACrB;AACA;IACI,kBAAkB;AACtB;AACA;IACI,wBAAwB;IACxB,WAAW;IACX,mBAAmB;AACvB;AACA;IACI,YAAY;IACZ,6CAA6C;AACjD;AACA;IACI,kBAAkB;IAClB,kBAAkB;AACtB;AACA;IACI;AACJ;AACA;IACI,WAAW;AACf;AACA;IACI,YAAY;AAChB;AACA;IACI,YAAY;AAChB;AACA;IACI,YAAY;AAChB;AACA;IACI,YAAY;AAChB;AACA;IACI,WAAW;AACf;AACA;IACI,sBAAsB;AAC1B;AACA;IACI,cAAc;AAClB;AACA;IACI,WAAW;IACX,mBAAmB;IACnB,kBAAkB;AACtB;AACA;IACI,WAAW;IACX,mBAAmB;IACnB,kBAAkB;AACtB;;AAEA;IACI,aAAa;IACb,iCAAiC;IACjC,oCAAoC;IACpC,WAAW;IACX,YAAY;IACZ,sBAAsB;AAC1B;AACA;IACI,kBAAkB;IAClB,eAAe;IACf,iBAAiB;IACjB,SAAS,EAAE,wGAAwG;AACvH;AACA;IACI,kBAAkB;IAClB,eAAe;IACf,iBAAiB;IACjB,6BAA6B;AACjC;AACA;IACI,kBAAkB;IAClB,eAAe;AACnB;AACA;IACI,kBAAkB;IAClB,eAAe;AACnB;AACA;IACI,kBAAkB;IAClB,eAAe;IACf,iBAAiB;AACrB;AACA;IACI,WAAW;IACX,WAAW;IACX,kBAAkB;IAClB,oCAAoC;IACpC,YAAY;IACZ,iBAAiB;IACjB,gBAAgB;IAChB,OAAO;IACP,6BAA6B;IAC7B,cAAc;IACd,2BAA2B;IAC3B,8BAA8B;AAClC;AACA;IACI,YAAY;AAChB;AACA;IACI,eAAe;AACnB;AACA;IACI,YAAY;AAChB;;AAEA;IACI,iBAAiB;IACjB,QAAQ;IACR,SAAS;IACT,gBAAgB;IAChB,SAAS;IACT,WAAW;AACf;AACA;IACI,0BAA0B;IAC1B,qBAAqB;IACrB,cAAc;IACd,eAAe;AACnB;AACA;IACI,mBAAmB;IACnB,kBAAkB;IAClB,6BAA6B;AACjC;AACA;IACI,oCAAoC;AACxC;AACA;IACI,iCAAiC;IACjC,SAAS;AACb;AACA;IACI,YAAY;AAChB;AACA;IACI,WAAW;IACX,yBAAyB;AAC7B;AACA;IACI,qBAAqB;IACrB,0BAA0B;AAC9B;AACA;IACI,iBAAiB;IACjB,wBAAwB;AAC5B;AACA;IACI,WAAW;IACX,iBAAiB;IACjB,wBAAwB;IACxB,cAAc;AAClB;AACA;IACI,UAAU;IACV,YAAY;IACZ,sBAAsB;IACtB,cAAc;IACd,0BAA0B;AAC9B;AACA,yBAAyB;AACzB;IACI,yCAAyC;AAC7C;AACA,6BAA6B;;AAE7B,2BAA2B;AAC3B;IACI,mDAAmD;AACvD;AACA;IACI,kBAAkB;AACtB;AACA,+BAA+B;;AAE/B,8BAA8B;AAC9B;IACI,yCAAyC;AAC7C;AACA,kCAAkC;AAClC;IACI,cAAc;AAClB;AACA;IACI,WAAW;AACf;AACA;IACI,eAAe;AACnB;AACA;IACI,YAAY;AAChB;AACA;IACI,kBAAkB;AACtB;AACA;IACI,YAAY;AAChB;AACA;IACI,kBAAkB;AACtB;AACA;IACI,eAAe;AACnB;AACA;IACI,WAAW;AACf;AACA;IACI,WAAW;AACf;AACA;IACI,kBAAkB;AACtB;AACA;IACI,WAAW;AACf;;AAEA,wBAAwB;AACxB;IACI,wCAAwC;AAC5C;;AAEA;IACI,YAAY;IACZ,qBAAqB;AACzB;AACA;IACI,eAAe;IACf,eAAe;AACnB;AACA;;;GAGG;AACH;;GAEG;AACH;IACI,YAAY;IACZ,cAAc;IACd,iCAAiC;AACrC;AACA;IACI,YAAY;IACZ,4BAA4B;IAC5B,eAAe;IACf,iBAAiB;IACjB,wBAAwB;AAC5B;AACA;IACI,yBAAyB;AAC7B;AACA;IACI,YAAY;AAChB;AACA,4BAA4B;;AAE5B;IACI,YAAY;AAChB;;AAEA,yBAAyB;;AAEzB;IACI,YAAY;IACZ,yCAAyC;IACzC,gBAAgB;IAChB,kBAAkB;AACtB;AACA;IACI,oBAAoB;IACpB,SAAS;IACT,mBAAmB;IACnB,eAAe;IACf,sBAAsB;IACtB,kBAAkB;IAClB,cAAc;AAClB;AACA;IACI,iCAAiC;AACrC;AACA;IACI,cAAc;IACd,eAAe;AACnB;AACA;IACI,WAAW;AACf;AACA;IACI,YAAY;AAChB;AACA;IACI,YAAY;IACZ;AACJ;AACA;IACI,iBAAiB;IACjB,aAAa;IACb;;AAEJ;AACA;IACI,uFAAuF;IACvF,iBAAiB;IACjB,iBAAiB;AACrB;AACA;IACI,aAAa;IACb,iBAAiB;IACjB,wBAAwB;IACxB,KAAK;IACL,MAAM;IACN,QAAQ;IACR,OAAO;AACX;AACA;IACI,aAAa;IACb,iBAAiB;IACjB,eAAe;AACnB;AACA;IACI,oBAAoB;AACxB;;AAEA,6BAA6B;;;AAG7B;IACI,cAAc;AAClB;AACA;IACI,6BAA6B;IAC7B,uBAAuB;AAC3B;AACA,oCAAoC;AACpC;IACI,YAAY;IACZ,qCAAqC;AACzC;AACA;IACI,gBAAgB;AACpB;AACA;IACI,4BAA4B;IAC5B,2BAA2B;IAC3B,UAAU;IACV,iBAAiB;AACrB;AACA;IACI,YAAY;IACZ,qBAAqB;IACrB,aAAa;AACjB;AACA;IACI,iCAAiC;IACjC,aAAa;IACb,UAAU;AACd;AACA;IACI,8CAA8C;IAC9C,iBAAiB;IACjB,UAAU;AACd;AACA;IACI,cAAc;AAClB;AACA;IACI,qCAAqC;AACzC;AACA;IACI,sBAAsB;IACtB,gBAAgB;IAChB,iCAAiC;IACjC,WAAW;IACX,eAAe;AACnB;AACA;IACI,UAAU;IACV,iBAAiB;AACrB;AACA;IACI,mBAAmB;IACnB,6BAA6B;IAC7B,kBAAkB;IAClB,iBAAiB;AACrB;AACA;IACI,aAAa;AACjB;;AAEA;IACI,YAAY;IACZ,qBAAqB;AACzB;AACA;IACI,aAAa;AACjB;;AAEA;IACI,WAAW;AACf;;AAEA;IACI,iCAAiC;;AAErC;AACA;IACI,mBAAmB;AACvB;AACA;IACI,kBAAkB;IAClB,eAAe;AACnB;AACA;IACI,kBAAkB;IAClB,WAAW;AACf;AACA;IACI,iBAAiB;AACrB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,WAAW;AACf;AACA;IACI,YAAY;AAChB;AACA;IACI,sCAAsC;AAC1C;AACA;IACI,mBAAmB;AACvB;AACA;IACI,mBAAmB;AACvB;AACA;IACI,wBAAwB;IACxB,iBAAiB;AACrB;AACA;IACI,iBAAiB;AACrB;;AAEA,mBAAmB;AACnB;IACI,cAAc;IACd,WAAW;AACf;AACA;IACI,qBAAqB;IACrB,gBAAgB;IAChB,gBAAgB;IAChB,eAAe;IACf,sBAAsB;IACtB,6BAA6B;IAC7B,kBAAkB;IAClB,mBAAmB;IACnB,sBAAsB;IACtB;iCAC6B;IAC7B,eAAe;IACf;;4BAEwB;IACxB,iBAAiB;IACjB,sBAAsB;IACtB,6BAA6B;IAC7B,wBAAwB;AAC5B;AACA;IACI,cAAc;AAClB;;AAEA;IACI,UAAU;IACV,WAAW;IACX,wBAAwB;AAC5B;AACA,mJAAmJ;AACnJ;IACI,mBAAmB;AACvB;;AAEA;IACI,qCAAqC;AACzC",sourcesContent:['/**\n * OpenSeadragon paperjs overlay plugin based on paper.js\n * @version 0.4.13\n * \n * Includes additional open source libraries which are subject to copyright notices\n * as indicated accompanying those segments of code.\n * \n * Original code:\n * Copyright (c) 2022-2024, Thomas Pearce\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n * \n * * Redistributions of source code must retain the above copyright notice, this\n *   list of conditions and the following disclaimer.\n * \n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * \n * * Neither the name of osd-paperjs-annotation nor the names of its\n *   contributors may be used to endorse or promote products derived from\n *   this software without specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n * \n */\n.annotation-ui-noselect{\n    user-select:none;\n}\n.ui-dialog{\n    font-size:14px;\n}\n.ui-dialog, .ui-dialog-content {\n    box-sizing: content-box;\n}\n.flex-row{\n    display:flex;\n    flex-direction:row;\n}\n.annotation-ui-mainwindow .templates{\n    display:none;\n}\n.annotation-ui-mainwindow{\n    height:100%;\n    width:16em;\n    min-width:12em;\n    color:black;\n    overflow:hidden;\n    display:grid;\n    grid-template-rows: auto auto minmax(4em, 1fr) auto;\n    border:thin gray solid;\n    padding:2px;\n    box-sizing:border-box;\n}\n.annotation-visibility-controls{\n    display:flex;\n    flex-grow:0;\n    flex-shrink:0;\n    border-bottom:thin gray solid;\n    padding-bottom:2px;\n    margin-bottom:2px;\n}\n.annotation-visibility-controls .visibility-buttons{\n    flex-grow:0;\n    display:flex;\n    margin-right:5px;\n}\n.annotation-visibility-controls .annotation-opacity-container{\n    flex-grow:1;\n}\n.annotation-ui-mainwindow button.btn{\n    padding:0 3px;\n}\n.file-button{\n    padding:0.1em 0.5em;\n    margin-right:0.3em;\n}\n.annotation-ui label{\n    margin:0;\n}\n.annotation-ui-feature-collections{\n    overflow:auto;\n    border-bottom:thin gray solid;\n}\n.annotation-ui-feature-collections:empty::before {\n    content: \'Click below to begin a new feature collection\';\n    color: gray;\n}\n.feature-collection{\n    border: thin transparent solid;\n    padding:2px;\n    opacity:0.1;\n}\n.annotation-ui-feature-collections .feature-collection{\n    transition: opacity 1s;\n}\n.annotation-ui-feature-collections .feature-collection.inserted:not(.trashed):not(.draganddrop-dragging){\n    opacity:1;\n}\n.annotation-ui-feature-collections .feature-collection:not(.trashed).selected{\n    border:thin black solid;\n    background-color:azure;\n} \n.annotation-ui-feature-collections\n    .feature-collection:not(.trashed,.annotation-hidden,.selected):hover, \n    .feature-collection.svg-hovered:not(.trashed):not(.annotation-hidden){\n    background-color:lightgoldenrodyellow;\n    border:thin black solid;\n}\n.feature-collection.annotation-hidden [data-action="hide"]{\n    display:none;\n}\n.feature-collection:not(.annotation-hidden) [data-action="show"]{\n    display:none;\n}\n.feature-collection.annotation-hidden .features{\n    pointer-events:none;\n    opacity:50%;\n}\n.annotation-ui-feature-collections .name{\n    font-weight:bold;\n}\n.annotation-details{\n    flex-grow:1;\n}\n.feature-item{\n    margin-left:1em;\n}\n\n.feature-collection [data-action], .feature [data-action]{\n    margin-left:0.2em;\n}\n.hoverable-actions:not(:hover) .onhover{\n    visibility:hidden;\n}\n.hoverable-actions:hover .editablecontent .onhover {\n    visibility:visible;\n}\n.feature-collection.trashed{\n    background-color:darkred;\n    opacity:0.3;\n    pointer-events:none;\n}\n.annotation-header{\n    display:grid;\n    grid-template-columns:auto 1fr auto auto auto;\n}\n.feature-collection.trashed .annotation-header [data-action="trash"]{\n    pointer-events:all;\n    visibility:visible;\n}\n.feature-collection .toggle-list{\n    flex-grow:0\n}\n.feature-collection .features{\n    flex-grow:1;\n}\n.features.collapsed .features-list{\n    display:none;\n}\n.features:not(.collapsed) .features-summary{\n    display:none;\n}\n.features.collapsed [data-action="collapse-up"]{\n    display:none;\n}\n.features:not(.collapsed) [data-action="collapse-down"]{\n    display:none;\n}\n.features-summary:not([data-num-elements="1"]) .pluralize::before{\n    content:\'s\';\n}\n.feature.selected{\n    background-color:green;\n}\n.feature{\n    cursor:default;\n}\n.annotation-ui-mainwindow.disabled .disable-when-annotations-hidden{\n    opacity:0.5;\n    pointer-events:none;\n    cursor:not-allowed;\n}\n.annotation-ui-mainwindow.deactivated .disable-when-deactivated{\n    opacity:0.5;\n    pointer-events:none;\n    cursor:not-allowed;\n}\n\n.annotation-ui-grid{\n    display: grid;\n    grid-template-rows: auto 1fr auto;\n    grid-template-columns: auto 1fr auto;\n    width: 100%;\n    height: 100%;\n    background-color:white;\n}\n.annotation-ui-grid .center{\n    grid-column: 2 / 3;\n    grid-row: 2 / 3;\n    position:relative;\n    z-index:0; /* reset the z-index basis for this container so children can be manipulated independently of siblings */\n}\n.annotation-ui-grid .top {\n    grid-column: 1 / 3;\n    grid-row: 1 / 2;\n    text-align:center;\n    border-bottom:thin gray solid;\n}\n.annotation-ui-grid .bottom {\n    grid-column: 1 / 3;\n    grid-row: 3 / 4;\n}\n.annotation-ui-grid .left {\n    grid-column: 1 / 2;\n    grid-row: 2 / 3;\n}\n.annotation-ui-grid .right {\n    grid-column: 3 / 4;\n    grid-row: 1 / 4;\n    position:relative;\n}\n.annotation-ui-grid .resize-right{\n    width: 15px;\n    left: -15px;\n    position: absolute;\n    background-color: rgb(196, 196, 196);\n    cursor: grab;\n    text-align:center;\n    user-select:none;\n    top:50%;\n    transform: translate(0, -50%);\n    padding:10px 0;\n    border-top-left-radius: 5px;\n    border-bottom-left-radius: 5px;\n}\n.annotation-ui-grid .resize-right::before{\n    content:\'||\';\n}\n.annotation-ui-grid .resize-right.resizing{\n    cursor:grabbing;\n}\n.annotation-ui-grid .right:not(:hover) .resize-right{\n    display:none;\n}\n\n.annotation-ui-drawing-toolbar .pseudohidden, .annotation-ui-drawing-toolbar .invisible{\n    visibility:hidden;\n    width: 0;\n    height: 0;\n    overflow: hidden;\n    padding:0;\n    border:none;\n}\n.annotation-ui-drawing-toolbar{\n    background-color:lightgray;\n    display: inline-block;\n    max-width:100%;\n    text-align:left;\n}\n.annotation-ui-drawing-toolbar button[disabled]{\n    pointer-events:none;\n    cursor:not-allowed;\n    border:thin solid transparent;\n}\n.annotation-ui-drawing-toolbar button:not([disabled]){\n    border:thin rgb(195, 195, 195) solid;\n}\n.annotation-ui-drawing-toolbar button:not([disabled]):hover{\n    border:thin rgb(41, 41, 41) solid;\n    z-index:2;\n}\n.annotation-ui-drawing-toolbar .dropdowns>*:not(.active){\n    display:none;\n}\n.annotation-ui-buttonbar>.btn.active{\n    color:black;\n    background-color:darkgray;\n}\n.annotation-ui-buttonbar>.btn:not(.active){\n    color:rgb(62, 62, 62);\n    background-color:lightgrey;\n}\n.dropdowns-container{\n    position:relative;\n    background-color:inherit;\n}\n.dropdowns{\n    color:black;\n    position:absolute;\n    background-color:inherit;\n    min-width:100%;\n}\n.dropdown{\n    width:100%;\n    display:grid;\n    vertical-align: middle;\n    column-gap:1em;\n    grid-template-columns:auto;\n}\n/* brush-toolbar styles */\n.dropdown.brush-toolbar{\n    grid-template-columns: auto 1fr auto auto;    \n}\n/* end brush-toolbar styles */\n\n/* polygon-toolbar styles */\n.dropdown.polygon-toolbar{\n    grid-template-columns: 1fr auto auto auto auto auto;    \n}\n.dropdown.polygon-toolbar button[data-action="simplify"]{\n    margin-right:0.2em;\n}\n/* end polygon-toolbar styles */\n\n/* linestring-toolbar styles */\n.dropdown.linestring-toolbar{\n    grid-template-columns: auto 1fr auto auto;\n}\n/* end linestring-toolbar styles */\ncanvas.selectable-layer{\n    cursor:pointer;\n}\ncanvas.point-tool-grab{\n    cursor:grab;\n}\ncanvas.point-tool-grabbing{\n    cursor:grabbing;\n}\ncanvas.rectangle-tool-move{\n    cursor: move;\n}\ncanvas.rectangle-tool-resize{\n    cursor:nesw-resize;\n}\ncanvas.transform-tool-move{\n    cursor: move;\n}\ncanvas.transform-tool-resize{\n    cursor:nesw-resize;\n}\ncanvas.transform-tool-rotate{\n    cursor: pointer;\n}\n.tool-action[data-tool-action="segment"]{\n    cursor:move;\n}\n.tool-action[data-tool-action="stroke"]{\n    cursor:copy;\n}\n.tool-action[data-tool-action="segment-erase"]{\n    cursor:not-allowed;\n}\n.tool-action[data-tool-action="colorpicker"]{\n    cursor:none;\n}\n\n/* wand-toolbar styles */\n.dropdown.wand-toolbar{\n    grid-template-columns: 5em 1fr auto auto;\n}\n\n.wand-toolbar .threshold-container{\n    display:flex;\n    flex-direction:column;\n}\n.wand-toolbar .threshold-container label, .wand-toolbar .label{\n    margin-bottom:0;\n    font-size:0.8em;\n}\n/* .wand-toolbar .toggle .btn{\n    padding:auto 4px;\n    line-height:1;\n} */\n/* .wand-toolbar .toggle.btn-primary{\n    margin-bottom:0;\n} */\n.wand-toolbar .toggles{\n    display:grid;\n    column-gap:2px;\n    grid-template-columns:7em 5em 8em;\n}\n.wand-toolbar .option-toggle{\n    display:grid;\n    grid-template-rows:auto auto;\n    cursor: pointer;\n    user-select: none;\n    -webkit-user-select:none;\n}\n.wand-toolbar .option-toggle:hover .option{\n    background-color:darkgray;\n}\n.wand-toolbar .option-toggle .option:not(.selected){\n    display:none;\n}\n/* End wand-toolbar styles */\n\n.viewer-controls-topleft{\n    display:flex;\n}\n\n/* style-toolbar styles */\n\n.style-toolbar .style-row{\n    display:grid;\n    grid-template-columns:auto auto auto auto;\n    column-gap:0.5em;\n    align-items:center;\n}\n.style-toolbar .style-item{\n    display:inline-block;\n    width:7em;\n    white-space: nowrap;\n    overflow:hidden;\n    text-overflow:ellipsis;\n    padding-left:0.5em;\n    cursor:pointer;\n}\n.style-toolbar .style-item.selected{\n    outline:medium lightskyblue solid;\n}\n.style-toolbar .hierarchy-up{\n    cursor:pointer;\n    padding:0 0.5em;\n}\n.style-toolbar input[type="number"]{\n    width:3.5em;\n}\n.style-toolbar .colorpicker-row.hidden{\n    display:none;\n}\n.style-toolbar .colorpicker-row{\n    display:grid;\n    grid-template-columns:repeat(4,auto)\n}\n.style-toolbar .preview{\n    position:relative;\n    display:block;\n    background: repeating-conic-gradient(#d0d0d0 0% 25%, white 0% 50%) \n              50% / 20px 20px\n}\n.style-toolbar .preview::after{\n    /* This is just so the height is set correctly since children are absolute positioned */\n    content:\'Preview\';\n    visibility:hidden;\n}\n.style-toolbar .preview .bg{\n    display:block;\n    position:absolute;\n    outline:thin solid black;\n    top:0;\n    left:0;\n    bottom:0;\n    right:0;\n}\n.style-toolbar .preview .text{\n    display:block;\n    position:absolute;\n    padding:0 0.2em;\n}\n.style-toolbar input[type="range"]{\n    display:inline-block;\n}\n\n/* end style-toolbar styles */\n\n\n.new-feature,.new-feature-collection{\n    cursor:pointer;\n}\n.new-feature:hover,.new-feature-collection:hover{\n    background-color:antiquewhite;\n    outline:thin gray solid;\n}\n/* Annotation UI File Dialog Styles*/\n.annotation-ui-filedialog{\n    display:grid;\n    grid-template-columns: auto auto auto;\n}\n.annotation-ui-filedialog>div{\n    padding: 0 0.3em;\n}\n.annotation-ui-filedialog .featurecollection-selection{\n    border-right:thin gray solid;\n    border-left:thin gray solid;\n    width:15em;\n    overflow-x:hidden;\n}\n.annotation-ui-filedialog .featurecollection-list{\n    display:flex;\n    flex-direction:column;\n    overflow:auto;\n}\n.annotation-ui-filedialog .localstorage-key-list::before{\n    content:\'Saved in local storage:\';\n    display:block;\n    color:gray;\n}\n.annotation-ui-filedialog .localstorage-key-list:empty::after{\n    content:\'No items were found in local storage\';\n    font-style:italic;\n    color:gray;\n}\n.annotation-ui-filedialog .localstorage-key{\n    cursor:pointer;\n}\n.annotation-ui-filedialog .localstorage-key:hover{\n    background-color:lightgoldenrodyellow;\n}\n.annotation-ui-filedialog .localstorage-key-test.key-exists::after{\n    content: \'(overwrite)\';\n    font-weight:bold;\n    background-color:rgb(190, 99, 66);\n    color:white;\n    padding:0 0.2em;\n}\n.annotation-ui-filedialog .finalize-panel{\n    width:15em;\n    overflow-x:hidden;\n}\n.annotation-ui-filedialog .header{\n    white-space: nowrap;\n    border-bottom:thin gray solid;\n    padding-bottom:2px;\n    margin-bottom:2px;\n}\n.annotation-ui-filedialog button{\n    display:block;\n}\n\n.annotation-ui-filedialog .file-actions{\n    display:flex;\n    flex-direction:column;\n}\n.annotation-ui-filedialog .file-actions hr{\n    margin: 5px 0;\n}\n\nbutton[disabled]{\n    opacity:0.3;\n}\n\n.dropdown button[data-action="erase"].active{\n    background-color:rgb(187, 86, 86);\n\n}\n.feature .bounding-element{\n    margin-right:-1.2em;\n}\n.feature .bounding-element:not(.active){\n    visibility:visible;\n    color:lightgray;\n}\n.feature .bounding-element.active{\n    visibility:visible;\n    color:black;\n}\n.feature:not(:hover) .bounding-element:not(.active){\n    visibility:hidden;\n}\n\n.hidden{\n    display:none;\n}\n\n.draganddrop-dragging{\n    opacity:0.3;\n}\n.draganddrop-hide{\n    display:none;\n}\n.draganddrop-drop-target{\n    outline:thick rgb(112, 111, 111) solid;\n}\n.draganddrop-drop-target:hover{\n    outline-color:black;\n}\n.draganddrop-drop-target>*>*{\n    pointer-events:none;\n}\n.draganddrop-placeholder{\n    border: thin black solid;\n    border-radius:2px;\n}\n.draganddrop-placeholder>*{\n    visibility:hidden;\n}\n\n/* From bootstrap */\ninput[type=range] {\n    display: block;\n    width: 100%;\n}\n.btn {\n    display: inline-block;\n    padding: 2px 8px;\n    margin-bottom: 0;\n    font-size: 14px;\n    /* font-weight: 400; */\n    /* line-height: 1.42857143; */\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    /* -ms-touch-action: manipulation;\n    touch-action: manipulation; */\n    cursor: pointer;\n    /* -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none; */\n    user-select: none;\n    background-image: none;\n    border: 1px solid transparent;\n    /* border-radius: 4px; */\n}\n.btn.btn-sm{\n    font-size:12px;\n}\n\n.icon {\n    width: 1em;\n    height: 1em;\n    vertical-align: -0.125em;\n}\n/* Items with [data-action] are supposed to be clickable but if the sub-object gets the click it doesn\'t work, so stop pointer events on children */\n[data-action]>*{\n    pointer-events:none;\n}\n\n.rotate-by{\n    transform:rotate(var(--rotate-angle));\n}'],sourceRoot:""}]);const a=s},676:(t,e,n)=>{"use strict";n.d(e,{A:()=>a});var i=n(354),o=n.n(i),r=n(314),s=n.n(r)()(o());s.push([t.id,'/**\n * OpenSeadragon paperjs overlay plugin based on paper.js\n * @version 0.4.13\n * \n * Includes additional open source libraries which are subject to copyright notices\n * as indicated accompanying those segments of code.\n * \n * Original code:\n * Copyright (c) 2022-2024, Thomas Pearce\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n * \n * * Redistributions of source code must retain the above copyright notice, this\n *   list of conditions and the following disclaimer.\n * \n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * \n * * Neither the name of osd-paperjs-annotation nor the names of its\n *   contributors may be used to endorse or promote products derived from\n *   this software without specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n * \n */\n.editablecontent{\n    display:grid;\n    grid-template-columns:1fr auto;\n}\n.editablecontent:not(.editing){\n    cursor:default;\n}\n\n.editablecontent>.edit-button{\n    margin-left:0.2em;\n    cursor:pointer;\n}\n.editablecontent:not(:hover) .onhover{\n    visibility:hidden;\n}\n.editablecontent.editing .text-content{\n    display: none;\n}\n.editablecontent.editing textarea{\n    display:block;\n}\n.editablecontent:not(.editing) textarea{\n    display:none;\n}\n\n.editablecontent .text-content{\n    display:inline-block;\n    position:relative;\n}\n.editablecontent svg *{\n    pointer-events: none;\n}\n.editablecontent textarea{\n    resize:none;\n    width:100%;\n    padding:0;\n    margin:0;\n    border:none;\n    outline:thin black solid;\n    font-weight: inherit;\n    font-size: inherit;\n    font-family: inherit;\n}',"",{version:3,sources:["webpack://./src/css/editablecontent.css"],names:[],mappings:"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAoCE;AACF;IACI,YAAY;IACZ,8BAA8B;AAClC;AACA;IACI,cAAc;AAClB;;AAEA;IACI,iBAAiB;IACjB,cAAc;AAClB;AACA;IACI,iBAAiB;AACrB;AACA;IACI,aAAa;AACjB;AACA;IACI,aAAa;AACjB;AACA;IACI,YAAY;AAChB;;AAEA;IACI,oBAAoB;IACpB,iBAAiB;AACrB;AACA;IACI,oBAAoB;AACxB;AACA;IACI,WAAW;IACX,UAAU;IACV,SAAS;IACT,QAAQ;IACR,WAAW;IACX,wBAAwB;IACxB,oBAAoB;IACpB,kBAAkB;IAClB,oBAAoB;AACxB",sourcesContent:['/**\n * OpenSeadragon paperjs overlay plugin based on paper.js\n * @version 0.4.13\n * \n * Includes additional open source libraries which are subject to copyright notices\n * as indicated accompanying those segments of code.\n * \n * Original code:\n * Copyright (c) 2022-2024, Thomas Pearce\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n * \n * * Redistributions of source code must retain the above copyright notice, this\n *   list of conditions and the following disclaimer.\n * \n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * \n * * Neither the name of osd-paperjs-annotation nor the names of its\n *   contributors may be used to endorse or promote products derived from\n *   this software without specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n * \n */\n.editablecontent{\n    display:grid;\n    grid-template-columns:1fr auto;\n}\n.editablecontent:not(.editing){\n    cursor:default;\n}\n\n.editablecontent>.edit-button{\n    margin-left:0.2em;\n    cursor:pointer;\n}\n.editablecontent:not(:hover) .onhover{\n    visibility:hidden;\n}\n.editablecontent.editing .text-content{\n    display: none;\n}\n.editablecontent.editing textarea{\n    display:block;\n}\n.editablecontent:not(.editing) textarea{\n    display:none;\n}\n\n.editablecontent .text-content{\n    display:inline-block;\n    position:relative;\n}\n.editablecontent svg *{\n    pointer-events: none;\n}\n.editablecontent textarea{\n    resize:none;\n    width:100%;\n    padding:0;\n    margin:0;\n    border:none;\n    outline:thin black solid;\n    font-weight: inherit;\n    font-size: inherit;\n    font-family: inherit;\n}'],sourceRoot:""}]);const a=s},314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,o,r){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var h=0;h<t.length;h++){var c=[].concat(t[h]);i&&s[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),e.push(c))}},e}},354:t=>{"use strict";t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),r="/*# ".concat(o," */");return[e].concat([r]).join("\n")}return[e].join("\n")}},292:function(t,e,n){var i,o;(function(r,s){var a=(r=r||n(965)).window,l=r.document,h=new function(){function t(t,e,n){var i;return t&&((i=r(t,"length"))&&"number"==typeof i.value?l:function(t,e){for(var n in this)this.hasOwnProperty(n)&&t.call(e,this[n],n,this)}).call(t,e,n=n||t),n}var e=/^(statics|enumerable|beans|preserve)$/,n=[],i=n.slice,o=Object.create,r=Object.getOwnPropertyDescriptor,a=Object.defineProperty,l=n.forEach||function(t,e){for(var n=0,i=this.length;n<i;n++)t.call(e,this[n],n,this)},h=Object.assign||function(t){for(var e=1,n=arguments.length;e<n;e++){var i,o=arguments[e];for(i in o)o.hasOwnProperty(i)&&(t[i]=o[i])}return t};function c(t,n,i,o,s){var l={};function h(e,h){var c,d="function"==typeof(h="string"==typeof(h=h||(h=r(n,e))&&(h.get?h:h.value))&&"#"===h[0]&&t[h.substring(1)]||h),p=h,g=s||d&&!h.base?h&&h.get?e in t:t[e]:null;s&&g||(d&&g&&(h.base=g),d&&!1!==o&&(c=e.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(l[c[3].toLowerCase()+c[4]]=c[2]),p&&!d&&p.get&&"function"==typeof p.get&&u.isPlainObject(p)||(p={value:p,writable:!0}),(r(t,e)||{configurable:!0}).configurable&&(p.configurable=!0,p.enumerable=null!=i?i:!c),a(t,e,p))}if(n){for(var c in n)n.hasOwnProperty(c)&&!e.test(c)&&h(c);for(var c in l){var d=l[c],p=t["set"+d];!(d=t["get"+d]||p&&t["is"+d])||!0!==o&&0!==d.length||h(c,{get:d,set:p})}}return t}function u(){for(var t=0,e=arguments.length;t<e;t++){var n=arguments[t];n&&h(this,n)}return this}return c(u,{inject:function(t){var e,n,i;t&&(e=!0===t.statics?t:t.statics,n=t.beans,i=t.preserve,e!==t&&c(this.prototype,t,t.enumerable,n,i),c(this,e,null,n,i));for(var o=1,r=arguments.length;o<r;o++)this.inject(arguments[o]);return this},extend:function(){for(var t,e,n,i=this,r=0,s=arguments.length;r<s&&(!t||!e);r++)n=arguments[r],t=t||n.initialize,e=e||n.prototype;return e=(t=t||function(){i.apply(this,arguments)}).prototype=e||o(this.prototype),a(e,"constructor",{value:t,writable:!0,configurable:!0}),c(t,this),arguments.length&&this.inject.apply(t,arguments),t.base=i,t}}).inject({enumerable:!1,initialize:u,set:u,inject:function(){for(var t=0,e=arguments.length;t<e;t++){var n=arguments[t];n&&c(this,n,n.enumerable,n.beans,n.preserve)}return this},extend:function(){var t=o(this);return t.inject.apply(t,arguments)},each:function(e,n){return t(this,e,n)},clone:function(){return new this.constructor(this)},statics:{set:h,each:t,create:o,define:a,describe:r,clone:function(t){return h(new t.constructor,t)},isPlainObject:function(t){return(t=null!=t&&t.constructor)&&(t===Object||t===u||"Object"===t.name)},pick:function(t,e){return t!==s?t:e},slice:function(t,e,n){return i.call(t,e,n)}}})};t.exports=h,h.inject({enumerable:!1,toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+h.each(this,(function(t,e){/^_/.test(e)||this.push(e+": "+("number"==(e=typeof t)?g.instance.number(t):"string"==e?"'"+t+"'":t))}),[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(t){return h.importJSON(t,this)},exportJSON:function(t){return h.exportJSON(this,t)},toJSON:function(){return h.serialize(this)},set:function(t,e){return t&&h.filter(this,t,e,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function t(){var e=t.base.apply(this,arguments),n=e.prototype._class;return n&&!h.exports[n]&&(h.exports[n]=e),e},equals:function(t,e){if(t===e)return!0;if(t&&t.equals)return t.equals(e);if(e&&e.equals)return e.equals(t);if(t&&e&&"object"==typeof t&&"object"==typeof e){if(Array.isArray(t)&&Array.isArray(e)){if((n=t.length)!==e.length)return!1;for(;n--;)if(!h.equals(t[n],e[n]))return!1}else{var n,i=Object.keys(t);if((n=i.length)!==Object.keys(e).length)return!1;for(;n--;){var o=i[n];if(!e.hasOwnProperty(o)||!h.equals(t[o],e[o]))return!1}}return!0}return!1},read:function(t,e,n,i){if(this===h){var o=this.peek(t,e);return t.__index++,o}var r=this.prototype,a=r._readIndex,l=e||a&&t.__index||0;return o=t.length,i=i||o-l,(e=t[l])instanceof this||n&&n.readNull&&null==e&&i<=1?(a&&(t.__index=l+1),e&&n&&n.clone?e.clone():e):(e=h.create(r),a&&(e.__read=!0),e=e.initialize.apply(e,0<l||l+i<o?h.slice(t,l,l+i):t)||e,a&&(t.__index=l+e.__read,(l=e.__filtered)&&(t.__filtered=l,e.__filtered=s),e.__read=s),e)},peek:function(t,e){return t[t.__index=e||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readList:function(t,e,n,i){for(var o,r=[],s=(e=e||0,i?e+i:t.length),a=e;a<s;a++)r.push(Array.isArray(o=t[a])?this.read(o,0,n):this.read(t,a,n,1));return r},readNamed:function(t,e,n,i,o){var r,a,l=this.getNamed(t,e),c=l!==s;return c&&((a=t.__filtered)||(r=this.getSource(t),(a=t.__filtered=h.create(r)).__unfiltered=r),a[e]=s),this.read(c?[l]:t,n,i,o)},readSupported:function(t,e){var n=this.getSource(t),i=this,o=!1;return n&&Object.keys(n).forEach((function(n){var r;n in e&&((r=i.readNamed(t,n))!==s&&(e[n]=r),o=!0)})),o},getSource:function(t){var e,n=t.__source;return n===s&&(e=1===t.length&&t[0],n=t.__source=e&&h.isPlainObject(e)?e:null),n},getNamed:function(t,e){var n=this.getSource(t);if(n)return e?n[e]:t.__filtered||n},hasNamed:function(t,e){return!!this.getNamed(t,e)},filter:function(t,e,n,i){var o;function r(i){var r;n&&i in n||o&&i in o||(r=e[i])!==s&&(t[i]=r)}if(i){for(var a,l={},h=0,c=i.length;h<c;h++)(a=i[h])in e&&(r(a),l[a]=!0);o=l}return Object.keys(e.__unfiltered||e).forEach(r),t},isPlainValue:function(t,e){return h.isPlainObject(t)||Array.isArray(t)||e&&"string"==typeof t},serialize:function(t,e,n,i){e=e||{};var o=!i;if(o&&(e.formatter=new g(e.precision),i={length:0,definitions:{},references:{},add:function(t,e){var n="#"+t._id,i=this.references[n];return i||(this.length++,e=e.call(t),(t=t._class)&&e[0]!==t&&e.unshift(t),this.definitions[n]=e,i=this.references[n]=[n]),i}}),t&&t._serialize){var r=t._serialize(e,i),s=t._class;!s||t._compactSerialize||!o&&n||r[0]===s||r.unshift(s)}else if(Array.isArray(t)){r=[];for(var a=0,l=t.length;a<l;a++)r[a]=h.serialize(t[a],e,n,i)}else if(h.isPlainObject(t)){r={};var c=Object.keys(t);for(a=0,l=c.length;a<l;a++){var u=c[a];r[u]=h.serialize(t[u],e,n,i)}}else r="number"==typeof t?e.formatter.number(t,e.precision):t;return o&&0<i.length?[["dictionary",i.definitions],r]:r},deserialize:function(t,e,n,i,o){var r=t,s=!n,a=s&&t&&t.length&&"dictionary"===t[0][0];if(n=n||{},Array.isArray(t)){var l=t[0],c="dictionary"===l;if(1==t.length&&/^#/.test(l))return n.dictionary[l];r=[];for(var u,d=(l=h.exports[l])?1:0,p=t.length;d<p;d++)r.push(h.deserialize(t[d],e,n,c,a));l&&(u=r,r=e?e(l,u,s||o):new l(u))}else if(h.isPlainObject(t))for(var g in r={},i&&(n.dictionary=r),t)r[g]=h.deserialize(t[g],e,n);return a?r[1]:r},exportJSON:function(t,e){return t=h.serialize(t,e),e&&0==e.asString?t:JSON.stringify(t)},importJSON:function(t,e){return h.deserialize("string"==typeof t?JSON.parse(t):t,(function(t,n,i){var o=i&&e&&e.constructor===t,r=o?e:h.create(t.prototype);return!(1===n.length&&r instanceof S)||!o&&r instanceof k||(i=n[0],h.isPlainObject(i)&&(i.insert=!1,o&&(n=n.concat([S.INSERT])))),(o?r.set:t).apply(r,n),o&&(e=null),r}))},push:function(t,e){var n=e.length;if(n<4096)t.push.apply(t,e);else{var i=t.length;t.length+=n;for(var o=0;o<n;o++)t[i+o]=e[o]}return t},splice:function(t,e,n,i){var o=e&&e.length,r=n===s;(n=r?t.length:n)>t.length&&(n=t.length);for(var a=0;a<o;a++)e[a]._index=n+a;if(r)return h.push(t,e),[];i=[n,i],e&&h.push(i,e);for(var l=t.splice.apply(t,i),c=(a=0,l.length);a<c;a++)l[a]._index=s;for(a=n+o,c=t.length;a<c;a++)t[a]._index=a;return l},capitalize:function(t){return t.replace(/\b[a-z]/g,(function(t){return t.toUpperCase()}))},camelize:function(t){return t.replace(/-(.)/g,(function(t,e){return e.toUpperCase()}))},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var c={on:function(t,e){var n,i;return"string"!=typeof t?h.each(t,(function(t,e){this.on(e,t)}),this):(n=(i=this._eventTypes)&&i[t],-1===(i=(i=this._callbacks=this._callbacks||{})[t]=i[t]||[]).indexOf(e)&&(i.push(e),n&&n.install&&1===i.length&&n.install.call(this,t))),this},off:function(t,e){if("string"==typeof t){var n,i,o=(i=this._eventTypes)&&i[t];return(i=this._callbacks&&this._callbacks[t])&&(!e||-1!==(n=i.indexOf(e))&&1===i.length?(o&&o.uninstall&&o.uninstall.call(this,t),delete this._callbacks[t]):-1!==n&&i.splice(n,1)),this}h.each(t,(function(t,e){this.off(e,t)}),this)},once:function(t,e){return this.on(t,(function n(){e.apply(this,arguments),this.off(t,n)}))},emit:function(t,e){if(!(o=this._callbacks&&this._callbacks[t]))return!1;var n=h.slice(arguments,1),i=e&&e.target&&!e.currentTarget,o=o.slice();i&&(e.currentTarget=this);for(var r=0,s=o.length;r<s;r++)if(0==o[r].apply(this,n)){e&&e.stop&&e.stop();break}return i&&delete e.currentTarget,!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var e,n=this._eventTypes,i=this._callbacks,o=t?"install":"uninstall";if(n)for(var r in i)0<i[r].length&&(e=(e=n[r])&&e[o])&&e.call(this,r)},statics:{inject:function t(e){var n,i=e._events;return i&&(n={},h.each(i,(function(t,i){var o="string"==typeof t,r=o?t:i,s=(i=h.capitalize(r),r.substring(2).toLowerCase());n[s]=o?{}:t,r="_"+r,e["get"+i]=function(){return this[r]},e["set"+i]=function(t){var e=this[r];e&&this.off(s,e),t&&this.on(s,t),this[r]=t}})),e._eventTypes=n),t.base.apply(this,arguments)}}},u=h.extend({_class:"PaperScope",initialize:function t(){(jt=this).settings=new h({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=t._id++,t._scopes[this._id]=this;var e,n,i,o=t.prototype;this.support||(n=dt.getContext(1,1)||{},o.support={nativeDash:"setLineDash"in n||"mozDash"in n,nativeBlendModes:pt.nativeModes},dt.release(n)),this.agent||(e=r.navigator.userAgent.toLowerCase(),n=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(e)||[])[0],i=o.agent=o.browser={platform:n="darwin"===n?"mac":n},n&&(i[n]=!0),e.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,(function(t,e,n,o,r){i.chrome||(n="opera"===e?o:/^(node|trident)$/.test(e)?r:n,i.version=n,i.versionNumber=parseFloat(n),i.name=e={trident:"msie",jsdom:"node"}[e]||e,i[e]=!0)})),i.chrome&&delete i.webkit,i.atom&&delete i.chrome)},version:"0.12.17",getView:function(){var t=this.project;return t&&t._view},getPaper:function(){return this},execute:function(t,e){},install:function(t){var e,n=this;for(e in h.each(["project","view","tool"],(function(e){h.define(t,e,{configurable:!0,get:function(){return n[e]}})})),this)!/^_/.test(e)&&this[e]&&(t[e]=this[e])},setup:function(t){return(jt=this).project=new I(t),this},createCanvas:function(t,e){return dt.getCanvas(t,e)},activate:function(){jt=this},clear:function(){for(var t=this.projects,e=this.tools,n=t.length-1;0<=n;n--)t[n].remove();for(n=e.length-1;0<=n;n--)e[n].remove()},remove:function(){this.clear(),delete u._scopes[this._id]},statics:new function(){function t(t){return t+="Attribute",function(e,n){return e[t](n)||e[t]("data-paper-"+n)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),d=h.extend(c,{initialize:function(t){this._scope=jt,this._index=this._scope[this._list].push(this)-1,!t&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];return t&&t!==this&&t.emit("deactivate"),(this._scope[this._reference]=this).emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(h.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),!(this._scope=null))},getView:function(){return this._scope.getView()}}),p={findItemBoundsCollisions:function(t,e,n){function i(t){for(var e=new Array(t.length),n=0;n<t.length;n++){var i=t[n].getBounds();e[n]=[i.left,i.top,i.right,i.bottom]}return e}var o=i(t);return e=e&&e!==t?i(e):o,this.findBoundsCollisions(o,e,n||0)},findCurveBoundsCollisions:function(t,e,n,i){function o(t){for(var e=Math.min,n=Math.max,i=new Array(t.length),o=0;o<t.length;o++){var r=t[o];i[o]=[e(r[0],r[2],r[4],r[6]),e(r[1],r[3],r[5],r[7]),n(r[0],r[2],r[4],r[6]),n(r[1],r[3],r[5],r[7])]}return i}var r=o(t);if(e=e&&e!==t?o(e):r,i){for(var s=this.findBoundsCollisions(r,e,n||0,!1,!0),a=this.findBoundsCollisions(r,e,n||0,!0,!0),l=[],h=0,c=s.length;h<c;h++)l[h]={hor:s[h],ver:a[h]};return l}return this.findBoundsCollisions(r,e,n||0)},findBoundsCollisions:function(t,e,n,i,o){var r=!e||t===e,s=r?t:t.concat(e),a=t.length,l=s.length;function h(t,e,n){for(var i=0,o=t.length;i<o;){var r=o+i>>>1;s[t[r]][e]<n?i=1+r:o=r}return i-1}for(var c=i?1:0,u=2+c,d=i?0:1,p=2+d,g=new Array(l),f=0;f<l;f++)g[f]=f;g.sort((function(t,e){return s[t][c]-s[e][c]}));var m=[],v=new Array(a);for(f=0;f<l;f++){var _=g[f],y=s[_],w=r?_:_-a,A=_<a,b=r||!A,C=A?[]:null;if(m.length){var x=h(m,u,y[c]-n)+1;if(m.splice(0,x),r&&o){C=C.concat(m);for(var I=0;I<m.length;I++)v[k=m[I]].push(w)}else{var S=y[p],T=y[d];for(I=0;I<m.length;I++){var k=m[I],P=s[k],E=k<a,O=r||a<=k;(o||(A&&O||b&&E)&&S>=P[d]-n&&T<=P[p]+n)&&(A&&O&&C.push(r?k:k-a),b&&E&&v[k].push(w))}}}A&&(t===e&&C.push(_),v[_]=C),m.length?(y=h(m,u,y[u]),m.splice(y+1,0,_)):m.push(_)}for(f=0;f<v.length;f++){var B=v[f];B&&B.sort((function(t,e){return t-e}))}return v}},g=h.extend({initialize:function(t){this.precision=h.pick(t,5),this.multiplier=Math.pow(10,this.precision)},number:function(t){return this.precision<16?Math.round(t*this.multiplier)/this.multiplier:t},pair:function(t,e,n){return this.number(t)+(n||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});g.instance=new g;var f=new function(){var t=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],e=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],n=Math.abs,i=Math.sqrt,o=Math.pow,r=Math.log2||function(t){return Math.log(t)*Math.LOG2E},s=1e-12,a=112e-18;function l(t,e,n){return t<e?e:n<t?n:t}function h(t,e,i){function o(t){var e;return[e=t-(e=134217729*t)+e,t-e]}var r,s,a=e*e-t*i,l=e*e+t*i;return 3*n(a)<l&&(r=o(t),s=o(e),l=o(i),a=(e*=e)-(i*=t)+(s[0]*s[0]-e+2*s[0]*s[1]+s[1]*s[1]-(r[0]*l[0]-i+r[0]*l[1]+r[1]*l[0]+r[1]*l[1]))),a}function c(){var t=Math.max.apply(Math,arguments);return t&&(t<1e-8||1e8<t)?o(2,-Math.round(r(t))):0}return{EPSILON:s,MACHINE_EPSILON:a,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,ANGULAR_EPSILON:1e-5,KAPPA:4*(i(2)-1)/3,isZero:function(t){return-s<=t&&t<=s},isMachineZero:function(t){return-a<=t&&t<=a},clamp:l,integrate:function(n,i,o,r){for(var s=t[r-2],a=e[r-2],l=.5*(o-i),h=l+i,c=0,u=r+1>>1,d=1&r?a[c++]*n(h):0;c<u;){var p=l*s[c];d+=a[c++]*(n(h+p)+n(h-p))}return l*d},findRoot:function(t,e,i,o,r,s,a){for(var h=0;h<s;h++){var c=t(i),u=c/e(i),d=i-u;if(n(u)<a){i=d;break}i=0<c?(r=i,d<=o?.5*(o+r):d):(o=i,r<=d?.5*(o+r):d)}return l(i,o,r)},solveQuadratic:function(t,e,o,r,u,d){var p,g=1/0;if(n(t)<s){if(n(e)<s)return n(o)<s?-1:0;p=-o/e}else{var f,m=h(t,e*=-.5,o);m&&n(m)<a&&(f=c(n(t),n(e),n(o)))&&(m=h(t*=f,e*=f,o*=f)),-a<=m&&(v=m<0?0:i(m),g=0===(_=e+(e<0?-v:v))?-(p=o/t):(p=_/t,o/_))}var v=0,_=(t=null==u,o=u-s,d+s);return isFinite(p)&&(t||o<p&&p<_)&&(r[v++]=t?p:l(p,u,d)),g!==p&&isFinite(g)&&(t||o<g&&g<_)&&(r[v++]=t?g:l(g,u,d)),v},solveCubic:function(t,e,r,h,u,d,p){var g,m,v,_,y,w=c(n(t),n(e),n(r),n(h));function A(n){n=t*(g=n),_=(n+(m=n+e))*g+(v=m*g+r),y=v*g+h}if(w&&(t*=w,e*=w,r*=w,h*=w),n(t)<s)t=e,m=r,v=h,g=1/0;else if(n(h)<s)m=e,v=r,g=0;else{A(-e/t/3);var b=o(n(x=y/t),1/3),C=x<0?-1:1,x=0<(x=-_/t)?1.324717957244746*Math.max(b,i(x)):b,I=g-C*x;if(I!==g){for(;A(I),C*g<C*(I=0===_?g:g-y/_/(1+a)););n(t)*g*g>n(h/g)&&(m=((v=-h/g)-r)/g)}}return b=f.solveQuadratic(t,m,v,u,d,p),x=null==d,isFinite(g)&&(0===b||0<b&&g!==u[0]&&g!==u[1])&&(x||d-s<g&&g<p+s)&&(u[b++]=x?g:l(g,d,p)),b}}},m={_id:1,_pools:{},get:function(t){if(t){var e=this._pools[t];return(e=e||(this._pools[t]={_id:1}))._id++}return this._id++}},v=h.extend({_class:"Point",_readIndex:!0,initialize:function(t,e){var n,i=typeof t,o=this.__read,r=0;return"number"==i?(this._set(t,(n="number"==typeof e)?e:t),o&&(r=n?2:1)):"undefined"==i||null===t?(this._set(0,0),o&&(r=null===t?1:0)):(t="string"==i?t.split(/[\s,]+/)||[]:t,r=1,Array.isArray(t)?this._set(+t[0],+(1<t.length?t[1]:t[0])):"x"in t?this._set(t.x||0,t.y||0):"width"in t?this._set(t.width||0,t.height||0):"angle"in t?(this._set(t.length||0,0),this.setAngle(t.angle||0)):(this._set(0,0),r=0)),o&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new v(this.x,this.y)},toString:function(){var t=g.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){return[(t=t.formatter).number(this.x),t.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){var e;this.isZero()?(e=this._angle||0,this._set(Math.cos(e)*t,Math.sin(e)*t)):(t/=this.getLength(),f.isZero(t)&&this.getAngle(),this._set(this.x*t,this.y*t))},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=v.read(arguments),e=this.getLength()*t.getLength();return f.isZero(e)?NaN:(e=this.dot(t)/e,Math.acos(e<-1?-1:1<e?1:e))}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){var e;this._angle=t,this.isZero()||(e=this.getLength(),this._set(Math.cos(t)*e,Math.sin(t)*e))},getQuadrant:function(){return 0<=this.x?0<=this.y?1:4:0<=this.y?2:3}},{beans:!1,getDirectedAngle:function(){var t=v.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=arguments,e=(n=v.read(t)).x-this.x,n=e*e+(n=n.y-this.y)*n;return h.read(t)?n:Math.sqrt(n)},normalize:function(t){t===s&&(t=1),t=0!==(e=this.getLength())?t/e:0;var e=new v(this.x*t,this.y*t);return 0<=t&&(e._angle=this._angle),e},rotate:function(t,e){if(0===t)return this.clone();t=t*Math.PI/180;var n=e?this.subtract(e):this,i=Math.sin(t);return t=Math.cos(t),n=new v(n.x*t-n.y*i,n.x*i+n.y*t),e?n.add(e):n},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=v.read(arguments);return new v(this.x+t.x,this.y+t.y)},subtract:function(){var t=v.read(arguments);return new v(this.x-t.x,this.y-t.y)},multiply:function(){var t=v.read(arguments);return new v(this.x*t.x,this.y*t.y)},divide:function(){var t=v.read(arguments);return new v(this.x/t.x,this.y/t.y)},modulo:function(){var t=v.read(arguments);return new v(this.x%t.x,this.y%t.y)},negate:function(){return new v(-this.x,-this.y)},isInside:function(){return A.read(arguments).contains(this)},isClose:function(){var t=arguments,e=v.read(t);return t=h.read(t),this.getDistance(e)<=t},isCollinear:function(){var t=v.read(arguments);return v.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=v.read(arguments);return v.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){var t=f.isZero;return t(this.x)&&t(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(t){return 0<=this.x*(1<t&&t<4?-1:1)&&0<=this.y*(2<t?-1:1)},dot:function(){var t=v.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=v.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=v.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new v(t.x*e,t.y*e)},statics:{min:function(){var t=arguments,e=v.read(t);return t=v.read(t),new v(Math.min(e.x,t.x),Math.min(e.y,t.y))},max:function(){var t=arguments,e=v.read(t);return t=v.read(t),new v(Math.max(e.x,t.x),Math.max(e.y,t.y))},random:function(){return new v(Math.random(),Math.random())},isCollinear:function(t,e,n,i){return Math.abs(t*i-e*n)<=1e-8*Math.sqrt((t*t+e*e)*(n*n+i*i))},isOrthogonal:function(t,e,n,i){return Math.abs(t*n+e*i)<=1e-8*Math.sqrt((t*t+e*e)*(n*n+i*i))}}},h.each(["round","ceil","floor","abs"],(function(t){var e=Math[t];this[t]=function(){return new v(e(this.x),e(this.y))}}),{})),_=v.extend({initialize:function(t,e,n,i){this._x=t,this._y=e,this._owner=n,this._setter=i},_set:function(t,e,n){return this._x=t,this._y=e,n||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),y=h.extend({_class:"Size",_readIndex:!0,initialize:function(t,e){var n,i=typeof t,o=this.__read,r=0;return"number"==i?(this._set(t,(n="number"==typeof e)?e:t),o&&(r=n?2:1)):"undefined"==i||null===t?(this._set(0,0),o&&(r=null===t?1:0)):(t="string"==i?t.split(/[\s,]+/)||[]:t,r=1,Array.isArray(t)?this._set(+t[0],+(1<t.length?t[1]:t[0])):"width"in t?this._set(t.width||0,t.height||0):"x"in t?this._set(t.x||0,t.y||0):(this._set(0,0),r=0)),o&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.width=t,this.height=e,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new y(this.width,this.height)},toString:function(){var t=g.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){return[(t=t.formatter).number(this.width),t.number(this.height)]},add:function(){var t=y.read(arguments);return new y(this.width+t.width,this.height+t.height)},subtract:function(){var t=y.read(arguments);return new y(this.width-t.width,this.height-t.height)},multiply:function(){var t=y.read(arguments);return new y(this.width*t.width,this.height*t.height)},divide:function(){var t=y.read(arguments);return new y(this.width/t.width,this.height/t.height)},modulo:function(){var t=y.read(arguments);return new y(this.width%t.width,this.height%t.height)},negate:function(){return new y(-this.width,-this.height)},isZero:function(){var t=f.isZero;return t(this.width)&&t(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,e){return new y(Math.min(t.width,e.width),Math.min(t.height,e.height))},max:function(t,e){return new y(Math.max(t.width,e.width),Math.max(t.height,e.height))},random:function(){return new y(Math.random(),Math.random())}}},h.each(["round","ceil","floor","abs"],(function(t){var e=Math[t];this[t]=function(){return new y(e(this.width),e(this.height))}}),{})),w=y.extend({initialize:function(t,e,n,i){this._width=t,this._height=e,this._owner=n,this._setter=i},_set:function(t,e,n){return this._width=t,this._height=e,n||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),A=h.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(t,e,n,i){var o,r,a,l,c,u,d=arguments,p=typeof t;return"number"==p?(this._set(t,e,n,i),o=4):"undefined"==p||null===t?(this._set(0,0,0,0),o=null===t?1:0):1===d.length&&(Array.isArray(t)?(this._set.apply(this,t),o=1):t.x!==s||t.width!==s?(this._set(t.x||0,t.y||0,t.width||0,t.height||0),o=1):t.from===s&&t.to===s&&(this._set(0,0,0,0),h.readSupported(d,this)&&(o=1))),o===s&&(a=v.readNamed(d,"from"),r=h.peek(d),p=a.x,a=a.y,r&&r.x!==s||h.hasNamed(d,"to")?(l=(u=v.readNamed(d,"to")).x-p,c=u.y-a,l<0&&(p=u.x,l=-l),c<0&&(a=u.y,c=-c)):(l=(u=y.read(d)).width,c=u.height),this._set(p,a,l,c),o=d.__index),(d=d.__filtered)&&(this.__filtered=d),this.__read&&(this.__read=o),this},set:"#initialize",_set:function(t,e,n,i){return this.x=t,this.y=e,this.width=n,this.height=i,this},clone:function(){return new A(this.x,this.y,this.width,this.height)},equals:function(t){var e=h.isPlainValue(t)?A.read(arguments):t;return e===this||e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height||!1},toString:function(){var t=g.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){return[(t=t.formatter).number(this.x),t.number(this.y),t.number(this.width),t.number(this.height)]},getPoint:function(t){return new(t?v:_)(this.x,this.y,this,"setPoint")},setPoint:function(){var t=v.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){return new(t?y:w)(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var t=y.read(arguments),e=this._sx,n=this._sy,i=t.width;t=t.height,e&&(this.x+=(this.width-i)*e),n&&(this.y+=(this.height-t)*n),this.width=i,this.height=t,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(t){var e;this._fw||(e=t-this.x,this.width-=.5===this._sx?2*e:e),this.x=t,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(t){var e;this._fh||(e=t-this.y,this.height-=.5===this._sy?2*e:e),this.y=t,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(t){var e;this._fw||(e=t-this.x,this.width=.5===this._sx?2*e:e),this.x=t-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(t){var e;this._fh||(e=t-this.y,this.height=.5===this._sy?2*e:e),this.y=t-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(t){this._fw||.5===this._sx?this.x=t-this.width/2:(this._sx&&(this.x+=2*(t-this.x)*this._sx),this.width=2*(t-this.x)),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(t){this._fh||.5===this._sy?this.y=t-this.height/2:(this._sy&&(this.y+=2*(t-this.y)*this._sy),this.height=2*(t-this.y)),this._sy=.5,this._fh=0},getCenter:function(t){return new(t?v:_)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=v.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(t){return t&&t.width!==s||4===(Array.isArray(t)?t:arguments).length?this._containsRectangle(A.read(arguments)):this._containsPoint(v.read(arguments))},_containsPoint:function(t){var e=t.x;return t=t.y,e>=this.x&&t>=this.y&&e<=this.x+this.width&&t<=this.y+this.height},_containsRectangle:function(t){var e=t.x,n=t.y;return e>=this.x&&n>=this.y&&e+t.width<=this.x+this.width&&n+t.height<=this.y+this.height},intersects:function(){var t=A.read(arguments),e=h.read(arguments)||0;return t.x+t.width>this.x-e&&t.y+t.height>this.y-e&&t.x<this.x+this.width+e&&t.y<this.y+this.height+e},intersect:function(){var t=A.read(arguments),e=Math.max(this.x,t.x),n=Math.max(this.y,t.y),i=Math.min(this.x+this.width,t.x+t.width);return t=Math.min(this.y+this.height,t.y+t.height),new A(e,n,i-e,t-n)},unite:function(){var t=A.read(arguments),e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x+this.width,t.x+t.width);return t=Math.max(this.y+this.height,t.y+t.height),new A(e,n,i-e,t-n)},include:function(){var t=v.read(arguments),e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x+this.width,t.x);return t=Math.max(this.y+this.height,t.y),new A(e,n,i-e,t-n)},expand:function(){var t=(e=y.read(arguments)).width,e=e.height;return new A(this.x-t/2,this.y-e/2,this.width+t,this.height+e)},scale:function(t,e){return this.expand(this.width*t-this.width,this.height*(e===s?t:e)-this.height)}},h.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],(function(t,e){var n=t.join(""),i=/^[RL]/.test(n);4<=e&&(t[1]+=i?"Y":"X"),e=t[i?0:1],i=t[i?1:0];var o="get"+e,r="get"+i,s="set"+e,a="set"+i,l="set"+n;this["get"+n]=function(t){return new(t?v:_)(this[o](),this[r](),this,l)},this[l]=function(){var t=v.read(arguments);this[s](t.x),this[a](t.y)}}),{beans:!0})),b=A.extend({initialize:function(t,e,n,i,o,r){this._set(t,e,n,i,!0),this._owner=o,this._setter=r},_set:function(t,e,n,i,o){return this._x=t,this._y=e,this._width=n,this._height=i,o||this._owner[this._setter](this),this}},new function(){var t=A.prototype;return h.each(["x","y","width","height"],(function(t){var e=h.capitalize(t),n="_"+t;this["get"+e]=function(){return this[n]},this["set"+e]=function(t){this[n]=t,this._dontNotify||this._owner[this._setter](this)}}),h.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],(function(e){var n="set"+e;this[n]=function(){this._dontNotify=!0,t[n].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}}),{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(t){var e=this._owner;e._changeSelection&&e._changeSelection(2,t)}}))}),C=h.extend({_class:"Matrix",initialize:function t(e,n){var i=arguments,o=i.length,r=!0;if(6<=o?this._set.apply(this,i):1===o||2===o?e instanceof t?this._set(e._a,e._b,e._c,e._d,e._tx,e._ty,n):Array.isArray(e)?this._set.apply(this,n?e.concat([n]):e):r=!1:o?r=!1:this.reset(),!r)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(t,e,n,i,o,r,s){return this._a=t,this._b=e,this._c=n,this._d=i,this._tx=o,this._ty=r,s||this._changed(),this},_serialize:function(t,e){return h.serialize(this.getValues(),t,!0,e)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(25))},clone:function(){return new C(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty},toString:function(){var t=g.instance;return"[["+[t.number(this._a),t.number(this._c),t.number(this._tx)].join(", ")+"], ["+[t.number(this._b),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,e){var n=this._owner;return!!n&&(n.transform(null,h.pick(t,!0),e),this.isIdentity())},translate:function(){var t=(e=v.read(arguments)).x,e=e.y;return this._tx+=t*this._a+e*this._c,this._ty+=t*this._b+e*this._d,this._changed(),this},scale:function(){var t=arguments,e=v.read(t);return(t=v.read(t,0,{readNull:!0}))&&this.translate(t),this._a*=e.x,this._b*=e.x,this._c*=e.y,this._d*=e.y,t&&this.translate(t.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var e=(l=v.read(arguments,1)).x,n=l.y,i=Math.cos(t),o=Math.sin(t),r=e-e*i+n*o,s=n-e*o-n*i,a=this._a,l=this._b;return e=this._c,n=this._d,this._a=i*a+o*e,this._b=i*l+o*n,this._c=-o*a+i*e,this._d=-o*l+i*n,this._tx+=r*a+s*e,this._ty+=r*l+s*n,this._changed(),this},shear:function(){var t=arguments,e=v.read(t),n=v.read(t,0,{readNull:!0});n&&this.translate(n);var i=this._a;return t=this._b,this._a+=e.y*this._c,this._b+=e.y*this._d,this._c+=e.x*i,this._d+=e.x*t,n&&this.translate(n.negate()),this._changed(),this},skew:function(){var t=arguments,e=v.read(t),n=v.read(t,0,{readNull:!0});return t=Math.PI/180,t=new v(Math.tan(e.x*t),Math.tan(e.y*t)),this.shear(t,n)},append:function(t,e){var n,i,o,r,s,a,l,h,c;return t&&(n=this._a,i=this._b,o=this._c,r=this._d,s=t._a,a=t._c,l=t._b,h=t._d,c=t._tx,t=t._ty,this._a=s*n+l*o,this._c=a*n+h*o,this._b=s*i+l*r,this._d=a*i+h*r,this._tx+=c*n+t*o,this._ty+=c*i+t*r,e||this._changed()),this},prepend:function(t,e){var n,i,o,r,s,a,l,h,c,u,d;return t&&(n=this._a,i=this._b,o=this._c,r=this._d,s=this._tx,a=this._ty,l=t._a,h=t._c,c=t._b,u=t._d,d=t._tx,t=t._ty,this._a=l*n+h*i,this._c=l*o+h*r,this._b=c*n+u*i,this._d=c*o+u*r,this._tx=l*s+h*a+d,this._ty=c*s+u*a+t,e||this._changed()),this},appended:function(t){return this.clone().append(t)},prepended:function(t){return this.clone().prepend(t)},invert:function(){var t=this._a,e=this._b,n=this._c,i=this._d,o=this._tx,r=this._ty,s=t*i-e*n,a=null;return s&&!isNaN(s)&&isFinite(o)&&isFinite(r)&&(this._a=i/s,this._b=-e/s,this._c=-n/s,this._d=t/s,this._tx=(n*r-i*o)/s,this._ty=(e*o-t*r)/s,a=this),a},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new C(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var t=this._a*this._d-this._c*this._b;return t&&!isNaN(t)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(t,e,n){return arguments.length<3?this._transformPoint(v.read(arguments)):this._transformCoordinates(t,e,n)},_transformPoint:function(t,e,n){var i=t.x;return t=t.y,(e=e||new v)._set(i*this._a+t*this._c+this._tx,i*this._b+t*this._d+this._ty,n)},_transformCoordinates:function(t,e,n){for(var i=0,o=2*n;i<o;i+=2){var r=t[i],s=t[i+1];e[i]=r*this._a+s*this._c+this._tx,e[i+1]=r*this._b+s*this._d+this._ty}return e},_transformCorners:function(t){var e=t.x,n=t.y,i=e+t.width;return t=[e,n,i,n,i,t=n+t.height,e,t],this._transformCoordinates(t,t,4)},_transformBounds:function(t,e,n){for(var i=this._transformCorners(t),o=i.slice(0,2),r=o.slice(),s=2;s<8;s++){var a=i[s],l=1&s;a<o[l]?o[l]=a:a>r[l]&&(r[l]=a)}return(e=e||new A)._set(o[0],o[1],r[0]-o[0],r[1]-o[1],n)},inverseTransform:function(){return this._inverseTransform(v.read(arguments))},_inverseTransform:function(t,e,n){var i=this._a,o=this._b,r=this._c,s=this._d,a=this._tx,l=this._ty,h=i*s-o*r,c=null;return h&&!isNaN(h)&&isFinite(a)&&isFinite(l)&&(l=t.x-this._tx,t=t.y-this._ty,c=(e=e||new v)._set((l*s-t*r)/h,(t*i-l*o)/h,n)),c},decompose:function(){var t,e,n,i,o=this._a,r=this._b,s=this._c,a=this._d,l=o*a-r*s,h=Math.sqrt,c=Math.atan2,u=180/Math.PI;return i=0!==o||0!==r?(t=h(o*o+r*r),e=Math.acos(o/t)*(0<r?1:-1),n=[t,l/t],[c(o*s+r*a,t*t),0]):0!==s||0!==a?(i=h(s*s+a*a),e=Math.asin(s/i)*(0<a?1:-1),n=[l/i,i],[0,c(o*s+r*a,i*i)]):n=[e=0,0],{translation:this.getTranslation(),rotation:e*u,scaling:new v(n),skewing:new v(i[0]*u,i[1]*u)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new v(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(t){this.isIdentity()||t.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},h.each(["a","b","c","d","tx","ty"],(function(t){var e=h.capitalize(t),n="_"+t;this["get"+e]=function(){return this[n]},this["set"+e]=function(t){this[n]=t,this._changed()}}),{})),x=h.extend({_class:"Line",initialize:function(t,e,n,i,o){(4<=arguments.length?(this._px=t,this._py=e,this._vx=n,this._vy=i,o):(this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,n))||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new v(this._px,this._py)},getVector:function(){return new v(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return x.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return x.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(this.getSignedDistance(t))},getSignedDistance:function(t){return x.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0)},isCollinear:function(t){return v.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return v.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,n,i,o,r,s,a,l,h){if(l||(n-=t,i-=e,s-=o,a-=r),l=n*a-i*s,!f.isMachineZero(l)&&(a=(s*(r=e-r)-a*(o=t-o))/l,l=(n*r-i*o)/l,h||-1e-12<a&&a<1+1e-12&&-1e-12<l&&l<1+1e-12))return new v(t+(a=h?a:a<=0?0:1<=a?1:a)*n,e+a*i)},getSide:function(t,e,n,i,o,r,s,a){return s||(n-=t,i-=e),e=(t=o-t)*i-(r-e)*n,(e=!a&&f.isMachineZero(e)&&0<=(e=(t*n+t*n)/(n*n+i*i))&&e<=1?0:e)<0?-1:0<e?1:0},getSignedDistance:function(t,e,n,i,o,r,s){return s||(n-=t,i-=e),0===n?0<i?o-t:t-o:0===i?n<0?r-e:e-r:((o-t)*i-(r-e)*n)/(n<i?i*Math.sqrt(1+n*n/(i*i)):n*Math.sqrt(1+i*i/(n*n)))},getDistance:function(t,e,n,i,o,r,s){return Math.abs(x.getSignedDistance(t,e,n,i,o,r,s))}}}),I=d.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(t){d.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new J(null,null,this),this._view=ot.create(this,t||dt.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(t,e){return h.serialize(this._children,t,!0,e)},_changed:function(t,e){1&t&&(o=this._view)&&(o._needsUpdate=!0,!o._requested&&o._autoUpdate&&o.requestUpdate());var n,i,o,r=this._changes;r&&e&&((o=(n=this._changesById)[i=e._id])?o.flags|=t:r.push(n[i]={item:e,flags:t}))},clear:function(){for(var t=this._children,e=t.length-1;0<=e;e--)t[e].remove()},isEmpty:function(){return!this._children.length},remove:function t(){return!!t.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.set(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new k({project:this,insert:!0})},getSymbolDefinitions:function(){var t=[],e={};return this.getItems({class:O,match:function(n){var i=n._definition;return n=i._id,e[n]||(e[n]=!0,t.push(i)),!1}}),t},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var t,e=this._selectionItems,n=[];for(t in e){var i=e[t],o=i._selection;1&o&&i.isInserted()?n.push(i):o||this._updateSelection(i)}return n},_updateSelection:function(t){var e=t._id,n=this._selectionItems;t._selection?n[e]!==t&&(this._selectionCount++,n[e]=t):n[e]===t&&(this._selectionCount--,delete n[e])},selectAll:function(){for(var t=this._children,e=0,n=t.length;e<n;e++)t[e].setFullySelected(!0)},deselectAll:function(){var t,e=this._selectionItems;for(t in e)e[t].setFullySelected(!1)},addLayer:function(t){return this.insertLayer(s,t)},insertLayer:function(t,e){return e instanceof k?(e._remove(!1,!0),h.splice(this._children,[e],t,0),e._setProject(this,!0),(t=e._name)&&e.setName(t),this._changes&&e._changed(5),this._activeLayer||(this._activeLayer=e)):e=null,e},_insertItem:function(t,e,n){return e=this.insertLayer(t,e)||(this._activeLayer||this._insertItem(s,new k(S.NO_INSERT),!0)).insertChild(t,e),n&&e.activate&&e.activate(),e},getItems:function(t){return S._getItems(this,t)},getItem:function(t){return S._getItems(this,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var e=this._activeLayer;return h.importJSON(t,e&&e.isEmpty()&&e)},removeOn:function(t){var e=this._removeSets;if(e){"mouseup"===t&&(e.mousedrag=null);var n=e[t];if(n){for(var i in n){var o,r=n[i];for(o in e){var s=e[o];s&&s!=n&&delete s[r._id]}r.remove()}e[t]=null}}},draw:function(t,e,n){this._updateVersion++,t.save(),e.applyToContext(t);for(var i=this._children,o=new h({offset:new v(0,0),pixelRatio:n,viewMatrix:e.isIdentity()?null:e,matrices:[new C],updateMatrix:!0}),r=0,s=i.length;r<s;r++)i[r].draw(t,o);if(t.restore(),0<this._selectionCount){t.save(),t.strokeWidth=1;var a,l=this._selectionItems,c=this._scope.settings.handleSize,u=this._updateVersion;for(a in l)l[a]._drawSelection(t,e,c,l,u);t.restore()}}}),S=h.extend(c,{statics:{extend:function t(e){return e._serializeFields&&(e._serializeFields=h.set({},this.prototype._serializeFields,e._serializeFields)),t.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new C,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var t=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return h.each(t,(function(t){this._events[t]={install:function(t){this.getView()._countItemEvent(t,1)},uninstall:function(t){this.getView()._countItemEvent(t,-1)}}}),{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:t}})},{initialize:function(){},_initialize:function(t,e){var n=t&&h.isPlainObject(t),i=n&&!0===t.internal,o=this._matrix=new C,r=n&&t.project||jt.project,a=jt.settings;return this._id=i?null:m.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&a.applyMatrix,e&&o.translate(e),(o._owner=this)._style=new J(r._currentStyle,this,r),i||n&&0==t.insert||!a.insertItems&&(!n||1!=t.insert)?this._setProject(r):(n&&t.parent||r)._insertItem(s,this,!0),n&&t!==S.NO_INSERT&&t!==S.INSERT&&this.set(t,{internal:!0,insert:!0,project:!0,parent:!0}),n},_serialize:function(t,e){var n={},i=this;function o(o){for(var r in o){var s=i[r];h.equals(s,"leading"===r?1.2*o.fontSize:o[r])||(n[r]=h.serialize(s,t,"data"!==r,e))}}return o(this._serializeFields),this instanceof T||o(this._style._defaults),[this._class,n]},_changed:function(t){var e=this._symbol,n=this._parent||e,i=this._project;8&t&&(this._bounds=this._position=this._decomposed=s),16&t&&(this._globalMatrix=s),n&&72&t&&S._clearBoundsCache(n),2&t&&S._clearBoundsCache(this),i&&i._changed(t,this),e&&e._changed(t)},getId:function(){return this._id},getName:function(){return this._name},setName:function(t){if(this._name&&this._removeNamed(),t===+t+"")throw new Error("Names consisting only of numbers are not supported.");var e,n=this._getOwner();t&&n&&(e=n._children,((n=n._namedChildren)[t]=n[t]||[]).push(this),t in e||(e[t]=this)),this._name=t||s,this._changed(256)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},h.each(["locked","visible","blendMode","opacity","guide"],(function(t){var e=h.capitalize(t),n="_"+t,i={locked:256,visible:265};this["get"+e]=function(){return this[n]},this["set"+e]=function(e){e!=this[n]&&(this[n]=e,this._changed(i[t]||257))}}),{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(t){t!==this._selection&&(this._selection=t,(t=this._project)&&(t._updateSelection(this),this._changed(257)))},_changeSelection:function(t,e){var n=this._selection;this.setSelection(e?n|t:n&~t)},isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,n=t.length;e<n;e++)if(t[e].isSelected())return!0;return!!(1&this._selection)},setSelected:function(t){if(this._selectChildren)for(var e=this._children,n=0,i=e.length;n<i;n++)e[n].setSelected(t);this._changeSelection(1,t)},isFullySelected:function(){var t=this._children,e=!!(1&this._selection);if(t&&e){for(var n=0,i=t.length;n<i;n++)if(!t[n].isFullySelected())return!1;return!0}return e},setFullySelected:function(t){var e=this._children;if(e)for(var n=0,i=e.length;n<i;n++)e[n].setFullySelected(t);this._changeSelection(1,t)},isClipMask:function(){return this._clipMask},setClipMask:function(t){this._clipMask!=(t=!!t)&&((this._clipMask=t)&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(t){return new(t?v:_)((t=this._position||(this._position=this._getPositionFromBounds())).x,t.y,this,"setPosition")},setPosition:function(){this.translate(v.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(t){return this._pivot?this._matrix._transformPoint(this._pivot):(t||this.getBounds()).getCenter(!0)},getPivot:function(){var t=this._pivot;return t?new _(t.x,t.y,this,"setPivot"):null},setPivot:function(){this._pivot=v.read(arguments,0,{clone:!0,readNull:!0}),this._position=s}},h.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},(function(t,e){this[e]=function(e){return this.getBounds(e,t)}}),{beans:!0,getBounds:function(t,e){var n=e||t instanceof C,i=h.set({},n?e:t,this._boundsOptions);return i.stroke&&!this.getStrokeScaling()||(i.cacheItem=this),i=this._getCachedBounds(n&&t,i).rect,arguments.length?i:new b(i.x,i.y,i.width,i.height,this,"setBounds")},setBounds:function(){var t=A.read(arguments),e=this.getBounds(),n=this._matrix,i=new C,o=t.getCenter();i.translate(o),t.width==e.width&&t.height==e.height||(n.isInvertible()||(n.set(n._backup||(new C).translate(n.getTranslation())),e=this.getBounds()),i.scale(0!==e.width?t.width/e.width:0,0!==e.height?t.height/e.height:0)),o=e.getCenter(),i.translate(-o.x,-o.y),this.transform(i)},_getBounds:function(t,e){var n=this._children;return n&&n.length?(S._updateBoundsCache(this,e.cacheItem),S._getBounds(n,t,e)):new A},_getBoundsCacheKey:function(t,e){return[t.stroke?1:0,t.handle?1:0,e?1:0].join("")},_getCachedBounds:function(t,e,n){t=t&&t._orNullIfIdentity();var i,o=e.internal&&!n,r=e.cacheItem,s=o?null:this._matrix._orNullIfIdentity(),a=r&&(!t||t.equals(s))&&this._getBoundsCacheKey(e,o);return n=this._bounds,S._updateBoundsCache(this._parent||this._symbol,r),a&&n&&a in n?{rect:(i=n[a]).rect.clone(),nonscaling:i.nonscaling}:(s=(t=this._getBounds(t||s,e)).rect||t,e=this._style,e=t.nonscaling||e.hasStroke()&&!e.getStrokeScaling(),a&&(n||(this._bounds=n={}),i=n[a]={rect:s.clone(),nonscaling:e,internal:o}),{rect:s,nonscaling:e})},_getStrokeMatrix:function(t,e){return(t=(e=this.getStrokeScaling()?null:e&&e.internal?this:this._parent||this._symbol&&this._symbol._item)?e.getViewMatrix().invert():t)&&t._shiftless()},statics:{_updateBoundsCache:function(t,e){var n;t&&e&&(n=e._id,(t=t._boundsCache=t._boundsCache||{ids:{},list:[]}).ids[n]||(t.list.push(e),t.ids[n]=e))},_clearBoundsCache:function(t){var e=t._boundsCache;if(e){t._bounds=t._position=t._boundsCache=s;for(var n=0,i=e.list,o=i.length;n<o;n++){var r=i[n];r!==t&&(r._bounds=r._position=s,r._boundsCache&&S._clearBoundsCache(r))}}},_getBounds:function(t,e,n){var i=h=1/0,o=c=-h,r=!1;n=n||{};for(var s=0,a=t.length;s<a;s++){var l,h,c,u=t[s];u._visible&&!u.isEmpty(!0)&&(u=(l=u._getCachedBounds(e&&e.appended(u._matrix),n,!0)).rect,h=Math.min(u.x,h),i=Math.min(u.y,i),c=Math.max(u.x+u.width,c),o=Math.max(u.y+u.height,o),l.nonscaling&&(r=!0))}return{rect:isFinite(h)?new A(h,i,c-h,o-i):new A,nonscaling:r}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var t=this._decompose();return t?t.rotation:0},setRotation:function(t){var e,n=this.getRotation();null!=n&&null!=t&&(e=this._decomposed,this.rotate(t-n),e&&(e.rotation=t,this._decomposed=e))},getScaling:function(){var t=(t=this._decompose())&&t.scaling;return new _(t?t.x:1,t?t.y:1,this,"setScaling")},setScaling:function(){var t,e,n,i,o=this.getScaling(),r=v.read(arguments,0,{clone:!0,readNull:!0});o&&r&&!o.equals(r)&&(t=this.getRotation(),e=this._decomposed,n=new C,(i=f.isZero)(o.x)||i(o.y)?(n.translate(e.translation),t&&n.rotate(t),n.scale(r.x,r.y),this._matrix.set(n)):(i=this.getPosition(!0),n.translate(i),t&&n.rotate(t),n.scale(r.x/o.x,r.y/o.y),t&&n.rotate(-t),n.translate(i.negate()),this.transform(n)),e&&(e.scaling=r,this._decomposed=e))},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.set.apply(t,arguments)},getGlobalMatrix:function(t){if(i=this._globalMatrix)for(var e=this._parent,n=[];e;){if(!e._globalMatrix){for(var i=null,o=0,r=n.length;o<r;o++)n[o]._globalMatrix=null;break}n.push(e),e=e._parent}return i||(i=this._globalMatrix=this._matrix.clone(),(e=this._parent)&&i.prepend(e.getGlobalMatrix(!0))),t?i:i.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var n=this._children,i=0,o=n&&n.length;i<o;i++)n[i]._setProject(t);e=!0}e&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function t(e){t.base.call(this,e);for(var n=this._children,i=0,o=n&&n.length;i<o;i++)n[i]._installEvents(e)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof k)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var t=this._getOwner();return t&&t._children[this._index+1]||null},getPreviousSibling:function(){var t=this._getOwner();return t&&t._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return h.equals(this._children,t._children)},clone:function(t){var e=new this.constructor(S.NO_INSERT),n=this._children,i=h.pick(t?t.insert:s,t===s||!0===t);t=h.pick(t?t.deep:s,!0),n&&e.copyAttributes(this),n&&!t||e.copyContent(this),n||e.copyAttributes(this),i&&e.insertAbove(this);var o=this._name;if(i=this._parent,o&&i){n=i._children;for(var r=o,a=1;n[o];)o=r+" "+a++;o!==r&&e.setName(o)}return e},copyContent:function(t){for(var e=t._children,n=0,i=e&&e.length;n<i;n++)this.addChild(e[n].clone(!1),!0)},copyAttributes:function(t,e){this.setStyle(t._style);for(var n=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],i=0,o=n.length;i<o;i++){var r=n[i];t.hasOwnProperty(r)&&(this[r]=t[r])}e||this._matrix.set(t._matrix,!0),this.setApplyMatrix(t._applyMatrix),this.setPivot(t._pivot),this.setSelection(t._selection);var s=t._data;e=t._name,this._data=s?h.clone(s):null,e&&this.setName(e)},rasterize:function(t,e){var n;h.isPlainObject(t)?(a=t.resolution,n=t.insert,i=t.raster):(a=t,n=e);var i=i||new E(S.NO_INSERT),o=this.getStrokeBounds(),r=(a||this.getView().getResolution())/72,a=(t=o.getTopLeft().floor(),e=o.getBottomRight().ceil(),new y(e.subtract(t)));return o=a.multiply(r),i.setSize(o,!0),o.isZero()||(e=i.getContext(!0),o=(new C).scale(r).translate(t.negate()),e.save(),o.applyToContext(e),this.draw(e,new h({matrices:[o]})),e.restore()),i._matrix.set((new C).translate(t.add(a.divide(2))).scale(1/r)),n!==s&&!n||i.insertAbove(this),i},contains:function(){var t=this._matrix;return t.isInvertible()&&!!this._contains(t._inverseTransform(v.read(arguments)))},_contains:function(t){var e=this._children;if(e){for(var n=e.length-1;0<=n;n--)if(e[n].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return A.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new z.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){return t instanceof S&&0<this._asPathItem().getIntersections(t._asPathItem(),null,e,!0).length}},new function(){function t(){var t=arguments;return this._hitTest(v.read(t),L.getOptions(t))}function e(){var t=arguments,e=v.read(t),n=L.getOptions(t);return t=[],this._hitTest(e,new h({all:t},n)),t}function n(t,e,n,i){var o=this._children;if(o)for(var r=o.length-1;0<=r;r--){var s;if((s=(s=o[r])!==i&&s._hitTest(t,e,n))&&!e.all)return s}return null}return I.inject({hitTest:t,hitTestAll:e,_hitTest:n}),{hitTest:t,hitTestAll:e,_hitTestChildren:n}},{_hitTest:function(t,e,n){if(this._locked||!this._visible||this._guide&&!e.guides||this.isEmpty())return null;var i=this._matrix,o=n?n.appended(i):this.getGlobalMatrix().prepend(this.getView()._matrix),r=Math.max(e.tolerance,1e-12),s=e._tolerancePadding=new y(z._getStrokePadding(r,i._shiftless().invert()));if(!(t=i._inverseTransform(t))||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(s.multiply(2))._containsPoint(t))return null;var a,l,c=!(e.guides&&!this._guide||e.selected&&!this.isSelected()||e.type&&e.type!==h.hyphenate(this._class)||e.class&&!(this instanceof e.class)),u=e.match,d=this;function p(t){return(t=t&&u&&!u(t)?null:t)&&e.all&&e.all.push(t),t}function g(e,n){var i=n?a["get"+n]():d.getPosition();if(t.subtract(i).divide(s).length<=1)return new L(e,d,{name:n?h.hyphenate(n):e,point:i})}var f=e.position;if(n=e.center,r=e.bounds,c&&this._parent&&(f||n||r)){if((n||r)&&(a=this.getInternalBounds()),!(l=f&&g("position")||n&&g("center","Center"))&&r)for(var m=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],v=0;v<8&&!l;v++)l=g("bounds",m[v]);l=p(l)}return(l=l||this._hitTestChildren(t,e,o)||c&&p(this._hitTestSelf(t,e,o,this.getStrokeScaling()?null:o._shiftless().invert()))||null)&&l.point&&(l.point=i.transform(l.point)),l},_hitTestSelf:function(t,e){if(e.fill&&this.hasFill()&&this._contains(t))return new L("fill",this)},matches:function(t,e){var n=typeof t;if("object"==n){for(var i in t)if(t.hasOwnProperty(i)&&!this.matches(i,t[i]))return!1;return!0}if("function"==n)return t(this);if("match"===t)return e(this);if(n=/^(empty|editable)$/.test(t)?this["is"+h.capitalize(t)]():"type"===t?h.hyphenate(this._class):this[t],"class"===t){if("function"==typeof e)return this instanceof e;n=this._class}if("function"==typeof e)return!!e(n);if(e){if(e.test)return e.test(n);if(h.isPlainObject(e))return function t(e,n){for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];if(i=n[i],h.isPlainObject(o)&&h.isPlainObject(i)){if(!t(o,i))return!1}else if(!h.equals(o,i))return!1}return!0}(e,n)}return h.equals(n,e)},getItems:function(t){return S._getItems(this,t,this._matrix)},getItem:function(t){return S._getItems(this,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function t(e,n,i,o,r){var s,a,l;o||(a=(s="object"==typeof n&&n)&&s.overlapping,l=s&&s.inside,c=(_=a||l)&&A.read([_]),o={items:[],recursive:s&&!1!==s.recursive,inside:!!l,overlapping:!!a,rect:c,path:a&&new z.Rectangle({rectangle:c,insert:!1})},s&&(n=h.filter({},n,{recursive:!0,inside:!0,overlapping:!0})));var c,u=e._children,d=o.items;i=(c=o.rect)&&(i||new C);for(var p=0,g=u&&u.length;p<g;p++){var f=u[p],m=i&&i.appended(f._matrix),v=!0;if(c){var _=f.getBounds(m);if(!c.intersects(_))continue;c.contains(_)||o.overlapping&&(_.contains(c)||o.path.intersects(f,m))||(v=!1)}if(v&&f.matches(n)&&(d.push(f),r))break;if(!1!==o.recursive&&t(f,n,m,o,r),r&&0<d.length)break}return d}}},{importJSON:function(t){return(t=h.importJSON(t,this))!==this?this.addChild(t):t},addChild:function(t){return this.insertChild(s,t)},insertChild:function(t,e){return(e=e?this.insertChildren(t,[e]):null)&&e[0]},addChildren:function(t){return this.insertChildren(this._children.length,t)},insertChildren:function(t,e){var n=this._children;if(n&&e&&0<e.length){for(var i={},o=(e=h.slice(e)).length-1;0<=o;o--){var r=(c=e[o])&&c._id;!c||i[r]?e.splice(o,1):(c._remove(!1,!0),i[r]=!0)}h.splice(n,e,t,0);for(var s=this._project,a=s._changes,l=(o=0,e.length);o<l;o++){var c,u=(c=e[o])._name;c._parent=this,c._setProject(s,!0),u&&c.setName(u),a&&c._changed(5)}this._changed(11)}else e=null;return e},_insertItem:"#insertChild",_insertAt:function(t,e){var n=t&&t._getOwner(),i=t!==this&&n?this:null;return i&&(i._remove(!1,!0),n._insertItem(t._index+e,i)),i},insertAbove:function(t){return this._insertAt(t,1)},insertBelow:function(t){return this._insertAt(t,0)},sendToBack:function(){var t=this._getOwner();return t?t._insertItem(0,this):null},bringToFront:function(){var t=this._getOwner();return t?t._insertItem(s,this):null},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(t){return t._insertItem(s,this)},copyTo:function(t){return this.clone(!1).addTo(t)},reduce:function(t){var e=this._children;return e&&1===e.length?(t=e[0].reduce(t),this._parent?(t.insertAbove(this),this.remove()):t.remove(),t):this},_removeNamed:function(){var t,e,n,i,o=this._getOwner();o&&(t=o._children,-1!==(o=(i=(e=o._namedChildren)[n=this._name])?i.indexOf(this):-1)&&(t[n]==this&&delete t[n],i.splice(o,1),i.length?t[n]=i[0]:delete e[n]))},_remove:function(t,e){var n=this._getOwner(),i=this._project,o=this._index;return this._style&&this._style._dispose(),!(!n||(this._name&&this._removeNamed(),null!=o&&(i._activeLayer===this&&(i._activeLayer=this.getNextSibling()||this.getPreviousSibling()),h.splice(n._children,null,o,1)),this._installEvents(!1),t&&i._changes&&this._changed(5),e&&n._changed(11,this),this._parent=null))},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){return(t=t&&t.insertBelow(this))&&this.remove(),t},removeChildren:function(t,e){if(!this._children)return null;t=t||0,e=h.pick(e,this._children.length);for(var n=h.splice(this._children,null,t,e-t),i=n.length-1;0<=i;i--)n[i]._remove(!0,!1);return 0<n.length&&this._changed(11),n},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;t<e;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(t){var e=this._children,n=e?e.length:0;if(t){for(var i=0;i<n;i++)if(!e[i].isEmpty(t))return!1;return!0}return!n},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function e(t){for(var e=[];e.unshift(t),t=t._parent;);return e}for(var n=e(this),i=e(t),o=0,r=Math.min(n.length,i.length);o<r;o++)if(n[o]!=i[o])return n[o]._index<i[o]._index?1:-1;return 0},hasChildren:function(){return this._children&&0<this._children.length},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e===t)return!0;return!1},isAncestor:function(t){return!!t&&t.isDescendant(this)},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1}},h.each(["rotate","scale","shear","skew"],(function(t){var e="rotate"===t;this[t]=function(){var n=arguments,i=(e?h:v).read(n);return n=v.read(n,0,{readNull:!0}),this.transform((new C)[t](i,n||this.getPosition(!0)))}}),{translate:function(){var t=new C;return this.transform(t.translate.apply(t,arguments))},transform:function(t,e,n){var i,o,r=this._matrix,s=t&&!t.isIdentity(),a=n&&this._canApplyMatrix||this._applyMatrix&&(s||!r.isIdentity()||e&&this._children);if(!s&&!a)return this;s&&(!t.isInvertible()&&r.isInvertible()&&(r._backup=r.getValues()),r.prepend(t,!0),i=(o=this._style).getFillColor(!0),o=o.getStrokeColor(!0),i&&i.transform(t),o&&o.transform(t)),(a=a&&this._transformContent(r,e,n))&&((e=this._pivot)&&r._transformPoint(e,e,!0),r.reset(!0),n&&this._canApplyMatrix&&(this._applyMatrix=!0));var l=this._bounds;if(r=this._position,(s||a)&&this._changed(25),(n=s&&l&&t.decompose())&&n.skewing.isZero()&&n.rotation%90==0){for(var h in l){var c=l[h];c.nonscaling?delete l[h]:!a&&c.internal||(c=c.rect,t._transformBounds(c,c))}(n=(this._bounds=l)[this._getBoundsCacheKey(this._boundsOptions||{})])&&(this._position=this._getPositionFromBounds(n.rect))}else s&&r&&this._pivot&&(this._position=t._transformPoint(r,r));return this},_transformContent:function(t,e,n){var i=this._children;if(i){for(var o=0,r=i.length;o<r;o++)i[o].transform(t,e,n);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(v.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(v.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(v.read(arguments))},localToParent:function(){return this._matrix._transformPoint(v.read(arguments))},fitBounds:function(t,e){t=A.read(arguments);var n=this.getBounds(),i=n.height/n.width,o=t.height/t.width;o=(e?o<i:i<o)?t.width/n.width:t.height/n.height,(o=new A(new v,new y(n.width*o,n.height*o))).setCenter(t.getCenter()),this.setBounds(o)}}),{_setStyles:function(t,e,n){var i,o,r=this._style,s=this._matrix;r.hasFill()&&(t.fillStyle=r.getFillColor().toCanvasStyle(t,s)),r.hasStroke()&&(t.strokeStyle=r.getStrokeColor().toCanvasStyle(t,s),t.lineWidth=r.getStrokeWidth(),i=r.getStrokeJoin(),o=r.getStrokeCap(),s=r.getMiterLimit(),i&&(t.lineJoin=i),o&&(t.lineCap=o),s&&(t.miterLimit=s),jt.support.nativeDash&&(o=r.getDashArray(),s=r.getDashOffset(),o&&o.length&&("setLineDash"in t?(t.setLineDash(o),t.lineDashOffset=s):(t.mozDash=o,t.mozDashOffset=s)))),r.hasShadow()&&(e=e.pixelRatio||1,e=(n=n._shiftless().prepend((new C).scale(e,e))).transform(new v(r.getShadowBlur(),0)),n=n.transform(this.getShadowOffset()),t.shadowColor=r.getShadowColor().toCanvasStyle(t),t.shadowBlur=e.getLength(),t.shadowOffsetX=n.x,t.shadowOffsetY=n.y)},draw:function(t,e,n){if(this._updateVersion=this._project._updateVersion,this._visible&&0!==this._opacity){var i=e.matrices,o=e.viewMatrix,r=this._matrix;if((g=i[i.length-1].appended(r)).isInvertible()){o=o?o.appended(g):g,i.push(g),e.updateMatrix&&(this._globalMatrix=g);var s,a,l,h=this._blendMode,c=f.clamp(this._opacity,0,1),u="normal"===h,d=pt.nativeModes[h],p=u&&1===c||e.dontStart||e.clip||(d||u&&c<1)&&this._canComposite(),g=e.pixelRatio||1;if(!p){var m=this.getStrokeBounds(o);if(!m.width||!m.height)return void i.pop();l=e.offset,a=e.offset=m.getTopLeft().floor(),s=t,t=dt.getContext(m.getSize().ceil().add(1).multiply(g)),1!==g&&t.scale(g,g)}t.save(),u=n?n.appended(r):this._canScaleStroke&&!this.getStrokeScaling(!0)&&o,m=!p&&e.clipItem,n=!u||m,p?(t.globalAlpha=c,d&&(t.globalCompositeOperation=h)):n&&t.translate(-a.x,-a.y),n&&(p?r:o).applyToContext(t),m&&e.clipItem.draw(t,e.extend({clip:!0})),u&&(t.setTransform(g,0,0,g,0,0),(m=e.offset)&&t.translate(-m.x,-m.y)),this._draw(t,e,o,u),t.restore(),i.pop(),e.clip&&!e.dontFinish&&t.clip(this.getFillRule()),p||(pt.process(h,t,s,c,a.subtract(l).multiply(g)),dt.release(t),e.offset=l)}}},_isUpdated:function(t){var e=this._parent;if(e instanceof D)return e._isUpdated(t);var n=this._updateVersion===t;return!n&&e&&e._visible&&e._isUpdated(t)&&(this._updateVersion=t,n=!0),n},_drawSelection:function(t,e,n,i,o){var r=1&(a=this._selection),s=2&a||r&&this._selectBounds,a=4&a;if(((r=!!this._drawSelected&&r)||s||a)&&this._isUpdated(o)){var l=this.getSelectedColor(!0)||(l=this.getLayer())&&l.getSelectedColor(!0),h=(e=e.appended(this.getGlobalMatrix(!0)),n/2);if(t.strokeStyle=t.fillStyle=l?l.toCanvasStyle(t):"#009dec",r&&this._drawSelected(t,e,i),a){i=this.getPosition(!0);var c=(i=(a=this._parent)?a.localToGlobal(i):i).x,u=i.y;t.beginPath(),t.arc(c,u,h,0,2*Math.PI,!0),t.stroke();for(var d=[[0,-1],[1,0],[0,1],[-1,0]],p=h,g=n+1,f=0;f<4;f++){var m=(v=d[f])[0],v=v[1];t.moveTo(c+m*p,u+v*p),t.lineTo(c+m*g,u+v*g),t.stroke()}}if(s){var _=e._transformCorners(this.getInternalBounds());for(t.beginPath(),f=0;f<8;f++)t[f?"lineTo":"moveTo"](_[f],_[++f]);for(t.closePath(),t.stroke(),f=0;f<8;f++)t.fillRect(_[f]-h,_[++f]-h,n,n)}}},_canComposite:function(){return!1}},h.each(["down","drag","up","move"],(function(t){this["removeOn"+h.capitalize(t)]=function(){var e={};return e[t]=!0,this.removeOn(e)}}),{removeOn:function(t){for(var e in t){var n;t[e]&&(n="mouse"+e,(e=(e=this._project)._removeSets=e._removeSets||{})[n]=e[n]||{},e[n][this._id]=this)}return this}}),{tween:function(t,e,n){n||(n=e,e=t,t=null,n||(n=e,e=null));var i=n&&n.easing,o=n&&n.start,r=(n=null!=n&&("number"==typeof n?n:n.duration),new ut(this,t,e,n,i,o));return n&&this.on("frame",(function t(e){r._handleFrame(1e3*e.time),r.running||this.off("frame",t)})),r},tweenTo:function(t,e){return this.tween(null,t,e)},tweenFrom:function(t,e){return this.tween(t,null,e)}}),T=S.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function t(e){t.base.call(this,e),2050&e&&(this._clipItem=s)},_getClipItem:function(){if((t=this._clipItem)===s){for(var t=null,e=this._children,n=0,i=e.length;n<i;n++)if(e[n]._clipMask){t=e[n];break}this._clipItem=t}return t},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var e=this.getFirstChild();e&&e.setClipMask(t)},_getBounds:function t(e,n){var i=this._getClipItem();return i?i._getCachedBounds(i._matrix.prepended(e),h.set({},n,{stroke:!1})):t.base.call(this,e,n)},_hitTestChildren:function t(e,n,i){var o=this._getClipItem();return(!o||o.contains(e))&&t.base.call(this,e,n,i,o)},_draw:function(t,e){var n=e.clip,i=!n&&this._getClipItem();e=e.extend({clipItem:i,clip:!1}),n?(t.beginPath(),e.dontStart=e.dontFinish=!0):i&&i.draw(t,e.extend({clip:!0}));for(var o=this._children,r=0,s=o.length;r<s;r++){var a=o[r];a!==i&&a.draw(t,e)}}}),k=T.extend({_class:"Layer",initialize:function(){T.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function t(){return this._parent?t.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),P=S.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(t,e){this._initialize(t,e)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&h.equals(this._radius,t._radius)},copyContent:function(t){this.setType(t._type),this.setSize(t._size),this.setRadius(t._radius)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new w(t.width,t.height,this,"setSize")},setSize:function(){var t,e,n,i=y.read(arguments);this._size?this._size.equals(i)||(t=this._type,e=i.width,n=i.height,"rectangle"===t?this._radius.set(y.min(this._radius,i.divide(2).abs())):"circle"===t?(e=n=(e+n)/2,this._radius=e/2):"ellipse"===t&&this._radius._set(e/2,n/2),this._size._set(e,n),this._changed(9)):this._size=i.clone()},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new w(t.width,t.height,this,"setRadius")},setRadius:function(t){var e=this._type;if("circle"===e){if(t===this._radius)return;var n=2*t;this._radius=t,this._size._set(n,n)}else if(t=y.read(arguments),this._radius){if(this._radius.equals(t))return;this._radius.set(t),"rectangle"===e?(n=y.max(this._size,t.multiply(2)),this._size.set(n)):"ellipse"===e&&this._size._set(2*t.width,2*t.height)}else this._radius=t.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var e=new(z[h.capitalize(this._type)])({center:new v,size:this._size,radius:this._radius,insert:!1});return e.copyAttributes(this),jt.settings.applyMatrix&&e.setApplyMatrix(!0),t!==s&&!t||e.insertAbove(this),e},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(t,e,n,i){var o,r,s,a,l,h=this._style,c=h.hasFill(),u=h.hasStroke(),d=e.dontFinish||e.clip,p=!i;(c||u||d)&&(s=this._type,a=this._radius,l="circle"===s,e.dontStart||t.beginPath(),p&&l?t.arc(0,0,a,0,2*Math.PI,!0):(o=l?a:a.width,r=l?a:a.height,a=(l=this._size).width,l=l.height,p&&"rectangle"===s&&0===o&&0===r?t.rect(-a/2,-l/2,a,l):(l=[-(p=a/2),-(s=l/2)+r,-p,(l=r*(a=.44771525016920644))-s,(a*=o)-p,-s,-p+o,-s,p-o,-s,p-a,-s,p,l-s,p,-s+r,p,s-r,p,s-l,p-a,s,p-o,s,-p+o,s,a-p,s,-p,s-l,-p,s-r],i&&i.transform(l,l,32),t.moveTo(l[0],l[1]),t.bezierCurveTo(l[2],l[3],l[4],l[5],l[6],l[7]),p!==o&&t.lineTo(l[8],l[9]),t.bezierCurveTo(l[10],l[11],l[12],l[13],l[14],l[15]),s!==r&&t.lineTo(l[16],l[17]),t.bezierCurveTo(l[18],l[19],l[20],l[21],l[22],l[23]),p!==o&&t.lineTo(l[24],l[25]),t.bezierCurveTo(l[26],l[27],l[28],l[29],l[30],l[31]))),t.closePath()),d||!c&&!u||(this._setStyles(t,e,n),c&&(t.fill(h.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),u&&t.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,e){var n=new A(this._size).setCenter(0,0),i=this._style;return i=e.stroke&&i.hasStroke()&&i.getStrokeWidth(),t&&(n=t._transformBounds(n)),i?n.expand(z._getStrokePadding(i,this._getStrokeMatrix(t,e))):n}},new function(){function t(t,e,n){var i=t._radius;if(!i.isZero())for(var o=t._size.divide(2),r=1;r<=4;r++){var s=new v(1<r&&r<4?-1:1,2<r?-1:1),a=s.multiply(o),l=a.subtract(s.multiply(i));if(new A(n?a.add(s.multiply(n)):a,l).contains(e))return{point:l,quadrant:r}}}function e(t,e,n,i){return t=t.divide(e),(!i||t.isInQuadrant(i))&&t.subtract(t.normalize()).multiply(e).divide(n).length<=1}return{_contains:function e(n){if("rectangle"!==this._type)return n.divide(this.size).getLength()<=.5;var i=t(this,n);return i?n.subtract(i.point).divide(this._radius).getLength()<=1:e.base.call(this,n)},_hitTestSelf:function n(i,o,r,s){var a,l,h,c=!1,u=this._style,d=o.stroke&&u.hasStroke(),p=o.fill&&u.hasFill();return(d||p)&&(l=this._type,a=this._radius,h=d?u.getStrokeWidth()/2:0,p=o._tolerancePadding.add(z._getStrokePadding(h,!u.getStrokeScaling()&&s)),c="rectangle"===l?(u=t(this,i,h=p.multiply(2)))?e(i.subtract(u.point),a,p,u.quadrant):(u=(l=new A(this._size).setCenter(0,0)).expand(h),h=l.expand(h.negate()),u._containsPoint(i)&&!h._containsPoint(i)):e(i,a,p)),c?new L(d?"stroke":"fill",this):n.base.apply(this,arguments)}}},{statics:new function(){function t(t,e,n,i,o){var r=h.create(P.prototype);return r._type=t,r._size=n,r._radius=i,r._initialize(h.getNamed(o),e),r}return{Circle:function(){var e=arguments,n=v.readNamed(e,"center"),i=h.readNamed(e,"radius");return t("circle",n,new y(2*i),i,e)},Rectangle:function(){var e=arguments,n=A.readNamed(e,"rectangle"),i=y.min(y.readNamed(e,"radius"),n.getSize(!0).divide(2));return t("rectangle",n.getCenter(!0),n.getSize(!0),i,e)},Ellipse:function(){var e=arguments,n=P._readEllipse(e),i=n.radius;return t("ellipse",n.center,i.multiply(2),i,e)},_readEllipse:function(t){var e,n;return n=h.hasNamed(t,"radius")?(e=v.readNamed(t,"center"),y.readNamed(t,"radius")):(e=(n=A.readNamed(t,"rectangle")).getCenter(!0),n.getSize(!0).divide(2)),{center:e,radius:n}}}}}),E=S.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function(t,e){var n,i;this._initialize(t,e!==s&&v.read(arguments))||((i="string"==(i=typeof t)?l.getElementById(t):"object"==i?t:null)&&i!==S.NO_INSERT&&(i.getContext||null!=i.naturalHeight?n=i:i&&((i=y.read(arguments)).isZero()||(n=dt.getCanvas(i)))),n?this.setImage(n):this.setSource(t)),this._size||(this._size=new y,this._loaded=!1)},_equals:function(t){return this.getSource()===t.getSource()},copyContent:function(t){var e=t._image,n=t._canvas;e?this._setImage(e):n&&((e=dt.getCanvas(t._size)).getContext("2d").drawImage(n,0,0),this._setImage(e)),this._crossOrigin=t._crossOrigin},getSize:function(){var t=this._size;return new w(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(t,e){var n,i=y.read(arguments);i.equals(this._size)?e&&this.clear():0<i.width&&0<i.height?(n=!e&&this.getElement(),this._setImage(dt.getCanvas(i)),n&&this.getContext(!0).drawImage(n,0,0,i.width,i.height)):(this._canvas&&dt.release(this._canvas),this._size=i.clone())},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},getLoaded:function(){return this._loaded},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,e=new v(0,0).transform(t),n=new v(1,0).transform(t).subtract(e);return e=new v(0,1).transform(t).subtract(e),new y(72/n.getLength(),72/e.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){var e=this;function n(t){var n=e.getView(),i=t&&t.type||"load";n&&e.responds(i)&&(jt=n._scope,e.emit(i,new st(t)))}this._setImage(t),this._loaded?setTimeout(n,0):t&&X.add(t,{load:function(i){e._setImage(t),n(i)},error:n})},_setImage:function(t){this._canvas&&dt.release(this._canvas),t&&t.getContext?(this._image=null,this._canvas=t,this._loaded=!0):(this._image=t,this._canvas=null,this._loaded=!!(t&&t.src&&t.complete)),this._size=new y(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var t=dt.getContext(this._size);try{this._image&&t.drawImage(this._image,0,0),this._canvas=t.canvas}catch(e){dt.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){return this._context||(this._context=this.getCanvas().getContext("2d")),t&&(this._image=null,this._changed(1025)),this._context},setContext:function(t){this._context=t},getSource:function(){var t=this._image;return t&&t.src||this.toDataURL()},setSource:function(t){var e=new r.Image,n=this._crossOrigin;n&&(e.crossOrigin=n),t&&(e.src=t),this.setImage(e)},getCrossOrigin:function(){var t=this._image;return t&&t.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){this._crossOrigin=t;var e=this._image;e&&(e.crossOrigin=t)},getSmoothing:function(){return this._smoothing},setSmoothing:function(t){this._smoothing="string"==typeof t?t:t?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=A.read(arguments),e=dt.getContext(t.getSize());return e.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),e.canvas},getSubRaster:function(){var t=A.read(arguments),e=new E(S.NO_INSERT);return e._setImage(this.getSubCanvas(t)),e.translate(t.getCenter().subtract(this.getSize().divide(2))),e._matrix.prepend(this._matrix),e.insertAbove(this),e},toDataURL:function(){var t=(t=this._image)&&t.src;return/^data:/.test(t)?t:(t=this.getCanvas())?t.toDataURL.apply(t,arguments):null},drawImage:function(t){var e=v.read(arguments,1);this.getContext(!0).drawImage(t,e.x,e.y)},getAverageColor:function(t){if(t?t instanceof j?o=(i=t).getBounds():"object"==typeof t&&("width"in t?o=new A(t):"x"in t&&(o=new A(t.x-.5,t.y-.5,1,1))):o=this.getBounds(),!o)return null;var e=Math.min(o.width,32),n=Math.min(o.height,32);(t=E._sampleContext)?t.clearRect(0,0,33,33):t=E._sampleContext=dt.getContext(new y(32)),t.save(),(o=(new C).scale(e/o.width,n/o.height).translate(-o.x,-o.y)).applyToContext(t),i&&i.draw(t,new h({clip:!0,matrices:[o]})),this._matrix.applyToContext(t);var i=this.getElement(),o=this._size;i&&t.drawImage(i,-o.width/2,-o.height/2),t.restore();for(var r=t.getImageData(.5,.5,Math.ceil(e),Math.ceil(n)).data,s=[0,0,0],a=0,l=0,c=r.length;l<c;l+=4){var u=r[l+3];a+=u,u/=255,s[0]+=r[l]*u,s[1]+=r[l+1]*u,s[2]+=r[l+2]*u}for(l=0;l<3;l++)s[l]/=a;return a?U.read(s):null},getPixel:function(){var t=v.read(arguments);return t=this.getContext().getImageData(t.x,t.y,1,1).data,new U("rgb",[t[0]/255,t[1]/255,t[2]/255],t[3]/255)},setPixel:function(){var t,e=arguments,n=v.read(e),i=(t=U.read(e))._convert("rgb"),o=t._alpha,r=this.getContext(!0);(t=(e=r.createImageData(1,1)).data)[0]=255*i[0],t[1]=255*i[1],t[2]=255*i[2],t[3]=null!=o?255*o:255,r.putImageData(e,n.x,n.y)},clear:function(){var t=this._size;this.getContext(!0).clearRect(0,0,t.width+1,t.height+1)},createImageData:function(){var t=y.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=A.read(arguments);return t.isEmpty()&&(t=new A(this._size)),this.getContext().getImageData(t.x,t.y,t.width,t.height)},putImageData:function(t){var e=v.read(arguments,1);this.getContext(!0).putImageData(t,e.x,e.y)},setImageData:function(t){this.setSize(t),this.getContext(!0).putImageData(t,0,0)},_getBounds:function(t,e){var n=new A(this._size).setCenter(0,0);return t?t._transformBounds(n):n},_hitTestSelf:function(t){if(this._contains(t)){var e=this;return new L("pixel",e,{offset:t.add(e._size.divide(2)).round(),color:{get:function(){return e.getPixel(this.offset)}}})}},_draw:function(t,e,n){var i=this.getElement();i&&0<i.width&&0<i.height&&(t.globalAlpha=f.clamp(this._opacity,0,1),this._setStyles(t,e,n),e=this._smoothing,Z.setPrefixed(t,(n="off"===e)?"imageSmoothingEnabled":"imageSmoothingQuality",!n&&e),t.drawImage(i,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),O=S.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(t,e){this._initialize(t,e!==s&&v.read(arguments,1))||this.setDefinition(t instanceof B?t:new B(t))},_equals:function(t){return this._definition===t._definition},copyContent:function(t){this.setDefinition(t._definition)},getDefinition:function(){return this._definition},setDefinition:function(t){this._definition=t,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(t,e){var n=this._definition._item;return n._getCachedBounds(n._matrix.prepended(t),e)},_hitTestSelf:function(t,e,n){return e=e.extend({all:!1}),(n=this._definition._item._hitTest(t,e,n))&&(n.item=this),n},_draw:function(t,e){this._definition._item.draw(t,e)}}),B=h.extend({_class:"SymbolDefinition",initialize:function(t,e){this._id=m.get(),this.project=jt.project,t&&this.setItem(t,e)},_serialize:function(t,e){return e.add(this,(function(){return h.serialize([this._class,this._item],t,!1,e)}))},_changed:function(t){8&t&&S._clearBoundsCache(this),1&t&&this.project._changed(t)},getItem:function(){return this._item},setItem:function(t,e){t._symbol&&(t=t.clone()),this._item&&(this._item._symbol=null),(this._item=t).remove(),t.setSelected(!1),e||t.setPosition(new v),(t._symbol=this)._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(t){return new O(this,t)},clone:function(){return new B(this._item.clone(!1))},equals:function(t){return t===this||t&&this._item.equals(t._item)||!1}}),L=h.extend({_class:"HitResult",initialize:function(t,e,n){this.type=t,this.item=e,n&&this.inject(n)},statics:{getOptions:function(t){return t=t&&h.read(t),new h({type:null,tolerance:jt.settings.hitTolerance,fill:!t,stroke:!t,segments:!t,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},t)}}}),M=h.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(t,e,n,i,o,r){var a,l,h,c,u=arguments.length;0<u&&(null==t||"object"==typeof t?c=1===u&&t&&"point"in t?(a=t.point,l=t.handleIn,h=t.handleOut,t.selection):(a=t,l=e,h=n,i):(a=[t,e],l=n!==s?[n,i]:null,h=o!==s?[o,r]:null)),new N(a,this,"_point"),new N(l,this,"_handleIn"),new N(h,this,"_handleOut"),c&&this.setSelection(c)},_serialize:function(t,e){var n=this._point,i=this._selection;return n=i||this.hasHandles()?[n,this._handleIn,this._handleOut]:n,i&&n.push(i),h.serialize(n,t,!0,e)},_changed:function(t){var e,n,i,o=this._path;o&&(e=o._curves,n=this._index,e&&(t&&t!==this._point&&t!==this._handleIn||!(i=0<n?e[n-1]:o._closed?e[e.length-1]:null)||i._changed(),t&&t!==this._point&&t!==this._handleOut||!(i=e[n])||i._changed()),o._changed(41))},getPoint:function(){return this._point},setPoint:function(){this._point.set(v.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(v.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(v.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var t=this._handleIn,e=this._handleOut;return!t.isZero()&&!e.isZero()&&t.isCollinear(e)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(t){var e=this._selection,n=this._path;this._selection=t=t||0,n&&t!==e&&(n._updateSelection(this,e,t),n._changed(257))},_changeSelection:function(t,e){var n=this._selection;this.setSelection(e?n|t:n&~t)},isSelected:function(){return!!(7&this._selection)},setSelected:function(t){this._changeSelection(7,t)},getIndex:function(){return this._index!==s?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;return t?(0<e&&!t._closed&&e===t._segments.length-1&&e--,t.getCurves()[e]||null):null},getLocation:function(){var t=this.getCurve();return t?new F(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},smooth:function(t,e,n){var i=t||{},o=i.type,r=i.factor,a=this.getPrevious(),l=this.getNext(),h=(a||this)._point,c=this._point,u=(l||this)._point,d=h.getDistance(c);if(t=c.getDistance(u),o&&"catmull-rom"!==o){if("geometric"!==o)throw new Error("Smoothing method '"+o+"' not supported.");a&&l&&(i=h.subtract(u),o=(f=r===s?.4:r)*d/(d+t),e||this.setHandleIn(i.multiply(o)),n||this.setHandleOut(i.multiply(o-f)))}else{var p,g,f=r===s?.5:r;d=(r=Math.pow(d,f))*r,f=(t=Math.pow(t,f))*t,!e&&a&&(p=2*f+3*t*r+d,this.setHandleIn(0!=(g=3*t*(t+r))?new v((f*h._x+p*c._x-d*u._x)/g-c._x,(f*h._y+p*c._y-d*u._y)/g-c._y):new v)),!n&&l&&(p=2*d+3*r*t+f,this.setHandleOut(0!=(g=3*r*(r+t))?new v((d*u._x+p*c._x-f*h._x)/g-c._x,(d*u._y+p*c._y-f*h._y)/g-c._y):new v))}},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,n=t.clone();t.set(e),e.set(n)},reversed:function(){return new M(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new M(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];return this._handleIn.isZero()||t.push("handleIn: "+this._handleIn),this._handleOut.isZero()||t.push("handleOut: "+this._handleOut),"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},interpolate:function(t,e,n){var i=1-n,o=n,r=t._point,s=e._point,a=t._handleIn;n=e._handleIn,e=e._handleOut,t=t._handleOut,this._point._set(i*r._x+o*s._x,i*r._y+o*s._y,!0),this._handleIn._set(i*a._x+o*n._x,i*a._y+o*n._y,!0),this._handleOut._set(i*t._x+o*e._x,i*t._y+o*e._y,!0),this._changed()},_transformCoordinates:function(t,e,n){var i=this._point,o=n&&this._handleIn.isZero()?null:this._handleIn,r=n&&this._handleOut.isZero()?null:this._handleOut,s=i._x,a=i._y,l=2;return e[0]=s,e[1]=a,o&&(e[l++]=o._x+s,e[l++]=o._y+a),r&&(e[l++]=r._x+s,e[l++]=r._y+a),t&&(t._transformCoordinates(e,e,l/2),s=e[0],a=e[1],n?(i._x=s,i._y=a,l=2,o&&(o._x=e[l++]-s,o._y=e[l++]-a),r&&(r._x=e[l++]-s,r._y=e[l++]-a)):(o||(e[l++]=s,e[l++]=a),r||(e[l++]=s,e[l++]=a))),e}}),N=v.extend({initialize:function(t,e,n){var i,o,r;t?(i=t[0])!==s?o=t[1]:((i=(r=t).x)===s&&(i=(r=v.read(arguments)).x),o=r.y,r=r.selected):i=o=0,this._x=i,this._y=o,(this._owner=e)[n]=this,r&&this.setSelected(!0)},_set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){var t=f.isZero;return t(this._x)&&t(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){var t=this._owner;return this===t._point?1:this===t._handleIn?2:this===t._handleOut?4:0}}),R=h.extend({_class:"Curve",beans:!0,initialize:function(t,e,n,i,o,r,s,a){var l,h,c,u,d,p,g=arguments.length;3===g?(this._path=t,l=e,h=n):g?1===g?"segment1"in t?(l=new M(t.segment1),h=new M(t.segment2)):"point1"in t?(c=t.point1,d=t.handle1,p=t.handle2,u=t.point2):Array.isArray(t)&&(c=[t[0],t[1]],u=[t[6],t[7]],d=[t[2]-t[0],t[3]-t[1]],p=[t[4]-t[6],t[5]-t[7]]):2===g?(l=new M(t),h=new M(e)):4===g?(c=t,d=e,p=n,u=i):8===g&&(c=[t,e],u=[s,a],d=[n-t,i-e],p=[o-s,r-a]):(l=new M,h=new M),this._segment1=l||new M(c,null,d),this._segment2=h||new M(u,p,null)},_serialize:function(t,e){return h.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0,e)},_changed:function(){this._length=this._bounds=s},clone:function(){return new R(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},classify:function(){return R.classify(this.getValues())},remove:function(){var t,e,n=!1;return this._path&&(e=(t=this._segment2)._handleOut,(n=t.remove())&&this._segment1._handleOut.set(e)),n},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(v.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(v.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(v.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(v.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return R.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],n=0;n<8;n+=2)e.push(new v(t[n],t[n+1]));return e}},{getLength:function(){return null==this._length&&(this._length=R.getLength(this.getValues(),0,1)),this._length},getArea:function(){return R.getArea(this.getValues())},getLine:function(){return new x(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new R(R.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return R.getLength(this.getValues(),t,e)},divideAt:function(t){return this.divideAtTime(t&&t.curve===this?t.time:this.getTimeAt(t))},divideAtTime:function(t,e){var n,i,o,r,s,a,l=null;return 1e-8<=t&&t<=1-1e-8&&(n=(a=R.subdivide(this.getValues(),t))[0],i=a[1],o=e||this.hasHandles(),r=this._segment1,s=this._segment2,t=this._path,o&&(r._handleOut._set(n[2]-n[0],n[3]-n[1]),s._handleIn._set(i[4]-i[6],i[5]-i[7])),a=n[6],e=n[7],e=new M(new v(a,e),o&&new v(n[4]-a,n[5]-e),o&&new v(i[2]-a,i[3]-e)),l=t?(t.insert(r._index+1,e),this.getNext()):(this._segment2=e,this._changed(),new R(e,s))),l},splitAt:function(t){var e=this._path;return e?e.splitAt(t):null},splitAtTime:function(t){return this.splitAt(this.getLocationAtTime(t))},divide:function(t,e){return this.divideAtTime(t===s?.5:e?t:this.getTimeAt(t))},split:function(t,e){return this.splitAtTime(t===s?.5:e?t:this.getTimeAt(t))},reversed:function(){return new R(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(t,e,n,i){var o=t._point,r=t._handleOut,s=e._handleIn,a=e._point;return t=o.x,e=o.y,o=a.x,a=a.y,a=i?[t,e,t,e,o,a,o,a]:[t,e,t+r._x,e+r._y,o+s._x,a+s._y,o,a],n&&n._transformCoordinates(a,a,4),a},subdivide:function(t,e){var n=t[0],i=t[1],o=t[2],r=t[3],a=t[4],l=t[5],h=t[6],c=t[7],u=1-(e=e===s?.5:e),d=u*n+e*o,p=u*i+e*r,g=u*o+e*a,f=u*r+e*l;return o=u*l+e*c,r=u*d+e*g,l=u*g+e*(t=u*a+e*h),g=u*f+e*o,[[n,i,d,p,r,a=u*p+e*f,f=u*r+e*l,e=u*a+e*g],[f,e,l,g,t,o,h,c]]},getMonoCurves:function(t,e){var n,i,o=[],r=t[0+(a=e?0:1)],s=t[2+a],a=(e=t[4+a],t[6+a]);return s<=r==e<=s&&e<=s==a<=e||R.isStraight(t)||!(i=f.solveQuadratic(3*(s-e)-r+a,2*(r+e)-4*s,s-r,n=[],1e-8,1-1e-8))?o.push(t):(n.sort(),s=n[0],r=R.subdivide(t,s),o.push(r[0]),1<i&&(s=(n[1]-s)/(1-s),r=R.subdivide(r[1],s),o.push(r[0])),o.push(r[1])),o},solveCubic:function(t,e,n,i,o,r){var s=t[e],a=t[e+2],l=t[e+4];return t=t[e+6],e=0,s<n&&t<n&&a<n&&l<n||n<s&&n<t&&n<a&&n<l?e:f.solveCubic(t-s-(t=3*(a-s))-(a=3*(l-a)-t),a,t,s-n,i,o,r)},getTimeOf:function(t,e){var n=new v(t[0],t[1]),i=new v(t[6],t[7]);if(null===(e.isClose(n,1e-12)?0:e.isClose(i,1e-12)?1:null))for(var o=[e.x,e.y],r=[],s=0;s<2;s++)for(var a=R.solveCubic(t,s,o[s],r,0,1),l=0;l<a;l++){var h=r[l];if(e.isClose(R.getPoint(t,h),1e-7))return h}return e.isClose(n,1e-7)?0:e.isClose(i,1e-7)?1:null},getNearestTime:function(t,e){if(R.isStraight(t)){var n=t[0],i=t[1],o=t[6]-n,r=t[7]-i,s=o*o+r*r;return 0==s||(s=((e.x-n)*o+(e.y-i)*r)/s)<1e-12?0:.999999999999<s?1:R.getTimeOf(t,new v(n+s*o,i+s*r))}var a=1/0,l=0;function h(n){if(0<=n&&n<=1){var i=e.getDistance(R.getPoint(t,n),!0);return i<a?(a=i,l=n,1):void 0}}for(var c=0;c<=100;c++)h(c/100);for(var u=.005;1e-8<u;)h(l-u)||h(l+u)||(u/=2);return l},getPart:function(t,e,n){var i,o=n<e;return o&&(i=e,e=n,n=i),0<e&&(t=R.subdivide(t,e)[1]),n<1&&(t=R.subdivide(t,(n-e)/(1-e))[0]),o?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},isFlatEnough:function(t,e){var n=t[0],i=t[1],o=t[2],r=t[3],s=t[4],a=t[5],l=t[6];return o=3*o-2*n-l,r=3*r-2*i-(t=t[7]),n=3*s-2*l-n,i=3*a-2*t-i,Math.max(o*o,n*n)+Math.max(r*r,i*i)<=16*e*e},getArea:function(t){var e=t[0],n=t[1],i=t[2],o=t[3],r=t[4],s=t[5],a=t[6];return 3*(((t=t[7])-n)*(i+r)-(a-e)*(o+s)+o*(e-r)-i*(n-s)+t*(r+e/3)-a*(s+n/3))/20},getBounds:function(t){for(var e=t.slice(0,2),n=e.slice(),i=[0,0],o=0;o<2;o++)R._addBounds(t[o],t[o+2],t[o+4],t[o+6],o,0,e,n,i);return new A(e[0],e[1],n[0]-e[0],n[1]-e[1])},_addBounds:function(t,e,n,i,o,r,s,a,l){function h(t,e){var n=t-e;e=t+e,n<s[o]&&(s[o]=n),e>a[o]&&(a[o]=e)}var c=s[o]+(r/=2),u=a[o]-r;if(t<c||e<c||n<c||i<c||u<t||u<e||u<n||u<i)if(e<t!=e<i&&n<t!=n<i)h(t,0),h(i,0);else{var d=f.solveQuadratic(3*(e-n)-t+i,2*(t+n)-4*e,e-t,l);h(i,0);for(var p=0;p<d;p++){var g=l[p],m=1-g;1e-8<=g&&g<=1-1e-8&&h(m*m*m*t+3*m*m*g*e+3*m*g*g*n+g*g*g*i,r)}}}}},h.each(["getBounds","getStrokeBounds","getHandleBounds"],(function(t){this[t]=function(){return this._bounds||(this._bounds={}),(this._bounds[t]||(this._bounds[t]=z[t]([this._segment1,this._segment2],!1,this._path))).clone()}}),{}),h.each({isStraight:function(t,e,n,i){if(e.isZero()&&n.isZero())return!0;var o=i.subtract(t);if(o.isZero())return!1;if(o.isCollinear(e)&&o.isCollinear(n)){var r=new x(t,i);if(r.getDistance(t.add(e))<1e-7&&r.getDistance(i.add(n))<1e-7)return i=o.dot(o),e=o.dot(e)/i,i=o.dot(n)/i,0<=e&&e<=1&&i<=0&&-1<=i}return!1},isLinear:function(t,e,n,i){return t=i.subtract(t).divide(3),e.equals(t)&&n.negate().equals(t)}},(function(t,e){this[e]=function(e){var n=this._segment1,i=this._segment2;return t(n._point,n._handleOut,i._handleIn,i._point,e)},this.statics[e]=function(e,n){var i=e[0],o=e[1],r=e[6],s=e[7];return t(new v(i,o),new v(e[2]-i,e[3]-o),new v(e[4]-r,e[5]-s),new v(r,s),n)}}),{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(t){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(t||0)},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(t,e){return this.getLocationAtTime(e?t:this.getTimeAt(t))},getLocationAtTime:function(t){return null!=t&&0<=t&&t<=1?new F(this,t):null},getTimeAt:function(t,e){return R.getTimeAt(this.getValues(),t,e)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var t=v.read(arguments);return t.isZero()?[]:R.getTimesWithTangent(this.getValues(),t)},getOffsetAtTime:function(t){return this.getPartLength(0,t)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(v.read(arguments)))},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getTimeOf:function(){return R.getTimeOf(this.getValues(),v.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var t=v.read(arguments),e=this.getValues(),n=R.getNearestTime(e,t);return e=R.getPoint(e,n),new F(this,n,e,null,t.getDistance(e))},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t&&t.getPoint()}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return h.each(t,(function(t){this[t+"At"]=function(e,n){var i=this.getValues();return R[t](i,n?e:R.getTimeAt(i,e))},this[t+"AtTime"]=function(e){return R[t](this.getValues(),e)}}),{statics:{_evaluateMethods:t}})},new function(){function t(t){var e=t[0],n=t[1],i=t[2],o=t[3],r=t[4],s=t[5],a=t[6],l=(t=t[7],9*(i-r)+3*(a-e)),h=6*(e+r)-12*i,c=3*(i-e),u=9*(o-s)+3*(t-n),d=6*(n+s)-12*o,p=3*(o-n);return function(t){var e=(l*t+h)*t+c;return t=(u*t+d)*t+p,Math.sqrt(e*e+t*t)}}function e(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function n(t,e,n,i){if(null==e||e<0||1<e)return null;var o=t[0],r=t[1],s=t[2],a=t[3],l=t[4],h=t[5],c=t[6],u=t[7];(w=f.isZero)(s-o)&&w(a-r)&&(s=o,a=r),w(l-c)&&w(h-u)&&(l=c,h=u);var d,p,g=3*(s-o),m=3*(l-s)-g,_=c-o-g-m,y=3*(a-r),w=u-r-y-(t=3*(h-a)-y);return 0===n?(d=0===e?o:1===e?c:((_*e+m)*e+g)*e+o,p=0===e?r:1===e?u:((w*e+t)*e+y)*e+r):(p=e<1e-8?(d=g,y):1-1e-8<e?(d=3*(c-l),3*(u-h)):(d=(3*_*e+2*m)*e+g,(3*w*e+2*t)*e+y),i&&(0===d&&0===p&&(e<1e-8||1-1e-8<e)&&(d=l-s,p=h-a),(a=Math.sqrt(d*d+p*p))&&(d/=a,p/=a)),3===n&&(l=6*_*e+2*m,h=6*w*e+2*t,d=0!==(t=Math.pow(d*d+p*p,1.5))?(d*h-p*l)/t:0,p=0)),2===n?new v(p,-d):new v(d,p)}return{statics:{classify:function(t){var e=t[0],n=t[1],i=t[2],o=t[3],r=t[4],a=t[5],l=t[6],h=(t=i*(n-(h=t[7]))+o*(l-e)+e*h-n*l,l=(o=(i=3*(r*(o-n)+a*(e-i)+i*n-o*e))-t)-t+(e*(h-a)+n*(r-l)+l*a-h*r),0!==(a=Math.sqrt(l*l+o*o+i*i))?1/a:0);function c(t,e,n){var i=e!==s,o=i&&0<e&&e<1,r=i&&0<n&&n<1;return!i||(o||r)&&("loop"!==t||o&&r)||(o=r=!(t="arch")),{type:t,roots:o||r?o&&r?e<n?[e,n]:[n,e]:[o?e:n]:null}}return a="serpentine",o*=h,i*=h,(r=f.isZero)(l*=h)?r(o)?c(r(i)?"line":"quadratic"):c(a,i/(3*o)):r(i=3*o*o-4*l*i)?c("cusp",o/(2*l)):c(0<i?a:"loop",(o+(r=0<i?Math.sqrt(i/3):Math.sqrt(-i)))/(l*=2),(o-r)/l)},getLength:function(n,i,o,r){if(i===s&&(i=0),o===s&&(o=1),R.isStraight(n)){var a=n;o<1&&(a=R.subdivide(a,o)[0],i/=o);var l=(a=0<i?R.subdivide(a,i)[1]:a)[6]-a[0];return a=a[7]-a[1],Math.sqrt(l*l+a*a)}return f.integrate(r||t(n),i,o,e(i,o))},getTimeAt:function(n,i,o){if(o===s&&(o=i<0?1:0),0===i)return o;var r=Math.abs,a=0<i,l=a?o:0,h=a?1:o,c=t(n),u=R.getLength(n,l,h,c);if(n=r(i)-u,r(n)<1e-12)return a?h:l;if(1e-12<n)return null;var d=0;return f.findRoot((function(t){return d+=f.integrate(c,o,t,e(o,t)),o=t,d-i}),c,o+i/u,l,h,32,1e-12)},getPoint:function(t,e){return n(t,e,0,!1)},getTangent:function(t,e){return n(t,e,1,!0)},getWeightedTangent:function(t,e){return n(t,e,1,!1)},getNormal:function(t,e){return n(t,e,2,!0)},getWeightedNormal:function(t,e){return n(t,e,2,!1)},getCurvature:function(t,e){return n(t,e,3,!1).x},getPeaks:function(t){var e=t[0],n=t[1],i=t[2],o=t[3],r=t[4],s=t[5],a=3*i-e-3*r+t[6];return r=3*e-6*i+3*r,i=-3*e+3*i,t=3*o-n-3*s+t[7],s=3*n-6*o+3*s,n=-3*n+3*o,o=[],f.solveCubic(9*(a*a+t*t),9*(a*r+s*t),2*(r*r+s*s)+3*(i*a+n*t),i*r+s*n,o,1e-8,1-1e-8),o.sort()}}}},new function(){function t(t,e,n,i,o,r,s){var a=!s&&n.getPrevious()===o,l=!s&&n!==o&&n.getNext()===o;null!==i&&(a?1e-8:0)<=i&&i<=(l?1-1e-8:1)&&null!==r&&(l?1e-8:0)<=r&&r<=(a?1-1e-8:1)&&(i=new F(n,i,null,s),s=new F(o,r,null,s),(i._intersection=s)._intersection=i,e&&!e(i)||F.insert(t,i,!0))}function e(i,o,r,s,a,l,h,c,u,d,p,g,f){if(4096<=++u||40<=++c)return u;var m,v,_,y,w,A,b=o[0],C=o[1],I=o[6],S=o[7],T=x.getSignedDistance,k=T(b,C,I,S,o[2],o[3]),P=T(b,C,I,S,o[4],o[5]),E=(_=0<k*P?.75:4/9)*Math.min(0,k,P),O=_*Math.max(0,k,P),B=T(b,C,I,S,i[0],i[1]),L=T(b,C,I,S,i[2],i[3]);return I=function(t,e,n,i){var o=[0,t],r=[1/3,e],s=[2/3,n],a=[1,i];return a=(e-=(2*t+i)/3)*(t=n-(t+2*i)/3)<0?[[o,r,a],[o,s,a]]:[2<=(i=e/t)?[o,r,a]:i<=.5?[o,s,a]:[o,r,s,a],[o,a]],(e||t)<0?a.reverse():a}(B,L,_=T(b,C,I,S,i[4],i[5]),C=T(b,C,I,S,i[6],i[7])),S=I[0],I=I[1],0===k&&0===P&&0===B&&0===L&&0===_&&0===C||null==(m=n(S,I,E,O))||null==(v=n(S.reverse(),I.reverse(),E,O))||(O=d+(p-d)*m,p=d+(p-d)*v,Math.max(f-g,p-O)<1e-9?(y=(O+p)/2,A=(g+f)/2,t(a,l,h?s:r,h?A:y,h?r:s,h?y:A)):(i=R.getPart(i,m,v),d=f-g,u=.8<v-m?d<p-O?(u=e(o,(w=R.subdivide(i,.5))[0],s,r,a,l,!h,c,u,g,f,O,y=(O+p)/2),e(o,w[1],s,r,a,l,!h,c,u,g,f,y,p)):(u=e((w=R.subdivide(o,.5))[0],i,s,r,a,l,!h,c,u,g,A=(g+f)/2,O,p),e(w[1],i,s,r,a,l,!h,c,u,A,f,O,p)):0==d||1e-9<=d?e(o,i,s,r,a,l,!h,c,u,g,f,O,p):e(i,o,r,s,a,l,h,c,u,O,p,g,f))),u}function n(t,e,n,o){return t[0][1]<n?i(t,!0,n):e[0][1]>o?i(e,!1,o):t[0][0]}function i(t,e,n){for(var i=t[0][0],o=t[0][1],r=1,s=t.length;r<s;r++){var a=t[r][0],l=t[r][1];if(e?n<=l:l<=n)return l===n?a:i+(n-o)*(a-i)/(l-o);i=a,o=l}return null}function o(t,e,n,i,o){var r=f.isZero;if(r(i)&&r(o))return null===(r=R.getTimeOf(t,new v(e,n)))?[]:[r];i=Math.atan2(-o,i);for(var s=Math.sin(i),a=Math.cos(i),l=[],h=(i=[],0);h<8;h+=2){var c=t[h]-e,u=t[h+1]-n;l.push(c*a-u*s,c*s+u*a)}return R.solveCubic(l,1,0,i,0,1),i}function r(n,i,r,s,l,h){var c=1e-12,u=Math.min;if((y=Math.max)(n[0],n[2],n[4],n[6])+c>u(i[0],i[2],i[4],i[6])&&u(n[0],n[2],n[4],n[6])-c<y(i[0],i[2],i[4],i[6])&&y(n[1],n[3],n[5],n[7])+c>u(i[1],i[3],i[5],i[7])&&u(n[1],n[3],n[5],n[7])-c<y(i[1],i[3],i[5],i[7])){var d=a(n,i);if(d)for(var p=0;p<2;p++){var g=d[p];t(l,h,r,g[0],s,g[1],!0)}else{var f=R.isStraight(n),m=R.isStraight(i),_=f&&m,y=(u=f&&!m,l.length);if((_?function(e,n,i,o,r,s){var a=x.intersect(e[0],e[1],e[6],e[7],n[0],n[1],n[6],n[7]);a&&t(r,s,i,R.getTimeOf(e,a),o,R.getTimeOf(n,a))}:f||m?function(e,n,i,r,s,a,l){for(var h=n[0],c=n[1],u=o(e,h,c,n[6]-h,n[7]-c),d=0,p=u.length;d<p;d++){var g=u[d],f=R.getPoint(e,g);null!==(f=R.getTimeOf(n,f))&&t(s,a,l?r:i,l?f:g,l?i:r,l?g:f)}}:e)(u?i:n,u?n:i,u?s:r,u?r:s,l,h,u,0,0,0,1,0,1),!_||l.length===y)for(p=0;p<4;p++){var w=p>>1,A=1&p,b=6*A,C=new v(n[C=6*w],n[1+C]);b=new v(i[b],i[1+b]),C.isClose(b,c)&&t(l,h,r,w,s,A)}}}return l}function s(e,n,i,o){return"loop"===(e=R.classify(e)).type&&t(i,o,n,(e=e.roots)[0],n,e[1]),i}function a(t,e){function n(t){var e=t[6]-t[0];return e*e+(t=t[7]-t[1])*t}var i,o=Math.abs,r=x.getDistance,s=1e-7,a=R.isStraight(t),l=R.isStraight(e),h=a&&l,c=(i=n(t)<n(e))?e:t,u=i?t:e,d=c[0],p=c[1],g=c[6]-d;if(r(d,p,g,i=c[7]-p,u[0],u[1],!0)<s&&r(d,p,g,i,u[6],u[7],!0)<s)!h&&r(d,p,g,i,c[2],c[3],!0)<s&&r(d,p,g,i,c[4],c[5],!0)<s&&r(d,p,g,i,u[2],u[3],!0)<s&&r(d,p,g,i,u[4],u[5],!0)<s&&(a=l=h=!0);else if(h)return null;if(a^l)return null;for(var f=[t,e],m=[],_=0;_<4&&m.length<2;_++){var y=1&_,w=1^y,A=_>>1;if(null!=(w=R.getTimeOf(f[y],new v(f[w][A?6:0],f[w][A?7:1])))&&(A=y?[A,w]:[w,A],(!m.length||1e-8<o(A[0]-m[0][0])&&1e-8<o(A[1]-m[0][1]))&&m.push(A)),2<_&&!m.length)break}return 2!==m.length?m=null:h||(t=R.getPart(t,m[0][0],m[1][0]),(o((e=R.getPart(e,m[0][1],m[1][1]))[2]-t[2])>s||o(e[3]-t[3])>s||o(e[4]-t[4])>s||o(e[5]-t[5])>s)&&(m=null)),m}return{getIntersections:function(t){var e=this.getValues(),n=t&&t!==this&&t.getValues();return n?r(e,n,this,t,[]):s(e,this,[])},statics:{getOverlaps:a,getIntersections:function(t,e,n,i,o,a){for(var l=!e,h=t.length,c=(e=l?t:e).length,u=new Array(h),d=l?u:new Array(c),g=[],f=0;f<h;f++)u[f]=t[f].getValues(i);if(!l)for(f=0;f<c;f++)d[f]=e[f].getValues(o);for(var m=p.findCurveBoundsCollisions(u,d,1e-7),v=0;v<h;v++){var _=t[v],y=u[v];l&&s(y,_,g,n);var w=m[v];if(w)for(var A=0;A<w.length;A++){if(a&&g.length)return g;var b,C=w[A];(!l||v<C)&&(b=e[C],r(y,d[C],_,b,g,n))}}return g},getCurveLineIntersections:o,getTimesWithTangent:function(t,e){var n,i=t[0],o=t[1],r=t[2],s=t[3],a=t[4],l=t[5],h=t[6],c=t[7];return e=(t=e.normalize()).x,h=3*h-9*a+9*r-3*i,c=3*c-9*l+9*s-3*o,a=6*a-12*r+6*i,l=6*l-12*s+6*o,r=3*r-3*i,i=3*s-3*o,s=2*h*(t=t.y)-2*c*e,o=[],Math.abs(s)<f.CURVETIME_EPSILON?0==(s=h*l-c*a)||0<=(n=-(h*i-c*r)/s)&&n<=1&&o.push(n):(n=a*t-l*e,0<=(i=(a*a-4*h*r)*t*t+(-2*a*l+4*c*r+4*h*i)*e*t+(l*l-4*c*i)*e*e)&&0!=s&&(i=(-n+(e=Math.sqrt(i)))/s,0<=(s=-(n+e)/s)&&s<=1&&o.push(s),0<=i&&i<=1&&o.push(i))),o}}}}),F=h.extend({_class:"CurveLocation",initialize:function(t,e,n,i,o){var r;.99999999<=e&&(r=t.getNext())&&(e=0,t=r),this._setCurve(t),this._time=e,this._point=n||t.getPointAtTime(e),this._overlap=i,this._distance=o,this._intersection=this._next=this._previous=null},_setPath:function(t){this._path=t,this._version=t?t._version:0},_setCurve:function(t){this._setPath(t._path),this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){var e=t.getCurve();e?this._setCurve(e):(this._setPath(t._path),this._segment1=t,this._segment2=null),this._segment=t,this._time=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t,e,n=this._segment;return n||(t=this.getCurve(),0===(e=this.getTime())?n=t._segment1:1===e?n=t._segment2:null!=e&&(n=t.getPartLength(0,e)<t.getPartLength(e,1)?t._segment1:t._segment2),this._segment=n),n},getCurve:function(){var t=this._path,e=this;function n(t){if((t=t&&t.getCurve())&&null!=(e._time=t.getTimeOf(e._point)))return e._setCurve(t),t}return t&&t._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null),this._curve||n(this._segment)||n(this._segment1)||n(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getTime:function(){var t=this.getCurve(),e=this._time;return t&&null==e?this._time=t.getTimeOf(this._point):e},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){if(null==(t=this._offset)){var t=0,e=this.getPath(),n=this.getIndex();if(e&&null!=n)for(var i=e.getCurves(),o=0;o<n;o++)t+=i[o].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t,e,n=this._curveOffset;return null==n&&(t=this.getCurve(),e=this.getTime(),this._curveOffset=n=null!=e&&t&&t.getPartLength(0,e)),n},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t;return(t=(t=this.getCurve())&&t.divideAtTime(this.getTime()))&&this._setSegment(t._segment1),t},split:function(){var t,e=(t=this.getCurve())._path;return(t=t&&t.splitAtTime(this.getTime()))&&this._setSegment(e.getLastSegment()),t},equals:function(t,e){var n,i,o,r,s=this===t;return!s&&t instanceof F&&(o=this.getCurve(),r=t.getCurve(),(n=o._path)===r._path&&(o=(i=Math.abs)(this.getOffset()-t.getOffset()),r=!e&&this._intersection,t=!e&&t._intersection,s=(o<1e-7||n&&i(n.getLength()-o)<1e-7)&&(!r&&!t||r&&t&&r.equals(t,!0)))),s},toString:function(){var t=[],e=this.getPoint(),n=g.instance;return e&&t.push("point: "+e),null!=(e=this.getIndex())&&t.push("index: "+e),null!=(e=this.getTime())&&t.push("time: "+n.number(e)),null!=this._distance&&t.push("distance: "+n.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){if((e=this._intersection)&&this.getTangent().isCollinear(e.getTangent())){var t=this.getCurve(),e=e.getCurve();return!(t.isStraight()&&e.isStraight()&&t.getLine().intersect(e.getLine()))}return!1},isCrossing:function(){if(!(h=this._intersection))return!1;var t=this.getTime(),e=h.getTime(),n=1e-8,i=1-n,o=n<=t&&t<=i,r=n<=e&&e<=i;if(o&&r)return!this.isTouching();var s=this.getCurve(),a=s&&t<n?s.getPrevious():s,l=h.getCurve(),h=l&&e<n?l.getPrevious():l;if(i<t&&(s=s.getNext()),i<e&&(l=l.getNext()),!(a&&s&&h&&l))return!1;var c=[];function u(t,e){var n=t.getValues(),i=(t=(i=R.classify(n).roots||R.getPeaks(n)).length,R.getLength(n,e&&t?i[t-1]:0,!e&&t?i[0]:1));c.push(t?i:i/32)}function d(t,e,n){return e<n?e<t&&t<n:e<t||t<n}return o||(u(a,!0),u(s,!1)),r||(u(h,!0),u(l,!1)),n=this.getPoint(),i=Math.min.apply(Math,c),s=o?s.getTangentAtTime(t):s.getPointAt(i).subtract(n),a=o?s.negate():a.getPointAt(-i).subtract(n),l=r?l.getTangentAtTime(e):l.getPointAt(i).subtract(n),n=r?l.negate():h.getPointAt(-i).subtract(n),a=a.getAngle(),s=s.getAngle(),n=n.getAngle(),l=l.getAngle(),!!(o?d(a,n,l)^d(s,n,l)&&d(a,l,n)^d(s,l,n):d(n,a,s)^d(l,a,s)&&d(n,s,a)^d(l,s,a))},hasOverlap:function(){return!!this._overlap}},h.each(R._evaluateMethods,(function(t){var e=t+"At";this[t]=function(){var t=this.getCurve(),n=this.getTime();return null!=n&&t&&t[e](n,!0)}}),{preserve:!0}),new function(){function t(t,e,n){var i=t.length,o=0,r=i-1;function s(n,o){for(var r=n+o;-1<=r&&r<=i;r+=o){var s=t[(r%i+i)%i];if(!e.getPoint().isClose(s.getPoint(),1e-7))break;if(e.equals(s))return s}return null}for(;o<=r;){var a,l=o+r>>>1,h=t[l];if(n&&(a=e.equals(h)?h:s(l,-1)||s(l,1)))return e._overlap&&(a._overlap=a._intersection._overlap=!0),a;var c=e.getPath(),u=h.getPath();(c!==u?c._id-u._id:e.getIndex()+e.getTime()-(h.getIndex()+h.getTime()))<0?r=l-1:o=1+l}return t.splice(o,0,e),e}return{statics:{insert:t,expand:function(e){for(var n=e.slice(),i=e.length-1;0<=i;i--)t(n,e[i]._intersection,!1);return n}}}}),j=S.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(t){var e,n,i;return h.isPlainObject(t)?(n=t.segments,e=t.pathData):Array.isArray(t)?n=t:"string"==typeof t&&(e=t),n?i=(i=n[0])&&Array.isArray(i[0]):e&&(i=1<(e.match(/m/gi)||[]).length||/z\s*\S+/i.test(e)),new(i?D:z)(t)}},_asPathItem:function(){return this},isClockwise:function(){return 0<=this.getArea()},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse()},setPathData:function(t){var e,n,i=t&&t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),o=!1,r=new v,s=new v;function a(t,e){return t=+u[t],o&&(t+=r[e]),t}function l(t){return new v(a(t,"x"),a(t+1,"y"))}this.clear();for(var h=0,c=i&&i.length;h<c;h++){var u,d=i[h],p=d[0],g=p.toLowerCase(),f=(u=d.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&u.length;switch(o=p===g,"z"!==e||/[mz]/.test(g)||this.moveTo(r),g){case"m":case"l":for(var m="m"===g,_=0;_<f;_+=2)this[m?"moveTo":"lineTo"](r=l(_)),m&&(s=r,m=!1);n=r;break;case"h":case"v":var w="h"===g?"x":"y";for(r=r.clone(),_=0;_<f;_++)r[w]=a(_,w),this.lineTo(r);n=r;break;case"c":for(_=0;_<f;_+=6)this.cubicCurveTo(l(_),n=l(_+2),r=l(_+4));break;case"s":for(_=0;_<f;_+=4)this.cubicCurveTo(/[cs]/.test(e)?r.multiply(2).subtract(n):r,n=l(_),r=l(_+2)),e=g;break;case"q":for(_=0;_<f;_+=4)this.quadraticCurveTo(n=l(_),r=l(_+2));break;case"t":for(_=0;_<f;_+=2)this.quadraticCurveTo(n=/[qt]/.test(e)?r.multiply(2).subtract(n):r,r=l(_)),e=g;break;case"a":for(_=0;_<f;_+=7)this.arcTo(r=l(_+5),new y(+u[_],+u[_+1]),+u[_+2],+u[_+4],+u[_+3]);break;case"z":this.closePath(1e-12),r=s}e=g}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){return(t=t.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(t):{}).onPath||!!("evenodd"===this.getFillRule()?1&t.windingL||1&t.windingR:t.winding)},getIntersections:function(t,e,n,i){var o=this===t||!t,r=this._matrix._orNullIfIdentity();return n=o?r:(n||t._matrix)._orNullIfIdentity(),o||this.getBounds(r).intersects(t.getBounds(n),1e-12)?R.getIntersections(this.getCurves(),!o&&t.getCurves(),e,r,n,i):[]},getCrossings:function(t){return this.getIntersections(t,(function(t){return t.isCrossing()}))},getNearestLocation:function(){for(var t=v.read(arguments),e=this.getCurves(),n=1/0,i=null,o=0,r=e.length;o<r;o++){var s=e[o].getNearestLocation(t);s._distance<n&&(n=s._distance,i=s)}return i},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t&&t.getPoint()},interpolate:function(t,e,n){var i=!this._children,o=i?"_segments":"_children",r=t[o],s=e[o],a=this[o];if(!r||!s||r.length!==s.length)throw new Error("Invalid operands in interpolate() call: "+t+", "+e);e=a.length;var l=s.length;if(e<l)for(var h=i?M:z,c=e;c<l;c++)this.add(new h);else l<e&&this[i?"removeSegments":"removeChildren"](l,e);for(c=0;c<l;c++)a[c].interpolate(r[c],s[c],n);i&&(this.setClosed(t._closed),this._changed(9))},compare:function(t){var e=!1;if(t){var n=this._children||[this],i=t._children?t._children.slice():[t],o=n.length,r=(t=i.length,[]),s=0;e=!0;for(var a=p.findItemBoundsCollisions(n,i,f.GEOMETRIC_EPSILON),l=o-1;0<=l&&e;l--){var h=n[l],c=(e=!1,a[l]);if(c)for(var u=c.length-1;0<=u&&!e;u--)h.compare(i[c[u]])&&(r[c[u]]||(r[c[u]]=!0,s++),e=!0)}e=e&&s===t}return e}}),z=j.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(t){this._closed=!1,this._segments=[],this._version=0;var e=arguments;(e=Array.isArray(t)?"object"==typeof t[0]?t:e:!t||t.size!==s||t.x===s&&t.point===s?null:e)&&0<e.length?this.setSegments(e):(this._curves=s,this._segmentSelection=0,e||"string"!=typeof t||(this.setPathData(t),t=null)),this._initialize(!e&&t)},_equals:function(t){return this._closed===t._closed&&h.equals(this._segments,t._segments)},copyContent:function(t){this.setSegments(t._segments),this._closed=t._closed},_changed:function t(e){if(t.base.call(this,e),8&e){if(this._length=this._area=s,32&e)this._version++;else if(this._curves)for(var n=0,i=this._curves.length;n<i;n++)this._curves[n]._changed()}else 64&e&&(this._bounds=s)},getStyle:function(){var t=this._parent;return(t instanceof D?t:this)._style},getSegments:function(){return this._segments},setSegments:function(t){var e,n=this.isFullySelected(),i=t&&t.length;this._segments.length=0,this._segmentSelection=0,this._curves=s,i&&("boolean"==typeof(e=t[i-1])&&(this.setClosed(e),i--),this._add(M.readList(t,0,{},i))),n&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t)for(var n=this._countCurves(),i=(t=this._curves=new Array(n),0);i<n;i++)t[i]=new R(this,e[i],e[i+1]||e[0]);return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){var e;this._closed!=(t=!!t)&&(this._closed=t,this._curves&&(e=this._curves.length=this._countCurves(),t&&(this._curves[e-1]=new R(this,this._segments[e-1],this._segments[0]))),this._changed(41))}},{beans:!0,getPathData:function(t,e){var n,i,o,r,s,a,l,h,c=this._segments,u=c.length,d=new g(e),p=new Array(6),f=!0,m=[];function v(e,c){e._transformCoordinates(t,p),n=p[0],i=p[1],f?(m.push("M"+d.pair(n,i)),f=!1):(s=p[2],a=p[3],s===n&&a===i&&l===o&&h===r?c||(e=i-r,m.push(0==(c=n-o)?"v"+d.number(e):0==e?"h"+d.number(c):"l"+d.pair(c,e))):m.push("c"+d.pair(l-o,h-r)+" "+d.pair(s-o,a-r)+" "+d.pair(n-o,i-r))),o=n,r=i,l=p[4],h=p[5]}if(!u)return"";for(var _=0;_<u;_++)v(c[_]);return this._closed&&0<u&&(v(c[0],!0),m.push("z")),m.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(t){for(var e=this._segments,n=new Array(6),i=0,o=e.length;i<o;i++)e[i]._transformCoordinates(t,n,!0);return!0},_add:function(t,e){for(var n=this._segments,i=this._curves,o=t.length,r=(e=(u=null==e)?n.length:e,0);r<o;r++){var s=t[r];(s=s._path?t[r]=s.clone():s)._path=this,s._index=e+r,s._selection&&this._updateSelection(s,0,s._selection)}if(u)h.push(n,t);else{n.splice.apply(n,[e,0].concat(t)),r=e+o;for(var a=n.length;r<a;r++)n[r]._index=r}if(i){var l=this._countCurves(),c=0<e&&e+o-1===l?e-1:e,u=c,d=Math.min(c+o,l);for(t._curves&&(i.splice.apply(i,[c,0].concat(t._curves)),u+=t._curves.length),r=u;r<d;r++)i.splice(r,0,new R(this,null,null));this._adjustCurves(c,d)}return this._changed(41),t},_adjustCurves:function(t,e){for(var n,i=this._segments,o=this._curves,r=t;r<e;r++)(n=o[r])._path=this,n._segment1=i[r],n._segment2=i[r+1]||i[0],n._changed();(n=o[this._closed&&!t?i.length-1:t-1])&&(n._segment2=i[t]||i[0],n._changed()),(n=o[e])&&(n._segment1=i[e],n._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&0<t?t-1:t},add:function(t){var e=arguments;return 1<e.length&&"number"!=typeof t?this._add(M.readList(e)):this._add([M.read(e)])[0]},insert:function(t,e){var n=arguments;return 2<n.length&&"number"!=typeof e?this._add(M.readList(n,1),t):this._add([M.read(n,1)],t)[0]},addSegment:function(){return this._add([M.read(arguments)])[0]},insertSegment:function(t){return this._add([M.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(M.readList(t))},insertSegments:function(t,e){return this._add(M.readList(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,e,n){t=t||0,e=h.pick(e,this._segments.length);var i=this._segments,o=this._curves,r=i.length,s=i.splice(t,e-t),a=s.length;if(!a)return s;for(var l=0;l<a;l++){var c=s[l];c._selection&&this._updateSelection(c,c._selection,0),c._index=c._path=null}l=t;for(var u=i.length;l<u;l++)i[l]._index=l;if(o){for(t=0<t&&e===r+(this._closed?1:0)?t-1:t,l=(o=o.splice(t,a)).length-1;0<=l;l--)o[l]._path=null;n&&(s._curves=o.slice(1)),this._adjustCurves(t,t)}return this._changed(41),s},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,n=t.length;e<n;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,n=t.length;e<n;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,n=0,i=t.length;n<i;n++)e+=t[n].getLength();this._length=e}return this._length},getArea:function(){if(null==(n=this._area)){for(var t=this._segments,e=this._closed,n=0,i=0,o=t.length;i<o;i++){var r=i+1===o;n+=R.getArea(R.getValues(t[i],t[r?0:i+1],null,r&&!e))}this._area=n}return n},isFullySelected:function(){var t=this._segments.length;return this.isSelected()&&0<t&&this._segmentSelection===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelection:function t(e){1&e||this._selectSegments(!1),t.base.call(this,e)},_selectSegments:function(t){var e=this._segments,n=e.length,i=t?7:0;this._segmentSelection=i*n;for(var o=0;o<n;o++)e[o]._selection=i},_updateSelection:function(t,e,n){t._selection=n,0<(this._segmentSelection+=n-e)&&this.setSelected(!0)},divideAt:function(t){var e;return(t=this.getLocationAt(t))&&(e=t.getCurve().divideAt(t.getCurveOffset()))?e._segment1:null},splitAt:function(t){var e,n=this.getLocationAt(t),i=n&&n.index;return 1-1e-8<(t=n&&n.time)&&(i++,t=0),n=this.getCurves(),0<=i&&i<n.length?(1e-8<=t&&n[i++].divideAtTime(t),i=this.removeSegments(i,this._segments.length,!0),this._closed?(this.setClosed(!1),e=this):((e=new z(S.NO_INSERT)).insertAbove(this),e.copyAttributes(this)),e._add(i,0),this.addSegment(i[0]),e):null},split:function(t,e){return null!=(e=e===s?t:(t=this.getCurves()[t])&&t.getLocationAtTime(e))?this.splitAt(e):null},join:function(t,e){var n=e||0;if(t&&t!==this){var i=t._segments,o=this.getLastSegment(),r=t.getLastSegment();if(!r)return this;o&&o._point.isClose(r._point,n)&&t.reverse(),e=t.getFirstSegment(),o&&o._point.isClose(e._point,n)?(o.setHandleOut(e._handleOut),this._add(i.slice(1))):((o=this.getFirstSegment())&&o._point.isClose(e._point,n)&&t.reverse(),r=t.getLastSegment(),o&&o._point.isClose(r._point,n)?(o.setHandleIn(r._handleIn),this._add(i.slice(0,i.length-1),0)):this._add(i.slice())),t._closed&&this._add([i[0]]),t.remove()}return(i=this.getFirstSegment())!==(t=this.getLastSegment())&&i._point.isClose(t._point,n)&&(i.setHandleIn(t._handleIn),t.remove(),this.setClosed(!0)),this},reduce:function(t){for(var e=this.getCurves(),n=t&&t.simplify,i=n?1e-7:0,o=e.length-1;0<=o;o--){var r=e[o];!r.hasHandles()&&(!r.hasLength(i)||n&&r.isCollinear(r.getNext()))&&r.remove()}return this},reverse:function(){this._segments.reverse();for(var t=0,e=this._segments.length;t<e;t++){var n=this._segments[t],i=n._handleIn;n._handleIn=n._handleOut,n._handleOut=i,n._index=t}this._curves=null,this._changed(9)},flatten:function(t){for(var e=new H(this,t||.25,256,!0).parts,n=e.length,i=[],o=0;o<n;o++)i.push(new M(e[o].curve.slice(0,2)));!this._closed&&0<n&&i.push(new M(e[n-1].curve.slice(6))),this.setSegments(i)},simplify:function(t){return(t=new G(this).fit(t||2.5))&&this.setSegments(t),!!t},smooth:function(t){var e=this,n=t||{},i=(t=n.type||"asymmetric",this._segments),o=i.length,r=this._closed;function a(t,n){var i=t&&t.index;if(null!=i){var s=t.path;if(s&&s!==e)throw new Error(t._class+" "+i+" of "+s+" is not part of "+e);n&&t instanceof R&&i++}else i="number"==typeof t?t:n;return Math.min(i<0&&r?i%o:i<0?i+o:i,o-1)}var l=r&&n.from===s&&n.to===s,h=a(n.from,0),c=a(n.to,o-1);if(c<h&&(r?h-=o:(d=h,h=c,c=d)),/^(?:asymmetric|continuous)$/.test(t)){var u="asymmetric"===t,d=Math.min,p=(t=c-h+1)-1,g=t=l?d(t,4):1,f=[];if(r||(g=d(1,h),t=d(1,o-c-1)),!((p+=g+t)<=1)){for(var m=0,v=h-g;m<=p;m++,v++)f[m]=i[(v<0?v+o:v)%o]._point;var _=p-1,y=[P=f[0]._x+2*f[1]._x],w=[E=f[0]._y+2*f[1]._y],A=[k=2],b=[],C=[];for(m=1;m<p;m++)var x=m<_,I=x?4:u?3:8,S=x?2:u?0:1,T=(x||u?1:2)/k,k=A[m]=(x?4:u?2:7)-T,P=y[m]=I*f[m]._x+S*f[m+1]._x-T*P,E=w[m]=I*f[m]._y+S*f[m+1]._y-T*E;for(b[_]=y[_]/A[_],C[_]=w[_]/A[_],m=p-2;0<=m;m--)b[m]=(y[m]-b[m+1])/A[m],C[m]=(w[m]-C[m+1])/A[m];b[p]=(3*f[p]._x-b[_])/2,C[p]=(3*f[p]._y-C[_])/2,m=g;var O=p-t;for(v=h;m<=O;m++,v++){var B=i[v<0?v+o:v],L=B._point,M=b[m]-L._x;L=C[m]-L._y,(l||m<O)&&B.setHandleOut(M,L),(l||g<m)&&B.setHandleIn(-M,-L)}}}else for(m=h;m<=c;m++)i[m<0?m+o:m].smooth(n,!l&&m===h,!l&&m===c)},toShape:function(t){if(!this._closed)return null;var e,n,i,o,r,a,l=this._segments;function h(t,e){var n=l[t],i=n.getNext();return e=(t=l[e]).getNext(),n._handleOut.isZero()&&i._handleIn.isZero()&&t._handleOut.isZero()&&e._handleIn.isZero()&&i._point.subtract(n._point).isCollinear(e._point.subtract(t._point))}function c(t){var e=l[t],n=e.getNext(),i=e._handleOut,o=n._handleIn,r=.5522847498307936;if(i.isOrthogonal(o))return t=e._point,e=n._point,(n=new x(t,i,!0).intersect(new x(e,o,!0),!0))&&f.isZero(i.getLength()/n.subtract(t).getLength()-r)&&f.isZero(o.getLength()/n.subtract(e).getLength()-r)}function u(t,e){return l[t]._point.getDistance(l[e]._point)}if(!this.hasHandles()&&4===l.length&&h(0,2)&&h(1,3)&&(a=(r=l[o=1]).getPrevious(),o=r.getNext(),a._handleOut.isZero()&&r._handleIn.isZero()&&r._handleOut.isZero()&&o._handleIn.isZero()&&r._point.subtract(a._point).isOrthogonal(o._point.subtract(r._point)))?(e=P.Rectangle,n=new y(u(0,3),u(0,1)),i=l[1]._point.add(l[2]._point).divide(2)):8===l.length&&c(0)&&c(2)&&c(4)&&c(6)&&h(1,5)&&h(3,7)?(e=P.Rectangle,p=(n=new y(u(1,6),u(0,3))).subtract(new y(u(0,7),u(1,2))).divide(2),i=l[3]._point.add(l[4]._point).divide(2)):4===l.length&&c(0)&&c(1)&&c(2)&&c(3)&&(p=f.isZero(u(0,2)-u(1,3))?(e=P.Circle,u(0,2)/2):(e=P.Ellipse,new y(u(2,0)/2,u(3,1)/2)),i=l[1]._point),e){var d=this.getPosition(!0),p=new e({center:d,size:n,radius:p,insert:!1});return p.copyAttributes(this,!0),p._matrix.prepend(this._matrix),p.rotate(i.subtract(d).getAngle()+90),t!==s&&!t||p.insertAbove(this),p}return null},toPath:"#clone",compare:function t(e){if(!e||e instanceof D)return t.base.call(this,e);var n=this.getCurves(),i=e.getCurves(),o=n.length,r=i.length;if(!o||!r)return o==r;for(var s,a,l=n[0].getValues(),h=[],c=0,u=0,d=0;d<r;d++){var p=i[d].getValues();if(h.push(p),m=R.getOverlaps(l,p)){s=!d&&0<m[0][0]?r-1:d,a=m[0][1];break}}var g,f=Math.abs;for(p=h[s];l&&p;){var m=R.getOverlaps(l,p);if(m&&f(m[0][0]-u)<1e-8){1===(u=m[1][0])&&(l=++c<o?n[c].getValues():null,u=0);var v=m[0][1];if(f(v-a)<1e-8){if(g=g||[s,v],1===(a=m[1][1])&&(p=h[s=++s>=r?0:s]||i[s].getValues(),a=0),!l)return g[0]===s&&g[1]===a;continue}}break}return!1},_hitTestSelf:function(t,e,n,i){var o,r,s,a,l,h,c=this,u=this.getStyle(),d=this._segments,p=d.length,g=this._closed,f=e._tolerancePadding,m=f,v=e.stroke&&u.hasStroke(),_=e.fill&&u.hasFill(),y=e.curves,w=v?u.getStrokeWidth()/2:_&&0<e.tolerance||y?0:null;function A(e,n){return t.subtract(e).divide(n).length<=1}function b(t,n,i){if(!e.selected||n.isSelected()){var o=t._point;if(A(n=n!==o?n.add(o):n,m))return new L(i,c,{segment:t,point:n})}}function C(t,n){return(n||e.segments)&&b(t,t._point,"segment")||!n&&e.handles&&(b(t,t._handleIn,"handle-in")||b(t,t._handleOut,"handle-out"))}function x(t){a.add(t)}function I(e){var n=g||0<e._index&&e._index<p-1;return"round"===(n?o:r)?A(e._point,m):(a=new z({internal:!0,closed:!0}),n?e.isSmooth()||z._addBevelJoin(e,o,w,s,null,i,x,!0):"square"===r&&z._addSquareCap(e,r,w,null,i,x,!0),!a.isEmpty()&&(a.contains(t)||(e=a.getNearestLocation(t))&&A(e.getPoint(),f)))}if(null!==w&&(0<w?(o=u.getStrokeJoin(),r=u.getStrokeCap(),s=u.getMiterLimit(),m=m.add(z._getStrokePadding(w,i))):o=r="round"),!e.ends||e.segments||g){if(e.segments||e.handles)for(var S=0;S<p;S++)if(l=C(d[S]))return l}else if(l=C(d[0],!0)||C(d[p-1],!0))return l;if(null!==w&&((h=this.getNearestLocation(t))&&(0===(u=h.getTime())||1===u&&1<p?I(h.getSegment())||(h=null):A(h.getPoint(),m)||(h=null)),!h&&"miter"===o&&1<p))for(S=0;S<p;S++){var T=d[S];if(t.getDistance(T._point)<=s*w&&I(T)){h=T.getLocation();break}}return!h&&_&&this._contains(t)||h&&!v&&!y?new L("fill",this):h?new L(v?"stroke":"curve",this,{location:h,point:h.getPoint()}):null}},h.each(R._evaluateMethods,(function(t){this[t+"At"]=function(e){return(e=this.getLocationAt(e))&&e[t]()}}),{beans:!1,getLocationOf:function(){for(var t=v.read(arguments),e=this.getCurves(),n=0,i=e.length;n<i;n++){var o=e[n].getLocationOf(t);if(o)return o}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t){if("number"==typeof t){for(var e=this.getCurves(),n=0,i=0,o=e.length;i<o;i++){var r=n,s=e[i];if(t<(n+=s.getLength()))return s.getLocationAt(t-r)}if(0<e.length&&t<=this.getLength())return new F(e[e.length-1],1)}else if(t&&t.getPath&&t.getPath()===this)return t;return null},getOffsetsWithTangent:function(){var t=v.read(arguments);if(t.isZero())return[];for(var e=[],n=0,i=this.getCurves(),o=0,r=i.length;o<r;o++){for(var s=i[o],a=s.getTimesWithTangent(t),l=0,h=a.length;l<h;l++){var c=n+s.getOffsetAtTime(a[l]);e.indexOf(c)<0&&e.push(c)}n+=s.length}return e}}),new function(){function t(t,e,n){var i,o,r,s,a,l,h,c,u=e._segments,d=u.length,p=new Array(6),g=!0;function f(e){var u,d;o=n?(e._transformCoordinates(n,p),i=p[0],p[1]):(u=e._point,i=u._x,u._y),g?(t.moveTo(i,o),g=!1):(l=n?(a=p[2],p[3]):(d=e._handleIn,a=i+d._x,o+d._y),a===i&&l===o&&h===r&&c===s?t.lineTo(i,o):t.bezierCurveTo(h,c,a,l,i,o)),r=i,s=o,c=n?(h=p[4],p[5]):(d=e._handleOut,h=r+d._x,s+d._y)}for(var m=0;m<d;m++)f(u[m]);e._closed&&0<d&&f(u[0])}return{_draw:function(e,n,i,o){var r=n.dontStart,s=n.dontFinish||n.clip,a=this.getStyle(),l=a.hasFill(),h=a.hasStroke(),c=a.getDashArray(),u=!jt.support.nativeDash&&h&&c&&c.length;function d(t){return c[(t%u+u)%u]}if(r||e.beginPath(),(l||h&&!u||s)&&(t(e,this,o),this._closed&&e.closePath()),!s&&(l||h)&&(this._setStyles(e,n,i),l&&(e.fill(a.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),h)){if(u){r||e.beginPath();for(var p,g=new H(this,.25,32,!1,o),f=g.length,m=-a.getDashOffset(),v=0;0<m;)m-=d(v--)+d(v--);for(;m<f;)p=m+d(v++),(0<m||0<p)&&g.drawPart(e,Math.max(m,0),Math.max(p,0)),m=p+d(v++)}e.stroke()}},_drawSelected:function(e,n){e.beginPath(),t(e,this,n),e.stroke(),function(t,e,n,i){if(!(i<=0))for(var o,r,s=i/2,a=i-2,l=s-1,h=new Array(6),c=0,u=e.length;c<u;c++){var d=e[c],p=d._selection;d._transformCoordinates(n,h),o=h[0],r=h[1],2&p&&g(2),4&p&&g(4),t.fillRect(o-s,r-s,i,i),0<a&&!(1&p)&&(p=t.fillStyle,t.fillStyle="#ffffff",t.fillRect(o-l,r-l,a,a),t.fillStyle=p)}function g(e){var n=h[e];e=h[e+1],o==n&&r==e||(t.beginPath(),t.moveTo(o,r),t.lineTo(n,e),t.stroke(),t.beginPath(),t.arc(n,e,s,0,2*Math.PI,!0),t.fill())}}(e,this._segments,n,jt.settings.handleSize)}}},new function(){function t(t){if(!(t=t._segments).length)throw new Error("Use a moveTo() command first");return t[t.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new M(v.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new M(v.read(arguments))])},cubicCurveTo:function(){var e=arguments,n=v.read(e),i=v.read(e),o=v.read(e);(e=t(this)).setHandleOut(n.subtract(e._point)),this._add([new M(o,i.subtract(o))])},quadraticCurveTo:function(){var e=arguments,n=v.read(e),i=v.read(e);e=t(this)._point,this.cubicCurveTo(n.add(e.subtract(n).multiply(1/3)),n.add(i.subtract(n).multiply(1/3)),i)},curveTo:function(){var e=arguments,n=v.read(e),i=v.read(e),o=h.pick(h.read(e),.5),r=1-o;if(e=t(this)._point,(r=n.subtract(e.multiply(r*r)).subtract(i.multiply(o*o)).divide(2*o*r)).isNaN())throw new Error("Cannot put a curve through points with parameter = "+o);this.quadraticCurveTo(r,i)},arcTo:function(){var e,n=arguments,i=Math.abs,o=Math.sqrt,r=t(this),s=r._point,a=v.read(n),l=h.peek(n);if("boolean"==typeof(g=h.pick(l,!0)))var c=(_=s.add(a).divide(2)).add(_.subtract(s).rotate(g?-90:90));else if(h.remain(n)<=2)c=a,a=v.read(n);else if(!s.equals(a)){var u=y.read(n);if((d=f.isZero)(u.width)||d(u.height))return this.lineTo(a);var d,p=h.read(n),g=!!h.read(n),m=!!h.read(n),_=s.add(a).divide(2),w=(R=s.subtract(_).rotate(-p)).x,A=R.y,b=(T=i(u.width))*T;if(1<(u=o((d=w*w)/b+(n=A*A)/(l=(k=i(u.height))*k)))&&(b=(T*=u)*T,l=(k*=u)*k),(u=i(u=(b*l-b*n-l*d)/(b*n+l*d))<1e-12?0:u)<0)throw new Error("Cannot create an arc with the given arguments");I=new v(T*A/k,-k*w/T).multiply((m===g?-1:1)*o(u)).rotate(p).add(_),p=(S=(e=(new C).translate(I).rotate(p).scale(T,k))._inverseTransform(s)).getDirectedAngle(e._inverseTransform(a)),!g&&0<p?p-=360:g&&p<0&&(p+=360)}if(c){var I,S,T=new x(s.add(c).divide(2),c.subtract(s).rotate(90),!0),k=new x(c.add(a).divide(2),a.subtract(c).rotate(90),!0);if(c=(g=new x(s,a)).getSide(c),!(I=T.intersect(k,!0))){if(!c)return this.lineTo(a);throw new Error("Cannot create an arc with the given arguments")}p=(S=s.subtract(I)).getDirectedAngle(a.subtract(I)),0===(g=g.getSide(I,!0))?p=c*i(p):c===g&&(p+=p<0?360:-360)}if(p){for(var P=360<=(i=i(p))?4:Math.ceil((i-1e-5)/90),E=p/P,O=(p=E*Math.PI/360,4/3*Math.sin(p)/(1+Math.cos(p))),B=[],L=0;L<=P;L++){var N,R=a,F=null;L<P&&(F=S.rotate(90).multiply(O),e?(R=e._transformPoint(S),F=e._transformPoint(S.add(F)).subtract(R)):R=I.add(S)),L?(N=S.rotate(-90).multiply(O),e&&(N=e._transformPoint(S.add(N)).subtract(R)),B.push(new M(R,N,F))):r.setHandleOut(F),S=S.rotate(E)}this._add(B)}},lineBy:function(){var e=v.read(arguments),n=t(this)._point;this.lineTo(n.add(e))},curveBy:function(){var e=arguments,n=v.read(e),i=v.read(e),o=h.read(e);e=t(this)._point,this.curveTo(e.add(n),e.add(i),o)},cubicCurveBy:function(){var e=arguments,n=v.read(e),i=v.read(e),o=v.read(e);e=t(this)._point,this.cubicCurveTo(e.add(n),e.add(i),e.add(o))},quadraticCurveBy:function(){var e=arguments,n=v.read(e),i=v.read(e);e=t(this)._point,this.quadraticCurveTo(e.add(n),e.add(i))},arcBy:function(){var e=arguments,n=t(this)._point,i=n.add(v.read(e)),o=h.pick(h.peek(e),!0);"boolean"==typeof o?this.arcTo(i,o):this.arcTo(i,n.add(v.read(e)))},closePath:function(t){this.setClosed(!0),this.join(this,t)}}},{_getBounds:function(t,e){var n=e.handle?"getHandleBounds":e.stroke?"getStrokeBounds":"getBounds";return z[n](this._segments,this._closed,this,t,e)},statics:{getBounds:function(t,e,n,i,o,r){var s=t[0];if(!s)return new A;var a=new Array(6),l=s._transformCoordinates(i,new Array(6)),h=l.slice(0,2),c=h.slice(),u=new Array(2);function d(t){t._transformCoordinates(i,a);for(var e=0;e<2;e++)R._addBounds(l[e],l[e+4],a[e+2],a[e],e,r?r[e]:0,h,c,u);t=l,l=a,a=t}for(var p=1,g=t.length;p<g;p++)d(t[p]);return e&&d(s),new A(h[0],h[1],c[0]-h[0],c[1]-h[1])},getStrokeBounds:function(t,e,n,i,o){var r=n.getStyle(),s=r.hasStroke(),a=r.getStrokeWidth(),l=s&&n._getStrokeMatrix(i,o),h=s&&z._getStrokePadding(a,l),c=z.getBounds(t,e,n,i,o,h);if(!s)return c;var u=a/2,d=r.getStrokeJoin(),p=(a=r.getStrokeCap(),r.getMiterLimit()),g=new A(new y(h));function f(t){c=c.include(t)}function m(t){c=c.unite(g.setCenter(t._point.transform(i)))}function v(t,e){"round"===e||t.isSmooth()?m(t):z._addBevelJoin(t,e,u,p,i,l,f)}function _(t,e){"round"===e?m(t):z._addSquareCap(t,e,u,i,l,f)}var w=t.length-(e?0:1);if(0<w){for(var b=1;b<w;b++)v(t[b],d);e?v(t[0],d):(_(t[0],a),_(t[t.length-1],a))}return c},_getStrokePadding:function(t,e){if(!e)return[t,t];var n=new v(t,0).transform(e),i=new v(0,t).transform(e),o=n.getAngleInRadians(),r=n.getLength();return t=i.getLength(),e=Math.sin(o),n=Math.cos(o),i=Math.tan(o),o=Math.atan2(t*i,r),i=Math.atan2(t,i*r),[Math.abs(r*Math.cos(o)*n+t*Math.sin(o)*e),Math.abs(t*Math.sin(i)*n+r*Math.cos(i)*e)]},_addBevelJoin:function(t,e,n,i,o,r,s,a){t=(l=t.getCurve()).getPrevious(),o=l.getPoint1().transform(o),t=t.getNormalAtTime(1).multiply(n).transform(r);var l=l.getNormalAtTime(0).multiply(n).transform(r);((r=t.getDirectedAngle(l))<0||180<=r)&&(t=t.negate(),l=l.negate()),a&&s(o),s(o.add(t)),"miter"!==e||(t=new x(o.add(t),new v(-t.y,t.x),!0).intersect(new x(o.add(l),new v(-l.y,l.x),!0),!0))&&o.getDistance(t)<=i*n&&s(t),s(o.add(l))},_addSquareCap:function(t,e,n,i,o,r,s){i=t._point.transform(i),o=(t=t.getLocation()).getNormal().multiply(0===t.getTime()?n:-n).transform(o),"square"===e&&(s&&(r(i.subtract(o)),r(i.add(o))),i=i.add(o.rotate(-90))),r(i.add(o)),r(i.subtract(o))},getHandleBounds:function(t,e,n,i,o){var r,s,a,l=n.getStyle();o.stroke&&l.hasStroke()&&(a=n._getStrokeMatrix(i,o),o=n=l.getStrokeWidth()/2,"miter"===l.getStrokeJoin()&&(o=n*l.getMiterLimit()),"square"===l.getStrokeCap()&&(o=Math.max(o,n*Math.SQRT2)),r=z._getStrokePadding(n,a),s=z._getStrokePadding(o,a));for(var h=new Array(6),c=1/0,u=-c,d=c,p=u,g=0,f=t.length;g<f;g++){t[g]._transformCoordinates(i,h);for(var m=0;m<6;m+=2){var v,_=(v=m?r:s)?v[0]:0,y=v?v[1]:0,w=h[m],b=h[m+1];(v=w-_)<c&&(c=v),u<(w+=_)&&(u=w),(_=b-y)<d&&(d=_),p<(y=b+y)&&(p=y)}}return new A(c,d,u-c,p-d)}}});z.inject({statics:new function(){var t=.5522847498307936,e=[new M([-1,0],[0,t],[0,-t]),new M([0,-1],[-t,0],[t,0]),new M([1,0],[0,-t],[0,t]),new M([0,1],[t,0],[-t,0])];function n(t,e,n){var i=h.getNamed(n);return(n=new z(i&&(1==i.insert?S.INSERT:0==i.insert?S.NO_INSERT:null)))._add(t),n._closed=e,n.set(i,S.INSERT)}function i(t,i,o){for(var r=new Array(4),s=0;s<4;s++){var a=e[s];r[s]=new M(a._point.multiply(i).add(t),a._handleIn.multiply(i),a._handleOut.multiply(i))}return n(r,!0,o)}return{Line:function(){var t=arguments;return n([new M(v.readNamed(t,"from")),new M(v.readNamed(t,"to"))],!1,t)},Circle:function(){var t=arguments,e=v.readNamed(t,"center"),n=h.readNamed(t,"radius");return i(e,new y(n),t)},Rectangle:function(){var e,i,o=arguments,r=A.readNamed(o,"rectangle"),s=y.readNamed(o,"radius",0,{readNull:!0}),a=r.getBottomLeft(!0),l=r.getTopLeft(!0),h=r.getTopRight(!0),c=r.getBottomRight(!0);return n(!s||s.isZero()?[new M(a),new M(l),new M(h),new M(c)]:(e=(s=y.min(s,r.getSize(!0).divide(2))).width,i=s.height,r=e*t,s=i*t,[new M(a.add(e,0),null,[-r,0]),new M(a.subtract(0,i),[0,s]),new M(l.add(0,i),null,[0,-s]),new M(l.add(e,0),[-r,0],null),new M(h.subtract(e,0),null,[r,0]),new M(h.add(0,i),[0,-s],null),new M(c.subtract(0,i),null,[0,s]),new M(c.subtract(e,0),[r,0])]),!0,o)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=arguments,e=P._readEllipse(t);return i(e.center,e.radius,t)},Oval:"#Ellipse",Arc:function(){var t=arguments,e=v.readNamed(t,"from"),n=v.readNamed(t,"through"),i=v.readNamed(t,"to"),o=h.getNamed(t);return(t=new z(o&&0==o.insert&&S.NO_INSERT)).moveTo(e),t.arcTo(n,i),t.set(o)},RegularPolygon:function(){for(var t=arguments,e=v.readNamed(t,"center"),i=h.readNamed(t,"sides"),o=h.readNamed(t,"radius"),r=360/i,s=i%3==0,a=new v(0,s?-o:o),l=s?-1:.5,c=new Array(i),u=0;u<i;u++)c[u]=new M(e.add(a.rotate((u+l)*r)));return n(c,!0,t)},Star:function(){for(var t=arguments,e=v.readNamed(t,"center"),i=2*h.readNamed(t,"points"),o=h.readNamed(t,"radius1"),r=h.readNamed(t,"radius2"),s=360/i,a=new v(0,-1),l=new Array(i),c=0;c<i;c++)l[c]=new M(e.add(a.rotate(s*c).multiply(c%2?r:o)));return n(l,!0,t)}}}});var D=j.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function t(e,n){var i=n,o=i[0];o&&"number"==typeof o[0]&&(i=[i]);for(var r=n.length-1;0<=r;r--){var s=i[r];i!==n||s instanceof z||(i=h.slice(i)),Array.isArray(s)?i[r]=new z({segments:s,insert:!1}):s instanceof D&&(i.splice.apply(i,[r,1].concat(s.removeChildren())),s.remove())}return t.base.call(this,e,i)},reduce:function t(e){for(var n,i=this._children,o=i.length-1;0<=o;o--)(n=i[o].reduce(e)).isEmpty()&&n.remove();return i.length?t.base.call(this):((n=new z(S.NO_INSERT)).copyAttributes(this),n.insertAbove(this),this.remove(),n)},isClosed:function(){for(var t=this._children,e=0,n=t.length;e<n;e++)if(!t[e]._closed)return!1;return!0},setClosed:function(t){for(var e=this._children,n=0,i=e.length;n<i;n++)e[n].setClosed(t)},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],n=0,i=t.length;n<i;n++)h.push(e,t[n].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getLastCurve()},getArea:function(){for(var t=this._children,e=0,n=0,i=t.length;n<i;n++)e+=t[n].getArea();return e},getLength:function(){for(var t=this._children,e=0,n=0,i=t.length;n<i;n++)e+=t[n].getLength();return e},getPathData:function(t,e){for(var n=this._children,i=[],o=0,r=n.length;o<r;o++){var s=n[o],a=s._matrix;i.push(s.getPathData(t&&!a.isIdentity()?t.appended(a):t,e))}return i.join("")},_hitTestChildren:function t(e,n,i){return t.base.call(this,e,n.class===z||"path"===n.type?n:h.set({},n,{fill:!1}),i)},_draw:function(t,e,n,i){var o=this._children;if(o.length){e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var r=0,s=o.length;r<s;r++)o[r].draw(t,e,i);e.clip||(this._setStyles(t,e,n),(n=this._style).hasFill()&&(t.fill(n.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),n.hasStroke()&&t.stroke())}},_drawSelected:function(t,e,n){for(var i=this._children,o=0,r=i.length;o<r;o++){var s=i[o],a=s._matrix;n[s._id]||s._drawSelected(t,a.isIdentity()?e:e.appended(a))}}},new function(){function t(t,e){if(t=t._children,e&&!t.length)throw new Error("Use a moveTo() command first");return t[t.length-1]}return h.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],(function(e){this[e]=function(){var n=t(this,!0);n[e].apply(n,arguments)}}),{moveTo:function(){var e=t(this),n=e&&e.isEmpty()?e:new z(S.NO_INSERT);n!==e&&this.addChild(n),n.moveTo.apply(n,arguments)},moveBy:function(){var e=(n=t(this,!0))&&n.getLastSegment(),n=v.read(arguments);this.moveTo(e?n.add(e._point):n)},closePath:function(e){t(this,!0).closePath(e)}})},h.each(["reverse","flatten","simplify","smooth"],(function(t){this[t]=function(e){for(var n,i=this._children,o=0,r=i.length;o<r;o++)n=i[o][t](e)||n;return n}}),{}));j.inject(new function(){var t=Math.min,e=Math.max,n=Math.abs,i={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function o(t){return t._children||[t]}function r(t,e){var n=t.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(e){for(var i=o(n),r=0,s=i.length;r<s;r++)(t=i[r])._closed||t.isEmpty()||(t.closePath(1e-12),t.getFirstSegment().setHandleIn(0,0),t.getLastSegment().setHandleOut(0,0));n=n.resolveCrossings().reorient("nonzero"===n.getFillRule(),!0)}return n}function a(t,e,n,i,o){var r=new D(S.NO_INSERT);return r.addChildren(t,!0),r=r.reduce({simplify:e}),o&&0==o.insert||r.insertAbove(i&&n.isSibling(i)&&n.getIndex()<i.getIndex()?i:n),r.copyAttributes(n,!0),r}function l(t){return t.hasOverlap()||t.isCrossing()}function c(t,e,n,s){if(s&&(0==s.trace||s.stroke)&&/^(subtract|intersect)$/.test(n))return u(t,e,n);var c=r(t,!0),d=e&&t!==e&&r(e,!0),g=i[n];g[n]=!0,d&&(g.subtract||g.exclude)^d.isClockwise()^c.isClockwise()&&d.reverse();var f,_=v(F.expand(c.getIntersections(d,l))),A=o(c),b=(n=d&&o(d),[]),C=[];function x(t){for(var e=0,n=t.length;e<n;e++){var i=t[e];h.push(b,i._segments),h.push(C,i.getCurves()),i._overlapsOnly=!0}}function I(t){for(var e=[],n=0,i=t&&t.length;n<i;n++)e.push(C[t[n]]);return e}if(_.length){x(A),n&&x(n);for(var S=new Array(C.length),T=0,k=C.length;T<k;T++)S[T]=C[T].getValues();var P=p.findCurveBoundsCollisions(S,S,0,!0),E={};for(T=0;T<C.length;T++){var O=C[T],B=O._path._id;(E[B]=E[B]||{})[O.getIndex()]={hor:I(P[T].hor),ver:I(P[T].ver)}}for(T=0,k=_.length;T<k;T++)y(_[T]._segment,c,d,E,g);for(T=0,k=b.length;T<k;T++){var L=b[T],M=L._intersection;L._winding||y(L,c,d,E,g),M&&M._overlap||(L._path._overlapsOnly=!1)}f=w(b,g)}else f=m(n?A.concat(n):A.slice(),(function(t){return!!g[t]}));return a(f,!0,t,e,s)}function u(t,e,n){var i=r(t),o=r(e),s=i.getIntersections(o,l),h="subtract"===n,c="divide"===n,u={},d=[];function p(t){return!u[t._id]&&(c||o.contains(t.getPointAt(t.getLength()/2))^h)&&(d.unshift(t),u[t._id]=!0)}for(var g=s.length-1;0<=g;g--){var f=s[g].split();f&&(p(f)&&f.getFirstSegment().setHandleIn(0,0),i.getLastSegment().setHandleOut(0,0))}return p(i),a(d,!1,t,e)}function d(t,e){for(var n=t;n;){if(n===e)return;n=n._previous}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._previous;)e=e._previous;(t._next=e)._previous=t}}function g(t){for(var e=t.length-1;0<=e;e--)t[e].clearHandles()}function m(t,e,i){var o=t&&t.length;if(o){var r=h.each(t,(function(t,e){this[t._id]={container:null,winding:t.isClockwise()?1:-1,index:e}}),{}),s=t.slice().sort((function(t,e){return n(e.getArea())-n(t.getArea())})),a=s[0],l=p.findItemBoundsCollisions(s,null,f.GEOMETRIC_EPSILON);null==i&&(i=a.isClockwise());for(var c=0;c<o;c++){var u,d=s[c],g=r[d._id],m=0,v=l[c];if(v)for(var _=null,y=v.length-1;0<=y;y--)if(v[y]<c){_=_||d.getInteriorPoint();var w=s[v[y]];if(w.contains(_)){var A=r[w._id];m=A.winding,g.winding+=m,g.container=A.exclude?A.container:w;break}}e(g.winding)===e(m)?(g.exclude=!0,t[g.index]=null):(u=g.container,d.setClockwise(u?!u.isClockwise():i))}}return t}function v(t,e,n){var i,o,r,s=e&&[],a=!1,l=n||[],h=n&&{};function c(t){return t._path._id+"."+t._segment1._index}for(var u=(n&&n.length)-1;0<=u;u--)(p=n[u])._path&&(h[c(p)]=!0);for(u=t.length-1;0<=u;u--){var p,f=(b=t[u])._time,m=f,v=e&&!e(b);if((p=b._curve)&&(p!==o?(a=!p.hasHandles()||h&&h[c(p)],i=[],r=null,o=p):1e-8<=r&&(f/=r)),v)i&&i.push(b);else{if(e&&s.unshift(b),r=m,f<1e-8)_=p._segment1;else if(1-1e-8<f)_=p._segment2;else{m=p.divideAtTime(f,!0),a&&l.push(p,m);for(var _=m._segment1,y=i.length-1;0<=y;y--){var w=i[y];w._time=(w._time-f)/(1-f)}}b._setSegment(_);var A=_._intersection,b=b._intersection;if(A){d(A,b);for(var C=A;C;)d(C._intersection,A),C=C._next}else _._intersection=b}}return n||g(l),s||t}function _(i,o,r,s,a){var l,h=Array.isArray(o)?o:o[r?"hor":"ver"],c=r?1:0,u=1^c,d=[i.x,i.y],p=d[c],g=d[u],f=1e-6,m=p-1e-9,v=p+1e-9,y=0,w=0,A=0,b=0,C=!1,x=!1,I=1,S=[];function T(n){var l=n[u+0],h=n[u+2],d=n[u+4],y=n[u+6];if(g<=e(l,h,d,y)&&g>=t(l,h,d,y)){l=n[c+0],h=n[c+2],d=n[c+4],y=n[c+6];for(var w,x=m>e(l,h,d,y)||v<t(l,h,d,y)?[n]:R.getMonoCurves(n,r),T=0,k=x.length;T<k;T++)if(w=function(n){var l=n[u+0],h=n[u+6];if(!(g<t(l,h)||g>e(l,h))){var d=n[c+0],y=n[c+2],w=n[c+4],x=n[c+6];if(l!==h){var T=g===l?0:g!==h&&!(m>e(d,y,w,x)||v<t(d,y,w,x))&&0<R.solveCubic(n,u,g,S,0,1)?S[0]:1,k=0===T?d:1===T?x:R.getPoint(n,T)[r?"y":"x"];return y=h<l?1:-1,w=L[u]>L[u+6]?1:-1,h=L[c+6],g!==l?(k<m?A+=y:v<k?b+=y:C=!0,p-f<k&&k<p+f&&(I/=2)):(y!=w?d<m?A+=y:v<d&&(b+=y):d!=h&&(h<v&&v<k?(b+=y,C=!0):m<h&&k<m&&(A+=y,C=!0)),I/=4),L=n,!a&&m<k&&k<v&&0===R.getTangent(n,T)[r?"x":"y"]&&_(i,o,!r,s,!0)}(d<v&&m<x||x<v&&m<d)&&(C=!0)}}(x[T]))return w}}for(var k=0,P=h.length;k<P;k++){var E=h[k],O=E._path,B=E.getValues();if(!(k&&h[k-1]._path===O||(L=null,O._closed||(l=R.getValues(O.getLastCurve().getSegment2(),E.getSegment1(),null,!s))[u]!==l[u+6]&&(L=l),L)))for(var L=B,M=O.getLastCurve();M&&M!==E;){var N=M.getValues();if(N[u]!==N[u+6]){L=N;break}M=M.getPrevious()}if(B=T(B))return B;if(k+1===P||h[k+1]._path!==O){if(l&&(B=T(l)))return B;y+=A=!C||A||b?A:b=O.isClockwise(s)^r?1:-1,w+=b,A=b=0,C=C&&!(x=!0),l=null}}return y=n(y),w=n(w),{winding:e(y,w),windingL:y,windingR:w,quality:I,onPath:x}}function y(t,e,i,o,r){var s=[],a=t,l=0;do{}while((v=t.getCurve())&&(d=v.getLength(),s.push({segment:t,curve:v,length:d}),l+=d),(t=t.getNext())&&!t._intersection&&t!==a);for(var h=[.5,.25,.75],c={winding:0,quality:-1},u=0;u<h.length&&c.quality<.5;u++)for(var d=l*h[u],p=0,g=s.length;p<g;p++){var m=(C=s[p]).length;if(d<=m){var v,y=(v=C.curve)._path,w=(x=y._parent)instanceof D?x:y,A=f.clamp(v.getTimeAt(d),.001,.999),b=v.getPointAtTime(A),C=n(v.getTangentAtTime(A).y)<Math.SQRT1_2,x=null;if(r.subtract&&i&&(A=(w===e?i:e)._getWinding(b,C,!0),w===e&&A.winding||w===i&&!A.winding)){if(A.quality<1)continue;x={winding:0,quality:1}}(x=x||_(b,o[y._id][v.getIndex()],C,!0)).quality>c.quality&&(c=x);break}d-=m}for(p=s.length-1;0<=p;p--)s[p].segment._winding=c}function w(t,e){var n,i=[];function o(t){return!(!t||t._visited||e&&(!e[(t=t._winding||{}).winding]||e.unite&&2===t.winding&&t.windingL&&t.windingR))}function r(t){if(t)for(var e=0,i=n.length;e<i;e++)if(t===n[e])return!0;return!1}function s(t){for(var e=t._segments,n=0,i=e.length;n<i;n++)e[n]._visited=!0}t.sort((function(t,e){var n=t._intersection,i=e._intersection,o=!(!n||!n._overlap),r=!(!i||!i._overlap),s=t._path,a=e._path;return o^r?o?1:-1:!n^!i?n?1:-1:s!==a?s._id-a._id:t._index-e._index}));for(var a=0,l=t.length;a<l;a++){var h,c,u,d,p,g=t[a],f=o(g),m=null,v=!1,_=!0,y=[];for(f&&g._path._overlapsOnly&&(d=g._path,p=g._intersection._segment._path,d.compare(p)&&(d.getArea()&&i.push(d.clone(!1)),s(d),s(p),f=!1));f;){var w=!m,A=function(t,e){var i=t._intersection,s=i,a=[];function l(i,s){for(;i&&i!==s;){var l,h=i._segment,c=h&&h._path;c&&(c=(l=h.getNext()||c.getFirstSegment())._intersection,h!==t&&(r(h)||r(l)||l&&o(h)&&(o(l)||c&&o(c._segment)))&&a.push(h),e&&n.push(h)),i=i._next}}if(e&&(n=[t]),i){for(l(i);i&&i._previous;)i=i._previous;l(i,s)}return a}(g,w),b=A.shift(),C=!(v=!w&&(r(g)||r(b)))&&b;if(w&&(m=new z(S.NO_INSERT),h=null),v){(g.isFirst()||g.isLast())&&(_=g._path._closed),g._visited=!0;break}if(C&&h&&(y.push(h),h=null),h||(C&&A.push(g),h={start:m._segments.length,crossings:A,visited:c=[],handleIn:u}),!o(g=C?b:g)){m.removeSegments(h.start);for(var x=0,I=c.length;x<I;x++)c[x]._visited=!1;for(c.length=0;(g=h&&h.crossings.shift())&&g._path||(g=null,(h=y.pop())&&(c=h.visited,u=h.handleIn)),h&&!o(g););if(!g)break}b=g.getNext(),m.add(new M(g._point,u,b&&g._handleOut)),g._visited=!0,c.push(g),g=b||g._path.getFirstSegment(),u=b&&b._handleIn}v&&(_&&(m.getFirstSegment().setHandleIn(u),m.setClosed(_)),0!==m.getArea()&&i.push(m))}return i}return{_getWinding:function(t,e,n){return _(t,this.getCurves(),e,n)},unite:function(t,e){return c(this,t,"unite",e)},intersect:function(t,e){return c(this,t,"intersect",e)},subtract:function(t,e){return c(this,t,"subtract",e)},exclude:function(t,e){return c(this,t,"exclude",e)},divide:function(t,e){return e&&(0==e.trace||e.stroke)?u(this,t,"divide"):a([this.subtract(t,e),this.intersect(t,e)],!0,this,t,e)},resolveCrossings:function(){var t=this._children,e=t||[this];function n(t,e){return(t=t&&t._intersection)&&t._overlap&&t._path===e}var i,o=!1,r=!1,s=this.getIntersections(null,(function(t){return t.hasOverlap()?o=!0:t.isCrossing()&&(r=!0)})),a=o&&r&&[];if(s=F.expand(s),o)for(var l=v(s,(function(t){return t.hasOverlap()}),a),c=l.length-1;0<=c;c--){var u=(f=l[c])._path,d=f._segment,p=d.getPrevious(),f=d.getNext();n(p,u)&&n(f,u)&&(d.remove(),p._handleOut._set(0,0),f._handleIn._set(0,0),p===d||p.getCurve().hasLength()||(f._handleIn.set(p._handleIn),p.remove()))}return r&&(v(s,o&&function(t){var e=t.getCurve(),n=t.getSegment(),i=(t=(i=t._intersection)._curve,i._segment);if(e&&t&&e._path&&t._path)return!0;n&&(n._intersection=null),i&&(i._intersection=null)},a),a&&g(a),e=w(h.each(e,(function(t){h.push(this,t._segments)}),[]))),1<(a=e.length)&&t?(e!==t&&this.setChildren(e),i=this):1!==a||t||(e[0]!==this&&this.setSegments(e[0].removeSegments()),i=this),i||((i=new D(S.NO_INSERT)).addChildren(e),(i=i.reduce()).copyAttributes(this),this.replaceWith(i)),i},reorient:function(t,e){var n=this._children;return n&&n.length?this.setChildren(m(this.removeChildren(),(function(e){return!!(t?e:1&e)}),e)):e!==s&&this.setClockwise(e),this},getInteriorPoint:function(){var n=this.getBounds().getCenter(!0);if(!this.contains(n)){for(var i=this.getCurves(),o=n.y,r=[],s=[],a=0,l=i.length;a<l;a++){var h=i[a].getValues(),c=h[1],u=h[3],d=h[5],p=h[7];if(o>=t(c,u,d,p)&&o<=e(c,u,d,p))for(var g=R.getMonoCurves(h),f=0,m=g.length;f<m;f++){var v=g[f],_=v[1],y=v[7];_!==y&&(_<=o&&o<=y||y<=o&&o<=_)&&(v=o===_?v[0]:o===y?v[6]:1===R.solveCubic(v,1,o,s,0,1)?R.getPoint(v,s[0]).x:(v[0]+v[6])/2,r.push(v))}}1<r.length&&(r.sort((function(t,e){return t-e})),n.x=(r[0]+r[1])/2)}return n}}});var H=h.extend({_class:"PathFlattener",initialize:function(t,e,n,i,o){var r,s=[],a=[],l=0,h=1/(n||32),c=t._segments,u=c[0];function d(t,n){n=R.getValues(t,n,o),s.push(n),function t(n,o,r,s){var c,u;!(h<s-r)||i&&R.isStraight(n)||R.isFlatEnough(n,e||.25)?(c=n[6]-n[0],u=n[7]-n[1],0<(u=Math.sqrt(c*c+u*u))&&(l+=u,a.push({offset:l,curve:n,index:o,time:s}))):(u=R.subdivide(n,.5),n=(r+s)/2,t(u[0],o,r,n),t(u[1],o,n,s))}(n,t._index,0,1)}for(var p=1,g=c.length;p<g;p++)d(u,r=c[p]),u=r;t._closed&&d(r||u,c[0]),this.curves=s,this.parts=a,this.length=l,this.index=0},_get:function(t){for(var e,n=this.parts,i=n.length,o=this.index;(e=o)&&!(n[--o].offset<t););for(;e<i;e++){var r=n[e];if(r.offset>=t){var s=(a=n[(this.index=e)-1])&&a.index===r.index?a.time:0,a=a?a.offset:0;return{index:r.index,time:s+(r.time-s)*(t-a)/(r.offset-a)}}}return{index:n[i-1].index,time:1}},drawPart:function(t,e,n){for(var i=this._get(e),o=this._get(n),r=i.index,s=o.index;r<=s;r++){var a=R.getPart(this.curves[r],r===i.index?i.time:0,r===o.index?o.time:1);r===i.index&&t.moveTo(a[0],a[1]),t.bezierCurveTo.apply(t,a.slice(2))}}},h.each(R._evaluateMethods,(function(t){this[t+"At"]=function(e){return e=this._get(e),R[t](this.curves[e.index],e.time)}}),{})),G=h.extend({initialize:function(t){for(var e,n=this.points=[],i=t._segments,o=(t=t._closed,0),r=i.length;o<r;o++){var s=i[o].point;e&&e.equals(s)||n.push(e=s.clone())}t&&(n.unshift(n[n.length-1]),n.push(n[1])),this.closed=t},fit:function(t){var e=this.points,n=e.length,i=null;return 0<n&&(i=[new M(e[0])],1<n&&(this.fitCubic(i,t,0,n-1,e[1].subtract(e[0]),e[n-2].subtract(e[n-1])),this.closed&&(i.shift(),i.pop()))),i},fitCubic:function(t,e,n,i,o,r){var s=this.points;if(i-n!=1){for(var a,l=this.chordLengthParameterize(n,i),h=Math.max(e,e*e),c=!0,u=0;u<=4;u++){var d=this.generateBezier(n,i,l,o,r),p=this.findMaxError(n,i,d,l);if(p.error<e&&c)return void this.addCurve(t,d);if(a=p.index,p.error>=h)break;c=this.reparameterize(n,i,l,d),h=p.error}var g=s[a-1].subtract(s[a+1]);this.fitCubic(t,e,n,a,o,g),this.fitCubic(t,e,a,i,g.negate(),r)}else{var f=s[n];g=s[i],s=f.getDistance(g)/3,this.addCurve(t,[f,f.add(o.normalize(s)),g.add(r.normalize(s)),g])}},addCurve:function(t,e){t[t.length-1].setHandleOut(e[1].subtract(e[0])),t.push(new M(e[3],e[2].subtract(e[3])))},generateBezier:function(t,e,n,i,o){for(var r=Math.abs,s=this.points,a=s[t],l=s[e],h=[[0,0],[0,0]],c=[0,0],u=0,d=e-t+1;u<d;u++){var p=(m=1-(_=n[u]))*m*m,g=(v=3*_*m)*m,f=v*_,m=_*_*_,v=i.normalize(g),_=o.normalize(f);m=s[t+u].subtract(a.multiply(p+g)).subtract(l.multiply(f+m)),h[0][0]+=v.dot(v),h[0][1]+=v.dot(_),h[1][0]=h[0][1],h[1][1]+=_.dot(_),c[0]+=v.dot(m),c[1]+=_.dot(m)}var y,w;1e-12<r(e=h[0][0]*h[1][1]-h[1][0]*h[0][1])?(w=h[0][0]*c[1]-h[1][0]*c[0],y=(c[0]*h[1][1]-c[1]*h[0][1])/e,w/=e):(e=h[0][0]+h[0][1],C=h[1][0]+h[1][1],y=w=1e-12<r(e)?c[0]/e:1e-12<r(C)?c[1]/C:0);var A,b,C=1e-12*(r=l.getDistance(a));return y<C||w<C?y=w=r/3:(C=l.subtract(a),A=i.normalize(y),b=o.normalize(w),A.dot(C)-b.dot(C)>r*r&&(y=w=r/3,A=b=null)),[a,a.add(A||i.normalize(y)),l.add(b||o.normalize(w)),l]},reparameterize:function(t,e,n,i){for(var o=t;o<=e;o++)n[o-t]=this.findRoot(i,this.points[o],n[o-t]);o=1;for(var r=n.length;o<r;o++)if(n[o]<=n[o-1])return!1;return!0},findRoot:function(t,e,n){for(var i=[],o=[],r=0;r<=2;r++)i[r]=t[r+1].subtract(t[r]).multiply(3);for(r=0;r<=1;r++)o[r]=i[r+1].subtract(i[r]).multiply(2);var s=this.evaluate(3,t,n),a=this.evaluate(2,i,n),l=this.evaluate(1,o,n);return e=s.subtract(e),l=a.dot(a)+e.dot(l),f.isMachineZero(l)?n:n-e.dot(a)/l},evaluate:function(t,e,n){for(var i=e.slice(),o=1;o<=t;o++)for(var r=0;r<=t-o;r++)i[r]=i[r].multiply(1-n).add(i[r+1].multiply(n));return i[0]},chordLengthParameterize:function(t,e){for(var n=[0],i=t+1;i<=e;i++)n[i-t]=n[i-t-1]+this.points[i].getDistance(this.points[i-1]);i=1;for(var o=e-t;i<=o;i++)n[i]/=n[o];return n},findMaxError:function(t,e,n,i){for(var o=Math.floor((e-t+1)/2),r=0,s=t+1;s<e;s++){var a;r<=(a=(a=this.evaluate(3,n,i[s-t]).subtract(this.points[s])).x*a.x+a.y*a.y)&&(r=a,o=s)}return{error:r,index:o}}}),V=S.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(t){this._content="",this._lines=[];var e=t&&h.isPlainObject(t)&&t.x===s&&t.y===s;this._initialize(e&&t,!e&&v.read(arguments))},_equals:function(t){return this._content===t._content},copyContent:function(t){this.setContent(t._content)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),q=V.extend({_class:"PointText",initialize:function(){V.apply(this,arguments)},getPoint:function(){var t=this._matrix.getTranslation();return new _(t.x,t.y,this,"setPoint")},setPoint:function(){var t=v.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t,e,n){if(this._content){this._setStyles(t,e,n);var i=this._lines,o=(n=this._style).hasFill(),r=n.hasStroke(),s=n.getLeading(),a=t.shadowColor;t.font=n.getFontStyle(),t.textAlign=n.getJustification();for(var l=0,h=i.length;l<h;l++){t.shadowColor=a;var c=i[l];o&&(t.fillText(c,0,0),t.shadowColor="rgba(0,0,0,0)"),r&&t.strokeText(c,0,0),t.translate(0,s)}}},_getBounds:function(t,e){var n=this._style,i=(s=this._lines).length,o=n.getJustification(),r=n.getLeading(),s=(n=this.getView().getTextWidth(n.getFontStyle(),s),0);return"left"!==o&&(s-=n/("center"===o?2:1)),r=new A(s,i?-.75*r:0,n,i*r),t?t._transformBounds(r,r):r}}),U=h.extend(new function(){var t,e={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},n={},i={transparent:[0,0,0,0]},o=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],r={"rgb-hsb":function(t,e,n){var i=Math.max(t,e,n),o=i-Math.min(t,e,n);return[0==o?0:60*(i==t?(e-n)/o+(e<n?6:0):i==e?(n-t)/o+2:(t-e)/o+4),0===i?0:o/i,i]},"hsb-rgb":function(t,e,n){t=(t/60%6+6)%6;var i=Math.floor(t);return[(t=[n,n*(1-e),n*(1-e*(t-=i)),n*(1-e*(1-t))])[(i=o[i])[0]],t[i[1]],t[i[2]]]},"rgb-hsl":function(t,e,n){var i=Math.max(t,e,n),o=Math.min(t,e,n),r=i-o,s=0==r,a=(i+o)/2;return[s?0:60*(i==t?(e-n)/r+(e<n?6:0):i==e?(n-t)/r+2:(t-e)/r+4),s?0:a<.5?r/(i+o):r/(2-i-o),a]},"hsl-rgb":function(t,e,n){if(0===e)return[n,n,n];for(var i=[(t=(t/360%1+1)%1)+1/3,t,t-1/3],o=n<.5?n*(1+e):n+e-n*e,r=2*n-o,s=[],a=0;a<3;a++){var l=i[a];l<0&&(l+=1),1<l&&--l,s[a]=6*l<1?r+6*(o-r)*l:2*l<1?o:3*l<2?r+(o-r)*(2/3-l)*6:r}return s},"rgb-gray":function(t,e,n){return[.2989*t+.587*e+.114*n]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return h.each(e,(function(t,i){n[i]=[],h.each(t,(function(t,o){var r=h.capitalize(t),s=/^(hue|saturation)$/.test(t),a=n[i][o]="gradient"===i?"gradient"===t?function(t){var e=this._components[0];return e!==(t=W.read(Array.isArray(t)?t:arguments,0,{readNull:!0}))&&(e&&e._removeOwner(this),t&&t._addOwner(this)),t}:function(){return v.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:+t};this["get"+r]=function(){return(this._type===i||s&&/^hs[bl]$/.test(this._type)?this._components:this._convert(i))[o]},this["set"+r]=function(t){this._type===i||s&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(i),this._properties=e[i],this._type=i),this._components[o]=a.call(this,t),this._changed()}}),this)}),{_class:"Color",_readIndex:!0,initialize:function o(r){var s,l,c,u=arguments,d=this.__read,p=0,g=null!=(r=Array.isArray(r)?(u=r)[0]:r)&&typeof r;if("string"===g&&r in e&&(f=r,r=u[1],Array.isArray(r)?(s=r,v=u[2]):(d&&(p=1),u=h.slice(u,1),g=typeof r)),!s){if(l="number"===g?u:"object"===g&&null!=r.length?r:null){var f=f||(3<=l.length?"rgb":"gray"),m=e[f].length,v=l[m];d&&(p+=l===arguments?m+(null!=v?1:0):1),l.length>m&&(l=h.slice(l,0,m))}else if("string"===g)m=function(e){var n=e.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||e.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),o="rgb";if(n)for(var r=n[4]?4:3,s=new Array(r),l=0;l<r;l++){var h=n[l+1];s[l]=parseInt(1==h.length?h+h:h,16)/255}else if(n=e.match(/^(rgb|hsl)a?\((.*)\)$/)){o=n[1],s=n[2].trim().split(/[,\s]+/g);for(var c="hsl"===o,u=(l=0,Math.min(s.length,4));l<u;l++){var d,p=s[l];h=parseFloat(p),c?0===l?(d=p.match(/([a-z]*)$/)[1],h*={turn:360,rad:180/Math.PI,grad:.9}[d]||1):l<3&&(h/=100):l<3&&(h/=/%$/.test(p)?100:255),s[l]=h}}else{var g,f=i[e];s=(f=f||(a?(t||((t=dt.getContext(1,1,{willReadFrequently:!0})).globalCompositeOperation="copy"),t.fillStyle="rgba(0,0,0,0)",t.fillStyle=e,t.fillRect(0,0,1,1),g=t.getImageData(0,0,1,1).data,i[e]=[g[0]/255,g[1]/255,g[2]/255]):[0,0,0])).slice()}return[o,s]}(r),f=m[0],4===(s=m[1]).length&&(v=s[3],s.length--);else if("object"===g)if(r.constructor===o){if(f=r._type,s=r._components.slice(),v=r._alpha,"gradient"===f)for(var _=1,y=s.length;_<y;_++){var w=s[_];w&&(s[_]=w.clone())}}else if(r.constructor===W)f="gradient",l=u;else{var A=e[f="hue"in r?"lightness"in r?"hsl":"hsb":"gradient"in r||"stops"in r||"radial"in r?"gradient":"gray"in r?"gray":"rgb"],b=n[f];for(this._components=s=[],_=0,y=A.length;_<y;_++)null==(c=r[A[_]])&&!_&&"gradient"===f&&"stops"in r&&(c={stops:r.stops,radial:r.radial}),null!=(c=b[_].call(this,c))&&(s[_]=c);v=r.alpha}d&&f&&(p=1)}if(this._type=f||"rgb",!s)for(this._components=s=[],_=0,y=(b=n[this._type]).length;_<y;_++)null!=(c=b[_].call(this,l&&l[_]))&&(s[_]=c);return this._components=s,this._properties=e[this._type],this._alpha=v,d&&(this.__read=p),this},set:"#initialize",_serialize:function(t,e){var n=this.getComponents();return h.serialize(/^(gray|rgb)$/.test(this._type)?n:[this._type].concat(n),t,!0,e)},_changed:function(){this._canvasStyle=null,this._owner&&(this._setter?this._owner[this._setter](this):this._owner._changed(129))},_convert:function(t){var e;return this._type===t?this._components.slice():(e=r[this._type+"-"+t])?e.apply(this,this._components):r["rgb-"+t].apply(this,r[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new U(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=e[t],this._type=t},getComponents:function(){var t=this._components.slice();return null!=this._alpha&&t.push(this._alpha),t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var e=h.isPlainValue(t,!0)?U.read(arguments):t;return e===this||e&&this._class===e._class&&this._type===e._type&&this.getAlpha()===e.getAlpha()&&h.equals(this._components,e._components)||!1},toString:function(){for(var t=this._properties,e=[],n="gradient"===this._type,i=g.instance,o=0,r=t.length;o<r;o++){var s=this._components[o];null!=s&&e.push(t[o]+": "+(n?s:i.number(s)))}return null!=this._alpha&&e.push("alpha: "+i.number(this._alpha)),"{ "+e.join(", ")+" }"},toCSS:function(t){var e=this._convert("rgb"),n=t||null==this._alpha?1:this._alpha;function i(t){return Math.round(255*(t<0?0:1<t?1:t))}return e=[i(e[0]),i(e[1]),i(e[2])],n<1&&e.push(n<0?0:n),t?"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1):(4==e.length?"rgba(":"rgb(")+e.join(",")+")"},toCanvasStyle:function(t,e){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var n,i=(a=this._components)[0],o=i._stops,r=a[1],s=a[2],a=a[3];(e=e&&e.inverted())&&(r=e._transformPoint(r),s=e._transformPoint(s),a=a&&e._transformPoint(a)),n=i._radial?(e=s.getDistance(r),!a||(i=a.subtract(r)).getLength()>e&&(a=r.add(i.normalize(e-.1))),t.createRadialGradient((a=a||r).x,a.y,0,r.x,r.y,e)):t.createLinearGradient(r.x,r.y,s.x,s.y);for(var l=0,h=o.length;l<h;l++){var c=o[l],u=c._offset;n.addColorStop(null==u?l/(h-1):u,c._color.toCanvasStyle())}return this._canvasStyle=n},transform:function(t){if("gradient"===this._type){for(var e=this._components,n=1,i=e.length;n<i;n++){var o=e[n];t._transformPoint(o,o,!0)}this._changed()}},statics:{_types:e,random:function(){var t=Math.random;return new U(t(),t(),t())},_setOwner:function(t,e,n){return t&&!(t=t._owner&&e&&t._owner!==e?t.clone():t)._owner^!e&&(t._owner=e||null,t._setter=n||null),t}}})},new function(){return h.each({add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e}},(function(t,e){this[e]=function(e){e=U.read(arguments);for(var n=this._type,i=this._components,o=e._convert(n),r=0,s=i.length;r<s;r++)o[r]=t(i[r],o[r]);return new U(n,o,null!=this._alpha?t(this._alpha,e.getAlpha()):null)}}),{})}),W=h.extend({_class:"Gradient",initialize:function(t,e){this._id=m.get(),t&&h.isPlainObject(t)&&(this.set(t),t=e=null),null==this._stops&&this.setStops(t||["white","black"]),null==this._radial&&this.setRadial("string"==typeof e&&"radial"===e||e||!1)},_serialize:function(t,e){return e.add(this,(function(){return h.serialize([this._stops,this._radial],t,!0,e)}))},_changed:function(){for(var t=0,e=this._owners&&this._owners.length;t<e;t++)this._owners[t]._changed()},_addOwner:function(t){this._owners||(this._owners=[]),this._owners.push(t)},_removeOwner:function(t){-1!=(t=this._owners?this._owners.indexOf(t):-1)&&(this._owners.splice(t,1),this._owners.length||(this._owners=s))},clone:function(){for(var t=[],e=0,n=this._stops.length;e<n;e++)t[e]=this._stops[e].clone();return new W(t,this._radial)},getStops:function(){return this._stops},setStops:function(t){if(t.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var e=this._stops;if(e)for(var n=0,i=e.length;n<i;n++)e[n]._owner=s;for(n=0,i=(e=this._stops=Y.readList(t,0,{clone:!0})).length;n<i;n++)e[n]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class){var e=this._stops,n=t._stops,i=e.length;if(i===n.length){for(var o=0;o<i;o++)if(!e[o].equals(n[o]))return!1;return!0}}return!1}}),Y=h.extend({_class:"GradientStop",initialize:function(t,e){var n=t,i=e;"object"==typeof t&&e===s&&(Array.isArray(t)&&"number"!=typeof t[0]?(n=t[0],i=t[1]):("color"in t||"offset"in t||"rampPoint"in t)&&(n=t.color,i=t.offset||t.rampPoint||0)),this.setColor(n),this.setOffset(i)},clone:function(){return new Y(this._color.clone(),this._offset)},_serialize:function(t,e){var n=this._color,i=this._offset;return h.serialize(null==i?[n]:[n,i],t,!0,e)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){U._setOwner(this._color,null),this._color=U._setOwner(U.read(arguments,0),this,"setColor"),this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._offset==t._offset||!1}}),J=h.extend(new function(){var t={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new v,selectedColor:null},e=h.set({},t,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),n=h.set({},e,{fillColor:new U}),i={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},o={beans:!0},r={_class:"Style",beans:!0,initialize:function(i,o,r){this._values={},this._owner=o,this._project=o&&o._project||r||jt.project,this._defaults=!o||o instanceof T?e:o instanceof V?n:t,i&&this.set(i)}};return h.each(e,(function(t,e){var n=/Color$/.test(e),a="shadowOffset"===e,l=h.capitalize(e),c=i[e],u="set"+l,d="get"+l;r[u]=function(t){var i,o=this._owner,r=o&&o._children,s=r&&0<r.length&&!(o instanceof D);if(s)for(var a=0,l=r.length;a<l;a++)r[a]._style[u](t);"selectedColor"!==e&&s||!(e in this._defaults)||(i=this._values[e])!==t&&(n&&(i&&(U._setOwner(i,null),i._canvasStyle=null),t&&t.constructor===U&&(t=U._setOwner(t,o,s&&u))),this._values[e]=t,o&&o._changed(c||129))},r[d]=function(t){var i,o=this._owner,r=o&&o._children,l=r&&0<r.length&&!(o instanceof D);if(l&&!t)for(var c=0,p=r.length;c<p;c++){var g=r[c]._style[d]();if(c){if(!h.equals(i,g))return s}else i=g}else e in this._defaults&&((i=this._values[e])===s?(i=this._defaults[e])&&i.clone&&(i=i.clone()):!(t=n?U:a?v:null)||i&&i.constructor===t||(this._values[e]=i=t.read([i],0,{readNull:!0,clone:!0})));return i&&n?U._setOwner(i,o,l&&u):i},o[d]=function(t){return this._style[d](t)},o[u]=function(t){this._style[u](t)}})),h.each({Font:"FontFamily",WindingRule:"FillRule"},(function(t,e){var n="get"+e;e="set"+e,r[n]=o[n]="#get"+t,r[e]=o[e]="#set"+t})),S.inject(o),r},{set:function(t){var e,n=t instanceof J,i=n?t._values:t;if(i)for(var o in i)o in this._defaults&&(e=i[o],this[o]=e&&n&&e.clone?e.clone():e)},equals:function(t){function e(t,e,n){var i,o=t._values,r=e._values,a=e._defaults;for(i in o){var l=o[i],c=r[i];if(!(n&&i in r||h.equals(l,c===s?a[i]:c)))return!1}return!0}return t===this||t&&this._class===t._class&&e(this,t)&&e(t,this,!0)||!1},_dispose:function(){var t=this.getFillColor();t&&(t._canvasStyle=null),(t=this.getStrokeColor())&&(t._canvasStyle=null),(t=this.getShadowColor())&&(t._canvasStyle=null)},hasFill:function(){var t=this.getFillColor();return!!t&&0<t.alpha},hasStroke:function(){var t=this.getStrokeColor();return!!t&&0<t.alpha&&0<this.getStrokeWidth()},hasShadow:function(){var t=this.getShadowColor();return!!t&&0<t.alpha&&(0<this.getShadowBlur()||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var t=this.getFontSize();return this.getFontWeight()+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function t(){var e=t.base.call(this),n=this.getFontSize();return/pt|em|%|px/.test(n)&&(n=this.getView().getPixelSize(n)),null!=e?e:1.2*n}}),Z=new function(){function t(t,e,n,i){for(var o=["","webkit","moz","Moz","ms","o"],r=e[0].toUpperCase()+e.substring(1),s=0;s<6;s++){var a;if((a=(a=o[s])?a+r:e)in t){if(!n)return t[a];t[a]=i;break}}}return{getStyles:function(t){var e;return(e=(e=t&&9!==t.nodeType?t.ownerDocument:t)&&e.defaultView)&&e.getComputedStyle(t,"")},getBounds:function(t,e){var n,i=t.ownerDocument,o=i.body,r=i.documentElement;try{n=t.getBoundingClientRect()}catch(t){n={left:0,top:0,width:0,height:0}}var s=n.left-(r.clientLeft||o.clientLeft||0);return t=n.top-(r.clientTop||o.clientTop||0),e||(s+=(i=i.defaultView).pageXOffset||r.scrollLeft||o.scrollLeft,t+=i.pageYOffset||r.scrollTop||o.scrollTop),new A(s,t,n.width,n.height)},getViewportBounds:function(t){t=(e=t.ownerDocument).defaultView;var e=e.documentElement;return new A(0,0,t.innerWidth||e.clientWidth,t.innerHeight||e.clientHeight)},getOffset:function(t,e){return Z.getBounds(t,e).getPoint()},getSize:function(t){return Z.getBounds(t,!0).getSize()},isInvisible:function(t){return Z.getSize(t).equals(new y(0,0))},isInView:function(t){return!Z.isInvisible(t)&&Z.getViewportBounds(t).intersects(Z.getBounds(t,!0))},isInserted:function(t){return l.body.contains(t)},getPrefixed:function(e,n){return e&&t(e,n)},setPrefixed:function(e,n,i){if("object"==typeof n)for(var o in n)t(e,o,!0,n[o]);else t(e,n,!0,i)}}},X={add:function(t,e){if(t)for(var n in e)for(var i=e[n],o=n.split(/[\s,]+/g),r=0,s=o.length;r<s;r++){var a=o[r];t.addEventListener(a,i,t===l&&("touchstart"===a||"touchmove"===a)&&{passive:!1})}},remove:function(t,e){if(t)for(var n in e)for(var i=e[n],o=n.split(/[\s,]+/g),r=0,s=o.length;r<s;r++)t.removeEventListener(o[r],i,!1)},getPoint:function(t){return t=t.targetTouches?(t.targetTouches.length?t.targetTouches:t.changedTouches)[0]:t,new v(t.pageX||t.clientX+l.documentElement.scrollLeft,t.pageY||t.clientY+l.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,e){return X.getPoint(t).subtract(Z.getOffset(e||X.getTarget(t)))}};X.requestAnimationFrame=new function(){var t,e=Z.getPrefixed(a,"requestAnimationFrame"),n=!1,i=[];function o(){var t=i;i=[];for(var r=0,s=t.length;r<s;r++)t[r]();(n=e&&i.length)&&e(o)}return function(r){i.push(r),e?n||(e(o),n=!0):t=t||setInterval(o,1e3/60)}};var $,K,Q,tt,et,nt,it,ot=h.extend(c,{_class:"View",initialize:function t(e,n){function i(t){return n[t]||parseInt(n.getAttribute(t),10)}function o(){var t=Z.getSize(n);return t.isNaN()||t.isZero()?new y(i("width"),i("height")):t}var r,s,h,c,d;a&&n?(this._id=n.getAttribute("id"),null==this._id&&n.setAttribute("id",this._id="paper-view-"+t._id++),X.add(n,this._viewEvents),Z.setPrefixed(n.style,{userDrag:d="none",userSelect:d,touchCallout:d,contentZooming:d,tapHighlightColor:"rgba(0,0,0,0)"}),u.hasAttribute(n,"resize")&&X.add(a,(s=this)._windowEvents={resize:function(){s.setViewSize(o())}}),r=o(),u.hasAttribute(n,"stats")&&"undefined"!=typeof Stats&&(this._stats=new Stats,c=(h=this._stats.domElement).style,d=Z.getOffset(n),c.position="absolute",c.left=d.x+"px",c.top=d.y+"px",l.body.appendChild(h))):(r=new y(n),n=null),this._project=e,this._scope=e._scope,this._element=n,this._pixelRatio||(this._pixelRatio=a&&a.devicePixelRatio||1),this._setElementSize(r.width,r.height),this._viewSize=r,t._views.push(this),((t._viewsById[this._id]=this)._matrix=new C)._owner=this,t._focused||(t._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!jt.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;ot._focused===this&&(ot._focused=null),ot._views.splice(ot._views.indexOf(this),1),delete ot._viewsById[this._id];var t=this._project;return t._view===this&&(t._view=null),X.remove(this._element,this._viewEvents),X.remove(a,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:h.each(S._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),(function(t){this[t]={}}),{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(t){(this._autoUpdate=t)&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){var t;this._requested||(t=this,X.requestAnimationFrame((function(){var e;t._requested=!1,t._animate&&(t.requestUpdate(),e=t._element,Z.getPrefixed(l,"hidden")&&"true"!==u.getAttribute(e,"keepalive")||!Z.isInView(e)||t._handleFrame()),t._autoUpdate&&t.update()})),this._requested=!0)},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){jt=this._scope;var t=Date.now()/1e3,e=this._last?t-this._last:0;this._last=t,this.emit("frame",new h({delta:e,time:this._time+=e,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(t,e){var n=this._frameItems;e?(n[t._id]={item:t,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete n[t._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(t){for(var e in this._frameItems)(e=this._frameItems[e]).item.emit("frame",new h(t,{time:e.time+=t.delta,count:e.count++}))},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=s},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new w(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=y.read(arguments),e=t.subtract(this._viewSize);e.isZero()||(this._setElementSize(t.width,t.height),this._viewSize.set(t),this._changed(),this.emit("resize",{size:t,delta:e}),this._autoUpdate&&this.update())},_setElementSize:function(t,e){var n=this._element;n&&(n.width!==t&&(n.width=t),n.height!==e&&(n.height=e))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new A(new v,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return Z.isInView(this._element)},isInserted:function(){return Z.isInserted(this._element)},getPixelSize:function(t){var e,n,i=this._element;return i?(n=i.parentNode,(i=l.createElement("div")).style.fontSize=t,n.appendChild(i),e=parseFloat(Z.getStyles(i).fontSize),n.removeChild(i)):e=parseFloat(e),e},getTextWidth:function(t,e){return 0}},h.each(["rotate","scale","shear","skew"],(function(t){var e="rotate"===t;this[t]=function(){var n=arguments,i=(e?h:v).read(n);return n=v.read(n,0,{readNull:!0}),this.transform((new C)[t](i,n||this.getCenter(!0)))}}),{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var t=new C;return this.transform(t.translate.apply(t,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=v.read(arguments);this.translate(this.getCenter().subtract(t))},getZoom:function(){var t=this._decompose().scaling;return(t.x+t.y)/2},setZoom:function(t){this.transform((new C).scale(t/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(t){var e=this.getRotation();null!=e&&null!=t&&this.rotate(t-e)},getScaling:function(){var t=this._decompose().scaling;return new _(t.x,t.y,this,"setScaling")},setScaling:function(){var t=this.getScaling(),e=v.read(arguments,0,{clone:!0,readNull:!0});t&&e&&this.scale(e.x/t.x,e.y/t.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.set.apply(t,arguments)},transform:function(t){this._matrix.append(t)},scrollBy:function(){this.translate(v.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(v.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(v.read(arguments))},getEventPoint:function(t){return this.viewToProject(X.getOffset(t,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,e){return l&&"string"==typeof e&&(e=l.getElementById(e)),new(a?rt:ot)(t,e)}}},new function(){if(a){var t,e,n,i,o,r=!1,s=!1;(c=a.navigator).pointerEnabled||c.msPointerEnabled?(n="pointerdown MSPointerDown",i="pointermove MSPointerMove",o="pointerup pointercancel MSPointerUp MSPointerCancel"):(n="touchstart",i="touchmove",o="touchend touchcancel","ontouchstart"in a&&c.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(n+=" mousedown",i+=" mousemove",o+=" mouseup"));var h={},c={mouseout:function(t){var e,n,i,o=ot._focused,r=X.getRelatedTarget(t);!o||r&&"HTML"!==r.nodeName||(n=(e=X.getOffset(t,o._element)).x,r=(i=Math.abs)(n),e.x=i(i=r-(1<<25))<r?i*(n<0?-1:1):n,S(o,t,o.viewToProject(e)))},scroll:I};h[n]=function(t){var e=ot._focused=x(t);r||(r=!0,e._handleMouseEvent("mousedown",t))},c[i]=function(n){var i,o=ot._focused;s||((i=x(n))?o!==i&&(o&&S(o,n),t=t||o,o=ot._focused=e=i):e&&e===o&&(t&&!t.isInserted()&&(t=null),o=ot._focused=t,t=null,I())),o&&S(o,n)},c[n]=function(){s=!0},c[o]=function(t){var e=ot._focused;e&&r&&e._handleMouseEvent("mouseup",t),s=r=!1},X.add(l,c),X.add(a,{load:I});var u,d,p,g,f,m,v,_,y=!1,w=!1,A={doubleclick:"click",mousedrag:"mousemove"},b=!1,C={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:h,_handleMouseEvent:function(t,e,n){var i=this._itemEvents,o=i.native[t],s="mousemove"===t,a=this._scope.tool,l=this;function h(t){return i.virtual[t]||l.responds(t)||a&&a.responds(t)}s&&r&&h("mousedrag")&&(t="mousedrag"),n=n||this.getEventPoint(e);var c,A=this.getBounds().contains(n),C=(c=o&&A&&l._project.hitTest(n,{tolerance:0,fill:!0,stroke:!0}))&&c.item||null,x=!1;if((c={})[t.substr(5)]=!0,o&&C!==g&&(g&&T(g,null,"mouseleave",e,n),C&&T(C,null,"mouseenter",e,n),g=C),b^A&&(T(this,null,A?"mouseenter":"mouseleave",e,n),x=!0),!A&&!c.drag||n.equals(d)||(k(this,C,s?t:"mousemove",e,n,d),x=!0),b=A,c.down&&A||c.up&&u){if(k(this,C,t,e,n,u),c.down){if(_=C===m&&Date.now()-v<300,p=m=C,!w&&C){for(var I=C;I&&!I.responds("mousedrag");)I=I._parent;I&&(f=C)}u=n}else c.up&&(w||C!==p||(v=Date.now(),k(this,C,_?"doubleclick":"click",e,n,u),_=!1),p=f=null);x=!(b=!1)}d=n,x&&a&&(y=a._handleMouseEvent(t,e,n,c)||y),!1!==e.cancelable&&(y&&!c.move||c.down&&h("mouseup"))&&e.preventDefault()},_handleKeyEvent:function(t,e,n,i){var o,r=this._scope,s=r.tool;function a(s){s.responds(t)&&(jt=r,s.emit(t,o=o||new at(t,e,n,i)))}this.isVisible()&&(a(this),s&&s.responds(t)&&a(s))},_countItemEvent:function(t,e){var n,i=(o=this._itemEvents).native,o=o.virtual;for(n in C)i[n]=(i[n]||0)+(C[n][t]||0)*e;o[t]=(o[t]||0)+e},statics:{updateFocus:I,_resetState:function(){r=s=y=b=!1,t=e=u=d=p=g=f=m=v=_=null}}}}function x(t){return(t=X.getTarget(t)).getAttribute&&ot._viewsById[t.getAttribute("id")]}function I(){var t=ot._focused;if(!t||!t.isVisible())for(var n=0,i=ot._views.length;n<i;n++)if((t=ot._views[n]).isVisible()){ot._focused=e=t;break}}function S(t,e,n){t._handleMouseEvent("mousemove",e,n)}function T(t,e,n,i,o,r,s){for(var a,l=!1;t&&t!==s&&!function t(n,s){if(n.responds(s)){if(a=a||new ht(s,i,o,e||n,r?o.subtract(r):null),n.emit(s,a)&&(y=!0,a.prevented&&(w=!0),a.stopped))return l=!0}else if(s=A[s])return t(n,s)}(t,n);)t=t._parent;return l}function k(t,e,n,i,o,r){return t._project.removeOn(n),w=y=!1,f&&T(f,null,n,i,o,r)||e&&e!==f&&!e.isDescendant(f)&&T(e,null,"mousedrag"===n?"mousemove":n,i,o,r,f)||T(t,f||e||t,n,i,o,r)}}),rt=ot.extend({_class:"CanvasView",initialize:function(t,e){if(!(e instanceof a.HTMLCanvasElement)){var n=y.read(arguments,1);if(n.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+h.slice(arguments,1));e=dt.getCanvas(n)}var i=this._context=e.getContext("2d");i.save(),this._pixelRatio=1,/^off|false$/.test(u.getAttribute(e,"hidpi"))||(n=a.devicePixelRatio||1,i=Z.getPrefixed(i,"backingStorePixelRatio")||1,this._pixelRatio=n/i),ot.call(this,t,e),this._needsUpdate=!0},remove:function t(){return this._context.restore(),t.base.call(this)},_setElementSize:function t(e,n){var i,o,r=this._pixelRatio;t.base.call(this,e*r,n*r),1!==r&&(o=this._element,i=this._context,u.hasAttribute(o,"resize")||((o=o.style).width=e+"px",o.height=n+"px"),i.restore(),i.save(),i.scale(r,r))},getContext:function(){return this._context},getPixelSize:function t(e){var n,i,o=jt.agent;return o&&o.firefox?n=t.base.call(this,e):(o=(i=this._context).font,i.font=e+" serif",n=parseFloat(i.font),i.font=o),n},getTextWidth:function(t,e){var n=this._context,i=n.font,o=0;n.font=t;for(var r=0,s=e.length;r<s;r++)o=Math.max(o,n.measureText(e[r]).width);return n.font=i,o},update:function(){if(!this._needsUpdate)return!1;var t=this._project,e=this._context,n=this._viewSize;return e.clearRect(0,0,n.width+1,n.height+1),t&&t.draw(e,this._matrix,this._pixelRatio),!(this._needsUpdate=!1)}}),st=h.extend({_class:"Event",initialize:function(t){this.event=t,this.type=t&&t.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return lt.modifiers}}),at=st.extend({_class:"KeyEvent",initialize:function(t,e,n,i){this.type=t,this.event=e,this.key=n,this.character=i},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),lt=new function(){var t,e,n={"\t":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},i={tab:"\t",space:" ",enter:"\r"},o={},r={},c=new h({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var t=jt&&jt.agent;return t&&t.mac?this.meta:this.control}}});function u(t){var e=t.key||t.keyIdentifier;return e=/^U\+/.test(e)?String.fromCharCode(parseInt(e.substr(2),16)):/^Arrow[A-Z]/.test(e)?e.substr(5):"Unidentified"===e||e===s?String.fromCharCode(t.keyCode):e,n[e]||(1<e.length?h.hyphenate(e):e.toLowerCase())}function d(e,n,i,s){var a,l=ot._focused;if((o[n]=e)?r[n]=i:delete r[n],1<n.length&&(a=h.camelize(n))in c){c[a]=e;var u=jt&&jt.agent;if("meta"===a&&u&&u.mac)if(e)t={};else{for(var p in t)p in r&&d(!1,p,t[p],s);t=null}}else e&&t&&(t[n]=i);l&&l._handleKeyEvent(e?"keydown":"keyup",s,n,i)}return X.add(l,{keydown:function(t){var n=u(t),o=jt&&jt.agent;1<n.length||o&&o.chrome&&(t.altKey||o.mac&&t.metaKey||!o.mac&&t.ctrlKey)?d(!0,n,i[n]||(1<n.length?"":n),t):e=n},keypress:function(t){var n,i;e&&(n=u(t),i=32<=(i=t.charCode)?String.fromCharCode(i):1<n.length?"":n,d(!0,n=n!==e?i.toLowerCase():n,i,t),e=null)},keyup:function(t){var e=u(t);e in r&&d(!1,e,r[e],t)}}),X.add(a,{blur:function(t){for(var e in r)d(!1,e,r[e],t)}}),{modifiers:c,isDown:function(t){return!!o[t]}}},ht=st.extend({_class:"MouseEvent",initialize:function(t,e,n,i,o){this.type=t,this.event=e,this.point=n,this.target=i,this.delta=o},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),ct=st.extend({_class:"ToolEvent",_item:null,initialize:function(t,e,n){this.tool=t,this.type=e,this.event=n},_choosePoint:function(t,e){return t||(e?e.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var e=t.item,n=e._parent;/^(Group|CompoundPath)$/.test(n._class);)n=(e=n)._parent;this._item=e}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),ut=(d.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(t){d.call(this),this._moveCount=-1,this._downCount=-1,this.set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){null!=(this._minDistance=t)&&null!=this._maxDistance&&t>this._maxDistance&&(this._maxDistance=t)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance&&(this._minDistance=t)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_handleMouseEvent:function(t,e,n,i){jt=this._scope,i.drag&&!this.responds(t)&&(t="mousemove");var o=i.move||i.drag,r=this.responds(t),s=this.minDistance,a=this.maxDistance,l=!1,h=this;function c(t,e){var r=n,s=o?h._point:h._downPoint||r;if(o){if(0<=h._moveCount&&r.equals(s))return;if(s&&(null!=t||null!=e)){var a=r.subtract(s),l=a.getLength();if(l<(t||0))return;e&&(r=s.add(a.normalize(Math.min(l,e))))}h._moveCount++}return h._point=r,h._lastPoint=s||r,i.down&&(h._moveCount=-1,h._downPoint=r,h._downCount++),1}function u(){r&&(l=h.emit(t,new ct(h,t,e))||l)}if(i.down)c(),u();else if(i.up)c(null,a),u();else if(r)for(;c(s,a);)u();return l}}),h.extend(c,{_class:"Tween",statics:{easings:new h({linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:2*(2-t)*t-1},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t}})},initialize:function t(e,n,i,o,r,s){this.object=e;var a=typeof r;e="function"==a,this.type=e?a:"string"==a?r:"linear",this.easing=e?r:t.easings[this.type],this.duration=o,this.running=!1,this._then=null,this._startTime=null,o=n||i,this._keys=o?Object.keys(o):[],this._parsedKeys=this._parseKeys(this._keys),this._from=o&&this._getState(n),this._to=o&&this._getState(i),!1!==s&&this.start()},then:function(t){return this._then=t,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(t){if(this.running){function e(e){return"function"==typeof e?e(n,t):e}1<=t&&(this.running=!(t=1));for(var n=this.easing(t),i=this._keys,o=0,r=i&&i.length;o<r;o++){var s=i[o],a=e(this._from[s]),l=e(this._to[s]);a=a&&l&&a.__add&&l.__add?l.__subtract(a).__multiply(n).__add(a):(l-a)*n+a,this._setProperty(this._parsedKeys[s],a)}this.responds("update")&&this.emit("update",new h({progress:t,factor:n})),!this.running&&this._then&&this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(t){var e=this._startTime,n=e?(t-e)/this.duration:0;e||(this._startTime=t),this.update(n)},_getState:function(t){for(var e=this._keys,n={},i=0,o=e.length;i<o;i++){var r,s=e[i],a=this._parsedKeys[s],l=this._getProperty(a);t?(r=this._resolveValue(l,t[s]),this._setProperty(a,r),r=(r=this._getProperty(a))&&r.clone?r.clone():r,this._setProperty(a,l)):r=l&&l.clone?l.clone():l,n[s]=r}return n},_resolveValue:function(t,e){if(e){if(Array.isArray(e)&&2===e.length){var n=e[0];return n&&n.match&&n.match(/^[+\-\*\/]=/)?this._calculate(t,n[0],e[1]):e}if("string"==typeof e&&(n=e.match(/^[+\-*/]=(.*)/)))return n=JSON.parse(n[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": ')),this._calculate(t,e[0],n)}return e},_calculate:function(t,e,n){return jt.PaperScript.calculateBinary(t,e,n)},_parseKeys:function(t){for(var e={},n=0,i=t.length;n<i;n++){var o=t[n],r=o.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");e[o]=r.split("/")}return e},_getProperty:function(t,e){for(var n=this.object,i=0,o=t.length-(e||0);i<o&&n;i++)n=n[t[i]];return n},_setProperty:function(t,e){var n=this._getProperty(t,1);n&&(n[t[t.length-1]]=e)}})),dt=h.exports.CanvasProvider={canvases:[],getCanvas:function(t,e,n){if(!a)return null;var i,o=!0;if("object"==typeof t&&(e=t.height,t=t.width),this.canvases.length?i=this.canvases.pop():(i=l.createElement("canvas"),o=!1),!(n=i.getContext("2d",n||{})))throw new Error("Canvas "+i+" is unable to provide a 2D context.");return i.width===t&&i.height===e?o&&n.clearRect(0,0,t+1,e+1):(i.width=t,i.height=e),n.save(),i},getContext:function(t,e,n){return(e=this.getCanvas(t,e,n))?e.getContext("2d",n||{}):null},release:function(t){(t=t&&t.canvas?t.canvas:t)&&t.getContext&&(t.getContext("2d").restore(),this.canvases.push(t))}},pt=new function(){var t,e,n,i,o,r,s,a,l,c,u,d=Math.min,p=Math.max,g=Math.abs;function f(t,e,n){return.2989*t+.587*e+.114*n}function m(t,e,n,i){var o,r=i-f(t,e,n);i=f(l=t+r,c=e+r,u=n+r),n=d(l,c,u),r=p(l,c,u),n<0&&(l=i+(l-i)*i/(o=i-n),c=i+(c-i)*i/o,u=i+(u-i)*i/o),255<r&&(l=i+(l-i)*(o=255-i)/(r-=i),c=i+(c-i)*o/r,u=i+(u-i)*o/r)}function v(t,e,n){return p(t,e,n)-d(t,e,n)}function _(t,e,n,i){var o=[t,e,n],r=p(t,e,n);n=d(t,e,n),e=0===d(n=n===t?0:n===e?1:2,r=r===t?0:r===e?1:2)?1===p(n,r)?2:1:0,o[r]>o[n]?(o[e]=(o[e]-o[n])*i/(o[r]-o[n]),o[r]=i):o[e]=o[r]=0,o[n]=0,l=o[0],c=o[1],u=o[2]}var y={multiply:function(){l=o*t/255,c=r*e/255,u=s*n/255},screen:function(){l=o+t-o*t/255,c=r+e-r*e/255,u=s+n-s*n/255},overlay:function(){l=o<128?2*o*t/255:255-2*(255-o)*(255-t)/255,c=r<128?2*r*e/255:255-2*(255-r)*(255-e)/255,u=s<128?2*s*n/255:255-2*(255-s)*(255-n)/255},"soft-light":function(){var i=t*o/255;l=i+o*(255-(255-o)*(255-t)/255-i)/255,c=(i=e*r/255)+r*(255-(255-r)*(255-e)/255-i)/255,u=(i=n*s/255)+s*(255-(255-s)*(255-n)/255-i)/255},"hard-light":function(){l=t<128?2*t*o/255:255-2*(255-t)*(255-o)/255,c=e<128?2*e*r/255:255-2*(255-e)*(255-r)/255,u=n<128?2*n*s/255:255-2*(255-n)*(255-s)/255},"color-dodge":function(){l=0===o?0:255===t?255:d(255,255*o/(255-t)),c=0===r?0:255===e?255:d(255,255*r/(255-e)),u=0===s?0:255===n?255:d(255,255*s/(255-n))},"color-burn":function(){l=255===o?255:0===t?0:p(0,255-255*(255-o)/t),c=255===r?255:0===e?0:p(0,255-255*(255-r)/e),u=255===s?255:0===n?0:p(0,255-255*(255-s)/n)},darken:function(){l=o<t?o:t,c=r<e?r:e,u=s<n?s:n},lighten:function(){l=t<o?o:t,c=e<r?r:e,u=n<s?s:n},difference:function(){(l=o-t)<0&&(l=-l),(c=r-e)<0&&(c=-c),(u=s-n)<0&&(u=-u)},exclusion:function(){l=o+t*(255-o-o)/255,c=r+e*(255-r-r)/255,u=s+n*(255-s-s)/255},hue:function(){_(t,e,n,v(o,r,s)),m(l,c,u,f(o,r,s))},saturation:function(){_(o,r,s,v(t,e,n)),m(l,c,u,f(o,r,s))},luminosity:function(){m(o,r,s,f(t,e,n))},color:function(){m(t,e,n,f(o,r,s))},add:function(){l=d(o+t,255),c=d(r+e,255),u=d(s+n,255)},subtract:function(){l=p(o-t,0),c=p(r-e,0),u=p(s-n,0)},average:function(){l=(o+t)/2,c=(r+e)/2,u=(s+n)/2},negation:function(){l=255-g(255-t-o),c=255-g(255-e-r),u=255-g(255-n-s)}},w=this.nativeModes=h.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],(function(t){this[t]=!0}),{}),A=dt.getContext(1,1,{willReadFrequently:!0});A&&(h.each(y,(function(t,e){var n="darken"===e,i=!1;A.save();try{A.fillStyle=n?"#300":"#a00",A.fillRect(0,0,1,1),A.globalCompositeOperation=e,A.globalCompositeOperation===e&&(A.fillStyle=n?"#a00":"#300",A.fillRect(0,0,1,1),i=A.getImageData(0,0,1,1).data[0]!==n?170:51)}catch(t){}A.restore(),w[e]=i})),dt.release(A)),this.process=function(h,d,p,g,f){var m=d.canvas,v="normal"===h;if(v||w[h])p.save(),p.setTransform(1,0,0,1,0,0),p.globalAlpha=g,v||(p.globalCompositeOperation=h),p.drawImage(m,f.x,f.y),p.restore();else{var _=y[h];if(_){for(var A=(h=p.getImageData(f.x,f.y,m.width,m.height)).data,b=d.getImageData(0,0,m.width,m.height).data,C=0,x=A.length;C<x;C+=4){t=b[C],o=A[C],e=b[C+1],r=A[C+1],n=b[C+2],s=A[C+2],i=b[C+3],a=A[C+3],_();var I=i*g/255,S=1-I;A[C]=I*l+S*o,A[C+1]=I*c+S*r,A[C+2]=I*u+S*s,A[C+3]=i*g+S*a}p.putImageData(h,f.x,f.y)}}}},gt=new function(){var t="http://www.w3.org/2000/svg",e="http://www.w3.org/2000/xmlns",n="http://www.w3.org/1999/xlink",i={href:n,xlink:e,xmlns:e+"/","xmlns:xlink":e+"/"};function o(t,e,n){for(var o in e){var r=e[o],s=i[o];"number"==typeof r&&n&&(r=n.number(r)),s?t.setAttributeNS(s,o,r):t.setAttribute(o,r)}return t}return{svg:t,xmlns:e,xlink:n,create:function(e,n,i){return o(l.createElementNS(t,e),n,i)},get:function(t,e){var n=i[e];return"null"===(e=n?t.getAttributeNS(n,e):t.getAttribute(e))?null:e},set:o}},ft=h.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(t,e){return!e&&(t instanceof j||t instanceof P||t instanceof V)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},(function(t,e){var n=h.capitalize(e),i=t[2];this[e]={type:t[1],property:e,attribute:t[0],toSVG:i,fromSVG:i&&h.each(i,(function(t,e){this[t]=e}),{}),exportFilter:t[3],get:"get"+n,set:"set"+n}}),{});function mt(t,e,n){var i,o,r=new h,s=t.getTranslation();return e&&(t.isInvertible()?(i=(t=t._shiftless())._inverseTransform(s),s=null):i=new v,r[n?"cx":"x"]=i.x,r[n?"cy":"y"]=i.y),t.isIdentity()||((o=t.decompose())?(e=[],n=o.rotation,i=o.scaling,o=o.skewing,s&&!s.isZero()&&e.push("translate("+$.point(s)+")"),n&&e.push("rotate("+$.number(n)+")"),f.isZero(i.x-1)&&f.isZero(i.y-1)||e.push("scale("+$.point(i)+")"),o.x&&e.push("skewX("+$.number(o.x)+")"),o.y&&e.push("skewY("+$.number(o.y)+")"),r.transform=e.join(" ")):r.transform="matrix("+t.getValues().join(",")+")"),r}function vt(t,e){for(var n=mt(t._matrix),i=t._children,o=gt.create("g",n,$),r=0,s=i.length;r<s;r++){var a,l=i[r],h=bt(l,e);h&&(l.isClipMask()?((a=gt.create("clipPath")).appendChild(h),wt(l,a,"clip"),gt.set(o,{"clip-path":"url(#"+a.id+")"})):o.appendChild(h))}return o}function _t(t){var e,n=t._type,i=t._radius,o=mt(t._matrix,!0,"rectangle"!==n);return"rectangle"===n&&(n="rect",t=(e=t._size).width,e=e.height,o.x-=t/2,o.y-=e/2,o.width=t,o.height=e,i.isZero()&&(i=null)),i&&("circle"===n?o.r=i:(o.rx=i.width,o.ry=i.height)),gt.create(n,o,$)}function yt(t,e){return K=K||{ids:{},svgs:{}},t&&K.svgs[e+"-"+(t._id||t.__id||(t.__id=m.get("svg")))]}function wt(t,e,n){K||yt();var i=K.ids[n]=(K.ids[n]||0)+1;e.id=n+"-"+i,K.svgs[n+"-"+(t._id||t.__id)]=e}function At(t,e){var n=t,i=null;if(K){for(var o in n="svg"===t.nodeName.toLowerCase()&&t,K.svgs)i||(n||(n=gt.create("svg")).appendChild(t),i=n.insertBefore(gt.create("defs"),n.firstChild)),i.appendChild(K.svgs[o]);K=null}return e.asString?(new r.XMLSerializer).serializeToString(n):n}function bt(t,e,n){var i=Q[t._class],o=i&&i(t,e);return o&&((i=e.onExport)&&(o=i(t,o,e)||o),(e=JSON.stringify(t._data))&&"{}"!==e&&"null"!==e&&o.setAttribute("data-paper-data",e)),o&&function(t,e,n){var i={},o=!n&&t.getParent(),r=[];return null!=t._name&&(i.id=t._name),h.each(ft,(function(e){var n=e.get,s=e.type,a=t[n]();(e.exportFilter?!e.exportFilter(t,a):o&&h.equals(o[n](),a))||("color"!==s||null==a||(n=a.getAlpha())<1&&(i[e.attribute+"-opacity"]=n),"style"===s?r.push(e.attribute+": "+a):i[e.attribute]=null==a?"none":"color"===s?a.gradient?function(t){if(!(a=yt(t,"color"))){var e,n,i=t.getGradient(),o=i._radial,r=t.getOrigin(),s=t.getDestination();o?(e={cx:r.x,cy:r.y,r:r.getDistance(s)},(n=t.getHighlight())&&(e.fx=n.x,e.fy=n.y)):e={x1:r.x,y1:r.y,x2:s.x,y2:s.y},e.gradientUnits="userSpaceOnUse";for(var a=gt.create((o?"radial":"linear")+"Gradient",e,$),l=i._stops,h=0,c=l.length;h<c;h++){var u,d=(u=l[h])._color,p=d.getAlpha();e={offset:null==(u=u._offset)?h/(c-1):u},d&&(e["stop-color"]=d.toCSS(!0)),p<1&&(e["stop-opacity"]=p),a.appendChild(gt.create("stop",e,$))}wt(t,a,"color")}return"url(#"+a.id+")"}(a):a.toCSS(!0):"array"===s?a.join(","):"lookup"===s?e.toSVG[a]:a)})),r.length&&(i.style=r.join(";")),1===i.opacity&&delete i.opacity,t._visible||(i.visibility="hidden"),gt.set(e,i,$)}(t,o,n)}function Ct(t){return $=new g((t=t||{}).precision),t}function xt(t,e,n,i,o,r){return n=null==(r=gt.get(t,e)||r)?i?null:n?"":0:n?r:parseFloat(r),/%\s*$/.test(r)?n/100*(o?1:tt[/x|^width/.test(e)?"width":"height"]):n}function It(t,e,n,i,o,r,s){return e=xt(t,e||"x",!1,i,o,r),n=xt(t,n||"y",!1,i,o,s),!i||null!=e&&null!=n?new v(e,n):null}function St(t,e,n,i,o){return e=xt(t,e||"width",!1,i,o),n=xt(t,n||"height",!1,i,o),!i||null!=e&&null!=n?new y(e,n):null}function Tt(t,e,n){return"none"===t?null:"number"===e?parseFloat(t):"array"===e?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===e?Nt(t)||t:"lookup"===e?n[t]:t}function kt(t,e,n,i){var o=t.childNodes,r="clippath"===e,s="defs"===e,a=new T,l=a._project,h=(e=l._currentStyle,[]);if(r||s||(a=Mt(a,t,i),l._currentStyle=a._style.clone()),i)for(var c=t.querySelectorAll("defs"),u=0,d=c.length;u<d;u++)Rt(c[u],n,!1);for(u=0,d=o.length;u<d;u++){var p,g=o[u];1!==g.nodeType||/^defs$/i.test(g.nodeName)||!(p=Rt(g,n,!1))||p instanceof B||h.push(p)}return a.addChildren(h),r&&(a=Mt(a.reduce(),t,i)),l._currentStyle=e,(r||s)&&(a.remove(),a=null),a}function Pt(t,e){for(var n=t.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),i=[],o=0,r=n.length;o<r;o+=2)i.push(new v(parseFloat(n[o]),parseFloat(n[o+1])));return t=new z(i),"polygon"===e&&t.closePath(),t}function Et(t,e){var n;if(e="radialgradient"===e,u=(xt(t,"href",!0)||"").substring(1))(n=et[u].getGradient())._radial^e&&((n=n.clone())._radial=e);else{for(var i=t.childNodes,o=[],r=0,s=i.length;r<s;r++){var a=i[r];1===a.nodeType&&o.push(Mt(new Y,a))}n=new W(o,e)}var l,h,c,u="userSpaceOnUse"!==xt(t,"gradientUnits",!0);return e?(h=(l=It(t,"cx","cy",!1,u,"50%","50%")).add(xt(t,"r",!1,!1,u,"50%"),0),c=It(t,"fx","fy",!0,u)):(l=It(t,"x1","y1",!1,u,"0%","0%"),h=It(t,"x2","y2",!1,u,"100%","0%")),Mt(new U(n,l,h,c),t)._scaleToBounds=u,null}function Ot(t,e,n,i){if(t.transform){for(var o=(i.getAttribute(n)||"").split(/\)\s*/g),r=new C,s=0,a=o.length;s<a&&(h=o[s]);s++){for(var l=h.split(/\(\s*/),h=l[0],c=l[1].split(/[\s,]+/g),u=0,d=c.length;u<d;u++)c[u]=parseFloat(c[u]);switch(h){case"matrix":r.append(new C(c[0],c[1],c[2],c[3],c[4],c[5]));break;case"rotate":r.rotate(c[0],c[1]||0,c[2]||0);break;case"translate":r.translate(c[0],c[1]||0);break;case"scale":r.scale(c);break;case"skewX":r.skew(c[0],0);break;case"skewY":r.skew(0,c[0])}}t.transform(r)}}function Bt(t,e,n){(n=t[n="fill-opacity"===n?"getFillColor":"getStrokeColor"]&&t[n]())&&n.setAlpha(parseFloat(e))}function Lt(t,e,n){var i;return!(i=(i=t.attributes[e])&&i.value)&&t.style&&(e=h.camelize(e),(i=t.style[e])||n.node[e]===n.parent[e]||(i=n.node[e])),i?"none"===i?null:i:s}function Mt(t,e,n){var i=e.parentNode,o={node:Z.getStyles(e)||{},parent:!n&&!/^defs$/i.test(i.tagName)&&Z.getStyles(i)||{}};return h.each(it,(function(n,i){var r=Lt(e,i,o);t=r!==s&&n(t,r,i,e,o)||t})),t}function Nt(t){return(t=(t=(t=t&&t.match(/\((?:["'#]*)([^"')]+)/))&&t[1])&&et[a?t.replace(a.location.href.split("#")[0]+"#",""):t])&&t._scaleToBounds&&((t=t.clone())._scaleToBounds=!0),t}function Rt(t,e,n){var i,o,r,s="#document"!==(g=t.nodeName.toLowerCase()),a=l.body;n&&s&&(tt=jt.getView().getSize(),tt=St(t,null,null,!0)||tt,i=gt.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),o=t.parentNode,r=t.nextSibling,i.appendChild(t),a.appendChild(i));var c=jt.settings,u=c.applyMatrix,d=c.insertItems;c.applyMatrix=!1,c.insertItems=!1;var p=nt[g],g=p&&p(t,g,e,n)||null;return c.insertItems=d,c.applyMatrix=u,g&&(!s||g instanceof T||(g=Mt(g,t,n)),c=e.onImport,s=s&&t.getAttribute("data-paper-data"),c&&(g=c(t,g,e)||g),e.expandShapes&&g instanceof P&&(g.remove(),g=g.toPath()),s&&(g._data=JSON.parse(s))),i&&(a.removeChild(i),o&&(r?o.insertBefore(t,r):o.appendChild(t))),n&&(et={},g&&h.pick(e.applyMatrix,u)&&g.matrix.apply(!0,!0)),g}function Ft(t,e,n){if(!t)return null;e="function"==typeof e?{onLoad:e}:e||{};var i=jt,o=null;function a(a){try{var l="object"==typeof a?a:(new r.DOMParser).parseFromString(a.trim(),"image/svg+xml");if(!l.nodeName)throw l=null,new Error("Unsupported SVG source: "+t);jt=i,o=Rt(l,e,!0),e&&!1===e.insert||n._insertItem(s,o);var h=e.onLoad;h&&h(o,a)}catch(a){c(a)}}function c(t,n){var i=e.onError;if(!i)throw new Error(t);i(t,n)}if("string"!=typeof t||/^[\s\S]*</.test(t)){if("undefined"!=typeof File&&t instanceof File){var u=new FileReader;return u.onload=function(){a(u.result)},u.onerror=function(){c(u.error)},u.readAsText(t)}a(t)}else{var d=l.getElementById(t);d?a(d):function(t){var e=new r.XMLHttpRequest;e.open((t.method||"get").toUpperCase(),t.url,h.pick(t.async,!0)),t.mimeType&&e.overrideMimeType(t.mimeType),e.onload=function(){var n=e.status;0===n||200===n?t.onLoad&&t.onLoad.call(e,e.responseText):e.onerror()},e.onerror=function(){var n=e.status,i='Could not load "'+t.url+'" (Status: '+n+")";if(!t.onError)throw new Error(i);t.onError(i,n)},e.send(null)}({url:t,async:!0,onLoad:a,onError:c})}return o}Q={Group:vt,Layer:vt,Raster:function(t,e){var n=mt(t._matrix,!0),i=t.getSize(),o=t.getImage();return n.x-=i.width/2,n.y-=i.height/2,n.width=i.width,n.height=i.height,n.href=0==e.embedImages&&o&&o.src||t.toDataURL(),gt.create("image",n,$)},Path:function(t,e){var n=e.matchShapes;if(n){var i=t.toShape(!1);if(i)return _t(i)}var o=t._segments,r=o.length,s=mt(t._matrix);if(n&&2<=r&&!t.hasHandles())if(2<r){for(var a=t._closed?"polygon":"polyline",l=[],h=0;h<r;h++)l.push($.point(o[h]._point));s.points=l.join(" ")}else a="line",i=o[0]._point,n=o[1]._point,s.set({x1:i.x,y1:i.y,x2:n.x,y2:n.y});else a="path",s.d=t.getPathData(null,e.precision);return gt.create(a,s,$)},Shape:_t,CompoundPath:function(t,e){var n=mt(t._matrix);return(e=t.getPathData(null,e.precision))&&(n.d=e),gt.create("path",n,$)},SymbolItem:function(t,e){var n=mt(t._matrix,!0),i=t._definition,o=yt(i,"symbol"),r=i._item;return t=r.getStrokeBounds(),o||((o=gt.create("symbol",{viewBox:$.rectangle(t)})).appendChild(bt(r,e)),wt(i,o,"symbol")),n.href="#"+o.id,n.x+=t.x,n.y+=t.y,n.width=t.width,n.height=t.height,n.overflow="visible",gt.create("use",n,$)},PointText:function(t){var e=gt.create("text",mt(t._matrix,!0),$);return e.textContent=t._content,e}},S.inject({exportSVG:function(t){return At(bt(this,t=Ct(t),!0),t)}}),I.inject({exportSVG:function(t){t=Ct(t);var e=this._children,n=this.getView(),i=h.pick(t.bounds,"view"),o=(o=t.matrix||"view"===i&&n._matrix)&&C.read([o]);n="view"===i?new A([0,0],n.getViewSize()):"content"===i?S._getBounds(e,o,{stroke:!0}).rect:A.read([i],0,{readNull:!0}),i={version:"1.1",xmlns:gt.svg,"xmlns:xlink":gt.xlink},n&&(i.width=n.width,i.height=n.height,(n.x||0===n.x||n.y||0===n.y)&&(i.viewBox=$.rectangle(n)));var r=i=gt.create("svg",i,$);o&&!o.isIdentity()&&(r=i.appendChild(gt.create("g",mt(o),$)));for(var s=0,a=e.length;s<a;s++)r.appendChild(bt(e[s],t,!0));return At(i,t)}}),et={},nt={"#document":function(t,e,n,i){for(var o=t.childNodes,r=0,s=o.length;r<s;r++){var a=o[r];if(1===a.nodeType)return Rt(a,n,i)}},g:kt,svg:kt,clippath:kt,polygon:Pt,polyline:Pt,path:function(t){return j.create(t.getAttribute("d"))},lineargradient:Et,radialgradient:Et,image:function(t){var e=new E(xt(t,"href",!0));return e.on("load",(function(){var e=St(t);this.setSize(e),e=It(t).add(e.divide(2)),this._matrix.append((new C).translate(e))})),e},symbol:function(t,e,n,i){return new B(kt(t,e,n,i),!0)},defs:kt,use:function(t){var e=(xt(t,"href",!0)||"").substring(1);return e=et[e],t=It(t),e?e instanceof B?e.place(t):e.clone().translate(t):null},circle:function(t){return new P.Circle(It(t,"cx","cy"),xt(t,"r"))},ellipse:function(t){return new P.Ellipse({center:It(t,"cx","cy"),radius:St(t,"rx","ry")})},rect:function(t){return new P.Rectangle(new A(It(t),St(t)),St(t,"rx","ry"))},line:function(t){return new z.Line(It(t,"x1","y1"),It(t,"x2","y2"))},text:function(t){var e=new q(It(t).add(It(t,"dx","dy")));return e.setContent(t.textContent.trim()||""),e},switch:kt},it=h.set(h.each(ft,(function(t){this[t.attribute]=function(e,n){e[t.set]&&(e[t.set](Tt(n,t.type,t.fromSVG)),"color"!==t.type||(n=e[t.get]())&&n._scaleToBounds&&(e=e.getBounds(),n.transform((new C).translate(e.getPoint()).scale(e.getSize()))))}}),{}),{id:function(t,e){(et[e]=t).setName&&t.setName(e)},"clip-path":function(t,e){if(e=Nt(e)){if((e=e.clone()).setClipMask(!0),!(t instanceof T))return new T(e,t);t.insertChild(0,e)}},gradientTransform:Ot,transform:Ot,"fill-opacity":Bt,"stroke-opacity":Bt,visibility:function(t,e){t.setVisible&&t.setVisible("visible"===e)},display:function(t,e){t.setVisible&&t.setVisible(null!==e)},"stop-color":function(t,e){t.setColor&&t.setColor(e)},"stop-opacity":function(t,e){t._color&&t._color.setAlpha(parseFloat(e))},offset:function(t,e){var n;t.setOffset&&(n=e.match(/(.*)%$/),t.setOffset(n?n[1]/100:parseFloat(e)))},viewBox:function(t,e,n,i,o){var r,s,a=new A(Tt(e,"array"));e=St(i,null,null,!0),t instanceof T?(s=e?e.divide(a.getSize()):1,r=(new C).scale(s).translate(a.getPoint().negate()),s=t):t instanceof B&&(e&&a.setSize(e),s=t._item),s&&("visible"!==Lt(i,"overflow",o)&&((a=new P.Rectangle(a)).setClipMask(!0),s.addChild(a)),r&&s.transform(r))}}),S.inject({importSVG:function(t,e){return Ft(t,e,this)}}),I.inject({importSVG:function(t,e){return this.activate(),Ft(t,e,this)}});var jt=new(u.inject(h.exports,{Base:h,Numerical:f,Key:lt,DomEvent:X,DomElement:Z,document:l,window:a,Symbol:B,PlacedSymbol:O}));return jt.agent.node&&n(999)(jt),void 0!==(o="function"==typeof(i=jt)?i.call(e,n,e,t):i)&&(t.exports=o),jt}).call(this,"object"==typeof self?self:null)},72:t=>{"use strict";var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var r={},s=[],a=0;a<t.length;a++){var l=t[a],h=i.base?l[0]+i.base:l[0],c=r[h]||0,u="".concat(h," ").concat(c);r[h]=c+1;var d=n(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)e[d].references++,e[d].updater(p);else{var g=o(p,i);i.byIndex=a,e.splice(a,0,{identifier:u,updater:g,references:1})}s.push(u)}return s}function o(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,o){var r=i(t=t||[],o=o||{});return function(t){t=t||[];for(var s=0;s<r.length;s++){var a=n(r[s]);e[a].references--}for(var l=i(t,o),h=0;h<r.length;h++){var c=n(r[h]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}r=l}}},659:t=>{"use strict";var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},540:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},56:(t,e,n)=>{"use strict";t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},825:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,o&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},113:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},999:()=>{},965:()=>{}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={id:i,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nc=void 0;var i={};return(()=>{"use strict";n.r(i),n.d(i,{AnnotationToolbar:()=>xt,AnnotationToolkit:()=>he,AnnotationUITool:()=>A,BrushTool:()=>$,DefaultTool:()=>T,EllipseTool:()=>dt,FeatureCollectionUI:()=>Ot,FeatureUI:()=>Tt,FileDialog:()=>Mt,LayerUI:()=>Bt,LinestringTool:()=>mt,OSDPaperjsAnnotation:()=>we,PaperOffset:()=>X,PaperOverlay:()=>Kt,PointTextTool:()=>lt,PointTool:()=>rt,PolygonTool:()=>gt,RasterTool:()=>bt,RectangleTool:()=>ct,RotationControlOverlay:()=>ce,ScreenshotOverlay:()=>_e,SelectTool:()=>_t,StyleTool:()=>P,ToolBase:()=>y,TransformTool:()=>wt,WandTool:()=>R});let t=n(292);var e=n(72),o=n.n(e),r=n(825),s=n.n(r),a=n(659),l=n.n(a),h=n(56),c=n.n(h),u=n(540),d=n.n(u),p=n(113),g=n.n(p),f=n(676),m={};m.styleTagTransform=g(),m.setAttributes=c(),m.insert=l().bind(null,"head"),m.domAPI=s(),m.insertStyleElement=d(),o()(f.A,m),f.A&&f.A.locals&&f.A.locals;var v=n(946),_={};_.styleTagTransform=g(),_.setAttributes=c(),_.insert=l().bind(null,"head"),_.domAPI=s(),_.insertStyleElement=d(),o()(v.A,_),v.A&&v.A.locals&&v.A.locals;class y{constructor(t){let e;this.project={getZoom:()=>t.view.getZoom(),toolLayer:t.project.layers.toolLayer||t.project.activeLayer,paperScope:t,overlay:t.overlay};let n=this;this._identityMatrix=new t.Matrix,this.extensions={onActivate:()=>{},onDeactivate:()=>{}},this.tool=new t.Tool,this.tool._toolObject=this,this.tool.extensions={onKeyUp:()=>{},onKeyDown:()=>{}},this.tool.onKeyDown=function(t){e||"shift"!==t.key||(e=!0,n.onDeactivate()),this.extensions.onKeyDown(t),n.onKeyDown(t)},this.tool.onKeyUp=function(t){"shift"==t.key&&(e=!1,n.onActivate()),this.extensions.onKeyUp(t),n.onKeyUp(t)},this.tool.onMouseDown=t=>{this.onMouseDown(t)},this.tool.onMouseDrag=t=>{this.onMouseDrag(t)},this.tool.onMouseMove=t=>{this.onMouseMove(t)},this.tool.onMouseUp=t=>{this.onMouseUp(t)},this.listeners={}}getTolerance(t,e=null){return e||(e=this.item),t/(e?.layer.scaling.x||1)/this.project.getZoom()}isActive(){return this._active}activate(){this.tool.activate(),this.onActivate()}deactivate(t){this.onDeactivate(t)}onActivate(){this.captureUserInput(!0),this.project.overlay.addEventListener("wheel",this.tool.onMouseWheel),this.project.toolLayer.bringToFront(),this.extensions.onActivate()}onDeactivate(t=!1){this.captureUserInput(!1),this.project.overlay.removeEventListener("wheel",this.tool.onMouseWheel),this.project.toolLayer.sendToBack(),this.extensions.onDeactivate(t)}addEventListener(t,e){this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e)}broadcast(t,...e){let n=this.listeners[t];n&&n.forEach((t=>t(...e)))}captureUserInput(t=!0){this.project.overlay.setOSDMouseNavEnabled(!t)}onMouseDown(){}onMouseMove(){}onMouseDrag(){}onMouseUp(){}onKeyDown(){}onKeyUp(){}}class w{constructor(){}getSqDist(t,e){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i}getSqSegDist(t,e,n){var i=e.x,o=e.y,r=n.x-i,s=n.y-o;if(0!==r||0!==s){var a=((t.x-i)*r+(t.y-o)*s)/(r*r+s*s);a>1?(i=n.x,o=n.y):a>0&&(i+=r*a,o+=s*a)}return(r=t.x-i)*r+(s=t.y-o)*s}simplifyRadialDist(t,e){for(var n,i=t[0],o=[i],r=1,s=t.length;r<s;r++)n=t[r],this.getSqDist(n,i)>e&&(o.push(n),i=n);return i!==n&&o.push(n),o}simplifyDPStep(t,e,n,i,o){for(var r,s=i,a=e+1;a<n;a++){var l=this.getSqSegDist(t[a],t[e],t[n]);l>s&&(r=a,s=l)}s>i&&(r-e>1&&this.simplifyDPStep(t,e,r,i,o),o.push(t[r]),n-r>1&&this.simplifyDPStep(t,r,n,i,o))}simplifyDouglasPeucker(t,e){var n=t.length-1,i=[t[0]];return this.simplifyDPStep(t,0,n,e,i),i.push(t[n]),i}simplify(t,e,n){if(t.length<=2)return t;var i=void 0!==e?e*e:1;return t=n?t:this.simplifyRadialDist(t,i),this.simplifyDouglasPeucker(t,i)}}class A extends y{constructor(t){super(t),this._active=!1,this._items=[],this._item=null,this.simplifier=new w,this.tool.onMouseDown=t=>{this.onMouseDown(this._transformEvent(t))},this.tool.onMouseDrag=t=>{this.onMouseDrag(this._transformEvent(t))},this.tool.onMouseMove=t=>{this.onMouseMove(this._transformEvent(t))},this.tool.onMouseUp=t=>{this.onMouseUp(this._transformEvent(t))}}isActive(){return this._active}activate(){if(this._active)return;this._active=!0,this.getSelectedItems(),this._setTargetLayer();let t=this.project.paperScope.getActiveTool();this.tool.activate(),this.toolbarControl.activate(),t&&t!=this&&t.deactivate(!0),this.raiseCanvasZIndex(),this.onActivate(),this.broadcast("activated",{target:this})}deactivate(t){this._active&&(this._active=!1,this.toolbarControl.deactivate(),this.resetCanvasZIndex(),this.onDeactivate(t),this.broadcast("deactivated",{target:this}))}raiseCanvasZIndex(){const t=this.project.paperScope.overlay.viewer,e=t.canvas;this._canvasPriorZIndex=window.getComputedStyle(e)["z-index"];const n=Array.from(t.canvas.parentElement.children).filter((t=>t!==e)),i=Math.max(...n.map((t=>{const e=window.getComputedStyle(t)["z-index"];return"auto"===e?0:parseInt(e)})));e.style["z-index"]=i+1}resetCanvasZIndex(){this.project.paperScope.overlay.viewer.canvas.style["z-index"]=this._canvasPriorZIndex}getToolbarControl(){return this.toolbarControl}setToolbarControl(t){return this.toolbarControl=t,this.toolbarControl}refreshItems(){return this.getSelectedItems()}getSelectedItems(){this._items=this.project.paperScope.findSelectedItems(),this._itemToCreate=this.project.paperScope.findSelectedNewItem()}selectionChanged(){this.getSelectedItems(),this._setTargetLayer(),this.onSelectionChanged()}onSelectionChanged(){}get items(){return this._items}get item(){return 1==this._items.length?this._items[0]:null}get itemToCreate(){return this._itemToCreate}get targetLayer(){return this._targetLayer}get targetMatrix(){return this.targetLayer?this.targetLayer.matrix:this._identityMatrix}doSimplify(t){t&&!Array.isArray(t)&&(t=[t]),t||(t=this.items);for(const e of t){let t=10/this.project.getZoom(),n=2.5/this.project.getZoom();const i=e.clone();let o=[];(i.children||[i]).forEach((e=>{let i=e.segments.map((e=>(e.point.subtract(e.previous.point).length<t&&e.point.subtract(e.next.point).length<t&&(e.point.x=(e.point.x+e.previous.point.x+e.next.point.x)/3,e.point.y=(e.point.y+e.previous.point.y+e.next.point.y)/3),e.point)));i.push(i[0]);let r=this.simplifier.simplify(i,n,!0);e.segments=r,(e.segments.length<3||Math.abs(e.area)<n*n)&&o.push(e)})),o.forEach((t=>t.remove()));let r=i.unite(i,{insert:!1}).reduce().toCompoundPath();if(i._children?(i.removeChildren(),i.addChildren(r.children)):i.setSegments(r.children[0].segments),!e.isBoundingElement){let t=e.parent.children.filter((t=>t.isBoundingElement));i.applyBounds(t)}r.remove(),e._children?(e.removeChildren(),e.addChildren(i.children)):e.setSegments(i.segments),i.remove()}}_setTargetLayer(){if(this.item)this._targetLayer=this.item.layer;else if(this.itemToCreate)this._targetLayer=this.itemToCreate.layer;else if(this.items){let t=new Set(this.items.map((t=>t.layer)));1===t.size?this._targetLayer=t.values().next().value:this._targetLayer=this.project.overlay.viewer.viewport.paperLayer}else this._targetLayer=this.project.paperScope.project.activeLayer}_transformEvent(t){let e=this.targetMatrix,n={point:e.inverseTransform(t.point),downPoint:e.inverseTransform(t.downPoint),lastPoint:e.inverseTransform(t.lastPoint),middlePoint:e.inverseTransform(t.middlePoint)},i=t.point.subtract(t.delta);return n.delta=n.point.subtract(e.inverseTransform(i)),t.original={point:t.point,downPoint:t.downPoint,lastPoint:t.lastPoint,middlePoint:t.middlePoint,delta:t.delta},Object.assign(t,n),t}}class b{constructor(t){this._active=!1;let e=document.createElement("button");e.classList.add("btn","invisible"),e.textContent="Generic Tool",this.button=new OpenSeadragon.Button({tooltip:"Generic Tool",element:e,onClick:function(e){e.eventSource.element.disabled||(t._active?t.deactivate(!0):t.activate())}}),this.button.configure=function(t,e){this.element.title=e,this.element.replaceChildren(t),this.element.classList.remove("invisible"),this.tooltip=e},this.dropdown=document.createElement("div"),this.dropdown.classList.add("dropdown"),this.tool=t}isEnabledForMode(t){return!1}activate(){this._active||(this._active=!0,this.button.element.classList.add("active"),this.dropdown.classList.add("active"))}deactivate(t){this._active&&(this._active=!1,this.button.element.classList.remove("active"),this.dropdown.classList.remove("active"))}}const C={"fa-pen-nib":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M368.4 18.3L312.7 74.1 437.9 199.3l55.7-55.7c21.9-21.9 21.9-57.3 0-79.2L447.6 18.3c-21.9-21.9-57.3-21.9-79.2 0zM288 94.6l-9.2 2.8L134.7 140.6c-19.9 6-35.7 21.2-42.3 41L3.8 445.8c-3.8 11.3-1 23.9 7.3 32.4L164.7 324.7c-3-6.3-4.7-13.3-4.7-20.7c0-26.5 21.5-48 48-48s48 21.5 48 48s-21.5 48-48 48c-7.4 0-14.4-1.7-20.7-4.7L33.7 500.9c8.6 8.3 21.1 11.2 32.4 7.3l264.3-88.6c19.7-6.6 35-22.4 41-42.3l43.2-144.1 2.8-9.2L288 94.6z"/></svg>',"fa-edit":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"/></svg>',"fa-up-down-left-right":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M278.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-64 64c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8h32v96H128V192c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6V288h96v96H192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64c12.5 12.5 32.8 12.5 45.3 0l64-64c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8H288V288h96v32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6v32H288V128h32c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-64-64z"/></svg>',"fa-palette":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M512 256c0 .9 0 1.8 0 2.7c-.4 36.5-33.6 61.3-70.1 61.3H344c-26.5 0-48 21.5-48 48c0 3.4 .4 6.7 1 9.9c2.1 10.2 6.5 20 10.8 29.9c6.1 13.8 12.1 27.5 12.1 42c0 31.8-21.6 60.7-53.4 62c-3.5 .1-7 .2-10.6 .2C114.6 512 0 397.4 0 256S114.6 0 256 0S512 114.6 512 256zM128 288a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm0-96a32 32 0 1 0 0-64 32 32 0 1 0 0 64zM288 96a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm96 96a32 32 0 1 0 0-64 32 32 0 1 0 0 64z"/></svg>',"fa-arrow-pointer":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M0 55.2V426c0 12.2 9.9 22 22 22c6.3 0 12.4-2.7 16.6-7.5L121.2 346l58.1 116.3c7.9 15.8 27.1 22.2 42.9 14.3s22.2-27.1 14.3-42.9L179.8 320H297.9c12.2 0 22.1-9.9 22.1-22.1c0-6.3-2.7-12.3-7.4-16.5L38.6 37.9C34.3 34.1 28.9 32 23.2 32C10.4 32 0 42.4 0 55.2z"/></svg>',"fa-vector-square":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M368 80h32v32H368V80zM352 32c-17.7 0-32 14.3-32 32H128c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3 0 64v64c0 17.7 14.3 32 32 32V352c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32H96c17.7 0 32-14.3 32-32H320c0 17.7 14.3 32 32 32h64c17.7 0 32-14.3 32-32V384c0-17.7-14.3-32-32-32V160c17.7 0 32-14.3 32-32V64c0-17.7-14.3-32-32-32H352zM96 160c17.7 0 32-14.3 32-32H320c0 17.7 14.3 32 32 32V352c-17.7 0-32 14.3-32 32H128c0-17.7-14.3-32-32-32V160zM48 400H80v32H48V400zm320 32V400h32v32H368zM48 112V80H80v32H48z"/></svg>',"fa-image":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M448 80c8.8 0 16 7.2 16 16V415.8l-5-6.5-136-176c-4.5-5.9-11.6-9.3-19-9.3s-14.4 3.4-19 9.3L202 340.7l-30.5-42.7C167 291.7 159.8 288 152 288s-15 3.7-19.5 10.1l-80 112L48 416.3l0-.3V96c0-8.8 7.2-16 16-16H448zM64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm80 192a48 48 0 1 0 0-96 48 48 0 1 0 0 96z"/></svg>',"fa-draw-polygon":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M96 151.4V360.6c9.7 5.6 17.8 13.7 23.4 23.4H328.6c0-.1 .1-.2 .1-.3l-4.5-7.9-32-56 0 0c-1.4 .1-2.8 .1-4.2 .1c-35.3 0-64-28.7-64-64s28.7-64 64-64c1.4 0 2.8 0 4.2 .1l0 0 32-56 4.5-7.9-.1-.3H119.4c-5.6 9.7-13.7 17.8-23.4 23.4zM384.3 352c35.2 .2 63.7 28.7 63.7 64c0 35.3-28.7 64-64 64c-23.7 0-44.4-12.9-55.4-32H119.4c-11.1 19.1-31.7 32-55.4 32c-35.3 0-64-28.7-64-64c0-23.7 12.9-44.4 32-55.4V151.4C12.9 140.4 0 119.7 0 96C0 60.7 28.7 32 64 32c23.7 0 44.4 12.9 55.4 32H328.6c11.1-19.1 31.7-32 55.4-32c35.3 0 64 28.7 64 64c0 35.3-28.5 63.8-63.7 64l-4.5 7.9-32 56-2.3 4c4.2 8.5 6.5 18 6.5 28.1s-2.3 19.6-6.5 28.1l2.3 4 32 56 4.5 7.9z"/></svg>',"fa-font":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M254 52.8C249.3 40.3 237.3 32 224 32s-25.3 8.3-30 20.8L57.8 416H32c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32h-1.8l18-48H303.8l18 48H320c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H390.2L254 52.8zM279.8 304H168.2L224 155.1 279.8 304z"/></svg>',"fa-map-pin":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M16 144a144 144 0 1 1 288 0A144 144 0 1 1 16 144zM160 80c8.8 0 16-7.2 16-16s-7.2-16-16-16c-53 0-96 43-96 96c0 8.8 7.2 16 16 16s16-7.2 16-16c0-35.3 28.7-64 64-64zM128 480V317.1c10.4 1.9 21.1 2.9 32 2.9s21.6-1 32-2.9V480c0 17.7-14.3 32-32 32s-32-14.3-32-32z"/></svg>',"fa-circle":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256z"/></svg>',"fa-hand":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V240c0 8.8-7.2 16-16 16s-16-7.2-16-16V64c0-17.7-14.3-32-32-32s-32 14.3-32 32V336c0 1.5 0 3.1 .1 4.6L67.6 283c-16-15.2-41.3-14.6-56.6 1.4s-14.6 41.3 1.4 56.6L124.8 448c43.1 41.1 100.4 64 160 64H304c97.2 0 176-78.8 176-176V128c0-17.7-14.3-32-32-32s-32 14.3-32 32V240c0 8.8-7.2 16-16 16s-16-7.2-16-16V64c0-17.7-14.3-32-32-32s-32 14.3-32 32V240c0 8.8-7.2 16-16 16s-16-7.2-16-16V32z"/></svg>',"fa-brush":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M162.4 6c-1.5-3.6-5-6-8.9-6h-19c-3.9 0-7.5 2.4-8.9 6L104.9 57.7c-3.2 8-14.6 8-17.8 0L66.4 6c-1.5-3.6-5-6-8.9-6H48C21.5 0 0 21.5 0 48V224v22.4V256H9.6 374.4 384v-9.6V224 48c0-26.5-21.5-48-48-48H230.5c-3.9 0-7.5 2.4-8.9 6L200.9 57.7c-3.2 8-14.6 8-17.8 0L162.4 6zM0 288v32c0 35.3 28.7 64 64 64h64v64c0 35.3 28.7 64 64 64s64-28.7 64-64V384h64c35.3 0 64-28.7 64-64V288H0zM192 432a16 16 0 1 1 0 32 16 16 0 1 1 0-32z"/></svg>',"fa-rotate":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M142.9 142.9c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5c0 0 0 0 0 0H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5c7.7-21.8 20.2-42.3 37.8-59.8zM16 312v7.6 .7V440c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l41.6-41.6c87.6 86.5 228.7 86.2 315.8-1c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.2 62.2-162.7 62.5-225.3 1L185 329c6.9-6.9 8.9-17.2 5.2-26.2s-12.5-14.8-22.2-14.8H48.4h-.7H40c-13.3 0-24 10.7-24 24z"/></svg>',"fa-pencil":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z"/></svg>',"fa-save":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V173.3c0-17-6.7-33.3-18.7-45.3L352 50.7C340 38.7 323.7 32 306.7 32H64zm0 96c0-17.7 14.3-32 32-32H288c17.7 0 32 14.3 32 32v64c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V128zM224 288a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>',"fa-wand-magic-sparkles":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M234.7 42.7L197 56.8c-3 1.1-5 4-5 7.2s2 6.1 5 7.2l37.7 14.1L248.8 123c1.1 3 4 5 7.2 5s6.1-2 7.2-5l14.1-37.7L315 71.2c3-1.1 5-4 5-7.2s-2-6.1-5-7.2L277.3 42.7 263.2 5c-1.1-3-4-5-7.2-5s-6.1 2-7.2 5L234.7 42.7zM46.1 395.4c-18.7 18.7-18.7 49.1 0 67.9l34.6 34.6c18.7 18.7 49.1 18.7 67.9 0L529.9 116.5c18.7-18.7 18.7-49.1 0-67.9L495.3 14.1c-18.7-18.7-49.1-18.7-67.9 0L46.1 395.4zM484.6 82.6l-105 105-23.3-23.3 105-105 23.3 23.3zM7.5 117.2C3 118.9 0 123.2 0 128s3 9.1 7.5 10.8L64 160l21.2 56.5c1.7 4.5 6 7.5 10.8 7.5s9.1-3 10.8-7.5L128 160l56.5-21.2c4.5-1.7 7.5-6 7.5-10.8s-3-9.1-7.5-10.8L128 96 106.8 39.5C105.1 35 100.8 32 96 32s-9.1 3-10.8 7.5L64 96 7.5 117.2zm352 256c-4.5 1.7-7.5 6-7.5 10.8s3 9.1 7.5 10.8L416 416l21.2 56.5c1.7 4.5 6 7.5 10.8 7.5s9.1-3 10.8-7.5L480 416l56.5-21.2c4.5-1.7 7.5-6 7.5-10.8s-3-9.1-7.5-10.8L480 352l-21.2-56.5c-1.7-4.5-6-7.5-10.8-7.5s-9.1 3-10.8 7.5L416 352l-56.5 21.2z"/></svg>',"fa-trash-can":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M135.2 17.7C140.6 6.8 151.7 0 163.8 0H284.2c12.1 0 23.2 6.8 28.6 17.7L320 32h96c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 96 0 81.7 0 64S14.3 32 32 32h96l7.2-14.3zM32 128H416V448c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V128zm96 64c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16z"/></svg>',"fa-sitemap":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M208 80c0-26.5 21.5-48 48-48h64c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48h-8v40H464c30.9 0 56 25.1 56 56v32h8c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48H464c-26.5 0-48-21.5-48-48V368c0-26.5 21.5-48 48-48h8V288c0-4.4-3.6-8-8-8H312v40h8c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48H256c-26.5 0-48-21.5-48-48V368c0-26.5 21.5-48 48-48h8V280H112c-4.4 0-8 3.6-8 8v32h8c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V368c0-26.5 21.5-48 48-48h8V288c0-30.9 25.1-56 56-56H264V192h-8c-26.5 0-48-21.5-48-48V80z"/></svg>',"fa-eye":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64c-7.1 0-13.9-1.2-20.3-3.3c-5.5-1.8-11.9 1.6-11.7 7.4c.3 6.9 1.3 13.8 3.2 20.7c13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3z"/></svg>',"fa-eye-slash":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c8.4-19.3 10.6-41.4 4.8-63.3c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zM373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5L373 389.9z"/></svg>',"fa-binoculars":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M128 32h32c17.7 0 32 14.3 32 32V96H96V64c0-17.7 14.3-32 32-32zm64 96V448c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32V388.9c0-34.6 9.4-68.6 27.2-98.3C40.9 267.8 49.7 242.4 53 216L60.5 156c2-16 15.6-28 31.8-28H192zm227.8 0c16.1 0 29.8 12 31.8 28L459 216c3.3 26.4 12.1 51.8 25.8 74.6c17.8 29.7 27.2 63.7 27.2 98.3V448c0 17.7-14.3 32-32 32H352c-17.7 0-32-14.3-32-32V128h99.8zM320 64c0-17.7 14.3-32 32-32h32c17.7 0 32 14.3 32 32V96H320V64zm-32 64V288H224V128h64z"/></svg>',"fa-crop-simple":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M128 32c0-17.7-14.3-32-32-32S64 14.3 64 32V64H32C14.3 64 0 78.3 0 96s14.3 32 32 32H64V384c0 35.3 28.7 64 64 64H352V384H128V32zM384 480c0 17.7 14.3 32 32 32s32-14.3 32-32V448h32c17.7 0 32-14.3 32-32s-14.3-32-32-32H448l0-256c0-35.3-28.7-64-64-64L160 64v64l224 0 0 352z"/></svg>',"fa-plus":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"/></svg>',"fa-caret-down":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M137.4 374.6c12.5 12.5 32.8 12.5 45.3 0l128-128c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8L32 192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l128 128z"/></svg>',"fa-caret-up":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M182.6 137.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8H288c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-128-128z"/></svg>',"fa-camera":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M149.1 64.8L138.7 96H64C28.7 96 0 124.7 0 160V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H373.3L362.9 64.8C356.4 45.2 338.1 32 317.4 32H194.6c-20.7 0-39 13.2-45.5 32.8zM256 192a96 96 0 1 1 0 192 96 96 0 1 1 0-192z"/></svg>'};class x{constructor(t){this._setupSymbols(t)}makeFaIcon(t,e=!0){const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.classList.add("icon"),e&&n.setAttribute("fill","currentColor");const i=document.createElementNS("http://www.w3.org/2000/svg","use");return i.setAttribute("href",`#${t}`),n.appendChild(i),n}convertFaIcons(t,e,n=["fa","fa-solid"]){e||(e=Object.keys(C));for(const i of e)t.querySelectorAll(`.${i}`).forEach((t=>{const e=this.makeFaIcon(i);t.classList.remove(i,...n),t.appendChild(e)}))}_setupSymbols(t){const e=document.createElement("div");t.appendChild(e),e.style.position="absolute",e.style.display="none";const n=document.createElementNS("http://www.w3.org/2000/svg","svg");e.appendChild(n);let i="";for(const[t,e]of Object.entries(C))i+=e.replace("<svg",`<symbol id="${t}"`).replace("/svg>","/symbol>");n.innerHTML=i}}function I(t,e=!0){const n=document.createElement("template");let i;return C[t]?(n.innerHTML=C[t],i=n.content.children[0]):i=document.createElementNS("http://www.w3.org/2000/svg","svg"),i.classList.add("icon"),e&&i.setAttribute("fill","currentColor"),i}function S(t,e,n=["fa","fa-solid"]){e||(e=Object.keys(C));for(const i of e)t.querySelectorAll(`.${i}`).forEach((t=>{const e=I(i);t.classList.remove(i,...n),t.appendChild(e)}))}class T extends A{constructor(t){super(t),this.setToolbarControl(new k(this))}onDeactivate(){}onActivate(){this.resetCanvasZIndex()}}class k extends b{constructor(t){super(t);const e=I("fa-hand");this.button.configure(e,"Image Navigation Tool")}isEnabledForMode(t){return!0}}class P extends A{constructor(t){super(t);let e=this,n=this.tool;this._ignoreNextSelectionChange=!1,this._targetItems=[],this.setToolbarControl(new E(this)),this.colorpicker=new O(12,9,this.project.toolLayer),this.cursor=this.colorpicker.element,this.cursor.applyRescale(),this.extensions.onActivate=function(){e.pickingColor&&(e.project.overlay.addClass("tool-action").setAttribute("data-tool-action","colorpicker"),e.cursor.visible=!0),e.selectionChanged(),e.captureUserInput(!!e.pickingColor)},this.extensions.onDeactivate=function(t){e.project.overlay.removeClass("tool-action").setAttribute("data-tool-action",""),e.cursor.visible=!1,t&&e.cancelColorpicker()},n.extensions.onKeyUp=function(t){"escape"==t.key&&e.cancelColorpicker()},this.project.paperScope.project.on("edit-style",(t=>{this.activateForItem(t.item)}))}onMouseMove(t){this.pickingColor&&this.colorpicker.updatePosition(t.original.point)}onMouseUp(){this.pickingColor&&this.cursor.visible&&(this._colorpickerPromise&&this._colorpickerPromise.resolve(this.colorpicker.selectedColor),this._colorpickerPromise=null,this.cancelColorpicker())}activateForItem(t){this.targetItems=t,this._ignoreNextSelectionChange=!0,this.activate(),this.toolbarControl.updateDisplay(),this._ignoreNextSelectionChange=!1}onSelectionChanged(){this._ignoreNextSelectionChange||(this.targetItems=this.items,this.toolbarControl.updateDisplay()),this._ignoreNextSelectionChange=!1}get defaultTarget(){return this.project.paperScope.project}get targetItems(){return this._targetItems}set targetItems(t){this._targetItems=t?[t].flat().filter((t=>t.defaultStyle||t.style)):[],0==this._targetItems.length&&(this._targetItems=[this.defaultTarget])}get targetItemStyles(){return this._targetItems.map((t=>t.defaultStyle||t.style))}get targetDescription(){if(0==this._targetItems.length)return"No target";if(this._targetItems.length>1)return`${this._targetItems.length} items`;{let t=this._targetItems[0];return t==this.defaultTarget?"Default style":t.displayName}}pickColor(){let t=this;return t.captureUserInput(!0),new Promise((function(e,n){t._colorpickerPromise&&t._colorpickerPromise.reject("Canceled"),t._colorpickerPromise={resolve:e,reject:n},t.activate(),t.pickingColor=!0,t.cursor.visible=!0,t.project.paperScope.project.layers.toolLayer.bringToFront(),t.tool.onMouseMove({point:t.cursor.view.center}),t.project.overlay.addClass("tool-action").setAttribute("data-tool-action","colorpicker")})).finally((()=>{t.captureUserInput(!1)}))}cancelColorpicker(){this.cursor.addTo(this.project.toolLayer),this.pickingColor=!1,this.cursor.visible=!1,this.project.overlay.removeClass("tool-action").setAttribute("data-tool-action",""),this._colorpickerPromise&&this._colorpickerPromise.reject("Canceled")}createMaskedImage(e){let n=e.clone(),i=new t.Group([n]),o=this.project.paperScope.view.projectToView(n.bounds),r=o.x,s=o.y,a=n.bounds.width*this.project.getZoom(),l=n.bounds.height*this.project.getZoom(),h=this.project.paperScope.view.pixelRatio;const c=document.createElement("canvas");canvas.setAttribute("width",a*h),canvas.setAttribute("height",l*h),c.getContext("2d").drawImage(this.project.overlay.viewer.drawer.canvas,r*h,s*h,a*h,l*h,0,0,a*h,l*h);let u=c.toDataURL(),d=new t.Raster({source:u,position:n.bounds.center});return d.scale(1/(h*this.project.getZoom())),i.addChild(d),i.clipped=!0,i.position.x=i.position.x+500,i}applyStrokeWidth(t){this.targetItems.forEach((e=>{e.defaultStyle&&(e=e.defaultStyle),e.strokeWidth=t,e.rescale&&(e.rescale.strokeWidth=t),e.isGeoJSONFeature&&e.applyRescale()}))}applyOpacity(t,e){this.targetItems.forEach((n=>{(n.defaultStyle||n.style)[e]=t,n.isGeoJSONFeature&&(n.updateFillOpacity(),n.updateStrokeOpacity())}))}applyColor(t,e,n){"fill"==e?this.applyFillColor(t,n):"stroke"==e?this.applyStrokeColor(t,n):console.warn(`Cannot apply color change - type "${e}" not recognized`)}applyFillColor(e,n){(n?[n]:this.targetItems).forEach((n=>{let i=new t.Color(e);(n.defaultStyle||n.style).fillColor=i,n.isGeoJSONFeature&&n.updateFillOpacity()}))}applyStrokeColor(e,n){(n?[n]:this.targetItems).forEach((n=>{let i=new t.Color(e);(n.defaultStyle||n.style).strokeColor=i,n.isGeoJSONFeature&&n.updateStrokeOpacity()}))}}class E extends b{constructor(e){super(e);let n=this;const i=I("fa-palette");this.button.configure(i,"Style Tool"),this.dropdown.innerHTML=this.uiHTML(),S(this.dropdown),this._hierarchy=[],this.dropdown.querySelectorAll('[data-action="pick-color"]').forEach((t=>{t.addEventListener("click",(function(){let t=this.getAttribute("data-type"),e=n.dropdown.querySelector(`input[type="color"][data-type="${t}"]`);var i;n.dropdown.querySelectorAll('[data-action="pick-color"]').forEach((t=>t.classList.remove("active"))),(i=e).offsetWidth||i.offsetHeight||i.getClientRects().length?n.dropdown.querySelectorAll(".colorpicker-row").forEach((t=>t.classList.add("hidden"))):(n.dropdown.querySelectorAll(".colorpicker-row").forEach((t=>t.classList.add("hidden"))),e.closest(".colorpicker-row").classList.remove("hidden"),this.classList.add("active"))}))})),this.dropdown.querySelectorAll('input[type="color"]').forEach((e=>e.addEventListener("input",(function(){let e=this.getAttribute("data-type");n.tool.applyColor(this.value,e),"fill"==e&&n.setFillButtonColor(new t.Color(this.value)),"stroke"==e&&n.setStrokeButtonColor(new t.Color(this.value))})))),this.dropdown.querySelectorAll('input[type="number"]').forEach((t=>t.addEventListener("input",(function(){n.tool.applyStrokeWidth(this.value)})))),this.dropdown.querySelectorAll('input[data-action="opacity"]').forEach((t=>t.addEventListener("input",(function(){let t=this.getAttribute("data-type"),e=this.getAttribute("data-property");n.tool.applyOpacity(this.value,e),"fill"==t&&n.setFillButtonOpacity(this.value),"stroke"==t&&n.setStrokeButtonOpacity(this.value)})))),this.dropdown.querySelectorAll('[data-action="from-image"]').forEach((t=>t.addEventListener("click",(function(){n.tool.pickColor().then((t=>{this.parentElement.querySelectorAll('input[type="color"]').forEach((e=>{e.value=t.toCSS(!0),e.dispatchEvent(new Event("input"))}))})).catch((t=>{}))})))),this.dropdown.querySelectorAll('[data-action="from-average"]').forEach((t=>t.addEventListener("click",(function(){let t=this.getAttribute("data-type");n.fromAverage(t)})))),this.dropdown.querySelectorAll(".style-item").forEach((t=>t.addEventListener("click",(function(){let t=n.tool.targetItems,e=t.every((t=>t.selected)),i=t.filter((t=>t.isGeoJSONFeature));i.length>0&&(n.tool._ignoreNextSelectionChange=!0,i.forEach((t=>e?t.deselect():t.select()))),n.updateTargetDescription()})))),this.dropdown.querySelectorAll(".hierarchy-up").forEach((t=>t.addEventListener("click",(function(){if(n._hierarchy&&n._hierarchy.length>0)n._hierarchy.index=(n._hierarchy.index+1)%n._hierarchy.length;else{let t=n.tool.targetItems,e=new Set(t.map((t=>t.hierarchy.filter((e=>e.isGeoJSONFeatureCollection&&e!==t)))).flat());0==e.size?t.indexOf(n.tool.defaultTarget)>-1?(n._hierarchy=[n.tool.defaultTarget],n._hierarchy.index=0):(n._hierarchy=[t,n.tool.defaultTarget],n._hierarchy.index=1):1==e.size?(n._hierarchy=[n.tool.targetItems,e.values().next().value,n.tool.defaultTarget],n._hierarchy.index=1):(n._hierarchy=[n.tool.targetItems,n.tool.defaultTarget],n._hierarchy.index=1)}let t=n._hierarchy;n.tool.activateForItem(n._hierarchy[n._hierarchy.index]),n._hierarchy=t}))))}fromAverage(t){let e=this,n=this.tool.targetItems.map((n=>B(n).then((i=>{e.tool.applyColor(i,t,n)}))));Promise.all(n).then((()=>e.updateDisplay()))}isEnabledForMode(t){return!0}uiHTML(){return'\n            <div class="style-toolbar">\n                <div class="flex-row style-row annotation-ui-buttonbar" >\n                    <span><span class="hierarchy-up fa-solid fa-sitemap" title=\'Cycle through hierarchy\'></span><span class=\'style-item\' title=\'Toggle selection\'></span></span>\n                    <span class=\'btn\' data-action="pick-color" data-type="fill"><span class="preview"><span class="color bg"></span><span class="color text">Fill</span></span></span>\n                    <span class=\'btn\' data-action="pick-color" data-type="stroke"><span class="preview"><span class="color bg"></span><span class="color text">Stroke</span></span></span>\n                    <input type="number" min=0 value=1>\n                </div>\n                <div class="colorpicker-row hidden">\n                    <input type="color" data-action="color" data-type="fill">\n                    <input type="range" data-action="opacity" data-type="fill" data-property="fillOpacity" min=0 max=1 step=0.01 value=1>\n                    <span class=\'btn\' data-action="from-image">From image</span>\n                    <span class=\'btn\' data-action="from-average" data-type="fill">Area average</span>\n                </div>\n                <div class="colorpicker-row hidden">\n                    <input type="color" data-action="color" data-type="stroke">\n                    <input type="range" data-action="opacity" data-type="stroke" data-property="strokeOpacity" min=0 max=1 step=0.01 value=1>\n                    <span class=\'btn\' data-action="from-image">From image</span>\n                    <span class=\'btn\' data-action="from-average" data-type="stroke">Area average</span>\n                </div>\n            </div>\n        '}updateTargetDescription(){let t=this.tool.targetDescription,e=this.tool.targetItems.every((t=>t.selected&&t.isGeoJSONFeature)),n=this.dropdown.querySelector(".style-item");n.innerHTML=t,e?n.classList.add("selected"):n.classList.remove("selected")}updateDisplay(){this._hierarchy=[];let t=this.tool.targetItemStyles;this.updateTargetDescription();let e=t.map((t=>t.fillColor));1==e.length||1==new Set(e.map((t=>t.toCSS()))).size?this.setFillButtonColor(e[0]):this.setFillButtonColor();let n=t.map((t=>t.strokeColor));1==n.length||1==new Set(n.map((t=>t.toCSS()))).size?this.setStrokeButtonColor(n[0]):this.setStrokeButtonColor();let i=t.map((t=>t.fillOpacity));1==i.length||1==new Set(i).size?this.setFillButtonOpacity(i[0]):this.setFillButtonOpacity(1);let o=t.map((t=>t.strokeOpacity));1==o.length||1==new Set(o).size?this.setStrokeButtonOpacity(o[0]):this.setStrokeButtonOpacity(1);let r=t.map((t=>t.rescale?t.rescale.strokeWidth:t.strokeWidth));1==r.length||1==new Set(r).size?this.dropdown.querySelectorAll('input[type="number"]').forEach((t=>t.value=r[0])):this.dropdown.querySelectorAll('input[type="number"]').forEach((t=>t.value=""))}setFillButtonColor(e=new t.Color("white")){e||(e=new t.Color("white"));let n=e.toCSS(!0),i=L(e.toCSS(!0));this.dropdown.querySelectorAll('[data-type="fill"] .preview .text').forEach((t=>t.style.color=i)),this.dropdown.querySelectorAll('[data-type="fill"] .preview .color').forEach((t=>{t.style.backgroundColor=n,t.style.outlineColor=i})),this.dropdown.querySelectorAll('input[type="color"][data-type="fill"]').forEach((t=>t.value=n))}setStrokeButtonColor(e=new t.Color("black")){e||(e=new t.Color("black"));let n=e.toCSS(!0),i=L(e.toCSS(!0));this.dropdown.querySelectorAll('[data-type="stroke"] .preview .text').forEach((t=>t.style.color=i)),this.dropdown.querySelectorAll('[data-type="stroke"] .preview .color').forEach((t=>{t.style.backgroundColor=n,t.style.outlineColor=i})),this.dropdown.querySelectorAll('input[type="color"][data-type="stroke"]').forEach((t=>t.value=n))}setFillButtonOpacity(t){this.dropdown.querySelectorAll('[data-type="fill"] .preview .bg').forEach((e=>e.style.opacity=t)),this.dropdown.querySelectorAll('[data-type="fill"][data-action="opacity"]').forEach((e=>e.value=t))}setStrokeButtonOpacity(t){this.dropdown.querySelectorAll('[data-type="stroke"] .preview .bg').forEach((e=>e.style.opacity=t)),this.dropdown.querySelectorAll('[data-type="stroke"][data-action="opacity"]').forEach((e=>e.value=t))}}function O(e,n,i){let o=new t.Group({visible:!1,applyMatrix:!1});function r(){const t=o.view.getFlipped()?o.view.getRotation():180-o.view.getRotation();o.rotate(-t),o.scale(-1,1),o.rotate(t)}this.element=o,i.addChild(o),o.view.on("rotate",(t=>o.rotate(-t.rotatedBy))),o.view.on("flip",r),o.numRows=n,o.numColumns=n;let s=document.createElement("canvas");s.height=o.numRows,s.width=o.numColumns;let a=s.getContext("2d",{willReadFrequently:!0}),l=e,h=-(n-1)/2,c=h+n;for(var u=h;u<c;u++)for(var d=h;d<c;d++){let e=new t.Shape.Rectangle({point:[d*l,u*l],size:[l,l],strokeWidth:.5,strokeColor:"white",fillColor:"white",rescale:{position:[d*l,u*l],size:[l,l],strokeWidth:.5}});o.addChild(e),0==d&&0==u&&(o.centerCell=e)}d=0,u=0;let p=new t.Shape.Rectangle({point:[d*l,u*l],size:[l,l],strokeWidth:1,strokeColor:"black",fillColor:null,rescale:{position:[d*l,u*l],size:[l,l],strokeWidth:1}});o.addChild(p),d=0,u=0;let g=e*(n+2),f=new t.Shape.Rectangle({point:[d*l,u*l],size:[g,g],strokeWidth:1,strokeColor:"black",fillColor:null,rescale:{position:[d*l,u*l],size:[g,g],strokeWidth:1}});return o.addChild(f),o.borderElement=f,f.sendToBack(),o.applyRescale=function(){o.children.forEach((t=>t.applyRescale()))},o.view.getFlipped()&&r(),this.updatePosition=function(t){o.position=t;let e=o.project.overlay.paperToCanvasCoordinates(t.x,t.y),n=Math.round(e.x)-Math.floor(o.numColumns/2),i=Math.round(e.y)-Math.floor(o.numRows/2),r=o.numColumns,s=o.numRows,l=o.view.pixelRatio,h=o.project.overlay.getImageData(n*l,i*l,r*l,s*l);a.clearRect(0,0,r,s),window.createImageBitmap(h).then((t=>{a.drawImage(t,0,0,o.numColumns,o.numRows);let e,n,i=a.getImageData(0,0,r,s);for(e=0,n=1;e<i.data.length;e+=4,n+=1)o.children[n].fillColor.red=i.data[e]/255,o.children[n].fillColor.green=i.data[e+1]/255,o.children[n].fillColor.blue=i.data[e+2]/255;o.borderElement.fillColor=o.centerCell.fillColor,this.selectedColor=o.centerCell.fillColor}))},this}async function B(t){let e=(t.project&&t.project.overlay||t.overlay).getViewportRaster();return new Promise((function(n,i){e.onLoad=function(){const o=t.clone();o.transform(o.layer.matrix);let r=e.getAverageColor(o);e.remove(),o.remove(),r||i("Error: The item must be visible on the screen to pick the average color of visible pixels. Please navigate and retry."),n(r)}}))}function L(t){return t=t.replace("#",""),(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>=140?"black":"white"}class M{constructor(t){if(this.width=t.width,this.height=t.height,this.data=new Uint8Array(t.data),this.data){if(this.height*this.width!=this.data.length)throw"MORPH_DIMENSION_ERROR: incorrect dimensions"}else this.data=Array(this.width*this.height).fill(0);this.dilate=function(){let t=Array.from(this.data),e=this.width,n=this.height;for(var i=0;i<n;i++)for(var o=0;o<e;o++){var r=i*e+o;this.data[r]=t[r]?t[r]:this.adjacentIndices(r).some((function(e){return t[e]}))?1:0}return{width:this.width,height:this.height,data:this.data}},this.addBorder=function(){this.width=this.width+2,this.height=this.height+2;let t=this.data;this.data=new Uint8Array(this.width*this.height).fill(0);for(var e=1;e<this.height-1;e++)for(var n=1;n<this.width-1;n++)this.data[e*this.width+n]=t[(e-1)*(this.width-2)+(n-1)];return{width:this.width,height:this.height,data:this.data}},this.adjacentIndices=function(t){var e=t-this.width-1,n=t+this.width-1;let i=this.data.length;return[e,e+1,e+2,t-1,t+1,n,n+1,n+2].filter((function(t){return t>=0&&t<i}))}}}const N=new class{constructor(){this._map=new WeakMap}set(t,e,n){if(this._map.has(t)||this._map.set(t,new Map),"object"==typeof e){const n=e,i=this._map.get(t);for(const[t,e]of Object.entries(n))i.set(t,e)}else this._map.get(t).set(e,n)}get(t,e){if(this._map.has(t))return void 0===e?Object.fromEntries(this._map.get(t)):this._map.get(t).get(e);this._map.set(t,new Map)}remove(t,e){if(this._map.has(t)){var n=this._map.get(t).delete(e);return 0===this._map.get(t).size&&this._map.delete(t),n}}};class R extends A{constructor(e){super(e);let n=this,i=this.tool;this.paperScope=n.project.paperScope,this.reduceMode=!1,this.replaceMode=!0,this.floodMode=!0,this.colors={pixelAllowed:new t.Color({red:0,green:0,blue:100}),pixelNotAllowed:new t.Color({red:100,green:0,blue:0}),currentItem:new t.Color({red:0,green:100,blue:0,alpha:.5}),nullColor:new t.Color({red:0,green:0,blue:0,alpha:0}),defaultColor:new t.Color({red:255,green:255,blue:255})},this.threshold=10,this.minThreshold=-1,this.maxThreshold=100,this.startThreshold=10,this.colorPicker=new O(10,7,n.project.toolLayer),this.colorPicker.element.applyRescale(),this.MagicWand={floodFill:function(t,e,n,i,o,r){return r?function(t,e,n,i,o){var r,s,a,l,h,c,u,d,p,g,f=t.data,m=t.width,v=t.height,_=t.bytes,y=-1,w=m+1,A=-1,b=v+1,C=n*m+e,x=new Uint8Array(m*v),I=new Uint8Array(o||m*v);if(1===I[C])return null;var S=[f[C*=_],f[C+1],f[C+2],f[C+3]],T=[{y:n,left:e-1,right:e+1,dir:1}];do{for(g=!1,s=(l=T.shift()).left+1;s<l.right;s++)if(C=((u=l.y*m)+s)*_,1!==I[u+s]&&(g=!0,x[u+s]=1,I[u+s]=1,!((r=f[C]-S[0])>i||r<-i||(r=f[C+1]-S[1])>i||r<-i||(r=f[C+2]-S[2])>i||r<-i||0===f[C+3]))){for(c=s-1;c>-1&&(C=(d=u+c)*_,1!==I[d])&&(x[d]=1,I[d]=1,c--,!((r=f[C]-S[0])>i||r<-i))&&!((r=f[C+1]-S[1])>i||r<-i)&&!((r=f[C+2]-S[2])>i||r<-i)&&0!==f[C+3];);for(h=s+1;h<m&&(C=(p=u+h)*_,1!==I[p])&&(x[p]=1,I[p]=1,h++,!((r=f[C]-S[0])>i||r<-i))&&!((r=f[C+1]-S[1])>i||r<-i)&&!((r=f[C+2]-S[2])>i||r<-i)&&0!==f[C+3];);c<w&&(w=c+1),h>y&&(y=h-1),(a=l.y-l.dir)>=0&&a<v&&(c<l.left&&T.push({y:a,left:c,right:l.left,dir:-l.dir}),l.right<h&&T.push({y:a,left:l.right,right:h,dir:-l.dir})),(a=l.y+l.dir)>=0&&a<v&&c<h&&T.push({y:a,left:c,right:h,dir:l.dir})}g&&(l.y<b&&(b=l.y),l.y>A&&(A=l.y))}while(T.length>0);return{data:x,width:t.width,height:t.height,bounds:{minX:w,minY:b,maxX:y,maxY:A},sampleColor:S}}(t,e,n,i,o):function(t,e,n,i,o){var r,s,a,l,h,c,u,d,p,g,f=t.data,m=t.width,v=t.height,_=t.bytes,y=-1,w=m+1,A=-1,b=v+1,C=n*m+e,x=new Uint8Array(m*v),I=new Uint8Array(o||m*v);if(1===I[C])return null;var S=[f[C*=_],f[C+1],f[C+2],f[C+3]],T=[{y:n,left:e-1,right:e+1,dir:1}];do{for(g=!1,s=(l=T.shift()).left+1;s<l.right;s++)if(C=((u=l.y*m)+s)*_,1!==I[u+s]&&!((r=f[C]-S[0])>i||r<-i||(r=f[C+1]-S[1])>i||r<-i||(r=f[C+2]-S[2])>i||r<-i||0===f[C+3])){for(g=!0,x[u+s]=1,I[u+s]=1,c=s-1;c>-1&&(C=(d=u+c)*_,1!==I[d])&&!((r=f[C]-S[0])>i||r<-i)&&!((r=f[C+1]-S[1])>i||r<-i)&&!((r=f[C+2]-S[2])>i||r<-i)&&0!==f[C+3];)x[d]=1,I[d]=1,c--;for(h=s+1;h<m&&(C=(p=u+h)*_,1!==I[p])&&!((r=f[C]-S[0])>i||r<-i)&&!((r=f[C+1]-S[1])>i||r<-i)&&!((r=f[C+2]-S[2])>i||r<-i)&&0!==f[C+3];)x[p]=1,I[p]=1,h++;c<w&&(w=c+1),h>y&&(y=h-1),(a=l.y-l.dir)>=0&&a<v&&(c<l.left&&T.push({y:a,left:c,right:l.left,dir:-l.dir}),l.right<h&&T.push({y:a,left:l.right,right:h,dir:-l.dir})),(a=l.y+l.dir)>=0&&a<v&&c<h&&T.push({y:a,left:c,right:h,dir:l.dir})}g&&(l.y<b&&(b=l.y),l.y>A&&(A=l.y))}while(T.length>0);return{data:x,width:t.width,height:t.height,bounds:{minX:w,minY:b,maxX:y,maxY:A},sampleColor:S}}(t,e,n,i,o)},thresholdMask:function(t,e,n,i,o={}){let r,s,a=t.data,l=t.width,h=t.height,c=t.bytes,u=n*l+e,d=new Uint8Array(o.append?o.append:l*h),p=new Uint8Array(o.ignore?o.ignore:l*h);if(1===p[u])return null;u*=c;var g=[a[u],a[u+1],a[u+2],a[u+3]];for(u=0,s=0;u<a.length;u+=4,s+=1)p[s]||d[s]||0!==a[u+3]&&(r=a[u]-g[0],r>i||r<-i||(r=a[u+1]-g[1],r>i||r<-i||(r=a[u+2]-g[2],r>i||r<-i||(d[s]=1))));return{data:d,width:t.width,height:t.height,bounds:{minX:0,minY:0,maxX:l,maxY:h},sampleColor:g}},gaussBlur:function(t,e){var n,i,o,r,s,a,l,h=2*e+1,c=e*e,u=new Float32Array(h),d=0,p=t.width,g=t.height,f=t.data,m=t.bounds.minX,v=t.bounds.maxX,_=t.bounds.minY,y=t.bounds.maxY;for(n=0;n<e;n++){var w=(e-n)*(e-n),A=Math.exp(-w/(2*c))/(2*Math.PI*c);u[e+n]=u[e-n]=A,d+=2*A}for(n=0;n<h;n++)u[n]/=d;var b=new Uint8Array(p*g),C=e+p,x=e+g;for(s=_;s<y+1;s++)for(r=m;r<v+1;r++){for(a=0,l=C-r<h?C-r:h,o=(i=s*p+r)-e,n=e-r>0?e-r:0;n<l;n++)a+=f[o+n]*u[n];for(l=x-s<h?x-s:h,o=i-e*p,n=e-s>0?e-s:0;n<l;n++)a+=f[o+n*p]*u[n];b[i]=a>.5?1:0}return{data:b,width:p,height:g,bounds:{minX:m,minY:_,maxX:v,maxY:y}}},gaussBlurOnlyBorder:function(t,e,n){var i,o,r,s,a,l,h,c,u,d,p=function(t,e,n){var i,o,r,s,a,l,h,c=t.width,u=t.height,d=t.data,p=new Uint8Array(d),g=t.bounds.minX,f=t.bounds.maxX,m=t.bounds.minY,v=t.bounds.maxY,_=c*u,y=new Uint8Array(_),w=[],A=Math.max(g,1),b=Math.min(f,c-2),C=Math.max(m,1),x=Math.min(v,u-2);if(n&&n.length>0)for(a=0;a<_;a++)1===n[a]&&(p[a]=1);for(s=C;s<x+1;s++)for(i=A;i<b+1;i++)0!==d[a=s*c+i]&&(l=a+c,h=a-c,0!==p[a+1]&&0!==p[a-1]&&0!==p[l]&&0!==p[l+1]&&0!==p[l-1]&&0!==p[h]&&0!==p[h+1]&&0!==p[h-1]||w.push(a));if(0==g)for(s=m;s<v+1;s++)1===d[s*c]&&w.push(s*c);if(f==c-1)for(s=m;s<v+1;s++)1===d[s*c+f]&&w.push(s*c+f);if(0==m)for(i=g;i<f+1;i++)1===d[i]&&w.push(i);if(v==u-1)for(i=g;i<f+1;i++)1===d[v*c+i]&&w.push(v*c+i);var I,S=[],T=e+c,k=e+u,P=2*e+1;for(_=w.length,r=0;r<_;r++){for(y[a=w[r]]=1,S.push(a),s=(a-(i=a%c))/c,I=T-i<P?T-i:P,l=a-e,o=e-i>0?e-i:0;o<I;o++)0===y[h=l+o]&&(y[h]=1,S.push(h));for(I=k-s<P?k-s:P,l=a-e*c,o=e-s>0?e-s:0;o<I;o++)0===y[h=l+o*c]&&(y[h]=1,S.push(h))}return S}(t,e,n),g=2*e+1,f=2*e*e,m=new Float32Array(g),v=0,_=t.width,y=t.height,w=t.data,A=t.bounds.minX,b=t.bounds.maxX,C=t.bounds.minY,x=t.bounds.maxY,I=p.length;for(r=0;r<e;r++)o=(e-r)*(e-r),i=Math.exp(-o/f)/Math.PI,m[e+r]=m[e-r]=i,v+=2*i;for(r=0;r<g;r++)m[r]/=v;var S=new Uint8Array(w),T=e+_,k=e+y;for(r=0;r<I;r++){for(u=0,c=((a=p[r])-(h=a%_))/_,d=T-h<g?T-h:g,l=a-e,s=e-h>0?e-h:0;s<d;s++)u+=w[l+s]*m[s];if(u>.5)S[a]=1,h<A&&(A=h),h>b&&(b=h),c<C&&(C=c),c>x&&(x=c);else{for(d=k-c<g?k-c:g,l=a-e*_,s=e-c>0?e-c:0;s<d;s++)u+=w[l+s*_]*m[s];u>.5?(S[a]=1,h<A&&(A=h),h>b&&(b=h),c<C&&(C=c),c>x&&(x=c)):S[a]=0}}return{data:S,width:_,height:y,bounds:{minX:A,minY:C,maxX:b,maxY:x}}},createBorderMask:function(t){var e,n,i,o,r,s=t.width,a=t.height,l=t.data,h=t.bounds.minX,c=t.bounds.maxX,u=t.bounds.minY,d=t.bounds.maxY,p=c-h+1,g=d-u+1,f=new Uint8Array(p*g),m=Math.max(h,1),v=Math.min(c,s-2),_=Math.max(u,1),y=Math.min(d,a-2);for(n=_;n<y+1;n++)for(e=m;e<v+1;e++)0!==l[i=n*s+e]&&(o=i+s,r=i-s,0!==l[i+1]&&0!==l[i-1]&&0!==l[o]&&0!==l[o+1]&&0!==l[o-1]&&0!==l[r]&&0!==l[r+1]&&0!==l[r-1]||(f[(n-u)*p+(e-h)]=1));if(0==h)for(n=u;n<d+1;n++)1===l[n*s]&&(f[(n-u)*p]=1);if(c==s-1)for(n=u;n<d+1;n++)1===l[n*s+c]&&(f[(n-u)*p+(c-h)]=1);if(0==u)for(e=h;e<c+1;e++)1===l[e]&&(f[e-h]=1);if(d==a-1)for(e=h;e<c+1;e++)1===l[d*s+e]&&(f[(d-u)*p+(e-h)]=1);return{data:f,width:p,height:g,offset:{x:h,y:u}}},getBorderIndices:function(t){var e,n,i,o,r,s=t.width,a=t.height,l=t.data,h=[],c=s-1,u=a-1;for(n=1;n<u;n++)for(e=1;e<c;e++)0!==l[i=n*s+e]&&(o=i+s,r=i-s,0!==l[i+1]&&0!==l[i-1]&&0!==l[o]&&0!==l[o+1]&&0!==l[o-1]&&0!==l[r]&&0!==l[r+1]&&0!==l[r-1]||h.push(i));for(n=0;n<a;n++)1===l[n*s]&&h.push(n*s);for(e=0;e<s;e++)1===l[e]&&h.push(e);for(i=s-1,n=0;n<a;n++)1===l[n*s+i]&&h.push(n*s+i);for(i=(a-1)*s,e=0;e<s;e++)1===l[i+e]&&h.push(i+e);return h},traceContours:function(t){var e,n,i,o,r,s,a,l,h,c,u,d,p,g,f,m=function(t){var e,n,i=t.width,o=t.data,r=t.bounds.minX,s=t.bounds.maxX,a=t.bounds.minY,l=t.bounds.maxY,h=s-r+3,c=l-a+3,u=new Uint8Array(h*c);for(n=a;n<l+1;n++)for(e=r;e<s+1;e++)1===o[n*i+e]&&(u[(n-a+1)*h+(e-r+1)]=1);return{data:u,width:h,height:c,offset:{x:r-1,y:a-1}}}(t),v=[],_=0,y=m.width,w=2*y,A=m.height,b=m.data,C=m.offset.x,x=m.offset.y,I=new Uint8Array(b),S=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]];for(o=1;o<A-1;o++)for(i=1;i<y-1;i++)if(1===b[r=o*y+i])for(e=-y;e<w;e+=w)if(0===b[r+e]&&0===I[r+e]){for(_++,a=[],h=(l=e===y)?2:6,d=p=c={x:i,y:o},u=null;;){for(I[d.y*y+d.x]=_,n=0;n<8;n++){if(f=S[h=(h+1)%8],1===b[s=(g={x:d.x+f[0],y:d.y+f[1]}).y*y+g.x]){I[s]=_;break}I[s]=-1,g=null}if(null===g)break;if(d=g,u){if(p.x===c.x&&p.y===c.y&&d.x===u.x&&d.y===u.y)break}else u=g;a.push({x:p.x+C,y:p.y+x}),p=d,h=(h+4)%8}null!=g&&(a.push({x:c.x+C,y:c.y+x}),v.push({inner:l,label:_,points:a}))}return v},simplifyContours:function(t,e,n){var i,o,r,s,a,l,h,c,u,d,p,g,f,m,v,_,y,w,A,b,C,x=t.length,I=[];for(o=0;o<x;o++)if(a=(s=t[o]).points,(l=s.points.length)<n){for(h=[],r=0;r<l;r++)h.push({x:a[r].x,y:a[r].y});I.push({inner:s.inner,label:s.label,points:h,initialCount:l})}else{c=[0,l-1],u=[{first:0,last:l-1}];do{if(!((d=u.shift()).last<=d.first+1)){for(p=-1,g=d.first,i=d.first+1;i<d.last;i++)A=a[i],b=a[d.first],C=a[d.last],y=A.x-b.x,w=A.y-b.y,m=Math.sqrt(y*y+w*w),y=A.x-C.x,w=A.y-C.y,v=Math.sqrt(y*y+w*w),y=b.x-C.x,w=b.y-C.y,_=Math.sqrt(y*y+w*w),(f=m>=Math.sqrt(v*v+_*_)?v:v>=Math.sqrt(m*m+_*_)?m:Math.abs((w*A.x-y*A.y+b.x*C.y-C.x*b.y)/_))>p&&(g=i,p=f);p>e&&(c.push(g),u.push({first:d.first,last:g}),u.push({first:g,last:d.last}))}}while(u.length>0);for(h=[],l=c.length,c.sort((function(t,e){return t-e})),r=0;r<l;r++)h.push({x:a[c[r]].x,y:a[c[r]].y});I.push({inner:s.inner,label:s.label,points:h,initialCount:s.points.length})}return I}},this.setToolbarControl(new F(this)),this.toolbarControl.setThreshold(this.threshold);let o=function(){n.getImageData()};this.onSelectionChanged=o,this.extensions.onActivate=function(){let t=n.item||n.itemToCreate;n.itemLayer=t?t.layer:null,n.getImageData(),n.project.overlay.viewer.addHandler("animation-finish",o),n.project.overlay.viewer.addHandler("rotate",o),n.colorPicker.element.visible=!0,n.project.toolLayer.bringToFront()},this.extensions.onDeactivate=function(t){n.project.overlay.viewer.removeHandler("animation-finish",o),n.project.overlay.viewer.removeHandler("rotate",o),n.colorPicker.element.visible=!1,this.preview&&this.preview.remove(),t&&n.finish(),n.project.toolLayer.sendToBack()},i.extensions.onKeyUp=function(t){"a"==t.key&&n.applyChanges(),"e"==t.key&&n.toolbarControl.cycleReduceMode(),"r"==t.key&&n.toolbarControl.cycleReplaceMode(),"f"==t.key&&n.toolbarControl.cycleFloodMode()}}onMouseDown(t){this.startThreshold=this.threshold,this.imageData.dragStartMask=this.imageData.binaryMask,this.applyMagicWand(t.original.point),this.colorPicker.element.visible=!1}onMouseDrag(t){let e=t.original.point.subtract(t.original.downPoint).multiply(this.project.getZoom());this.reduceMode&&(e=e.multiply(-1));let n=Math.round((e.x+-1*e.y)/2);this.threshold=Math.min(Math.max(this.startThreshold+n,this.minThreshold),this.maxThreshold),Number.isNaN(this.threshold)&&console.warn("NaN value for threshold"),this.toolbarControl.setThreshold(this.threshold),this.applyMagicWand(t.original.downPoint)}onMouseMove(t){this.colorPicker.updatePosition(t.original.point)}onMouseUp(t){this.colorPicker.element.visible=!0,this.colorPicker.element.bringToFront(),this.colorPicker.updatePosition(t.original.point)}finish(){this.itemLayer=null,this.preview&&this.preview.remove(),this.deactivate()}setThreshold(t){this.threshold=parseInt(t)}setReduceMode(t){this.reduceMode=t,this.getImageData()}setFloodMode(t){this.floodMode=t}setReplaceMode(t){this.replaceMode=t}applyChanges(){this.itemToCreate&&(this.itemToCreate.initializeGeoJSONFeature("MultiPolygon"),this.refreshItems());let t={width:this.imageData.width,height:this.imageData.height,data:this.imageData.wandMask,bounds:{minX:0,minY:0,maxX:this.preview.width,maxY:this.preview.height}};if(this.reduceMode){let e=j(this.MagicWand,t);e.translate(-1,-1),e.translate(-this.preview.width/2,-this.preview.height/2),e.matrix=this.preview.matrix,e.transform(this.item.layer.matrix.inverted());let n=this.item.subtract(e,!1).toCompoundPath();e.remove(),this.item.children=n.children}else{let e=j(this.MagicWand,t);e.translate(-1,-1),e.translate(-this.preview.width/2,-this.preview.height/2),e.matrix=this.preview.matrix,e.transform(this.item.layer.matrix.inverted());let n=this.itemLayer?this.itemLayer.getItems({match:t=>t.isBoundingElement}):[];n.length>0&&(e.children=n.map((t=>t.intersect(e))));let i=this.item.unite(e,!1).toCompoundPath();e.remove(),this.item.children=i.children}this.getImageData()}getImageData(){let e=this,n=e.project.overlay.getImageData(),i=new t.Group({children:[],insert:!1}),o=e.tool.view.bounds,r=new t.Path(o.topLeft,o.topRight,o.bottomRight,o.bottomLeft);r.strokeWidth=0,i.addChild(r.clone()),i.addChild(r),i.clipped=!0;let s=this.itemLayer?this.itemLayer.getItems({match:t=>t.isBoundingElement}):[];if(r.fillColor=0==s.length?e.colors.pixelAllowed:e.colors.pixelNotAllowed,s.forEach((t=>{let n=t.clone({insert:!1});n.transform(e.item.layer.matrix),n.fillColor=e.colors.pixelAllowed,n.strokeWidth=0,i.addChild(n)})),e.item){let t=e.item.clone({insert:!1});t.transform(e.item.layer.matrix),t.fillColor=e.colors.currentItem,t.strokeWidth=0,t.selected=!1,i.addChild(t)}i.selected=!1;let a=e.project.paperScope.project.getItems({match:t=>t.isGeoJSONFeatureCollection}),l=a.map((t=>t.visible));a.forEach((t=>t.visible=!1)),e.project.toolLayer.addChild(i),e.tool.view.update();let h=e.tool.view.getImageData();i.remove(),a.forEach(((t,e)=>t.visible=l[e])),e.tool.view.update(),e.imageData={width:n.width,height:n.height,bytes:4,data:n.data,binaryMask:new Uint8ClampedArray(n.width*n.height),wandMask:new Uint8ClampedArray(n.width*n.height),colorMask:h};for(let t=0,n=0;t<e.imageData.data.length;t+=e.imageData.bytes,n+=1)e.imageData.binaryMask[n]=e.imageData.colorMask.data[t+1]?1:0;e.item&&e.item.isGeoJSONFeature&&e.item.getArea()?B(e.item).then((t=>{let n=[255*t.red,255*t.green,255*t.blue];e.imageData.sampleColor=n,e.rasterPreview(e.imageData.binaryMask,n)})):e.rasterPreview(e.imageData.binaryMask)}applyMagicWand(t){let e,n=this.paperScope.view.projectToView(t),i=this.paperScope.view.pixelRatio;n=n.multiply(i),e=this.floodMode?this.MagicWand.floodFill(this.imageData,Math.round(n.x),Math.round(n.y),this.threshold):this.MagicWand.thresholdMask(this.imageData,Math.round(n.x),Math.round(n.y),this.threshold);let o=this.imageData.binaryMask,r=this.imageData.wandMask,s=this.imageData.dragStartMask,a=this.imageData.colorMask.data,l=e.data;if(this.replaceMode&&!this.reduceMode)for(let t=0,e=0;t<a.length;t+=this.imageData.bytes,e+=1)o[e]=a[t+1]>0||0==a[t]&&l[e],r[e]=l[e];else if(this.replaceMode&&this.reduceMode)for(let t=0,e=0;t<a.length;t+=this.imageData.bytes,e+=1)o[e]=a[t+1]>0&&!(0==a[t]&&l[e]),r[e]=l[e];else if(this.replaceMode||this.reduceMode){if(!this.replaceMode&&this.reduceMode)for(let t=0,e=0;t<a.length;t+=this.imageData.bytes,e+=1)o[e]=s[e]&&!(0==a[t]&&l[e]),r[e]=r[e]||l[e]}else for(let t=0,e=0;t<a.length;t+=this.imageData.bytes,e+=1)o[e]=s[e]||0==a[t]&&l[e],r[e]=r[e]||l[e];this.rasterPreview(this.imageData.binaryMask,this.imageData.sampleColor||e.sampleColor)}rasterPreview(e,n){let i,o=this,r={0:this.colors.nullColor,1:this.colors.defaultColor};n&&(r[1]=new t.Color(n[0],n[1],n[2]),r[1].hue+=180,r[1].brightness=(180+r[1].brightness)%360),this.preview&&this.preview.remove(),this.preview=this.project.paperScope.overlay.getViewportRaster(!1),window.preview=this.preview,this.project.toolLayer.insertChild(0,this.preview);let s=this.preview.createImageData(this.preview.size);for(var a=0,l=0;a<s.data.length;a+=4,l+=1)i=r[e[l]],s.data[a]=i.red,s.data[a+1]=i.blue,s.data[a+2]=i.green,s.data[a+3]=255*i.alpha;function h(){o.preview.tweenTo({opacity:.15},{duration:1200,easing:"easeInQuart"}).then(c)}function c(){o.preview.tweenTo({opacity:1},{duration:800,easing:"easeOutCubic"}).then(h)}this.preview.setImageData(s,new t.Point(0,0)),h()}}class F extends b{constructor(t){super(t);let e=I("fa-wand-magic-sparkles");e.classList.add("rotate-by"),e.style.setProperty("--rotate-angle","270deg"),this.button.configure(e,"Magic Wand Tool");let n=document.createElement("div");n.classList.add("wand-toolbar","dropdown"),n.setAttribute("data-tool","wand"),this.dropdown.appendChild(n);let i=document.createElement("div");i.classList.add("threshold-container"),n.appendChild(i);let o=document.createElement("label");i.appendChild(o),o.innerHTML="Threshold",this.thresholdInput=document.createElement("input"),i.appendChild(this.thresholdInput),Object.assign(this.thresholdInput,{type:"range",min:-1,max:100,value:20}),this.thresholdInput.onchange=function(){t.setThreshold(this.value)};let r=document.createElement("div");r.classList.add("toggles"),n.appendChild(r);let s=this.cycleReplaceModeButton=document.createElement("span");s.classList.add("option-toggle"),r.appendChild(s),N.set(s,{prefix:"On click:",actions:[{replace:"Start new mask"},{append:"Add to current"}],onclick:function(e){t.setReplaceMode("replace"==e)}});let a=this.cycleFloodModeButton=document.createElement("span");a.classList.add("option-toggle"),r.appendChild(a),N.set(a,{prefix:"Fill rule:",actions:[{flood:"Contiguous"},{everywhere:"Anywhere"}],onclick:function(e){t.setFloodMode("flood"==e)}});let l=this.cycleReduceModeButton=document.createElement("span");l.classList.add("option-toggle"),r.appendChild(l),N.set(l,{prefix:"Use to:",actions:[{expand:"Expand selection"},{reduce:"Reduce selection"}],onclick:function(e){t.setReduceMode("reduce"==e)}}),[s,a,l].forEach((t=>{let e=N.get(t),n=document.createElement("span");n.classList.add("label","prefix"),n.innerHTML=e.prefix,t.appendChild(n),e.actions.forEach(((e,n)=>{let i=Object.values(e)[0],o=Object.keys(e)[0],r=document.createElement("span");r.classList.add("option"),r.innerHTML=i,t.appendChild(r),N.set(r,{key:o,index:n}),e.htmlElement=r,e.key=o,0==n&&r.classList.add("selected")})),t.addEventListener("click",(function(){let t=N.get(this),e=t.actions,n=this.querySelector(".option.selected"),i=N.get(n)?.index,o=void 0===i?0:(i+1)%e.length;this.querySelectorAll(".option").forEach((t=>t.classList.remove("selected")));let r=e[o];r.htmlElement.classList.add("selected"),t.onclick(r.key)}))}));let h=document.createElement("button");h.classList.add("btn","btn-secondary","btn-sm"),h.setAttribute("data-action","apply"),n.appendChild(h),h.innerHTML="Apply",h.onclick=function(){t.applyChanges()};let c=document.createElement("button");c.classList.add("btn","btn-secondary","btn-sm"),c.setAttribute("data-action","done"),n.appendChild(c),c.innerHTML="Done",c.onclick=function(){t.finish()}}isEnabledForMode(t){return["new","Polygon","MultiPolygon"].includes(t)}setThreshold(t){this.thresholdInput.value=t}cycleReduceMode(){this.cycleReduceModeButton.dispatchEvent(new Event("click"))}cycleReplaceMode(){this.cycleReplaceModeButton.dispatchEvent(new Event("click"))}cycleFloodMode(){this.cycleFloodModeButton.dispatchEvent(new Event("click"))}}function j(e,n,i){let o=new t.CompoundPath({children:[],fillRule:"evenodd",insert:!1});if(n){let r=new M(n);n=r.addBorder(),"dilate"==i&&r.dilate(),n.bounds={minX:0,minY:0,maxX:n.width,maxY:n.height};let s=e.traceContours(n);o.children=s.map((function(e){let n=e.points.map((e=>new t.Point(e))),i=new t.Path(n,{insert:!1});return i.closed=!0,i})).filter((function(t){if(Math.abs(t.area)>=50)return!0;t.remove()}))}return o}function z(e,n,i,o){var r=e.curve===n,s=n.getNormalAtTime(r?0:1).multiply(o),a=e.point.add(s),l=new t.Segment(a),h=r?"handleOut":"handleIn";return l[h]=e[h].add(i.subtract(s).divide(2)),l}function D(e,n){var i=new t.Curve(e.segment1.handleOut.add(e.segment1.point),new t.Point(0,0),new t.Point(0,0),e.segment2.handleIn.add(e.segment2.point)).getNormalAtTime(.5).multiply(n),o=z(e.segment1,e,i,n),r=z(e.segment2,e,i,n),s=new t.Curve(o,r);if(0===s.getIntersections(s).length){var a=Math.min(Math.abs(n)/10,1),l=s.getPointAtTime(.5).getDistance(e.getPointAtTime(.5));if(Math.abs(l-Math.abs(n))>a){var h=e.divideAtTime(.5);if(null!=h)return D(e,n).concat(D(h,n))}}return[o,r]}function H(t,e){return t.x*e.y-t.y*e.x}function G(e,n,i,o,r,s){var a,l,h,c,u,d,p,g,f,m,v,_,y,w,A=new t.Curve(e[0],e[1]),b=new t.Curve(n[0],n[1]),C=A.getIntersections(b),x=e[1].point.getDistance(n[0].point);if(i.isSmooth())n[0].handleOut=n[0].handleOut.project(i.handleOut),n[0].handleIn=e[1].handleIn.project(i.handleIn),n[0].point=e[1].point.add(n[0].point).divide(2),e.pop();else if(0===C.length)if(x>.1*Math.abs(r))switch(o){case"miter":var I=(p=A.point2,g=A.point2.add(A.getTangentAtTime(1)),f=b.point1,m=b.point1.add(b.getTangentAtTime(0)),v=p.subtract(g),_=f.subtract(m),y=H(p,g),w=H(f,m),new t.Point(y*_.x-v.x*w,y*_.y-v.y*w).divide(H(v,_)));Math.max(I.getDistance(A.point2),I.getDistance(b.point1))<Math.abs(r)*s&&e.push(new t.Segment(I));break;case"round":var S=(a=e[1],l=n[0],h=i.point,c=r,u=a.point.subtract(h).add(l.point.subtract(h)).normalize(Math.abs(c)).add(h),d=new t.Path.Arc({from:a.point,to:l.point,through:u,insert:!1}),a.handleOut=d.firstSegment.handleOut,l.handleIn=d.lastSegment.handleIn,3===d.segments.length?d.segments[1]:null);S&&e.push(S)}else n[0].handleIn=e[1].handleIn,e.pop();else{var T=A.divideAt(C[0]);if(T){I=T.segment1;var k=b.divideAt(b.getIntersections(A)[0]);I.handleOut=k?k.segment1.handleOut:n[0].handleOut,e.pop(),n[0]=I}else n[0].handleIn=e[1].handleIn,e.pop()}}function V(t){return 1===t.children.length&&(t=t.children[0]).remove(),t}function q(e,n){if(void 0===n&&(n=.01),e.closed){var i=Math.abs(e.area*n);if(e.clockwise||e.reverse(),(e=e.unite(e,{insert:!1}))instanceof t.CompoundPath&&(e.children.filter((function(t){return Math.abs(t.area)<i})).forEach((function(t){return t.remove()})),1===e.children.length))return V(e)}return e}function U(t,e){var n=(t.segments[0].location.offset+t.segments[Math.max(1,Math.floor(t.segments.length/2))].location.offset)/3;return e.getNearestLocation(t.getPointAt(n)).offset<e.getNearestLocation(t.getPointAt(2*n)).offset}function W(e,n,i,o){var r,s;r=function(t,e){var n=t.clone({insert:!1});return n.reduce({}),t.clockwise||(n.reverse(),e=-e),[n,e]}(e,n),s=r[0],n=r[1];for(var a=s.curves.slice().map((function(t){return D(t,n)})).flat(),l=[],h=0;h<a.length;h+=2)l.push(a.slice(h,h+2));var c=function(t,e,n,i,o){var r=n.segments;if(0==t.length)return n.segments;for(var s=t[0].slice(),a=0;a<t.length-1;++a)G(t[a],t[a+1],r[a+1],e,i,o);return n.closed&&(G(t[t.length-1],s,r[0],e,i,o),t[0][0]=s[0]),t}(l,i,s,n,o).flat(),u=function(e){if(e.closed){var n=e.unite(e,{insert:!1});if(n instanceof t.CompoundPath)return n.children.filter((function(t){return!(t.segments.length>1&&U(t,e))})).forEach((function(t){return t.remove()})),V(n)}return e}(new t.Path({segments:c,insert:!1,closed:e.closed}));return u.reduce({}),s.closed&&(s.clockwise&&n<0||!s.clockwise&&n>0)&&function(e,n){var i=function(e){return e instanceof t.CompoundPath?e.children.map((function(t){return t.segments})).flat():e.segments}(e).slice();i.forEach((function(t){n.contains(t.point)||t.remove()}))}(u,e),s.clockwise!==e.clockwise&&u.reverse(),q(u)}function Y(e,n,i){var o=e.point.add(n.point).divide(2),r=n.point.subtract(e.point).rotate(-90,new t.Point(0,0)).normalize(i),s=o.add(r);return new t.Path.Arc({from:e.point,to:n.point,through:s,insert:!1}).segments}function J(e,n,i,o,r){var s=W(e,n=e.clockwise?n:-n,i,r),a=W(e,-n,i,r);if(e.closed)return s.subtract(a,{insert:!1});var l=a,h=new Array;a instanceof t.CompoundPath&&((h=a.children.filter((function(t){return t.closed}))).forEach((function(t){return t.remove()})),l=a.children[0]),l.reverse();var c=function(e,n,i,o){if(e instanceof t.CompoundPath){var r=e.children.map((function(t){return{c:t,a:Math.abs(t.area)}}));e=(r=r.sort((function(t,e){return e.a-t.a})))[0].c}var s=e.segments.slice(),a=n.segments.slice();if("round"===o){var l=Y(a[a.length-1],s[0],i),h=Y(s[s.length-1],a[0],i),c=new t.Path({segments:l.concat(s,h,a),closed:!0,insert:!1});return c.reduce({}),c}return new t.Path({segments:s.concat(a),closed:!0,insert:!1})}(s,l,n,o);if(h.length>0)for(var u=0,d=h;u<d.length;u++){var p=d[u];c=c.subtract(p,{insert:!1})}return c}function Z(t){return t.closed?t.unite(t,{insert:!1}):t}void 0===t&&console.error("paper-offset.mjs requires paper.js to have been loaded");var X=function(){function e(){}return e.offset=function(e,n,i){var o=function(e,n,i,o){var r=Z(e),s=r;if(r instanceof t.Path)s=W(r,n,i,o);else{var a=r.children.map((function(r){if(r.segments.length>1){U(r,e)||r.reverse();var s=W(r,n,i,o);return(s=q(s)).clockwise!==r.clockwise&&s.reverse(),s instanceof t.CompoundPath?(s.applyMatrix=!0,s.children):s}return null})).flat().filter((function(t){return!!t}));s=new t.CompoundPath({children:a,insert:!1})}return s.copyAttributes(r,!1),s.remove(),s}(e,n,(i=i||{}).join||"miter",i.limit||10);return void 0===i.insert&&(i.insert=!0),i.insert&&(e.parent||t.project.activeLayer).addChild(o),o},e.offsetStroke=function(e,n,i){var o=function(e,n,i,o,r){var s=Z(e),a=s;return(a=s instanceof t.Path?J(s,n,i,o,r):s.children.flatMap((function(t){return J(t,n,i,o,r)})).reduce((function(t,e){return t.unite(e,{insert:!1})}))).strokeWidth=0,a.fillColor=s.strokeColor,a.shadowBlur=s.shadowBlur,a.shadowColor=s.shadowColor,a.shadowOffset=s.shadowOffset,a}(e,n,(i=i||{}).join||"miter",i.cap||"butt",i.limit||10);return void 0===i.insert&&(i.insert=!0),i.insert&&(e.parent||t.project.activeLayer).addChild(o),o},e}();class $ extends A{constructor(e){super(e);let n=this;this.setToolbarControl(new K(this)),this.eraseMode=!1,this.drawColor=new t.Color("green"),this.eraseColor=new t.Color("red"),this.drawColor.alpha=.5,this.eraseColor.alpha=.5,this.autoSimplify=!1,this.radius=0,this.cursor=new t.Shape.Circle(new t.Point(0,0),this.radius),this.cursor.set({strokeWidth:1,strokeColor:"black",fillColor:this.drawColor,opacity:1,visible:!1}),this.cursor.name="brushtool",this.pathGroup=new t.Group([new t.Path,new t.Path]),n.project.toolLayer.addChild(this.pathGroup),n.project.toolLayer.addChild(this.cursor),this.extensions.onActivate=function(){n.cursor.radius=n.radius/n.project.getZoom(),n.cursor.strokeWidth=1/n.project.getZoom(),n.cursor.visible=!0,n.tool.minDistance=3/n.project.getZoom(),n.tool.maxDistance=10/n.project.getZoom(),n.targetLayer.addChild(n.pathGroup)},this.extensions.onDeactivate=function(t){n.cursor.visible=!1,n.project.toolLayer.addChild(n.pathGroup),t&&n.finish()},this.tool.onMouseWheel=function(t){t.preventDefault(),t.stopPropagation(),0!=t.deltaY&&n.toolbarControl.updateBrushRadius({larger:t.deltaY<0})},this.tool.extensions.onKeyDown=function(t){"e"==t.key&&(!1===n.eraseMode?n.setEraseMode(!0):n.eraseMode="keyhold")},this.tool.extensions.onKeyUp=function(t){"e"==t.key&&"keyhold"==n.eraseMode&&n.setEraseMode(!1)}}onMouseDown(e){e.preventDefault(),e.stopPropagation(),this.itemToCreate&&(this.itemToCreate.initializeGeoJSONFeature("MultiPolygon"),this.refreshItems()),this.cursor.position=e.original.point;let n=new t.Path([e.point]);n.mode=this.eraseMode?"erase":"draw",n.radius=this.radius/this.project.getZoom();const i=2*this.cursor.radius/this.targetLayer.scaling.x;this.pathGroup.lastChild.replaceWith(n),this.pathGroup.lastChild.set({strokeWidth:i,fillColor:null,strokeCap:"round"}),"erase"==n.mode?(this.pathGroup.firstChild.fillColor=this.eraseColor,this.pathGroup.lastChild.strokeColor=this.eraseColor):(this.pathGroup.firstChild.fillColor=this.drawColor,this.pathGroup.lastChild.strokeColor=this.drawColor)}onMouseUp(t){this.modifyArea()}onMouseMove(t){this.cursor.position=t.original.point}onMouseDrag(t){this.cursor.position=t.original.point,this.item&&(this.pathGroup.lastChild.add(t.point),this.pathGroup.lastChild.smooth({type:"continuous"}))}setRadius(t){this.radius=t,this.cursor.radius=t/this.project.getZoom()}setAutoSimplify(t){this.autoSimplify=!!t}setEraseMode(t){this.eraseMode=t,this.cursor.fillColor=t?this.eraseColor:this.drawColor,this.toolbarControl.setEraseMode(this.eraseMode)}finish(){this.deactivate()}modifyArea(){let e,n=this.pathGroup.lastChild;const i=n.radius/this.targetLayer.scaling.x;if(n.segments.length>1?(e=X.offsetStroke(n,i,{join:"round",cap:"round",insert:!0}),e.contains(n.segments[0].point)||(console.error("Oops! Bad stroke offset! Trying to correct"),n.segments[0].point.x+=.001,e=X.offsetStroke(n,i,{join:"round",cap:"round",insert:!0}))):e=new t.Path.RegularPolygon({center:n.firstSegment.point,radius:i,sides:360}),e.strokeWidth=1/this.project.getZoom(),e.strokeColor="black",e.fillColor="yellow",e.flatten(),e.name="shapeobject",!this.item.isBoundingElement){let t=this.item.parent.children.filter((t=>t.isBoundingElement));e.applyBounds(t)}let o;if(n.visible=!1,this.autoSimplify&&(e=e.toCompoundPath(),this.doSimplify(e)),o=this.eraseMode?this.item.subtract(e,{insert:!1}):this.item.unite(e,{insert:!1}),o){o=o.toCompoundPath();const t=o.children.filter((t=>t.area>0||Math.abs(t.area)>10));this.item.removeChildren(),this.item.addChildren(t),o.remove()}e.remove()}}class K extends b{constructor(t){super(t);const e=I("fa-brush");e.classList.add("rotate-by"),e.style.setProperty("--rotate-angle","225deg"),this.button.configure(e,"Brush Tool");const n=document.createElement("div");n.classList.add("dropdown","brush-toolbar"),n.setAttribute("data-tool","brush"),this.dropdown.appendChild(n);const i=document.createElement("label");i.innerHTML="Radius",n.appendChild(i),this.rangeInput=document.createElement("input"),n.appendChild(this.rangeInput),Object.assign(this.rangeInput,{type:"range",min:1,max:100,step:1,value:20}),this.rangeInput.addEventListener("change",(function(){t.setRadius(this.value)})),this.eraseButton=document.createElement("button"),n.appendChild(this.eraseButton),this.eraseButton.innerHTML="Eraser",this.eraseButton.setAttribute("data-action","erase"),this.eraseButton.addEventListener("click",(function(){let e=this.classList.toggle("active");t.setEraseMode(e)})),setTimeout((()=>t.setRadius(20)),0)}isEnabledForMode(t){return["new","Polygon","MultiPolygon"].includes(t)}updateBrushRadius(t){t.larger?(this.rangeInput.value=parseInt(this.rangeInput.value)+parseInt(this.rangeInput.step),this.rangeInput.dispatchEvent(new Event("change"))):(this.rangeInput.value=parseInt(this.rangeInput.value)-parseInt(this.rangeInput.step),this.rangeInput.dispatchEvent(new Event("change")))}setEraseMode(t){t?this.eraseButton.classList.add("active"):this.eraseButton.classList.remove("active")}}class Q{constructor(t){if(!1===tt.includes(t.geometry?.type||t.geometry))throw"Bad GeoJSON Geometry type";this._paperItem=null,this._props=t.properties||{}}static supportsGeoJSONType(t,e){return!1}_supportsGeoJSONObj(t){return this.constructor.supportsGeoJSONType(t.geometry?.type,t.geometry?.properties?.subtype)}getCoordinates(){return[]}getProperties(){return{}}getStyleProperties(){return this.paperItem.style.toJSON()}static onTransform(){}supportsGeoJSONType(t,e){return this.constructor.supportsGeoJSONType(t,e)}getGeoJSONType(){return{type:void 0,subtype:void 0}}getLabel(){if(this.paperItem.displayName)return this.paperItem.displayName;{const t=this.getGeoJSONType();return t.subtype||t.type}}get type(){return this.getGeoJSONType().type}get subtype(){return this.getGeoJSONType().subtype}get paperItem(){return this._paperItem}set paperItem(t){this._paperItem=t,function(t){let e=t.paperItem,n=t.constructor,i=t._props;he.registerFeature(e),e.onTransform=n.onTransform,t.setStyle(i),e.fillOpacity=e.fillColor?e.fillColor.alpha:1,e.displayName=i.label||t.getLabel(),e.annotationItem=t,e.replaceWith=it,"selected"in i&&(e.selected=i.selected)}(this)}setStyle(t){this._paperItem&&this._paperItem.style.set(t)}toGeoJSONFeature(){return{type:"Feature",geometry:this.toGeoJSONGeometry(),properties:{label:this.paperItem.displayName,selected:this.paperItem.selected,...this.getStyleProperties(),userdata:this.paperItem.data.userdata}}}toGeoJSONGeometry(){let t={type:this.type,properties:this.getProperties(),coordinates:this.getCoordinates()};return this.subtype&&(t.properties=Object.assign(t.properties,{subtype:this.subtype})),t}}const tt=["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection",null],et=[];class nt{constructor(){}static register(t){if(t.supportsGeoJSONType===Q.supportsGeoJSONType)throw console.error("Static accessor supportsGeoJSONType must be implemented"),"Static accessor supportsGeoJSONType must be implemented";et.includes(t)||et.push(t)}static getConstructor(t){if(!("geometry"in t)||!("properties"in t))return void console.error("Invalid GeoJSON Feature object. Returning undefined.");let e=t.geometry?.type,n=t.geometry?.properties?.subtype;return et.filter((t=>t.supportsGeoJSONType(e,n))).slice(-1)[0]}static itemFromGeoJSON(t){tt.includes(t.type)&&(t={type:"Feature",geometry:t,properties:{}});let e=nt.getConstructor(t);if(e){let n=new e(t);return n.paperItem.data.userdata=t.properties?.userdata,n.paperItem}}static itemFromAnnotationItem(t){if(!t.annotationItem)return void error("Only paper.Items constructed by AnnotationItem implementations are supported");let e={type:"Feature",geometry:t.annotationItem.toGeoJSONGeometry(),properties:t.annotationItem._props};return nt.itemFromGeoJSON(e)}}function it(e){e.isGeoJSONFeature||console.warn("An item with isGeoJSONFeature==false was used to replace an item."),e._callbacks=this._callbacks;let n=OpenSeadragon.extend(!0,this.rescale,e.rescale);return e.style=this.style,e.rescale=n,this.emit("item-replaced",{item:e}),e.project.emit("item-replaced",{item:e}),t.Item.prototype.replaceWith.call(this,e),e.selected=this.selected,e.updateFillOpacity(),e.applyRescale(),e.project.view.update(),e}class ot extends Q{constructor(e){super(e),"Point"!==e.geometry.type&&error('Bad geoJSON object: type !=="Point"');let n=e.geometry.coordinates.slice(0,2),i=new t.Group;i.pivot=new t.Point(0,0),i.applyMatrix=!0;let o=new t.Path.Circle(new t.Point(0,0),6);o.scale(new t.Point(1,.5),new t.Point(0,0)),i.addChild(o);let r=new t.Path.Line(new t.Point(0,0),new t.Point(0,-6));i.addChild(r);let s=new t.Path.Circle(new t.Point(0,-9),3);i.addChild(s),i.position=new t.Point(...n),i.scaleFactor=i.project._scope.scaleByCurrentZoom(1),i.scale(i.scaleFactor,o.bounds.center),i.rescale=i.rescale||{},i.rescale.size=function(t){i.scale(1/(i.scaleFactor*t)),i.scaleFactor=1/t},i.applyRescale(),this.paperItem=i}setStyle(t){t.rescale=OpenSeadragon.extend(!0,t.rescale,this.paperItem.rescale),this.paperItem.style.set(t)}static supportsGeoJSONType(t,e=null){return"point"===t.toLowerCase()&&null===e}getGeoJSONType(){return{type:"Point"}}getCoordinates(){let t=this.paperItem.children[0];return[t.bounds.center.x,t.bounds.center.y]}getStyleProperties(){return this.paperItem.children[0].style.toJSON()}static onTransform(){switch(arguments[0]){case"rotate":{let t=arguments[1],e=arguments[2];this.rotate(-t,e);let n=this.position.subtract(e),i=e.add(n.rotate(t)).subtract(this.position);this.translate(i);break}case"scale":{let t=arguments[1],e=arguments[2],n=arguments[3];this.matrix.append(n.inverted());let i=this.pivot.transform(this.matrix).subtract(t),o=i.rotate(-e).multiply(n.scaling).rotate(e).subtract(i);this.translate(o);break}}}}class rt extends A{constructor(t){super(t);let e=new ot({geometry:{type:"Point",coordinates:[0,0]},properties:{label:"Point Tool"}}).paperItem;e.visible=!1,delete e.isGeoJSONFeature,this.cursor=e,this.dragging=!1,this.project.toolLayer.addChild(e),this.setToolbarControl(new st(this)),this.extensions.onActivate=()=>{this.project.toolLayer.bringToFront(),this.setCursorProps()},this.extensions.onDeactivate=()=>{this.project.toolLayer.sendToBack(),this.cursor.visible=!1,this.project.overlay.removeClass("point-tool-grab","point-tool-grabbing")},this.onSelectionChanged=()=>{this.setCursorProps()}}setCursorProps(){this.itemToCreate?(this.cursor.fillColor=this.itemToCreate.fillColor,this.cursor.strokeColor=this.itemToCreate.strokeColor,this.cursor.visible=!0):this.cursor.visible=!1}onMouseMove(t){this.cursor.position=t.original.point,this.item.hitTest(t.point)?this.project.overlay.addClass("point-tool-grab"):this.project.overlay.removeClass("point-tool-grab")}onMouseDown(t){this.itemToCreate?(this.itemToCreate.initializeGeoJSONFeature("Point"),this.refreshItems(),this.item.position=t.point,this.cursor.visible=!1,this.toolbarControl.updateInstructions("Point")):this.item&&this.item.hitTest(t.point)&&(this.dragging=!0,this.project.overlay.addClass("point-tool-grabbing"))}onMouseDrag(t){this.dragging&&this.item&&(this.item.position=this.item.position.add(t.delta))}onMouseUp(){this.dragging=!1,this.project.overlay.removeClass("point-tool-grabbing")}}class st extends b{constructor(t){super(t);const e=I("fa-map-pin");this.button.configure(e,"Point Tool"),this.instructions=document.createElement("span"),this.instructions.classList.add("instructions"),this.dropdown.appendChild(this.instructions)}isEnabledForMode(t){return this.updateInstructions(t),["new","Point"].includes(t)}updateInstructions(t){const e="new"==t?"Click to drop a pin":"Point"==t?"Drag to reposition":"???";this.instructions.innerHTML=e}}class at extends Q{constructor(e){super(e),"Point"!==e.geometry.type&&error('Bad geoJSON object: type !=="Point"');let n=e.geometry.coordinates.slice(0,2),i=this.paperItem=new t.Group;i.pivot=new t.Point(0,0),i.applyMatrix=!0;let o=new t.Path.Circle(new t.Point(0,0),4);i.addChild(o);let r=new t.PointText({point:new t.Point(0,0),pivot:new t.Point(0,0),content:e.geometry.properties.content||"PointText",fontSize:18,strokeWidth:1});function s(){const t=i.view.getFlipped()?i.view.getRotation():180-i.view.getRotation();i.rotate(-t),i.scale(-1,1),i.rotate(t)}i.addChild(r),this.refreshTextOffset(),r.on("content-changed",(()=>{this.refreshTextOffset()})),i.position=new t.Point(...n),i.scaleFactor=i.project._scope.scaleByCurrentZoom(1),i.scale(i.scaleFactor,o.bounds.center),i.rescale=i.rescale||{},i.rescale.size=function(t){i.scale(1/(i.scaleFactor*t)),i.scaleFactor=1/t,r.strokeWidth=0},i.view.getFlipped()&&s();const a=i.view.getFlipped()?180-i.view.getRotation():-i.view.getRotation();i.rotate(a),i.view.on("rotate",(t=>{const e=-t.rotatedBy;i.rotate(e)})),i.view.on("flip",(()=>{s()})),i.applyRescale()}setStyle(t){t.rescale=OpenSeadragon.extend(!0,t.rescale,this.paperItem.rescale),this.paperItem.style.set(t)}get textitem(){return this.paperItem.children[1]}get circle(){return this.paperItem.children[0]}static supportsGeoJSONType(t,e){return"point"===t.toLowerCase()&&"pointtext"===e?.toLowerCase()}getGeoJSONType(){return{type:"Point",subtype:"PointText"}}getCoordinates(){let t=this.paperItem.children[0];return[t.bounds.center.x,t.bounds.center.y]}getProperties(){return{content:this.paperItem.children[1].content}}getStyleProperties(){return this.paperItem.children[0].style.toJSON()}static onTransform(){switch(arguments[0]){case"rotate":{let t=arguments[1],e=arguments[2];this.rotate(-t,e);let n=this.position.subtract(e),i=e.add(n.rotate(t)).subtract(this.position);this.translate(i);break}case"scale":{let t=arguments[1],e=arguments[2],n=arguments[3];this.matrix.append(n.inverted());let i=this.pivot.transform(this.matrix).subtract(t),o=i.rotate(-e).multiply(n.scaling).rotate(e).subtract(i);this.translate(o);break}}}refreshTextOffset(){const e=this.textitem.view.getFlipped();let n=this.textitem.getInternalBounds(),i=n.width/2/this.textitem.layer.scaling.x*(e?1:-1),o=-n.height/2/this.textitem.layer.scaling.x,r=e?180-this.textitem.view.getRotation():this.textitem.view.getRotation(),s=new t.Point(i,o).divide(this.textitem.view.getZoom()).rotate(-r);this.textitem.position=this.circle.bounds.center.add(s)}}class lt extends A{constructor(t){super(t),this.dragging=!1;let e=new at({geometry:{type:"Point",coordinates:[0,0],properties:{subtype:"PointText",content:"Click to place"}},properties:{label:"Text Tool"}}),n=this.cursor=e.paperItem;n.isGeoJSONFeature=!1,n.fillColor="grey",n.strokeColor="black",n.strokeWidth=1,n.visible=!1,this.project.toolLayer.addChild(n),e.refreshTextOffset(),n.applyRescale(),this.setToolbarControl(new ht(this)),this.extensions.onActivate=()=>{this.itemToCreate?(this.cursor.visible=!0,e.refreshTextOffset(),n.applyRescale()):this.item&&this._updateTextInput()},this.extensions.onDeactivate=()=>{this.project.toolLayer.addChild(this.cursor),this.cursor.visible=!1,this.project.overlay.removeClass("point-tool-grab","point-tool-grabbing")}}onSelectionChanged(){this.cursor.visible=!!this.itemToCreate,this._updateTextInput()}onMouseMove(t){this.cursor.position=t.original.point,this.item.hitTest(t.point)?this.project.overlay.addClass("point-tool-grab"):this.project.overlay.removeClass("point-tool-grab")}onMouseDown(t){this.itemToCreate?(this.itemToCreate.initializeGeoJSONFeature("Point","PointText"),this.refreshItems(),this.item.children[1].content=this.toolbarControl.getValue(),this.item.position=t.point,this.cursor.visible=!1,this.toolbarControl.updateInstructions("Point:PointText")):this.item&&this.item.hitTest(t.point)&&(this.dragging=!0,this.project.overlay.addClass("point-tool-grabbing"))}onMouseDrag=function(t){this.dragging&&this.item&&(this.item.position=this.item.position.add(t.delta))};onMouseUp(){this.dragging=!1,this.project.overlay.removeClass("point-tool-grabbing")}_updateTextInput(){let t=this.item&&"PointText"==this.item.annotationItem.subtype?this.item.children[1].content:"";this.toolbarControl.setItemText(t),this.cursor.children[1].content=t.length?t:this.toolbarControl.input.getAttribute("placeholder")}}class ht extends b{constructor(t){super(t);let e=this;const n=I("fa-font");this.button.configure(n,"Text Tool"),this.instructions=document.createElement("span"),this.instructions.classList.add("instructions"),this.dropdown.appendChild(this.instructions),this.input=document.createElement("input"),this.input.setAttribute("type","text"),this.input.setAttribute("placeholder","Enter text"),this.dropdown.appendChild(this.input),this.input.addEventListener("input",(function(){let t=e.getValue();e.tool.item&&"PointText"==e.tool.item.annotationItem.subtype&&(e.tool.item.children[1].content=t),e.tool.cursor.children[1].content=t})),this.input.dispatchEvent(new Event("input"))}setItemText(t){this.input.value=t}getValue(){let t=this.input;return t.value.trim()||t.getAttribute("placeholder")}isEnabledForMode(t){return this.updateInstructions(t),["new","Point:PointText"].includes(t)}updateInstructions(t){const e="new"==t?"Click to place":"Point:PointText"==t?"Drag to reposition":"???";this.instructions.innerHTML=e}}class ct extends A{constructor(e){super(e);let n=this,i=new t.Group({visible:!1}),o=new t.Path({segments:[new t.Point(0,0),new t.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"black"}),r=new t.Path({segments:[new t.Point(0,0),new t.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"white",dashArray:[6,6]}),s=new t.Path({segments:[new t.Point(0,0),new t.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"black"}),a=new t.Path({segments:[new t.Point(0,0),new t.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"white",dashArray:[6,6]});i.addChildren([o,r,s,a]),this.project.toolLayer.addChild(i),this.h1=o,this.h2=r,this.v1=s,this.v2=a,this.crosshairTool=i,this.mode=null,this.creating=null,this.setToolbarControl(new ut(this)),this.extensions.onActivate=this.onSelectionChanged=function(){n.itemToCreate?(n.mode="creating",i.visible=!0,n.creating=null,n.toolbarControl.updateInstructions("new")):n.creating&&n.creating.parent==n.item?(n.mode="creating",i.visible=!0,n.toolbarControl.updateInstructions("new")):n.item?(n.creating=null,n.mode="modifying",i.visible=!1,n.toolbarControl.updateInstructions("Point:Rectangle")):n.deactivate()},this.extensions.onDeactivate=function(t){t&&(n.creating=null),i.visible=!1,n.mode=null,n.project.overlay.removeClass("rectangle-tool-resize"),n.project.overlay.removeClass("rectangle-tool-move")}}get rectangle(){return this.item.children&&this.item.children[0]||this.item}setCursorPosition(e){let n=this.tool,i=n.view.projectToView(e),o=n.view.viewToProject(new t.Point(0,i.y)),r=n.view.viewToProject(new t.Point(n.view.viewSize.width,i.y)),s=n.view.viewToProject(new t.Point(i.x,0)),a=n.view.viewToProject(new t.Point(i.x,n.view.viewSize.height));this.h1.segments[0].point=o,this.h2.segments[0].point=o,this.h1.segments[1].point=r,this.h2.segments[1].point=r,this.v1.segments[0].point=s,this.v2.segments[0].point=s,this.v1.segments[1].point=a,this.v2.segments[1].point=a}onMouseDown(e){if(this.itemToCreate){this.itemToCreate.initializeGeoJSONFeature("Point","Rectangle"),this.refreshItems();let n=new t.Path.Rectangle(e.point,e.point);this.creating=n,this.item.removeChildren(),this.item.addChild(n),this.mode="creating"}else if(this.item){let t=this.item.hitTest(e.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)});if(t){this.mode="corner-drag";let e=(t.segment.path.segments.indexOf(t.segment)+2)%t.segment.path.segments.length;return this.refPoint=t.segment.path.segments[e].point,void(this.ctrlPoint=t.segment.point.clone())}if(this.item.contains(e.point))return void(this.mode="fill-drag")}}onMouseMove(t){this.setCursorPosition(t.original.point),"modifying"==this.mode&&(this.item.hitTest(t.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)})?this.project.overlay.addClass("rectangle-tool-resize"):this.project.overlay.removeClass("rectangle-tool-resize"),this.item.contains(t.point)?this.project.overlay.addClass("rectangle-tool-move"):this.project.overlay.removeClass("rectangle-tool-move"))}onMouseDrag(e){let n,i,o,r=this.item.center;if("creating"==this.mode)if(o=-(this.item.view.getRotation()+this.item.layer.getRotation()),n=e.downPoint,e.modifiers.command||e.modifiers.control){let n=e.point.subtract(e.downPoint),r=[[1,1],[1,-1],[-1,-1],[-1,1]].map((e=>new t.Point(e[0],e[1]).rotate(o))).sort(((t,e)=>t.dot(n)-e.dot(n)))[0],s=n.project(r);i=e.downPoint.add(s)}else i=e.point;else{if("corner-drag"!=this.mode)return"fill-drag"==this.mode?void this.item.translate(e.delta):void this.setCursorPosition(e.original.point);if(o=this.rectangle.segments[1].point.subtract(this.rectangle.segments[0].point).angle,n=this.refPoint,e.modifiers.command||e.modifiers.control){let t=e.point.subtract(this.refPoint),n=this.ctrlPoint.subtract(this.refPoint),o=t.project(n);i=this.refPoint.add(o)}else i=e.point}this.setCursorPosition(this.targetLayer.matrix.transform(i));let s=new t.Rectangle(n.rotate(-o,r),i.rotate(-o,r)),a=[s.topLeft,s.topRight,s.bottomRight,s.bottomLeft].map((t=>t.rotate(o,r)));this.rectangle.set({segments:a})}onMouseUp(){this.mode="modifying",this.crosshairTool.visible=!1,this.creating=null,this.toolbarControl.updateInstructions("Point:Rectangle")}}class ut extends b{constructor(t){super(t);const e=I("fa-vector-square");this.button.configure(e,"Rectangle Tool"),this.instructions=document.createElement("span"),this.instructions.innerHTML="Click and drag to create a rectangle",this.dropdown.appendChild(this.instructions)}isEnabledForMode(t){return["new","Point:Rectangle"].includes(t)}updateInstructions(t){const e="new"==t?"Click and drag to create a rectangle":"Point:Rectangle"==t?"Drag a corner to resize":"???";this.instructions.innerHTML=e}}class dt extends A{constructor(e){super(e);let n=this;this.crosshairTool=new t.Group({visible:!1}),this.h1=new t.Path({segments:[new t.Point(0,0),new t.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"black"}),this.h2=new t.Path({segments:[new t.Point(0,0),new t.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"white",dashArray:[6,6]}),this.v1=new t.Path({segments:[new t.Point(0,0),new t.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"black"}),this.v2=new t.Path({segments:[new t.Point(0,0),new t.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"white",dashArray:[6,6]}),this.crosshairTool.addChildren([this.h1,this.h2,this.v1,this.v2]),this.project.toolLayer.addChild(this.crosshairTool),this.mode=null,this.creating=null,this.setToolbarControl(new pt(this)),this.extensions.onActivate=this.onSelectionChanged=function(){n.itemToCreate?(n.mode="creating",n.crosshairTool.visible=!0,n.creating=null,n.toolbarControl.updateInstructions("new")):n.creating&&n.creating.parent==n.item?(n.mode="creating",n.crosshairTool.visible=!0,n.toolbarControl.updateInstructions("new")):n.item?(n.creating=null,n.mode="modifying",n.crosshairTool.visible=!1,n.toolbarControl.updateInstructions("Point:Ellipse")):(n.creating=null,n.mode=null,n.crosshairTool.visible=!1,n.toolbarControl.updateInstructions("Point:Ellipse"))},this.extensions.onDeactivate=function(t){t&&(n.creating=null),n.crosshairTool.visible=!1,n.mode=null,n.project.overlay.removeClass("rectangle-tool-resize")}}onMouseDown(e){if(this.itemToCreate){this.itemToCreate.initializeGeoJSONFeature("Point","Ellipse"),this.refreshItems();let n=new t.Path.Ellipse(e.point,e.point);this.creating=n,this.item.removeChildren(),this.item.addChild(n),this.mode="creating"}else if(this.item){let t=this.item.hitTest(e.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)});if(t){this.mode="segment-drag";let e=(t.segment.path.segments.indexOf(t.segment)+2)%t.segment.path.segments.length;return void(this.points={opposite:t.segment.path.segments[e].point.clone(),drag:t.segment.point.clone(),p1:t.segment.next.point.clone(),p2:t.segment.previous.point.clone()})}if(this.item.contains(e.point))return void(this.mode="fill-drag")}}onMouseDrag(e){let n,i=this.item.bounds.center;if("creating"==this.mode){let o=-(this.item.view.getRotation()+this.item.layer.getRotation());if(this.item.view.getFlipped()&&(o=180-o),e.modifiers.command||e.modifiers.control){let i=e.point.subtract(e.downPoint),r=[[1,1],[1,-1],[-1,-1],[-1,1]].map((e=>new t.Point(e[0],e[1]).rotate(o))).sort(((t,e)=>t.dot(i)-e.dot(i)))[0],s=i.project(r);n=e.downPoint.add(s)}else n=e.point;let r=new t.Rectangle(e.downPoint.rotate(-o,i),n.rotate(-o,i)),s=new t.Path.Ellipse(r);s.rotate(o,i),this.item.children[0].set({segments:s.segments}),s.remove()}else{if("segment-drag"!=this.mode)return"fill-drag"==this.mode?void this.item.translate(e.delta):void this.setCursorPosition(e.original.point);{let n=e.point.subtract(this.points.opposite),i=this.points.drag.subtract(this.points.opposite),o=n.project(i),r=i.angle;if(e.modifiers.command||e.modifiers.control){let e=o.length/i.length,n=o.divide(2),s=this.points.opposite.add(n),a=n.length,l=Math.abs(this.points.p1.subtract(this.points.opposite).multiply(e).cross(o.normalize())),h=new t.Path.Ellipse({center:s,radius:[a,l]}).rotate(r);this.item.children[0].set({segments:h.segments}),h.remove()}else{let e=o.divide(2),n=this.points.opposite.add(e),i=e.length,s=Math.abs(this.points.p1.subtract(this.points.opposite).cross(o.normalize())),a=new t.Path.Ellipse({center:n,radius:[i,s]}).rotate(r);this.item.children[0].set({segments:a.segments}),a.remove()}}}this.setCursorPosition(this.targetLayer.matrix.transform(n))}onMouseMove(t){this.setCursorPosition(t.original.point),"modifying"==this.mode&&(this.item.hitTest(t.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)})?this.project.overlay.addClass("rectangle-tool-resize"):this.project.overlay.removeClass("rectangle-tool-resize"),this.item.contains(t.point)?this.project.overlay.addClass("rectangle-tool-move"):this.project.overlay.removeClass("rectangle-tool-move"))}onMouseUp(){this.mode="modifying",this.crosshairTool.visible=!1,this.creating=null,this.toolbarControl.updateInstructions("Point:Ellipse")}setCursorPosition(e){let n=this.tool.view.projectToView(e),i=this.tool.view.viewToProject(new t.Point(0,n.y)),o=this.tool.view.viewToProject(new t.Point(this.tool.view.viewSize.width,n.y)),r=this.tool.view.viewToProject(new t.Point(n.x,0)),s=this.tool.view.viewToProject(new t.Point(n.x,this.tool.view.viewSize.height)),a=this.h1,l=this.h2,h=this.v1,c=this.v2;a.segments[0].point=i,l.segments[0].point=i,a.segments[1].point=o,l.segments[1].point=o,h.segments[0].point=r,c.segments[0].point=r,h.segments[1].point=s,c.segments[1].point=s}}class pt extends b{constructor(t){super(t);const e=I("fa-circle");this.button.configure(e,"Ellipse Tool"),this.instructions=document.createElement("span"),this.instructions.innerHTML="Click and drag to create an ellipse",this.dropdown.appendChild(this.instructions)}isEnabledForMode(t){return["new","Point:Ellipse"].includes(t)}updateInstructions(t){const e="new"==t?"Click and drag to create an ellipse":"Point:Ellipse"==t?"Drag a point to resize":"???";this.instructions.innerHTML=e}}class gt extends A{constructor(e){super(e);let n=this,i=this.tool;this._lastClickTime=0,this.drawingGroup=new t.Group,this._currentItem=null,this._currentItemSelectedColor=null,this.project.toolLayer.addChild(this.drawingGroup),this.drawingGroup.visible=!1,this.draggingSegment=null,this.eraseMode=!1,this.simplifying=null,this.setToolbarControl(new ft(this)),this.extensions.onActivate=function(){i.minDistance=4/n.project.getZoom(),i.maxDistance=20/n.project.getZoom(),n.drawingGroup.visible=!0,n.drawingGroup.selected=!0,n.targetLayer.addChild(n.drawingGroup),n._cacheCurrentItem()},this.extensions.onDeactivate=function(t){t&&(n.finish(),n.project.toolLayer.addChild(n.drawingGroup),n.drawingGroup.removeChildren(),n.drawingGroup.visible=!1,n.drawingGroup.selected=!1,n._restoreCachedItem(),n._currentItem=null)},i.extensions.onKeyDown=function(t){"e"==t.key&&(!1===n.eraseMode?n.setEraseMode(!0):!0===n.eraseMode&&(n.eraseMode="keyhold")),!t.event.metaKey&&!t.event.ctrlKey||t.event.shiftKey||"z"!==t.event.key||n.undo(),(t.event.metaKey||t.event.ctrlKey)&&t.event.shiftKey&&"z"===t.event.key&&n.redo()},i.extensions.onKeyUp=function(t){"e"==t.key&&"keyhold"==n.eraseMode&&n.setEraseMode(!1)}}_cacheCurrentItem(){this._currentItem=this.item,this._currentItem&&(this._currentItem.selectedColor=this._currentItemSelectedColor)}_restoreCachedItem(){this._currentItem&&(this._currentItem.selectedColor=this._currentItemSelectedColor)}onSelectionChanged(){this.item!==this._currentItem&&(this._restoreCachedItem(),this._cacheCurrentItem(),this.targetLayer.addChild(this.drawingGroup),this.drawingGroup.removeChildren(),this.setEraseMode(this.eraseMode))}onMouseDown(e){this.draggingSegment=null;let n=Date.now(),i=n-this._lastClickTime<300;this._lastClickTime=n,this.simplifying&&this.cancelSimplify(),this.itemToCreate&&(this.itemToCreate.initializeGeoJSONFeature("MultiPolygon"),this.refreshItems(),this._cacheCurrentItem(),this.saveHistory());let o=this.drawing();if(o&&i)return this.finishCurrentPath(),void(this.draggingSegment=null);let r=(o&&o.path||this.item).hitTest(e.point,{fill:!1,stroke:!0,segments:!0,tolerance:this.getTolerance(5)});if(r){if("segment"==r.type&&this.eraseMode)r.segment.remove();else if("segment"==r.type)this.draggingSegment=r.segment;else if("stroke"==r.type){let t=r.location.index+1;r.item.insert(t,e.point)}}else if(o){if(e.point.subtract(o.path.lastSegment).length<5/this.project.getZoom())return;o.path.add(e.point)}else this.drawingGroup.removeChildren(),this.drawingGroup.addChild(new t.Path([e.point])),this.drawingGroup.visible=!0,this.drawingGroup.selected=!0,this.drawingGroup.selectedColor=this.eraseMode?"red":null}onMouseUp(t){let e=this.drawing();if(e&&e.path.segments.length>1){let n=e.path.hitTest(t.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)});n&&n.segment==e.path.firstSegment&&this.finishCurrentPath()}else if(this.draggingSegment&&(this.draggingSegment=null,!this.item.isBoundingElement)){let t=this.item.parent.children.filter((t=>t.isBoundingElement));this.item.applyBounds(t)}this.saveHistory()}onMouseMove(t){let e=this.drawing(),n=this.item&&(e&&e.path||this.item).hitTest(t.point,{fill:!1,stroke:!0,segments:!0,tolerance:this.getTolerance(5)});if(n){let t=n.type+(this.eraseMode?"-erase":"");this.project.overlay.addClass("tool-action").setAttribute("data-tool-action",t)}else this.project.overlay.removeClass("tool-action").setAttribute("data-tool-action","")}onMouseDrag(t){let e=this.drawing();e?e.path.add(t.point):this.draggingSegment&&(this.draggingSegment.point=this.draggingSegment.point.add(t.delta))}drawing(){return this.drawingGroup.lastChild&&{path:this.drawingGroup.lastChild}}finish(){this.setEraseMode(!1),this.draggingSegment=null,this.project.overlay.removeClass("tool-action").setAttribute("data-tool-action",""),this.deactivate(),this.drawingGroup.selected=!1,this.drawingGroup.visible=!1}setEraseMode(t){this.eraseMode=t,this.item&&(this.item.selectedColor=t?"red":null),this.drawingGroup.selectedColor=t?"red":null,this.toolbarControl.setEraseMode(t)}finishCurrentPath(){let t=this.drawing();if(!t||!this.item||!this.item.parent)return;t.path.closed=!0;let e=this.eraseMode?this.item.subtract(t.path,{insert:!1}):this.item.unite(t.path,{insert:!1});if(e){if(e=e.toCompoundPath(),!this.item.isBoundingElement){let t=this.item.parent.children.filter((t=>t.isBoundingElement));e.applyBounds(t)}this.item.removeChildren(),this.item.addChildren(e.children),this.item.children.forEach((t=>t.selected=!1)),e.remove()}this.drawingGroup.removeChildren()}saveHistory(){let t=(this.item.history||[]).position||0;this.item.history=[{children:this.item.children.map((t=>t.clone({insert:!1,deep:!0}))),drawingGroup:this.drawingGroup.children.map((t=>t.clone({insert:!1,deep:!0})))}].concat((this.item.history||[]).slice(t,10))}undo(){let t=this.item.history||[],e=(t.position||0)+1;e<t.length&&(this.drawingGroup.removeChildren(),this.item.removeChildren(),this.item.children=t[e].children.map((t=>t.clone({insert:!0,deep:!0}))),this.drawingGroup.children=t[e].drawingGroup.map((t=>t.clone({insert:!0,deep:!0}))),t.position=e)}redo(){let t=this.item.history||[],e=(t.position||0)-1;e>=0&&(this.drawingGroup.removeChildren(),this.item.removeChildren(),this.item.children=t[e].children.map((t=>t.clone({insert:!0,deep:!0}))),this.drawingGroup.children=t[e].drawingGroup.map((t=>t.clone({insert:!0,deep:!0}))),t.position=e)}}class ft extends b{constructor(t){super(t);const e=I("fa-draw-polygon");this.button.configure(e,"Polygon Tool");const n=document.createElement("div");n.classList.add("dropdown","polygon-toolbar"),n.setAttribute("data-tool","polygon"),this.dropdown.appendChild(n);const i=document.createElement("span");i.innerHTML="Click or Drag",n.appendChild(i);const o=document.createElement("div");n.appendChild(o),this.simplifyButton=document.createElement("button"),this.simplifyButton.setAttribute("data-action","simplify"),this.simplifyButton.innerHTML="Simplify",o.append(this.simplifyButton),this.simplifyButton.addEventListener("click",(function(){t.doSimplify(),t.saveHistory()})),this.eraseButton=document.createElement("button"),n.appendChild(this.eraseButton),this.eraseButton.setAttribute("data-action","erase"),this.eraseButton.innerHTML="Eraser",this.eraseButton.addEventListener("click",(function(){let e=this.classList.toggle("active");t.setEraseMode(e)}));const r=document.createElement("span");n.appendChild(r),this.undoButton=document.createElement("button"),r.appendChild(this.undoButton),this.undoButton.setAttribute("data-action","undo"),this.undoButton.setAttribute("title","Undo (ctrl-Z)"),this.undoButton.innerHTML="<",this.undoButton.addEventListener("click",(function(){t.undo()})),this.redoButton=document.createElement("button"),r.appendChild(this.redoButton),this.redoButton.setAttribute("data-action","redo"),this.redoButton.setAttribute("title","Redo (ctrl-shift-Z)"),this.redoButton.innerHTML=">",this.redoButton.addEventListener("click",(function(){t.redo()}))}isEnabledForMode(t){return["new","MultiPolygon","Polygon"].includes(t)}setEraseMode(t){t?this.eraseButton.classList.add("active"):this.eraseButton.classList.remove("active")}}class mt extends gt{constructor(e){super(e);let n=this,i=this.tool;this.setToolbarControl(new vt(this));let o=new t.Color("green");new t.Color("red"),this.radius=0,this.cursor=new t.Shape.Circle(new t.Point(0,0),this.radius),this.cursor.set({strokeWidth:1,strokeColor:"black",fillColor:o,opacity:1,visible:!1}),n.project.toolLayer.addChild(this.cursor),this.clickAction="startPath",this.extensions.onActivate=()=>{this.cursor.radius=this.radius/this.project.getZoom(),this.cursor.strokeWidth=1/this.project.getZoom(),this.refreshCursorVisibility(),i.minDistance=4/n.project.getZoom(),i.maxDistance=10/n.project.getZoom()},this.extensions.onDeactivate=t=>{this.cursor.visible=!1,t&&this.finish()},i.onMouseWheel=t=>{t.preventDefault(),t.stopPropagation(),0!=t.deltaY&&this.toolbarControl.updateBrushRadius({larger:t.deltaY<0})}}setRadius(t){this.radius=t,this.cursor.radius=t/this.project.getZoom()}onMouseDown(t){if(this.draggingSegment=null,this.itemToCreate)return this.itemToCreate.initializeGeoJSONFeature("MultiLineString"),this.refreshItems(),void this.startNewPath(t);let e=this.item?.hitTest(t.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)});if(e){if("segment"==e.type&&this.eraseMode)e.segment.remove();else if("segment"==e.type)this.draggingSegment=e.segment;else if("stroke"==e.type&&!this.eraseMode){let n=e.location.index+1;e.item.insert(n,t.point)}}else this.eraseMode||this.startNewPath(t)}onMouseMove(t){this.cursor.position=t.original.point;let e=this.item?.hitTest(t.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)});if(e){let t=e.type+(this.eraseMode?"-erase":"");this.project.overlay.addClass("tool-action").setAttribute("data-tool-action",t),this.clickAction=t}else this.project.overlay.removeClass("tool-action").setAttribute("data-tool-action",""),this.clickAction="startPath";this.refreshCursorVisibility()}onMouseDrag(t){this.cursor.position=t.original.point,gt.prototype.onMouseDrag.call(this,t);let e=this.drawing();e&&(e.path.segments=this.simplifier.simplify(e.path.segments.map((t=>t.point))))}onMouseUp(t){this.finishCurrentPath()}startNewPath(e){this.finishCurrentPath(),this.drawingGroup.removeChildren(),this.drawingGroup.addChild(new t.Path([e.point])),this.drawingGroup.visible=!0,this.drawingGroup.selected=!0,this.drawingGroup.selectedColor=this.eraseMode?"red":null,this.drawing().path.set({strokeWidth:2*this.radius/this.targetLayer.scaling.x/this.project.getZoom(),strokeColor:this.item.strokeColor,strokeJoin:"round",strokeCap:"round"})}finishCurrentPath(){this.drawing()&&this.item&&(this.drawing().path.segments.length>1&&this.item.addChild(this.drawing().path),this.drawingGroup.removeChildren())}refreshCursorVisibility(){this.cursor.visible=!this.eraseMode&&"startPath"===this.clickAction}}class vt extends b{constructor(t){super(t),this.linestringTool=t;const e=I("fa-pen-nib");this.button.configure(e,"Linestring Tool");const n=document.createElement("div");n.classList.add("dropdown","linestring-toolbar"),n.setAttribute("data-tool","linestring"),this.dropdown.appendChild(n);const i=document.createElement("label");i.innerHTML="Set pen width:",n.appendChild(i),this.rangeInput=document.createElement("input"),n.appendChild(this.rangeInput),Object.assign(this.rangeInput,{type:"range",min:.2,max:12,step:.1,value:4}),this.rangeInput.addEventListener("change",(function(){t.setRadius(this.value)})),this.eraseButton=document.createElement("button"),n.appendChild(this.eraseButton),this.eraseButton.innerHTML="Eraser",this.eraseButton.setAttribute("data-action","erase"),this.eraseButton.addEventListener("click",(function(){let e=this.classList.toggle("active");t.setEraseMode(e)})),setTimeout((()=>t.setRadius(4)))}updateBrushRadius(t){t.larger?(this.rangeInput.value=parseFloat(this.rangeInput.value)+parseFloat(this.rangeInput.step),this.rangeInput.dispatchEvent(new Event("change"))):(this.rangeInput.value=parseFloat(this.rangeInput.value)-parseFloat(this.rangeInput.step),this.rangeInput.dispatchEvent(new Event("change")))}isEnabledForMode(t){return["new","LineString","MultiLineString"].includes(t)}setEraseMode(t){t?this.eraseButton.classList.add("active"):this.eraseButton.classList.remove("active"),this.linestringTool.refreshCursorVisibility()}}class _t extends A{constructor(e){super(e);let n=this;this.ps=this.project.paperScope,this.setToolbarControl(new yt(this));let i=new t.Path.Rectangle({strokeWidth:1,rescale:{strokeWidth:1},strokeColor:"black"}),o=new t.Path.Rectangle({strokeWidth:1,dashArray:[10,10],rescale:{strokeWidth:1,dashArray:[10,10]},strokeColor:"white"});this.project.toolLayer.addChild(i),this.project.toolLayer.addChild(o),i.applyRescale(),o.applyRescale(),i.visible=!1,o.visible=!1,this.extensions.onActivate=function(){n.tool.onMouseMove=t=>n.onMouseMove(t)},this.extensions.onDeactivate=function(t){n.project.overlay.removeClass("selectable-layer"),n.tool.onMouseMove=null},this.tool.extensions.onKeyUp=function(t){"escape"==t.key&&n.project.paperScope.findSelectedItems().forEach((t=>t.deselect()))},this.tool.onMouseUp=function(t){if(i.visible=!1,o.visible=!1,0==t.downPoint.subtract(t.point).length){let e=n.hitTestPoint(t);e&&n._isItemSelectable(e.item)&&e.item.toggle(t.modifiers.control||t.modifiers.meta)}else{let e=n.hitTestArea(t);t.modifiers.control||t.modifiers.meta||n.project.paperScope.findSelectedItems().forEach((t=>t.deselect())),e.forEach((t=>t.select(!0)))}},this.tool.onMouseDrag=function(e){i.visible=!0,o.visible=!0;let n=new t.Rectangle(e.downPoint,e.point);i.set({segments:[n.topLeft,n.topRight,n.bottomRight,n.bottomLeft]}),o.set({segments:[n.topLeft,n.topRight,n.bottomRight,n.bottomLeft]})}}doAnnotationItemsExist(){return this.ps.project.getItems({match:t=>t.isGeoJSONFeature}).length>0}onMouseMove(t){t.item&&this._isItemSelectable(t.item)?(this.currentItem!=t.item&&t.item.emit("selection:mouseenter"),this.currentLayer!=t.item.layer&&t.item.layer.emit("selection:mouseenter"),this.currentItem=t.item,this.currentLayer=this.currentItem.layer,this.project.overlay.addClass("selectable-layer")):(this.currenItem&&this.currentItem.emit("selection:mouseleave",t),this.currentLayer&&this.currentLayer.emit("selection:mouseleave",t),this.project.overlay.removeClass("selectable-layer"),this.currentItem=null,this.currentLayer=null)}hitTestPoint(t){let e=this.ps.project.hitTest(t.point,{fill:!0,stroke:!0,segments:!0,tolerance:this.getTolerance(5),match:t=>t.item.isGeoJSONFeature||t.item.parent.isGeoJSONFeature});return e&&!e.item.isGeoJSONFeature&&(e.item=e.item.parent),e}hitTestArea(e,n){let i={match:t=>t.isGeoJSONFeature},o=new t.Rectangle(e.point,e.downPoint);return n?i.inside=o:i.overlapping=o,this.ps.project.getItems(i)}_isItemSelectable(t){return!0}}class yt extends b{constructor(t){super(t),this.dropdown.classList.add("select-dropdown");const e=I("fa-arrow-pointer");this.button.configure(e,"Selection Tool");const n=document.createElement("div");n.setAttribute("data-active","select"),this.dropdown.appendChild(n);const i=document.createElement("span");i.innerHTML="(Ctrl)click to select items.",n.append(i)}isEnabledForMode(t){return this.tool.doAnnotationItemsExist()&&["default","select","multiselection","Polygon","MultiPolygon","Point:Rectangle","Point:Ellipse","Point","LineString","MultiLineString","GeometryColletion:Raster"].includes(t)}}class wt extends A{constructor(t){super(t);let e=this;this.ps=this.project.paperScope,this._mode="transform",this._moving=[],this._active=!1,this.setToolbarControl(new At(this)),this._makeTransformToolObject(e.project.getZoom()),this.extensions.onActivate=function(){e._active=!0,e.enableTransformToolObject()},this.extensions.onDeactivate=function(t){e._active=!1,e.project.overlay.removeClass("transform-tool-resize","transform-tool-rotate","transform-tool-move"),t&&e.disableTransformToolObject()}}onSelectionChanged(){this.enableTransformToolObject()}setUniformScaling(t){this._alwaysRescaleUniformly=t}_makeTransformToolObject(e){let n=this,i=12;this._transformTool&&this._transformTool.remove(),this._transformTool=new t.Group,this.project.toolLayer.addChild(this._transformTool),this._transformTool.applyMatrix=!1,this._transformTool.transforming=[],this._transformTool.boundingRect=new t.Shape.Rectangle(new t.Point(0,0),new t.Size(0,0)),this._transformTool.boundingDisplay=new t.Shape.Rectangle(new t.Point(0,0),new t.Size(0,0)),this._transformTool.boundingRect.set({strokeWidth:0,fillColor:new t.Color(0,0,0,.001)}),this._transformTool.boundingDisplay.set({strokeWidth:5,strokeColor:"lightblue",rescale:{strokeWidth:5}}),this._transformTool.addChild(this._transformTool.boundingRect),this._transformTool.addChild(this._transformTool.boundingDisplay),this._transformTool.corners=[["topLeft","bottomRight"],["topRight","bottomLeft"],["bottomRight","topLeft"],["bottomLeft","topRight"]].reduce(((o,r)=>{let s=new t.Shape.Rectangle(new t.Point(0,0),new t.Size(i/e,i/e));return s.set({rescale:{size:e=>new t.Size(i/e,i/e)},fillColor:"red",strokeColor:"black"}),n._transformTool.addChild(s),s.anchor=r[0],s.opposite=r[1],s.onMouseDown=function(t){t.stopPropagation()},s.onMouseDrag=function(e){let i=n.targetLayer.getRotation(),o=this.parent.rotation,r=e.delta.rotate(-o),s=this.parent.corners[this.opposite].position;(n._alwaysRescaleUniformly||e.modifiers.command||e.modifiers.control)&&(r=r.project(this.position.subtract(s)));let a=this.position,l=this.position.add(r),h=new t.Rectangle(s,a).size,c=new t.Rectangle(s,l).size.divide(h),u=s.transform(this.parent.matrix),d=this.parent.matrix.inverseTransform(this.parent.corners[this.opposite].refPos),p=n.targetMatrix.inverseTransform(d);this.parent.transforming.forEach((e=>{let n=new t.Matrix;n.rotate(-i,p).scale(c.width,c.height,p).rotate(i,p),e.matrix.append(n),e.onTransform&&e.onTransform("scale",u,o,n)})),this.parent.boundingRect.scale(c.width,c.height,s),this.parent.setBounds(!0)},o[r[0]]=s,o}),{}),this._transformTool.rotationHandle=new t.Shape.Circle(new t.Point(0,0),i/e),this._transformTool.rotationHandle.set({fillColor:"red",strokeColor:"black",rescale:{radius:i}}),this._transformTool.addChild(this._transformTool.rotationHandle),this._transformTool.rotationHandle.onMouseDown=function(t){t.stopPropagation()},this._transformTool.rotationHandle.onMouseDrag=function(t){let e=this.parent.matrix.transform(this.parent.boundingRect.position),i=t.point.subtract(t.delta).subtract(e),o=t.point.subtract(e).angle-i.angle;this.parent.rotate(o,e),this.parent.transforming.forEach((t=>{let i=n.targetMatrix.inverseTransform(e),r=t.layer.tiledImage.getFlip()?-o:o;t.rotate(r,i),t.onTransform&&t.onTransform("rotate",r,i)})),Object.values(this.parent.corners).forEach((t=>{t.refPos=t.refPos.rotate(o,e)}))},this.onMouseDrag=t=>{if(!this._transformTool._moveOnDrag)return;this._transformTool.translate(t.original.delta);const e=t.delta;Object.values(this._transformTool.corners).forEach((e=>{e.refPos=e.refPos.add(t.original.delta)})),this._transformTool.transforming.forEach((t=>{t.translate(e),t.onTransform&&t.onTransform("translate",e)}))},this._transformTool.setBounds=function(e=!1){if(!e){let e=this.transforming.reduce(((t,e)=>(e.transform(n.targetLayer.matrix),t.minX=null===t.minX?e.bounds.topLeft.x:Math.min(t.minX,e.bounds.topLeft.x),t.minY=null===t.minY?e.bounds.topLeft.y:Math.min(t.minY,e.bounds.topLeft.y),t.maxX=null===t.maxX?e.bounds.bottomRight.x:Math.max(t.maxX,e.bounds.bottomRight.x),t.maxY=null===t.maxY?e.bounds.bottomRight.y:Math.max(t.maxY,e.bounds.bottomRight.y),e.transform(n.targetLayer.matrix.inverted()),t)),{minX:null,minY:null,maxX:null,maxY:null}),i=new t.Point(e.minX,e.minY),o=new t.Point(e.maxX,e.maxY),r=new t.Rectangle(i,o);this.matrix.reset(),this.boundingRect.set({position:r.center,size:r.size})}let i=this.boundingRect;this.boundingDisplay.set({position:i.position,size:i.bounds.size}),Object.values(this.corners).forEach((t=>{t.position=i.bounds[t.anchor],e||(t.refPos=t.position)})),this.rotationHandle.set({position:i.position.subtract(new t.Point(0,i.bounds.size.height/2+2*this.rotationHandle.radius))})},this._transformTool.transformItems=function(t){this.transforming.forEach((t=>{t.matrix.apply(!0,!0),t.onTransform&&t.onTransform("complete")})),this.transforming=t,t.forEach((t=>t.applyMatrix=!1)),this.matrix.reset(),this.boundingRect.matrix.reset(),this.boundingDisplay.matrix.reset(),this.setBounds()},this._transformTool.visible=!1}enableTransformToolObject(){this.items.length>0&&(this.project.toolLayer.bringToFront(),this._transformTool.visible=!0,this._transformTool.transformItems(this.items))}disableTransformToolObject(){this.project.toolLayer.sendToBack(),this._transformTool.transformItems([]),this._transformTool.visible=!1}hitTest(t){let e=this.ps.project.hitTest(t,{fill:!0,stroke:!0,segments:!0,tolerance:this.getTolerance(5),match:t=>t.item.isGeoJSONFeature||t.item.parent.isGeoJSONFeature});return e&&!e.item.isGeoJSONFeature&&(e.item=e.item.parent),e}onMouseMove(t){if(!this._active)return;let e=this.project.paperScope.project.hitTest(t.original.point);e?(Object.values(this._transformTool.corners).includes(e.item)?this.project.overlay.addClass("transform-tool-resize"):this.project.overlay.removeClass("transform-tool-resize"),this._transformTool.rotationHandle==e.item?this.project.overlay.addClass("transform-tool-rotate"):this.project.overlay.removeClass("transform-tool-rotate"),[this._transformTool.boundingRect,this._transformTool.boundingDisplay].includes(e.item)?(this.project.overlay.addClass("transform-tool-move"),this._transformTool._moveOnDrag=!0):(this.project.overlay.removeClass("transform-tool-move"),this._transformTool._moveOnDrag=!1)):this.project.overlay.removeClass("transform-tool-resize","transform-tool-rotate","transform-tool-move")}}class At extends b{constructor(t){super(t),this.dropdown.classList.add("transform-dropdown");const e=I("fa-up-down-left-right");this.button.configure(e,"Transform Tool")}isEnabledForMode(t){let e=this.tool.project.paperScope.findSelectedItems();return e.length>0&&["select","multiselection","Polygon","MultiPolygon","Point:Rectangle","Point:Ellipse","LineString","GeometryCollection:Raster"].includes(t)&&1==new Set(e.map((t=>t.layer))).size}}class bt extends A{constructor(t){super(t),this.setToolbarControl(new Ct(this))}rasterize(){let e=this,n=this.item;if(n){let i=this.project.overlay.getViewportRaster();n.layer.addChild(i),i.onLoad=function(){let i=new t.Point(this.width/2,this.height/2),o=new t.Rectangle(i.add(this.matrix.inverseTransform(this.layer.matrix.transform(n.bounds.topLeft))).floor(),i.add(this.matrix.inverseTransform(this.layer.matrix.transform(n.bounds.bottomRight))).ceil()),r=this.getSubRaster(o);r.transform(this.layer.matrix.inverted()),r.selectedColor=null;let s={type:"Feature",geometry:{type:"GeometryCollection",properties:{subtype:"Raster",raster:{data:r}},geometries:[n]},properties:{}};n.replaceWith(t.Item.fromGeoJSON(s)),e.refreshItems(),this.remove()}}}}class Ct extends b{constructor(t){super(t);const e=I("fa-image");this.button.configure(e,"raster Tool");const n=document.createElement("div");this.dropdown.appendChild(n);const i=document.createElement("button");i.innerHTML="Convert to raster",n.appendChild(i);const o=document.createElement("span");o.innerHTML="Warning: this cannot be undone!",n.appendChild(o),i.addEventListener("click",(()=>t.rasterize()))}isEnabledForMode(t){return["Polygon","MultiPolygon","Point:Rectangle","Point:Ellipse"].includes(t)}}class xt{constructor(t,e){if(e&&!Array.isArray(e))throw"Bad option: if present, tools must be an Array of tool names or constructors to use.";this.ui=this._makeUI(),this.paperScope=t,this.currentMode=null,this.setModeTimeout=null;let n=new t.Layer;n.isGeoJSONFeatureCollection=!1,n.name="toolLayer",n.applyMatrix=!1,t.project.addLayer(n),this.toolConstructors={default:T,select:_t,transform:wt,style:P,rectangle:ct,ellipse:dt,point:rt,text:lt,polygon:gt,brush:$,wand:R,linestring:mt,raster:bt},this.tools={};let i=e||Object.keys(this.toolConstructors);-1==i.indexOf("default")&&(i=["default",...i]),this.paperScope.activate(),i.forEach((t=>{if("string"==typeof t){if(!this.toolConstructors[t])return void console.warn(`The requested tool is invalid: ${t}. No constructor found for that name.`)}else if(!(t instanceof y))return void console.warn(`${t} must inherit from class ToolBase`);let e=t instanceof y?t:this.toolConstructors[t],n=this.tools[t]=new e(this.paperScope),i=n.getToolbarControl();i&&this.addToolbarControl(i),n.addEventListener("deactivated",(t=>{t.target==this.paperScope.getActiveTool()&&this.tools.default.activate()}))})),this.tools.default.activate(),this.setMode(),t.project.on({"item-replaced":()=>{this.setMode()},"item-selected":()=>{this.setMode()},"item-deselected":()=>{this.setMode()},"item-removed":()=>{this.setMode()},"items-changed":()=>{this.setMode()}})}get element(){return this._element}setMode(){let t=this;this.setModeTimeout&&clearTimeout(this.setModeTimeout),this.setModeTimeout=setTimeout((()=>{if(this.setModeTimeout=null,!this.paperScope.project)return;let e=this.paperScope.findSelectedItems(),n=this.paperScope.getActiveTool();if(0===e.length)this.currentMode="select";else if(1===e.length){let t=e[0].annotationItem||{},n=t.type;t.subtype&&(n+=":"+t.subtype);let i=null===n?"new":n;this.currentMode=i}else this.currentMode="multiselection";!1===n.getToolbarControl().isEnabledForMode(this.currentMode)&&(n.deactivate(!0),this.tools.default.activate()),Object.values(this.tools).forEach((e=>{let n=e.getToolbarControl();n&&(n.isEnabledForMode(t.currentMode)?n.button.enable():n.button.disable())})),n.selectionChanged()}),0)}addToolbarControl(t){const e=t.button.element,n=t.dropdown;this._buttonbar.appendChild(e),this._dropdowns.appendChild(n),t.isEnabledForMode(this.currentMode)?t.button.enable():t.button.disable()}show(){this.element.style.display="inline-block"}hide(){this.element.style.display="none"}destroy(){this.element.remove()}_makeUI(){this._element=document.createElement("div"),this._buttonbar=document.createElement("div"),this._dropdowns=document.createElement("div");const t=document.createElement("div");this._element.appendChild(this._buttonbar),this._element.appendChild(t),t.appendChild(this._dropdowns),"annotation-ui-drawing-toolbar btn-group btn-group-sm mode-selection".split(" ").forEach((t=>this._element.classList.add(t))),t.classList.add("dropdowns-container"),this._dropdowns.classList.add("dropdowns"),this._buttonbar.classList.add("annotation-ui-buttonbar")}}class It{constructor(t){t=Object.assign({},{initialContent:"Enter text...",iconFactory:null},t),this._element=document.createElement("span"),this._textcontainer=document.createElement("span"),this._textcontainer.classList.add("text-container"),this._element.appendChild(this._textcontainer),this._textcontent=document.createElement("span"),this._textcontent.classList.add("text-content"),this._textcontainer.appendChild(this._textcontent);let e=this._textarea=document.createElement("textarea");this._textcontainer.appendChild(e),e.setAttribute("rows","1"),this._button=document.createElement("span"),this._element.appendChild(this._button),this._oldtext="";let n=t.iconFactory?t.iconFactory.makeFaIcon("fa-edit"):I("fa-edit");this._button.appendChild(n),n.classList.add("edit-button","onhover"),this._element.classList.add("editablecontent"),this._textarea.textContent=t.initialContent,this._textarea.addEventListener("focusout",(()=>{this._element.classList.contains("editing")&&(this._element.classList.remove("editing"),this._updateText(!0))})),this._textarea.addEventListener("keypress",(t=>{this._element.classList.contains("editing")&&(t.stopPropagation(),"Enter"!=t.key&&"Escape"!=t.key||(t.preventDefault(),this._textarea.blur()))})),this._textarea.addEventListener("input",(()=>{this._updateText()})),this._element.addEventListener("keydown keyup",(t=>{this._element.classList.contains("editing")&&t.stopPropagation()})),this._button.addEventListener("click",(t=>{this._onEditClicked&&this._onEditClicked(t),this._element.classList.toggle("editing"),this._oldtext=this._textarea.value.trim(),this._textarea.select()}))}get element(){return this._element}get onChanged(){return this._onChanged}set onChanged(t){if("function"!=typeof t&&null!==t)throw"Value must be a function or null";this._onChanged=t}get onEditClicked(){return this._onEditClicked}set onEditClicked(t){if("function"!=typeof t&&null!==t)throw"Value must be a function or null";this._onEditClicked=t}_updateText(t){let e=this._textarea.value;t&&(e=e.trim()),this._textcontent.textContent=e,e!==this._oldtext&&this.onChanged&&this.onChanged(e)}setText(t){this._textarea.value=t,this._textcontent.textContent=t}}function St(t){const e=document.createElement("template");return e.innerHTML=t,1===e.content.children.length?e.content.children[0]:e.content.children}class Tt{constructor(t,e){this.paperItem=t;let n=this._element=St("\n    <div class='feature'>\n        <div class='annotation-header hoverable-actions'>\n            <span class='onhover fa-solid fa-crop-simple bounding-element' data-action=\"bounds\" title='Bounding element'></span>\n            <span class='feature-item name'></span>\n            <span class='onhover fa-solid fa-palette' data-action='style' title='Open style editor'></span>\n            <span class='onhover fa-solid fa-binoculars' data-action='zoom-to' title='View this feature'></span>\n            <span class='onhover fa-solid fa-trash-can' data-action='trash' title='Remove'></span>\n        </div>\n    </div>\n    ");e.iconFactory?e.iconFactory.convertFaIcons(n):S(n),this.paperItem.FeatureUI=this,this._editableName=new It,n.querySelector(".feature-item.name").appendChild(this._editableName.element),this._editableName.onChanged=t=>{this.setLabel(t,"user-defined")},this._editableName.onEditClicked=function(t){t.preventDefault(),t.stopPropagation()},N.set(n,{feature:this}),n.addEventListener("click",(t=>{if(t.target.matches("[data-action]")){t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault();let e=t.target.dataset.action;switch(e){case"trash":this.removeItem();break;case"bounds":this.useAsBoundingElement(!0);break;case"style":this.openStyleEditor(t);break;case"zoom-to":this.centerItem();break;default:console.log("No function set for action:",e)}}})),n.addEventListener("click",(t=>{t.stopPropagation(),this.paperItem.toggle(t.metaKey||t.ctrlKey)})),this.element=n,this.paperItem.on({selected:()=>{n.classList.add("selected"),n.dispatchEvent(new Event("selected"))},deselected:()=>{n.classList.remove("selected"),n.dispatchEvent(new Event("deselected"))},"selection:mouseenter":()=>{n.classList.add("item-hovered")},"selection:mouseleave":()=>{n.classList.remove("item-hovered")},"item-replaced":t=>{"user-defined"==this.label.source&&(t.item.displayName=this.label),this.paperItem=t.item,this.paperItem.FeatureUI=this,this.updateLabel()},"display-name-changed":t=>{this.updateLabel()},removed:t=>{t.item==this.paperItem&&this.remove()}}),this.paperItem.selected&&this.paperItem.emit("selected"),this.label?this.updateLabel():this.setLabel("Creating...","initializing")}get label(){return this.paperItem.displayName}set label(t){return this.setLabel(t)}setLabel(t,e){let n=new String(t);return n.source=e,this.paperItem.displayName=n,this.updateLabel(),n}updateLabel(){this._editableName.setText(this.label)}removeItem(){this.paperItem.remove(),this.paperItem.deselect()}remove(){this._element.remove(),this._element.dispatchEvent(new Event("removed"))}useAsBoundingElement(t=!1){if(!this.paperItem.canBeBoundingElement)return!1;let e=this._element.querySelector('[data-action="bounds"]');t?e.classList.toggle("active"):e.classList.add("active");let n=e.classList.contains("active");return this.paperItem.isBoundingElement=n,n}openStyleEditor(){this.paperItem.project.emit("edit-style",{item:this.paperItem})||console.warn("No event listeners are registered for paperScope.project for event 'edit-style'")}centerItem(t=!1){let e=this.paperItem.project.overlay.viewer.viewport,n=this.paperItem.bounds,i=e.imageToViewportCoordinates(n.center.x,n.center.y),o=1.5,r=e.imageToViewportCoordinates(n.center.x-n.width/o,n.center.y-n.height/o),s=e.imageToViewportCoordinates(2*n.width/o,2*n.height/o),a=new OpenSeadragon.Rect(r.x,r.y,s.x,s.y),l=e.getBounds();a.width>l.width||a.height>l.height?e.fitBounds(a,t):e.panTo(i,t)}}class kt{constructor(t){t.parent?t.selector?t.dropTarget?(this.element=t.parent,this.selector=t.selector,this.droptarget=t.dropTarget,this.onDrop=t.onDrop,this.placeholder=null,this.dragging=null,this.refresh(),this.droptarget.addEventListener("dragover",(t=>(t.preventDefault(),!1))),this.droptarget.addEventListener("dragleave",(t=>(t.preventDefault(),!1))),this.droptarget.addEventListener("dragend",(t=>{if(this.dragging)return t.preventDefault(),this.cleanupDropTarget(),!1})),this.element.addEventListener("dragstart",(t=>{t.target.matches(this.selector)&&(t.stopPropagation(),this.dragging=t.target,this.placeholder=t.target.cloneNode(!0),this.placeholder.classList.add("draganddrop-placeholder"),t.target.classList.add("draganddrop-dragging"),this.setupDropTarget())})),this.element.addEventListener("dragend",(t=>{t.target.matches(this.selector)&&(t.stopPropagation(),t.target.classList.remove("draganddrop-dragging","draganddrop-hide"),this.placeholder&&this.placeholder.remove(),this.placeholder=null,this.dragging=null,this.cleanupDropTarget())})),this.element.addEventListener("dragleave",(t=>{t.target.matches(this.selector)&&t.stopPropagation()})),this.element.addEventListener("drop",(t=>{this.dragging&&this.placeholder.parentNode==this.droptarget&&(t.stopPropagation(),this.placeholder.replaceWith(this.dragging),this.dragging=null,this.placeholder=null,this.onDrop&&this.onDrop())})),this.element.addEventListener("dragover",(t=>{if(this.dragging)if(t.preventDefault(),this.dragging.classList.add("draganddrop-hide"),t.target.matches(this.selector)){t.stopPropagation();let e=t.target.getBoundingClientRect().top,n=t.target.getBoundingClientRect().bottom;if(this.placeholder==t.target)return;t.clientY<(e+n)/2?t.target.parentNode.insertBefore(this.placeholder,t.target):t.target.parentNode.insertBefore(this.placeholder,t.target.nextSibling)}else t.target==this.element&&(this.droptarget.appendChild(this.placeholder),t.stopPropagation())}))):console.error("droptarget is required"):console.error("selector is required"):console.error("element is required")}refresh(){this.element.querySelectorAll(this.selector).forEach((t=>{t.setAttribute("draggable",!0)}))}setupDropTarget(){this.droptarget.classList.add("draganddrop-drop-target")}cleanupDropTarget(){this.droptarget.classList.remove("draganddrop-drop-target")}}class Pt extends Q{constructor(e){super({type:"Feature",geometry:null}),this.paperItem=new t.Path,this.paperItem.style=new t.Style(e),this.paperItem.initializeGeoJSONFeature=Et}static supportsGeoJSONType(t,e=null){return null===t.toLowerCase()&&null===e}getGeoJSONType(){return{type:null}}getCoordinates(){return[]}getProperties(){return this.paperItem.style}}function Et(e,n){let i={geometry:{type:e,coordinates:[],properties:{subtype:n}},properties:this.style},o=t.Item.fromGeoJSON(i);return this.replaceWith(o),o}class Ot{constructor(e,n){return this.element=St("\n    <div class='feature-collection'>\n        <div class='annotation-header hoverable-actions'>\n            <span class=\"visibility-toggle\"><span class=\"fa fa-eye\" data-action=\"hide\"></span><span class=\"fa fa-eye-slash\" data-action=\"show\"></span></span>\n            <span class='annotation-name name'></span>\n            <span class='onhover fa-solid fa-palette' data-action='style' title='Open style editor'></span>\n            <span class='onhover fa-solid fa-trash-can' data-action='trash' title='Remove feature collection'></span>\n        </div>\n        <div class=\"flex-row features\">\n            <div class=\"toggle-list btn-group btn-group-sm\"><button class=\"btn btn-default\"><span class='fa-solid fa-caret-down' data-action=\"collapse-down\"></span><span class='fa-solid fa-caret-up' data-action=\"collapse-up\"></span></button></div>\n            <div class=\"annotation-details\">\n                <div>\n                    <div class='features-summary feature-item name'><span class='num-annotations'></span> annotation element<span class='pluralize'></span></div>\n                    <div class='features-list'></div>\n                </div>\n                <div class='new-feature feature'><span class='fa fa-plus' data-action=\"add-feature\"></span>Add feature</div>\n            </div>\n        </div>\n    </div>\n    "),n.iconFactory?n.iconFactory.convertFaIcons(this.element):S(this.element),this._editableName=new It({iconFactory:n.iconFactory}),this.element.querySelector(".annotation-name.name").appendChild(this._editableName.element),this._editableName.onChanged=t=>{this.label=t},this._editableName.onEditClicked=t=>{t.preventDefault(),t.stopPropagation()},this._featurelist=this.element.querySelector(".features-list"),this._dragAndDrop=new kt({parent:this.element,selector:".features-list .feature",dropTarget:this._featurelist,onDrop:()=>{this.features.forEach((t=>this.group.addChild(t.paperItem)))}}),this.group=e,this.group.on({"selection:mouseenter":()=>{this.element.classList.add("svg-hovered"),this.element.dispatchEvent(new Event("mouseover"))},"selection:mouseleave":()=>{this.element.classList.remove("svg-hovered"),this.element.dispatchEvent(new Event("mouseout"))},selected:()=>{this.element.classList.add("selected"),this.element.dispatchEvent(new Event("selected"))},deselected:()=>{this.element.classList.remove("selected"),this.element.dispatchEvent(new Event("deselected"))},"display-name-changed":()=>{this.updateLabel()},removed:()=>{this.remove()},"child-added":t=>{let e=t.item.FeatureUI||new Tt(t.item,n);this._addFeature(e)}}),this.group.featureCollectionUI=this,this.remove=()=>{this.element.remove()},this.numFeatures=()=>this.features.length,this._addFeature=t=>(t.paperItem.updateFillOpacity(),this._featurelist.appendChild(t.element),this._sortableDebounce&&window.clearTimeout(this._sortableDebounce),self._sortableDebounce=window.setTimeout((()=>this._dragAndDrop.refresh()),15),t.element),this.createFeature=function(){let e=this.group.defaultStyle,n={fillColor:new t.Color(e.fillColor),strokeColor:new t.Color(e.strokeColor),rescale:OpenSeadragon.extend(!0,{},e.rescale),fillOpacity:e.fillOpacity,strokeOpacity:e.strokeOpacity,strokeWidth:e.strokeWidth},i=new Pt(n);return this.group.addChild(i.paperItem),i.paperItem},this.ui={setOpacity:t=>{this.group.opacity=t},setFillOpacity:t=>{this.group.fillOpacity=t}},N.set(this.element,{featureCollection:this}),this.label=this.group.displayName,this.element.addEventListener("click",(t=>{t.stopPropagation()})),this.element.querySelector(".toggle-list").addEventListener("click",(t=>{let e=this._featurelist.children.length;this.element.querySelector(".num-annotations").textContent=e,this.element.querySelector(".features-summary").dataset.numElements=e,this.element.querySelector(".features").classList.toggle("collapsed"),t.stopPropagation(),t.preventDefault()})),this.element.addEventListener("click",(t=>{if(t.target.matches(".annotation-header [data-action]")){t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault();let e=t.target.dataset.action;switch(e){case"trash":this.removeLayer(!0);break;case"style":this.openStyleEditor(t);break;case"show":case"hide":this.toggleVisibility();break;default:console.log("No function set for action:",e)}}})),this.element.querySelector(".new-feature").addEventListener("click",(t=>{t.stopPropagation(),this.createFeature().select()})),this}get features(){return Array.from(this._featurelist.querySelectorAll(".feature")).map((t=>N.get(t,"feature")))}get label(){return this.group.displayName}set label(t){return this.setLabel(t)}setLabel(t,e){let n=new String(t);return n.source=e,this.group.displayName=n,this.updateLabel(),n}updateLabel(){this._editableName.setText(this.label)}toggleVisibility(){this.element.classList.toggle("annotation-hidden"),this.group.visible=!this.element.classList.contains("annotation-hidden")}removeLayer(t=!0){t&&1==window.confirm("Remove this layer?")&&this.group.remove()}openStyleEditor(t){this.group.project.emit("edit-style",{item:this.group})||console.warn("No event listeners are registered for paperScope.project for event 'edit-style'")}}class Bt extends OpenSeadragon.EventSource{constructor(t,e){super();let n=this;this._tk=t,this.paperScope=this._tk.paperScope,this.paperScope.project.on("feature-collection-added",(t=>this._onFeatureCollectionAdded(t))),this.element=function(){let t=St('\n        <div class="annotation-ui-mainwindow" title="Annotations">\n            <div><span class=\'fa-save\'></span> <span class="annotation-ui-title">Annotation Interface</span></div>\n            <div class=\'annotation-ui-toolbar annotation-visibility-controls\'>                \n                <div class="visibility-buttons btn-group btn-group-sm disable-when-deactivated" role="group">\n                    <button class="btn btn-default toggle-annotations" type="button" title="Toggle annotations">\n                        <span class="glyphicon glyphicon-eye-open fa fa-eye"></span><span class="glyphicon glyphicon-eye-close fa fa-eye-slash"></span>\n                    </button>\n                </div>\n                <span class="annotation-opacity-container disable-when-annotations-hidden" title="Change total opacity">\n                    <input class="annotation-total-opacity" type="range" min="0" max="1" step="0.01" value="1">\n                </span>\n                <span class="annotation-opacity-container disable-when-annotations-hidden" title="Change fill opacity">\n                    <input class="annotation-fill-opacity" type="range" min="0" max="1" step="0.01" value="0.25">\n                </span>\n            </div>\n            <div class=\'annotation-ui-feature-collections disable-when-annotations-hidden disable-when-deactivated\'></div>\n            <div class=\'new-feature-collection disable-when-deactivated\'><span class=\'glyphicon glyphicon-plus fa fa-plus\'></span>Add Feature Collection</div>\n            <div class=\'icon-factory-container\'></div>\n        </div>'),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}));return t.dataset.uiId=e,t}(),this.iconFactory=new x(this.element.querySelector(".icon-factory-container")),this.iconFactory.convertFaIcons(this.element),this.element.querySelector(".new-feature-collection").addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault(),this._tk.addEmptyFeatureCollectionGroup()})),this.element.querySelector(".annotation-ui-feature-collections").addEventListener("click",(function(){0===this.textContent.trim().length&&n._tk.addEmptyFeatureCollectionGroup()})),this.element.querySelector(".toggle-annotations").addEventListener("click",(()=>{let t=this.element.querySelectorAll(".annotation-ui-feature-collections .feature-collection.annotation-hidden");t.length>0?t.forEach((t=>{t.querySelectorAll('[data-action="show"]').forEach((t=>t.dispatchEvent(new Event("click",{bubbles:!0}))))})):this.element.querySelectorAll('.annotation-ui-feature-collections .feature-collection:not(.hidden) [data-action="hide"]').forEach((t=>t.dispatchEvent(new Event("click",{bubbles:!0}))))})),this._dragAndDrop=new kt({parent:this.element,selector:".feature-collection",dropTarget:this.element.querySelector(".annotation-ui-feature-collections"),onDrop:()=>{this.element.querySelectorAll(".annotation-ui-feature-collections .feature-collection").forEach((t=>{N.get(t,"featureCollection").group.bringToFront()}))}}),this.element.addEventListener("selected",(function(t){t.target.matches(".feature")&&(t.stopPropagation(),this.classList.add("selected"),this.scrollIntoView({block:"nearest"}))})),this.element.addEventListener("deselected",(function(t){t.target.matches(".feature")&&(t.stopPropagation(),this.classList.remove("selected"))})),this.element.addEventListener("click",(function(t){t.target.matches(".toggle-list")&&(this.closest(".features").classList.toggle("collapsed"),t.stopPropagation())})),this.element.addEventListener("value-changed",(()=>{this.element.querySelector(".feature.selected").dispatchEvent(new Event("selected")),this.element.querySelector(".feature-collection.active").dispatchEvent(new Event("selected"))}));const i=this.element.querySelector("input.annotation-total-opacity");i.addEventListener("input",(function(){!function(t){let e=Array.from(n.element.querySelectorAll(".feature-collection")).reduce((function(t,e){return e.classList.contains("selected")?t.selected.push(e):e.matches(":hover,.svg-hovered")?t.hover.push(e):t.other.push(e),t}),{selected:[],hover:[],other:[]});e.selected.length>0?(e.selected.forEach((function(e){let n=1*t,i=N.get(e,"featureCollection");i&&i.ui.setOpacity(n)})),e.hover.concat(e.other).forEach((function(e){let n=.25*t,i=N.get(e,"featureCollection");i&&i.ui.setOpacity(n)}))):e.hover.length>0?(e.hover.forEach((function(e){let n=1*t,i=N.get(e,"featureCollection");i&&i.ui.setOpacity(n)})),e.other.forEach((function(e){let n=.25*t,i=N.get(e,"featureCollection");i&&i.ui.setOpacity(n)}))):e.other.forEach((function(e){let n=1*t,i=N.get(e,"featureCollection");i&&i.ui.setOpacity(n)}))}(this.value)})),i.dispatchEvent(new Event("input"));const o=this.element.querySelector("input.annotation-fill-opacity");o.addEventListener("input",(function(){n.paperScope.view.fillOpacity=this.value})),o.dispatchEvent(new Event("input"))}hide(){this.element.classList.add("hidden"),this.raiseEvent("hide")}show(){this.element.classList.remove("hidden"),this.raiseEvent("show")}toggle(){this.element.matches(":visible")?this.hide():this.show()}deactivate(){this.element.classList.add("deactivated")}activate(){this.element.classList.remove("deactivated")}destroy(){this.raiseEvent("destroy"),this.element.remove()}_onFeatureCollectionAdded(t){let e=t.group,n=new Ot(e,{iconFactory:this.iconFactory});this.element.querySelector(".annotation-ui-feature-collections").appendChild(n.element),this._dragAndDrop.refresh(),n.element.dispatchEvent(new Event("element-added")),setTimeout((function(){n.element.classList.add("inserted")}),30)}}class Lt{constructor({innerHTML:t,title:e}){const n=document.createElement("div");document.querySelector("body").appendChild(n),n.style.position="fixed",n.style.width="100vw",n.style.height="100vh",n.style.left=0,n.style.top=0;const i=document.createElement("div");n.appendChild(i),i.style.backgroundColor="gray",i.style.opacity=.9,i.style.width="100%",i.style.height="100%",i.style.position="absolute";const o=document.createElement("div");o.classList.add("ui-dialog"),n.appendChild(o),o.style.setProperty("max-height","80%"),o.style.setProperty("max-width","80%"),o.style.left="50%",o.style.top="50%",o.style.transform="translate(-50%, -50%)",o.style.overflow="auto",o.style.position="relative",o.style.backgroundColor="white",o.style.display="inline-block",o.style.padding="2px",o.style.borderRadius="2px";const r=document.createElement("div");o.appendChild(r),r.style.padding="0.3em 0.6em",r.style.backgroundColor="rgb(233, 233, 233)",r.style.borderColor="rgb(220, 220, 220)",r.style.borderRadius="2px",r.style.display="flex";const s=document.createElement("label");r.appendChild(s),s.innerText=e,s.style.fontWeight="bold",s.style.flexGrow=1;const a=document.createElement("button");a.innerText="x",a.style.marginLeft="1em",r.appendChild(a),a.addEventListener("click",(()=>this.hide()));const l=document.createElement("div");o.appendChild(l),l.innerHTML=t,i.addEventListener("click",(()=>this.hide())),this.element=n,this.container=l,this.background=i,this.foreground=o,this.topbar=r,this.hide()}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}toggle(){"none"===this.element.style.display?this.show():this.hide()}}class Mt{constructor(e,n){let i=this;function o(t){let n=e.viewer.world.getItemAt(0)?.source.name||"";return n.length>0&&(n+=t),n}function r(){i.element.querySelector(".featurecollection-list")?.replaceChildren(),i.element.querySelector(".finalize")?.replaceChildren()}function s(t){let e=i.element.querySelector(".featurecollection-list");return e.replaceChildren(),t.forEach((t=>{let n=t.label||t.displayName;const i=document.createElement("div");e.appendChild(i);const o=document.createElement("input");i.appendChild(o),o.setAttribute("type","checkbox"),o.setAttribute("checked","true"),N.set(o,"fc",t);const r=document.createElement("label");r.innerText=n,i.appendChild(r)})),e}function a(t,e,n,o){function r(t,e,n){t&&(Object.keys(localStorage).includes(e)?n.classList.add("key-exists"):n.classList.remove("key-exists"))}const s=i.element.querySelector(".finalize"),a=document.createElement("button");let l;if(a.innerText=t,s.appendChild(a),e){const t=document.createElement("div"),i=document.createElement("div");t.appendChild(i),s.appendChild(t),i.innerText=e,l=new It,l.setText(n),t.appendChild(l.element),o&&t.classList.add("localstorage-key-test"),l.onChanged=e=>{a.setAttribute("data-label",e),r(o,e,t)},r(o,n,t)}return s.appendChild(a),a.setAttribute("data-label",n),a}this.dialog=new Lt({innerHTML:"\n                <div class=\"annotation-ui-filedialog\" title=\"Save and Load Feature Collections\">\n                    <div class=\"file-actions\">\n                        <div class='header'>1. Available actions</div>\n                        <button class='btn' data-action='geojson-load'>Load GeoJSON</button>\n                        <button class='btn' data-action='ls-load'>Load from browser</button>\n                        <hr>\n                        <button class='btn' data-action='geojson-save'>Save GeoJSON</button>\n                        <button class='btn' data-action='svg-export'>Export as SVG</button>\n                        <button class='btn' data-action='png-export'>Rasterize to PNG</button>\n                        <button class='btn' data-action='ls-store'>Store in browser</button>\n                    </div>\n                    <div class='featurecollection-selection'>\n                        <div class='header'>2. Select Feature Collections</div>\n                        <div class='featurecollection-list'></div>\n                    </div>\n                    <div class=\"finalize-panel\">\n                        <div class='header'>3. Finalize</div>\n                        <div class='finalize'>\n                        \n                        </div>\n                    </div>\n                </div>",title:""}),this.element=this.dialog.container,this.element.querySelector('button[data-action="geojson-load"]').addEventListener("click",(function(){r();const t=document.createElement("input");t.type="file",t.accept="text/geojson,.geojson,text/json,.json",t.addEventListener("change",(function(){let t=this.files[0],n=new FileReader,o=[];n.onload=function(){try{o=JSON.parse(this.result)}catch(t){return void alert("Bad file - JSON could not be parsed")}Array.isArray(o)||(o=[o]);let n=Array.from(new Set(o.map((t=>t.type))));if(0==n.length&&i.element.find(".featurecollection-list").text("Bad file - no Features or FeatureCollections were found"),n.length>1)return void alert("Bad file - valid geoJSON consists of an array of objects with single type (FeatureCollection or Feature)");if("Feature"==n[0]){let e=[{type:"FeatureCollection",features:o,properties:{label:t.name}}];o=e}s(o);const r=document.createElement("button");i.element.querySelector(".finalize").appendChild(r),r.innerText="Replace existing layers",r.addEventListener("click",(()=>e.addFeatureCollections(o,!0)));const a=document.createElement("button");i.element.querySelector(".finalize").appendChild(a),a.innerText="Add new layers",a.addEventListener("click",(()=>e.addFeatureCollections(o,!1)))},n.readAsText(t)})),t.click()})),this.element.querySelector('button[data-action="geojson-save"]').addEventListener("click",(function(){r();let t=s(e.toGeoJSON());a("Create file","Choose file name:",o("-")+"FeatureCollections.json").addEventListener("click",(function(){this.parentElement.querySelector(".download-link")?.remove();let e=Array.from(t.querySelectorAll("input:checked")).map((t=>N.get(t,"fc"))),n=JSON.stringify(e),i=new Blob([n],{type:"text/json"}),o=this.getAttribute("data-label");const r=document.createElement("div");r.classList.add("download-link"),this.parentElement.insertBefore(r,this.nextSibling);const s=document.createElement("a");s.href=window.URL.createObjectURL(i),s.download=o,s.target="_blank",s.innerText="Download file",r.appendChild(s)}))})),this.element.querySelector('button[data-action="svg-export"]').addEventListener("click",(function(){r();let n=s(e.getFeatureCollectionGroups());a("Create file","Choose file name:",o("-")+"FeatureCollections.svg").addEventListener("click",(function(){this.parentElement.querySelector(".download-link")?.remove();let e=Array.from(n.querySelectorAll("input:checked")).map((function(t){return N.get(t,"fc")}));if(e.length>0){let n=new t.PaperScope;n.setup(),e.forEach((function(t){n.project.activeLayer.addChildren(t.layer.clone({insert:!1,deep:!0}).children)}));let i=new Blob([n.project.exportSVG({asString:!0,bounds:"content"})],{type:"text/svg"}),o=this.getAttribute("data-label");const r=document.createElement("div");r.classList.add("download-link"),this.parentElement.insertBefore(r,this.nextSibling);const s=document.createElement("a");s.href=window.URL.createObjectURL(i),s.download=o,s.target="_blank",s.innerText="Download file",r.appendChild(s)}}))})),this.element.querySelector('button[data-action="png-export"]').addEventListener("click",(function(){r();let n=s(e.getFeatureCollectionGroups());a("Create file","Choose file name:",o("-")+"raster.png").addEventListener("click",(function(){this.parentElement.querySelector(".download-link")?.remove();let e=Array.from(n.querySelectorAll("input:checked")).map((function(t){return N.get(t,"fc")}));if(e.length>0){let n=new t.PaperScope;n.setup(),e.forEach((function(t){n.project.activeLayer.addChildren(t.layer.clone({insert:!1,deep:!0}).children)}));let i=this.getAttribute("data-label");const o=document.createElement("div");o.classList.add("download-link"),this.parentElement.insertBefore(o,this.nextSibling);const r=document.createElement("a");r.href=n.project.activeLayer.rasterize({insert:!1}).toDataURL(),r.download=i,r.target="_blank",r.innerText="Download file",o.appendChild(r)}}))})),this.element.querySelector('button[data-action="ls-store"]').addEventListener("click",(function(){r();let t=s(e.toGeoJSON());a("Save data","Local storage key:",o(),!0).addEventListener("click",(function(){let e=Array.from(t.querySelectorAll("input:checked")).map((function(t){return N.get(t,"fc")})),n=JSON.stringify(e),i=this.getAttribute("data-label");window.localStorage.setItem(i,n)}))})),this.element.querySelector('button[data-action="ls-load"]').addEventListener("click",(function(){r();let t=[],n=o(),a=Object.keys(window.localStorage),l=i.element.querySelector(".featurecollection-list");l.innerText="";const h=document.createElement("div");h.classList.add("localstorage-key-list"),l.appendChild(h),a.sort(((t,e)=>t.localeCompare(e))).forEach((t=>{const e=document.createElement("div");e.classList.add("localstorage-key"),e.style.order=t==n?0:1,e.innerText=t,h.appendChild(e)})),h.querySelectorAll(".localstorage-key").forEach((n=>n.addEventListener("click",(function(){let n=window.localStorage.getItem(this.textContent);if(!n)return void alert(`No data found in local storage for key=${this.textContent}`);try{t=JSON.parse(n)}catch(t){return void alert("Bad data - JSON could not be parsed")}s(t);const o=document.createElement("button");o.innerText="Replace existing layers",o.addEventListener("click",(()=>e.addFeatureCollections(t,!0))),i.element.querySelector(".finalize").appendChild(o);const r=document.createElement("button");r.innerText="Add new layers",r.addEventListener("click",(()=>e.addFeatureCollections(t,!1))),i.element.querySelector(".finalize").appendChild(r)}))))}))}show(){this.dialog.show()}hide(){this.dialog.hide()}toggle(){this.dialog.toggle()}}class Nt{constructor(t,e){e=this.options=Object.assign({autoOpen:!0,featureCollections:[],addButton:!0,addToolbar:!0,tools:null,addLayerUI:!0,addFileButton:!0,buttonTogglesToolbar:!0,buttonTogglesLayerUI:!0},e);let n=this._viewer=t.viewer;this._isOpen=!!e.autoOpen,e.addToolbar&&(this._toolbar=new xt(t.overlay.paperScope,e.tools)),this._fileDialog=new Mt(t,{appendTo:n.element}),this._filebutton=null,e.addFileButton&&(this._filebutton=t.overlay.addViewerButton({onClick:()=>{this._fileDialog.toggle()},faIconClass:"fa-save",tooltip:"Save/Load Annotations"})),e.addLayerUI&&(this._layerUI=new Bt(t,e.addFileButton)),this._addToViewer(),e.autoOpen?(this._layerUI?.show(),this._toolbar?.show()):(this._layerUI?.hide(),this._toolbar?.hide()),this._button=null,e.addButton&&(this._button=t.overlay.addViewerButton({onClick:()=>{this._isOpen=!this._isOpen,this._isOpen?(this.options.buttonTogglesToolbar&&this._toolbar.show(),this.options.buttonTogglesLayerUI&&this._layerUI.show()):(this.options.buttonTogglesToolbar&&this._toolbar.hide(),this.options.buttonTogglesLayerUI&&this._layerUI.hide())},faIconClass:"fa-pencil",tooltip:"Annotation Interface"})),e.featureCollections&&t.loadGeoJSON(e.featureCollections)}destroy(){if(this._layerUI.destroy(),this._toolbar.destroy(),this._button){let t=this._viewer.buttonGroup.buttons.indexOf(this._button);t>-1&&this._viewer.buttonGroup.buttons.splice(t,1),this._button.element.remove()}if(this._filebutton){let t=this._viewer.buttonGroup.buttons.indexOf(this._filebutton);t>-1&&this._viewer.buttonGroup.buttons.splice(t,1),this._filebutton.element.remove()}}showUI(){this.ui.show()}hideUI(){this.ui.hide()}showToolbar(){this.toolbar.show()}hideToolbar(){this.toolbar.hide()}get ui(){return this._layerUI}get toolbar(){return this._toolbar}get element(){return this._layerUI.element}_addToViewer(){const t=document.createElement("div");this._viewer.element.appendChild(t);const e=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div"),a={"annotation-ui-grid":t,top:e,bottom:n,center:i,left:o,right:r,"resize-right":s};Object.entries(a).forEach((([t,e])=>e.classList.add(t))),[i,r,o,e,n].forEach((e=>t.appendChild(e))),i.appendChild(this._viewer.container),r.appendChild(s),r.appendChild(this.element),e.appendChild(this._toolbar.element);const l=this.element,h=document.querySelector("body");let c;function u(t){if(s.classList.contains("resizing")){if(t.movementX){const e=l.getBoundingClientRect();l.style.width=e.right-t.x-c+"px"}t.preventDefault()}}function d(t){document.removeEventListener("mousemove",u),document.removeEventListener("mouseleave",d),document.removeEventListener("mouseup",d),h.classList.remove(".annotation-ui-noselect"),s.classList.remove("resizing")}s.addEventListener("mousedown",(function(t){this.classList.add("resizing"),h.classList.add(".annotation-ui-noselect"),document.addEventListener("mousemove",u),document.addEventListener("mouseleave",d),document.addEventListener("mouseup",d),c=l.getBoundingClientRect().left-t.x}))}}function Rt(){this._computedFillOpacity=this.hierarchy.filter((t=>"fillOpacity"in t&&(t._multiplyOpacity||t==this))).reduce(((t,e)=>t*e.fillOpacity),1),this.fillColor&&(this.fillColor.alpha=this._computedFillOpacity)}t.View.prototype.getZoom=function(){var t=this._decompose().scaling;return(Math.abs(t.x)+Math.abs(t.y))/2},t.CanvasView.prototype._setElementSize.base=function(t,e){var n=this._element;t=Math.round(t),e=Math.round(e),n&&(n.width!==t&&(n.width=t),n.height!==e&&(n.height=e))},t.View.prototype.setRotation=function(t,e){let n=t-(this._rotation||0);this.rotate(n,e),this._rotation=OpenSeadragon.positiveModulo(t,360),this.emit("rotate",{rotatedBy:n,currentRotation:this._rotation,center:e})},t.View.prototype.setFlipped=function(t,e){t!==this.getFlipped()&&(this.rotate(-e),this.scale(-1,1),this.rotate(e),this.emit("flip",{flipped:t}))},t.View.prototype.getFlipped=function(t){return this.scaling.x*this.scaling.y<0},Object.defineProperty(t.Item.prototype,"hierarchy",{get:function(){return this.parent?this.parent.hierarchy.concat(this):this.project?this.project.hierarchy.concat(this):[this.view,this]}}),Object.defineProperty(t.Item.prototype,"descendants",{get:function(){return(this.children?this.children.map((t=>t.descendants)).flat():[]).concat(this.isGeoJSONFeature?[this]:[])}}),Object.defineProperty(t.Item.prototype,"fillOpacity",{set:function(t){(this.style||this.defaultStyle).fillOpacity=t,this.descendants.forEach((t=>t.updateFillOpacity()))},get:function(){return(this.style||this.defaultStyle).fillOpacity}}),Object.defineProperty(t.Item.prototype,"strokeOpacity",{set:function(t){(this.style||this.defaultStyle).strokeOpacity=t,this.descendants.forEach((t=>t.updateStrokeOpacity()))},get:function(){return(this.style||this.defaultStyle).strokeOpacity}}),Object.defineProperty(t.Item.prototype,"rescale",{set:function(t){this._style.rescale=t},get:function(){return this._style.rescale}}),Object.defineProperty(t.Item.prototype,"stroke",{get:function(){return this._stroke},set:function(t){this._stroke=t,this.strokeWidth=t/(this.view.getZoom()*this.hierarchy.filter((t=>t.tiledImage))[0].scaling.x)}}),Object.defineProperty(t.Style.prototype,"fillOpacity",{set:function(t){this._fillOpacity=this._values.fillOpacity=t},get:function(){return void 0===this._fillOpacity?1:this._fillOpacity}}),Object.defineProperty(t.Style.prototype,"strokeOpacity",{set:function(t){this._strokeOpacity=this._values.strokeOpacity=t},get:function(){return void 0===this._strokeOpacity?1:this._strokeOpacity}}),Object.defineProperty(t.Style.prototype,"rescale",{set:function(t){this._rescale=this._values.rescale=t},get:function(){return this._rescale}}),Object.defineProperty(t.CompoundPath.prototype,"descendants",{get:function(){return[this]}}),Object.defineProperty(t.Project.prototype,"hierarchy",{get:function(){return this.parent?this.parent.hierarchy.concat(this):this.project?this.project.hierarchy.concat(this):[this.view,this]}}),Object.defineProperty(t.Project.prototype,"fillOpacity",{set:function(t){(this.style||this.defaultStyle).fillOpacity=t,this.descendants.forEach((t=>t.updateFillOpacity()))},get:function(){return(this.style||this.defaultStyle).fillOpacity}}),Object.defineProperty(t.View.prototype,"fillOpacity",{set:function(t){this._fillOpacity=t,this._project.descendants.forEach((t=>t.updateFillOpacity()))},get:function(){return this._fillOpacity}}),Object.defineProperty(t.View.prototype,"_fillOpacity",{value:1,writable:!0}),Object.defineProperty(t.Project.prototype,"strokeOpacity",{set:function(t){(this.style||this.defaultStyle).strokeOpacity=t,this.descendants.forEach((t=>t.updateStrokeOpacity()))},get:function(){return(this.style||this.defaultStyle).strokeOpacity}}),t.Item.prototype.updateFillOpacity=Rt,t.Item.prototype.updateStrokeOpacity=function(){this.strokeColor&&(this.strokeColor.alpha=this.hierarchy.filter((t=>"strokeOpacity"in t&&(t._multiplyOpacity||t==this))).reduce(((t,e)=>t*e.strokeOpacity),1))},t.Project.prototype.updateFillOpacity=Rt,t.View.prototype._multiplyOpacity=!0,t.Style.prototype.set=function(e){var n=e instanceof t.Style,i=n?e._values:e;if(i)for(var o in i)if(o in this._defaults||t.Style.prototype.hasOwnProperty(o)){var r=i[o];this[o]=r&&n&&r.clone?r.clone():r}},t.Item.prototype.applyRescale=function(){let t=this,e=t.rescale;if(e){let n=t.view.scaling.x*t.layer.scaling.x;Object.keys(e).forEach((function(i){"function"==typeof e[i]?t[i]=e[i](n):Array.isArray(e[i])?t[i]=e[i].map((function(t){return t/n})):t[i]=e[i]/n}))}},t.PathItem.prototype.isClockwise=function(){return this.getArea()>=-1e-8},Object.defineProperty(t.PathItem.prototype,"clockwise",{get:function(){return this.isClockwise()}});var Ft={findItemBoundsCollisions:function(t,e,n){function i(t){for(var e=new Array(t.length),n=0;n<t.length;n++){var i=t[n].getBounds();e[n]=[i.left,i.top,i.right,i.bottom]}return e}var o=i(t),r=e&&e!==t?i(e):o;return this.findBoundsCollisions(o,r,n||0)},findCurveBoundsCollisions:function(t,e,n,i){function o(t){for(var e=Math.min,n=Math.max,i=new Array(t.length),o=0;o<t.length;o++){var r=t[o];i[o]=[e(r[0],r[2],r[4],r[6]),e(r[1],r[3],r[5],r[7]),n(r[0],r[2],r[4],r[6]),n(r[1],r[3],r[5],r[7])]}return i}var r=o(t),s=e&&e!==t?o(e):r;if(i){for(var a=this.findBoundsCollisions(r,s,n||0,!1,!0),l=this.findBoundsCollisions(r,s,n||0,!0,!0),h=[],c=0,u=a.length;c<u;c++)h[c]={hor:a[c],ver:l[c]};return h}return this.findBoundsCollisions(r,s,n||0)},findBoundsCollisions:function(t,e,n,i,o){var r=!e||t===e,s=r?t:t.concat(e),a=t.length,l=s.length;function h(t,e,n){for(var i=0,o=t.length;i<o;){var r=o+i>>>1;s[t[r]][e]<n?i=r+1:o=r}return i-1}for(var c=i?1:0,u=c+2,d=i?0:1,p=d+2,g=new Array(l),f=0;f<l;f++)g[f]=f;g.sort((function(t,e){return s[t][c]-s[e][c]}));var m=[],v=new Array(a);for(f=0;f<l;f++){var _=g[f],y=s[_],w=r?_:_-a,A=_<a,b=r||!A,C=A?[]:null;if(m.length){var x=h(m,u,y[c]-n)+1;if(m.splice(0,x),r&&o){C=C.concat(m);for(var I=0;I<m.length;I++)v[k=m[I]].push(w)}else{var S=y[p],T=y[d];for(I=0;I<m.length;I++){var k=m[I],P=s[k],E=k<a,O=r||k>=a;(o||(A&&O||b&&E)&&S>=P[d]-n&&T<=P[p]+n)&&(A&&O&&C.push(r?k:k-a),b&&E&&v[k].push(w))}}}if(A&&(t===e&&C.push(_),v[_]=C),m.length){var B=h(m,u,y[u]);m.splice(B+1,0,_)}else m.push(_)}for(f=0;f<v.length;f++){var L=v[f];L&&L.sort((function(t,e){return t-e}))}return v}};const jt=t.PathItem,zt=t.Path,Dt=t.CompoundPath,Ht=t.Base,Gt=t.Item,Vt=t.Segment,qt=t.Curve,Ut=t.CurveLocation,Wt=t.Numerical;jt.inject(new function(){var t=Math.min,e=Math.max,n=Math.abs,i={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function o(t){return t._children||[t]}function r(t,e){var n=t.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(e){for(var i=o(n),r=0,s=i.length;r<s;r++)(t=i[r])._closed||t.isEmpty()||(t.closePath(Wt.EPSILON),t.getFirstSegment().setHandleIn(0,0),t.getLastSegment().setHandleOut(0,0));n=n.resolveCrossings().reorient("nonzero"===n.getFillRule(),!0)}return n}function s(t,e,n,i,o){var r=new Dt(Gt.NO_INSERT);return r.addChildren(t,!0),r=r.reduce({simplify:e}),o&&0==o.insert||r.insertAbove(i&&n.isSibling(i)&&n.getIndex()<i.getIndex()?i:n),r.copyAttributes(n,!0),r}function a(t){return t.hasOverlap()||t.isCrossing()}function l(t,e,n,l){if(l&&(0==l.trace||l.stroke)&&/^(subtract|intersect)$/.test(n))return h(t,e,n);var c=r(t,!0),u=e&&t!==e&&r(e,!0),g=i[n];g[n]=!0,u&&(g.subtract||g.exclude)^u.isClockwise()^c.isClockwise()&&u.reverse();var v,_=p(Ut.expand(c.getIntersections(u,a))),y=o(c),w=u&&o(u),A=[],b=[];function C(t){for(var e=0,n=t.length;e<n;e++){var i=t[e];Ht.push(A,i._segments),Ht.push(b,i.getCurves()),i._overlapsOnly=!0}}function x(t){for(var e=[],n=0,i=t&&t.length;n<i;n++)e.push(b[t[n]]);return e}if(_.length){C(y),w&&C(w);for(let t=_.length-1;t>-1;t--)A[t].curve.length<1e-7&&(A[t].remove(),A.splice(t,1),b.splice(t,1));for(var I=new Array(b.length),S=0,T=b.length;S<T;S++)I[S]=b[S].getValues();var k=Ft.findCurveBoundsCollisions(I,I,0,!0),P={};for(S=0;S<b.length;S++){var E=b[S],O=E._path._id;(P[O]=P[O]||{})[E.getIndex()]={hor:x(k[S].hor),ver:x(k[S].ver)}}for(S=0,T=_.length;S<T;S++)f(_[S]._segment,c,u,P,g);for(S=0,T=A.length;S<T;S++){var B=A[S],L=B._intersection;B._winding||f(B,c,u,P,g),L&&L._overlap||(B._path._overlapsOnly=!1)}v=m(A,g)}else v=d(w?y.concat(w):y.slice(),(function(t){return!!g[t]}));return s(v,!0,t,e,l)}function h(t,e,n){var i=r(t),o=r(e),l=i.getIntersections(o,a),h="subtract"===n,c="divide"===n,u={},d=[];function p(t){if(!u[t._id]&&(c||o.contains(t.getPointAt(t.getLength()/2))^h))return d.unshift(t),u[t._id]=!0}for(var g=l.length-1;g>=0;g--){var f=l[g].split();f&&(p(f)&&f.getFirstSegment().setHandleIn(0,0),i.getLastSegment().setHandleOut(0,0))}return p(i),s(d,!1,t,e)}function c(t,e){for(var n=t;n;){if(n===e)return;n=n._previous}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._previous;)e=e._previous;t._next=e,e._previous=t}}function u(t){for(var e=t.length-1;e>=0;e--)t[e].clearHandles()}function d(t,e,i){var o=t&&t.length;if(o){var r=Ht.each(t,(function(t,e){this[t._id]={container:null,winding:t.isClockwise()?1:-1,index:e}}),{}),s=t.slice().sort((function(t,e){return n(e.getArea())-n(t.getArea())})),a=s[0],l=Ft.findItemBoundsCollisions(s,null,Wt.GEOMETRIC_EPSILON);null==i&&(i=a.isClockwise());for(var h=0;h<o;h++){var c=s[h],u=r[c._id],d=0,p=l[h];if(p)for(var g=null,f=p.length-1;f>=0;f--)if(p[f]<h){g=g||c.getInteriorPoint();var m=s[p[f]];if(m.contains(g)){var v=r[m._id];d=v.winding,u.winding+=d,u.container=v.exclude?v.container:m;break}}if(e(u.winding)===e(d))u.exclude=!0,t[u.index]=null;else{var _=u.container;c.setClockwise(_?!_.isClockwise():i)}}}return t}function p(t,e,n){var i,o,r,s=e&&[],a=Wt.CURVETIME_EPSILON,l=1-a,h=!1,d=n||[],p=n&&{};function g(t){return t._path._id+"."+t._segment1._index}for(var f=(n&&n.length)-1;f>=0;f--)(m=n[f])._path&&(p[g(m)]=!0);for(f=t.length-1;f>=0;f--){var m,v,_=t[f],y=_._time,w=y,A=e&&!e(_);if((m=_._curve)&&(m!==o?(h=!m.hasHandles()||p&&p[g(m)],i=[],r=null,o=m):r>=a&&(y/=r)),A)i&&i.push(_);else{if(e&&s.unshift(_),r=w,y<a)v=m._segment1;else if(y>l)v=m._segment2;else{var b=m.divideAtTime(y,!0);h&&d.push(m,b),v=b._segment1;for(var C=i.length-1;C>=0;C--){var x=i[C];x._time=(x._time-y)/(1-y)}}_._setSegment(v);var I=v._intersection,S=_._intersection;if(I){c(I,S);for(var T=I;T;)c(T._intersection,I),T=T._next}else v._intersection=S}}return n||u(d),s||t}function g(i,o,r,s,a){var l,h,c=Array.isArray(o)?o:o[r?"hor":"ver"],u=r?1:0,d=1^u,p=[i.x,i.y],f=p[u],m=p[d],v=1e-6,_=f-1e-9,y=f+1e-9,w=0,A=0,b=0,C=0,x=!1,I=!1,S=1,T=[];function k(n){var h=n[d+0],c=n[d+6];if(!(m<t(h,c)||m>e(h,c))){var p=n[u+0],w=n[u+2],A=n[u+4],I=n[u+6];if(h!==c){var k=m===h?0:m===c||_>e(p,w,A,I)||y<t(p,w,A,I)?1:qt.solveCubic(n,d,m,T,0,1)>0?T[0]:1,P=0===k?p:1===k?I:qt.getPoint(n,k)[r?"y":"x"],E=h>c?1:-1,O=l[d]>l[d+6]?1:-1,B=l[u+6];return m!==h?(P<_?b+=E:P>y?C+=E:x=!0,P>f-v&&P<f+v&&(S/=2)):(E!==O?p<_?b+=E:p>y&&(C+=E):p!=B&&(B<y&&P>y?(C+=E,x=!0):B>_&&P<_&&(b+=E,x=!0)),S/=4),l=n,!a&&P>_&&P<y&&0===qt.getTangent(n,k)[r?"x":"y"]&&g(i,o,!r,s,!0)}(p<y&&I>_||I<y&&p>_)&&(x=!0)}}function P(n){var i=n[d+0],o=n[d+2],s=n[d+4],a=n[d+6];if(m<=e(i,o,s,a)&&m>=t(i,o,s,a))for(var l,h=n[u+0],c=n[u+2],p=n[u+4],g=n[u+6],f=_>e(h,c,p,g)||y<t(h,c,p,g)?[n]:qt.getMonoCurves(n,r),v=0,w=f.length;v<w;v++)if(l=k(f[v]))return l}for(var E=0,O=c.length;E<O;E++){var B,L=c[E],M=L._path,N=L.getValues();if(!(E&&c[E-1]._path===M||(l=null,M._closed||(h=qt.getValues(M.getLastCurve().getSegment2(),L.getSegment1(),null,!s))[d]!==h[d+6]&&(l=h),l))){l=N;for(var R=M.getLastCurve();R&&R!==L;){var F=R.getValues();if(F[d]!==F[d+6]){l=F;break}R=R.getPrevious()}}if(B=P(N))return B;if(E+1===O||c[E+1]._path!==M){if(h&&(B=P(h)))return B;!x||b||C||(b=C=M.isClockwise(s)^r?1:-1),w+=b,A+=C,b=C=0,x&&(I=!0,x=!1),h=null}}return w=n(w),A=n(A),{winding:e(w,A),windingL:w,windingR:A,quality:S,onPath:I}}function f(t,e,i,o,r){var s=[],a=t,l=0;do{if(_=t.getCurve()){var h=_.getLength();s.push({segment:t,curve:_,length:h}),l+=h}t=t.getNext()}while(t&&!t._intersection&&t!==a);for(var c=[.5,.25,.75],u={winding:0,quality:-1},d=0;d<c.length&&u.quality<.5;d++){h=l*c[d];for(var p=0,f=s.length;p<f;p++){var m=s[p],v=m.length;if(h<=v){var _,y=(_=m.curve)._path,w=y._parent,A=w instanceof Dt?w:y,b=Wt.clamp(_.getTimeAt(h),.001,.999),C=_.getPointAtTime(b),x=n(_.getTangentAtTime(b).y)<Math.SQRT1_2,I=null;if(r.subtract&&i){var S=(A===e?i:e)._getWinding(C,x,!0);if(A===e&&S.winding||A===i&&!S.winding){if(S.quality<1)continue;I={winding:0,quality:1}}}(I=I||g(C,o[y._id][_.getIndex()],x,!0)).quality>u.quality&&(u=I);break}h-=v}}for(p=s.length-1;p>=0;p--)s[p].segment._winding=u}function m(t,e){var n,i=[];function o(t){var n;return!(!t||t._visited||e&&(!e[(n=t._winding||{}).winding]||e.unite&&2===n.winding&&n.windingL&&n.windingR))}function r(t){if(t)for(var e=0,i=n.length;e<i;e++)if(t===n[e])return!0;return!1}function s(t){for(var e=t._segments,n=0,i=e.length;n<i;n++)e[n]._visited=!0}function a(t,e){var i=t._intersection,s=i,a=[];function l(i,s){for(;i&&i!==s;){var l=i._segment,h=l&&l._path;if(h){var c=l.getNext()||h.getFirstSegment(),u=c._intersection;l!==t&&(r(l)||r(c)||c&&o(l)&&(o(c)||u&&o(u._segment)))&&a.push(l),e&&n.push(l)}i=i._next}}if(e&&(n=[t]),i){for(l(i);i&&i._previous;)i=i._previous;l(i,s)}return a}t.sort((function(t,e){var n=t._intersection,i=e._intersection,o=!(!n||!n._overlap),r=!(!i||!i._overlap),s=t._path,a=e._path;return o^r?o?1:-1:!n^!i?n?1:-1:s!==a?s._id-a._id:t._index-e._index}));for(var l=0,h=t.length;l<h;l++){var c,u,d,p=t[l],g=o(p),f=null,m=!1,v=!0,_=[];if(g&&p._path._overlapsOnly){var y=p._path,w=p._intersection._segment._path;y.compare(w)&&(y.getArea()&&i.push(y.clone(!1)),s(y),s(w),g=!1)}for(;g;){var A=!f,b=a(p,A),C=b.shift(),x=!(m=!A&&(r(p)||r(C)))&&C;if(A&&(f=new zt(Gt.NO_INSERT),c=null),m){(p.isFirst()||p.isLast())&&(v=p._path._closed),p._visited=!0;break}if(x&&c&&(_.push(c),c=null),c||(x&&b.push(p),c={start:f._segments.length,crossings:b,visited:u=[],handleIn:d}),x&&(p=C),!o(p)){f.removeSegments(c.start);for(var I=0,S=u.length;I<S;I++)u[I]._visited=!1;u.length=0;do{(p=c&&c.crossings.shift())&&p._path||(p=null,(c=_.pop())&&(u=c.visited,d=c.handleIn))}while(c&&!o(p));if(!p)break}var T=p.getNext();f.add(new Vt(p._point,d,T&&p._handleOut)),p._visited=!0,u.push(p),p=T||p._path.getFirstSegment(),d=T&&T._handleIn}m&&(v&&(f.getFirstSegment().setHandleIn(d),f.setClosed(v)),0!==f.getArea()&&i.push(f))}return i}return{_getWinding:function(t,e,n){return g(t,this.getCurves(),e,n)},unite:function(t,e){return l(this,t,"unite",e)},intersect:function(t,e){return l(this,t,"intersect",e)},subtract:function(t,e){return l(this,t,"subtract",e)},exclude:function(t,e){return l(this,t,"exclude",e)},divide:function(t,e){return e&&(0==e.trace||e.stroke)?h(this,t,"divide"):s([this.subtract(t,e),this.intersect(t,e)],!0,this,t,e)},resolveCrossings:function(){var t=this._children,e=t||[this];function n(t,e){var n=t&&t._intersection;return n&&n._overlap&&n._path===e}var i=!1,o=!1,r=this.getIntersections(null,(function(t){return t.hasOverlap()&&(i=!0)||t.isCrossing()&&(o=!0)})),s=i&&o&&[];if(r=Ut.expand(r),i)for(var a=p(r,(function(t){return t.hasOverlap()}),s),l=a.length-1;l>=0;l--){var h=a[l],c=h._path,d=h._segment,g=d.getPrevious(),f=d.getNext();n(g,c)&&n(f,c)&&(d.remove(),g._handleOut._set(0,0),f._handleIn._set(0,0),g===d||g.getCurve().hasLength()||(f._handleIn.set(g._handleIn),g.remove()))}o&&(p(r,i&&function(t){var e=t.getCurve(),n=t.getSegment(),i=t._intersection,o=i._curve,r=i._segment;if(e&&o&&e._path&&o._path)return!0;n&&(n._intersection=null),r&&(r._intersection=null)},s),s&&u(s),e=m(Ht.each(e,(function(t){Ht.push(this,t._segments)}),[])));var v,_=e.length;return _>1&&t?(e!==t&&this.setChildren(e),v=this):1!==_||t||(e[0]!==this&&this.setSegments(e[0].removeSegments()),v=this),v||((v=new Dt(Gt.NO_INSERT)).addChildren(e),(v=v.reduce()).copyAttributes(this),this.replaceWith(v)),v},reorient:function(t,e){var n=this._children;return n&&n.length?this.setChildren(d(this.removeChildren(),(function(e){return!!(t?e:1&e)}),e)):void 0!==e&&this.setClockwise(e),this},getInteriorPoint:function(){var n=this.getBounds().getCenter(!0);if(!this.contains(n)){for(var i=this.getCurves(),o=n.y,r=[],s=[],a=0,l=i.length;a<l;a++){var h=i[a].getValues(),c=h[1],u=h[3],d=h[5],p=h[7];if(o>=t(c,u,d,p)&&o<=e(c,u,d,p))for(var g=qt.getMonoCurves(h),f=0,m=g.length;f<m;f++){var v=g[f],_=v[1],y=v[7];if(_!==y&&(o>=_&&o<=y||o>=y&&o<=_)){var w=o===_?v[0]:o===y?v[6]:1===qt.solveCubic(v,1,o,s,0,1)?qt.getPoint(v,s[0]).x:(v[0]+v[6])/2;r.push(w)}}}r.length>1&&(r.sort((function(t,e){return t-e})),n.x=(r[0]+r[1])/2)}return n}}});const Yt=["unite","intersect","subtract","exclude","divide"];for(const e of Yt){const n=t.PathItem.prototype[e];t.PathItem.prototype[e]=function(){const e=arguments[0],i=this.getBounds(),o=e.getBounds(),r=Math.min(i.x,o.x),s=Math.max(i.x+i.width,o.x+o.width),a=Math.min(i.y,o.y),l=Math.max(i.y+i.height,o.y+o.height);if(r>-1e3&&s<1e3&&a>-1e3&&l<1e3)return n.apply(this,arguments);const h=s-r,c=l-a,u=Math.pow(2,Math.ceil(Math.log2(h/2e3))),d=Math.pow(2,Math.ceil(Math.log2(c/2e3))),p=Math.max(u,d),g=new t.Point((r+s)/2,(a+l)/2),f=new t.Point(-Math.round(g.x),-Math.round(g.y));p>1&&(this.scale(1/p,g),e!==this&&e.scale(1/p,g)),this.translate(f),e!==this&&e.translate(f);const m=n.apply(this,arguments);return this.translate(f.multiply(-1)),m.translate(f.multiply(-1)),e!==this&&e.translate(f.multiply(-1)),p>1&&(this.scale(p,g),m.scale(p,g),e!==this&&e.scale(p,g)),m}}function Jt(){return{get:function(){let e=this._paperLayerMap.size;return 1===e?this._paperLayerMap.values().next().value:0===e?null:this._paperLayerMap.get(t)||null}}}function Zt(){return{get:function(){return this.__paperLayerMap||(this.__paperLayerMap=new Map),this.__paperLayerMap}}}function Xt(e){return function(e,n){let i=new t.Layer({applyMatrix:!1});return n.project.addLayer(i),e._paperLayerMap.set(n,i),i}(this,e.paperScope)}function $t(t){this.paperLayer?(this.paperLayer.addChild(t),t.applyRescale()):console.error("No layer has been set up in the active paper scope for this object. Does a scope need to be activated?")}t.Curve.getTimeOf=function(e,n){var i=new t.Point(e[0],e[1]),o=new t.Point(e[6],e[7]),r=1e-7,s=n.isClose(i,r)?0:n.isClose(o,r)?1:null;if(null===s)for(var a=[n.x,n.y],l=[],h=0;h<2;h++)for(var c=t.Curve.solveCubic(e,h,a[h],l,0,1),u=0;u<c;u++){var d=l[u];if(n.isClose(t.Curve.getPoint(e,d),r))return d}return s},Object.defineProperty(OpenSeadragon.Viewer.prototype,"paperLayer",Jt()),Object.defineProperty(OpenSeadragon.TiledImage.prototype,"paperLayer",Jt()),Object.defineProperty(OpenSeadragon.Viewport.prototype,"paperLayer",Jt()),Object.defineProperty(OpenSeadragon.TiledImage.prototype,"_paperLayerMap",Zt()),Object.defineProperty(OpenSeadragon.Viewer.prototype,"_paperLayerMap",Zt()),Object.defineProperty(OpenSeadragon.Viewport.prototype,"_paperLayerMap",Zt()),Object.defineProperty(OpenSeadragon.Viewer.prototype,"paperItems",{get:function(){return this.paperLayer.children}}),Object.defineProperty(OpenSeadragon.TiledImage.prototype,"paperItems",{get:function(){return this.paperLayer.children}}),Object.defineProperty(OpenSeadragon.Viewport.prototype,"paperItems",{get:function(){return this.paperLayer.children}}),OpenSeadragon.Viewer.prototype._setupPaper=Xt,OpenSeadragon.Viewport.prototype._setupPaper=function(t){let e=Xt.call(this,t);e.viewport=this,e.matrix.scale(t.scaleFactor),t.addHandler("update-scale",(function(){e.matrix.reset(),e.matrix.scale(t.scaleFactor)}))},OpenSeadragon.TiledImage.prototype._setupPaper=function(e){let n=this,i=Xt.call(this,e);function o(){let o=n.getRotation(),r=n.getBoundsNoRotate(),s=n.getFlip(),a=new t.Point((r.x+r.width/2)*e.scaleFactor,(r.y+r.height/2)*e.scaleFactor),l=new t.Matrix;s&&l.scale(-1,1,a),l.rotate(o,a),l.translate({x:r.x*e.scaleFactor,y:r.y*e.scaleFactor}),l.scale(r.width*e.scaleFactor/n.source.width),i.matrix.set(l)}i.tiledImage=this,this.addHandler("bounds-change",o),e.addHandler("update-scale",o),o()},OpenSeadragon.Viewer.prototype.addPaperItem=$t,OpenSeadragon.Viewport.prototype.addPaperItem=$t,OpenSeadragon.TiledImage.prototype.addPaperItem=$t,OpenSeadragon.Viewer.prototype.createPaperOverlay=function(){return new Kt(this,...arguments)},function(e){void 0!==e&&void 0!==t?e.Viewer.prototype.PaperOverlays?console.warn("Cannot redefine Viewer.prototype.PaperOverlays"):Object.defineProperty(e.Viewer.prototype,"PaperOverlays",{get:function(){return this._PaperOverlays||(this._PaperOverlays=[])}}):console.error("[paper-overlay.mjs] requires OpenSeadragon and paper.js")}(OpenSeadragon);class Kt extends OpenSeadragon.EventSource{constructor(e,n){super(),n=OpenSeadragon.extend(!0,{overlayType:"image"},n),this.viewer=e,this.overlayType=n.overlayType,e.PaperOverlays.push(this);let i=Qt();this._id="paper-overlay-canvas-"+i,this._containerWidth=0,this._containerHeight=0,this._canvasdiv=document.createElement("div"),this._canvasdiv.setAttribute("id","paper-overlay-"+i),this._canvasdiv.classList.add("paper-overlay"),this._canvasdiv.style.position="absolute",this._canvasdiv.style.left="0px",this._canvasdiv.style.top="0px",this._canvasdiv.style.width="100%",this._canvasdiv.style.height="100%",this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id",this._id),this._canvasdiv.appendChild(this._canvas),e.canvas.appendChild(this._canvasdiv),this._viewerButtons=[],this.paperScope=new t.PaperScope,this.paperScope.overlay=this;let o=this.paperScope.setup(this._canvas);if(this.paperScope.project.overlay=this,this.ps=o,this._paperProject=o.project,this._resize(),"image"==this.overlayType){this.viewer.viewport._setupPaper(this);for(let t=0;t<e.world.getItemCount();++t){let e=this.viewer.world.getItemAt(t);this._setupTiledImage(e)}this.onAddItem=(t=>function(e){let n=e.item;t._setupTiledImage(n)})(this),this.onRemoveItem=(t=>function(e){let n=e.item;t._removeTiledImage(n)})(this),e.world.addHandler("add-item",this.onAddItem),e.world.addHandler("remove-item",this.onRemoveItem),this._updatePaperView()}else"viewer"==this.overlayType?this.viewer._setupPaper(this):console.error("Unrecognized overlay type: "+this.overlayType);this.onViewerDestroy=(t=>function(){t.destroy(!0)})(this),this.onViewportChange=(t=>function(){t._updatePaperView()})(this),this.onViewerResetSize=(t=>function(e){setTimeout((()=>{t.destroyed||(t._resize(),t._updatePaperView())}))})(this),this.onViewerResize=(e=>function(){e._resize(),e.paperScope.view.emit("resize",{size:new t.Size(e._containerWidth,e._containerHeight)}),e._updatePaperView()})(this),this.onViewerRotate=function(t){this._pivot=t.pivot||this._getCenter()},this.onViewerFlip=(t=>function(n){t.paperScope.view.setFlipped(n.flipped,e.viewport.getRotation(!0))})(this),e.addHandler("resize",this.onViewerResize),e.addHandler("reset-size",this.onViewerResetSize),e.addHandler("viewport-change",this.onViewportChange),e.addHandler("rotate",this.onViewerRotate),e.addHandler("flip",this.onViewerFlip),e.addOnceHandler("destroy",this.onViewerDestroy)}get scaleFactor(){return this._currentScaleFactor=this._currentScaleFactor||this.viewer.drawer.canvas.clientWidth,this._currentScaleFactor}addViewerButton(t={}){const e=this.viewer.prefixUrl;let n=new OpenSeadragon.Button({tooltip:t.tooltip,srcRest:e+"button_rest.png",srcGroup:e+"button_grouphover.png",srcHover:e+"button_hover.png",srcDown:e+"button_pressed.png",onClick:t.onClick});if(t.faIconClass){let e=I(t.faIconClass);e.style="position:absolute;top:calc(50% - 4px);left:50%;transform:translate(-50%, -50%);color:#01010187;",n.element.appendChild(e)}return this.viewer.buttonGroup.buttons.push(n),this.viewer.buttonGroup.element.appendChild(n.element),this._viewerButtons.push(n),n}bringToFront(){this.viewer.PaperOverlays.splice(this.viewer.PaperOverlays.indexOf(this),1),this.viewer.PaperOverlays.push(this),this.viewer.PaperOverlays.forEach((t=>this.viewer.canvas.appendChild(t._canvasdiv))),this.paperScope.activate()}sendToBack(){this.viewer.PaperOverlays.splice(this.viewer.PaperOverlays.indexOf(this),1),this.viewer.PaperOverlays.splice(0,0,this),this.viewer.PaperOverlays.forEach((t=>this.viewer.canvas.appendChild(t._canvasdiv))),this.viewer.PaperOverlays[this.viewer.PaperOverlays.length-1].paperScope.activate()}destroy(t){this.destroyed=!0,this._canvasdiv.remove(),this.paperScope.project&&this.paperScope.project.remove(),this.ps&&this.ps.remove(),t||(this.viewer.removeHandler("viewport-change",this.onViewportChange),this.viewer.removeHandler("resize",this.onViewerResize),this.viewer.removeHandler("reset-size",this.onViewerResetSize),this.viewer.removeHandler("rotate",this.onViewerRotate),this.viewer.removeHandler("flip",this.onViewerFlip),this.viewer.world.removeHandler("add-item",this.onAddItem),this.viewer.world.removeHandler("remove-item",this.onRemoveItem),this.setOSDMouseNavEnabled(!0),this._viewerButtons.forEach((t=>{t.element.remove()})),this._viewerButtons=[],this.viewer.PaperOverlays.splice(this.viewer.PaperOverlays.indexOf(this),1),this.viewer.PaperOverlays.length>0&&this.viewer.PaperOverlays[this.viewer.PaperOverlays.length-1].paperScope.activate())}clear(){this.paperScope.project.clear()}canvas(){return this._canvas}addClass(t){return this._canvas.classList.add(...arguments),this}removeClass(t){return this._canvas.classList.remove(...arguments),this}setAttribute(t,e){return this._canvas.setAttribute(t,e),this}addEventListener(t,e){return this._canvas.addEventListener(t,e),this}removeEventListener(t,e){return this._canvas.removeEventListener(t,e),this}setOSDMouseNavEnabled(t=!0){let e=this.viewer.isMouseNavEnabled();return this.viewer.setMouseNavEnabled(t),t!==e&&this.viewer.raiseEvent("mouse-nav-changed",{enabled:t,overlay:this}),e}autoRescaleItems(t=!1){let e=this;function n(){e.rescaleItems()}this.ps.view.off("zoom-changed",n),t&&this.ps.view.on("zoom-changed",n)}rescaleItems(){this._paperProject.getItems({match:function(t){return t.rescale}}).forEach((function(t){t.applyRescale()}))}paperToCanvasCoordinates(t,e){let n=new OpenSeadragon.Point(t,e).divide(this.scaleFactor);return this.viewer.viewport.viewportToViewerElementCoordinates(n)}getImageData(t,e,n,i){return t=t||0,e=e||0,n=null==n?this.viewer.drawer.canvas.width:n,i=null==i?this.viewer.drawer.canvas.height:i,this.ps.view.getFlipped()&&(t=this.viewer.drawer.canvas.width-t-n),this.viewer.drawer.canvas.getContext("2d",{willReadFrequently:!0}).getImageData(t,e,n,i)}getViewportRaster(e=!0){let n=this.paperScope.view,i=n.viewToProject(new t.Point(n.viewSize.width/2,n.viewSize.height/2)),o=-1*this.viewer.viewport.getRotation(),r={insert:!1};e?r.canvas=this.viewer.drawer.canvas:r.size=new t.Size(this.viewer.drawer.canvas.width,this.viewer.drawer.canvas.height);let s=new t.Raster(r);s.position=i,s.rotate(o);let a=n.viewSize.width/n.getZoom()/this.viewer.drawer.canvas.width;if(s.scale(a),n.getFlipped()){const t=n.getRotation();s.rotate(-t),s.scale(-1,1),s.rotate(t)}return s}_setupTiledImage(t){t._setupPaper(this)}_removeTiledImage(t){t._paperLayerMap?.get(this.paperScope)?.remove(),t._paperLayerMap?.delete(this.paperScope)}_resize(){let e=!1;if(this._containerWidth!==this.viewer.container.clientWidth&&(this._containerWidth=this.viewer.container.clientWidth,this._canvasdiv.setAttribute("width",this._containerWidth),this._canvas.setAttribute("width",this._containerWidth),e=!0),this._containerHeight!==this.viewer.container.clientHeight&&(this._containerHeight=this.viewer.container.clientHeight,this._canvasdiv.setAttribute("height",this._containerHeight),this._canvas.setAttribute("height",this._containerHeight),e=!0),e){const e=this._currentScaleFactor;this._currentScaleFactor=this.viewer.drawer.canvas.clientWidth,e!==this._currentScaleFactor&&this.raiseEvent("update-scale",{scaleFactor:this._currentScaleFactor}),this.paperScope.view.viewSize=new t.Size(this._containerWidth,this._containerHeight),this.paperScope.view.update()}}_updatePaperView(){if("viewer"===this.overlayType)return;let e=this.viewer.viewport.getZoom(!0),n=this.paperScope.view.getZoom();this.paperScope.view.setZoom(this.viewer.viewport._containerInnerSize.x*e/this.scaleFactor);let i=this._getCenter();this.viewer.drawer.canvas.pixelRatio=window.devicePixelRatio,this.paperScope.view.center=new t.Point(i.x,i.y).multiply(this.scaleFactor);let o=this.viewer.viewport.getRotation(!0),r=this._getPivot();this.paperScope.view.setRotation(o,r);const s=this.paperScope.view.getZoom();Math.abs(s-n)>1e-7&&this.paperScope.view.emit("zoom-changed",{zoom:s}),this.paperScope.view.update()}_getPivot(){if(this._pivot)return this._pivot.multiply(this.scaleFactor)}_getCenter(){return this.viewer.viewport.getCenter(!0)}}let Qt=function(){let t=1;return function(){return t++}}();class te extends Q{constructor(e){let n;super(e),this._supportsGeoJSONObj(e)||error(`Bad geoJSON object: geometry type ${e.geometry?.type} is not supported by this factory.`),n="multipolygon"===e.geometry.type.toLowerCase()?e.geometry.coordinates.flat():e.geometry.coordinates;let i=n.map((function(e){let n=e.map((function(e){return new t.Point(e[0],e[1])}));return new t.Path(n)})),o=new t.CompoundPath({children:i,fillRule:"evenodd",closed:!0});o=o.replaceWith(o.unite(o).toCompoundPath()),o.canBeBoundingElement=!0,this.paperItem=o}static supportsGeoJSONType(t,e=null){return["polygon","multipolygon"].includes(t.toLowerCase())&&null===e}getGeoJSONType(){return{type:this.paperItem.children.filter((t=>t.area>0&&t.segments.length>2)).length>1?"MultiPolygon":"Polygon"}}getCoordinates(){let t=this.paperItem.children.filter((t=>t.area>0&&t.segments.length>2)),e=this.paperItem.children.filter((t=>t.area<=0&&t.segments.length>2)),n=t.map((t=>[t.segments.map((t=>[t.point.x,t.point.y]))].concat(e.filter((e=>t.contains(e.segments[0].point))).map((t=>t.segments.map((t=>[t.point.x,t.point.y])))))));return n.forEach((t=>{t.forEach((t=>{let e=t[0],n=t.slice(-1)[0];e[0]===n[0]&&e[1]===n[1]||t.push([e[0],e[1]])}))})),1===n.length&&(n=n[0]),n}getProperties(){}}class ee extends Q{constructor(e){super(e),"LineString"!==e.geometry.type&&error('Bad geoJSON object: type !=="LineString"');let n=e.geometry.coordinates.map((function(e){return new t.Point(e[0],e[1])})),i=new t.Group({children:[new t.Path(n)]});i.fillColor=null,this.paperItem=i}static supportsGeoJSONType(t,e=null){return"linestring"===t.toLowerCase()&&null===e}getGeoJSONType(){return{type:"Linestring"}}getCoordinates(){return this.paperItem.children.map((function(t){return t.segments.map((function(t){return[t.point.x,t.point.y]}))}))}getProperties(){return{strokeWidths:this.paperItem.children.map((t=>t.strokeWidth))}}setStyle(t){Object.assign({},t),t.rescale&&delete t.rescale.strokeWidth,this._paperItem.style.set(t)}}class ne extends Q{constructor(e){super(e),"MultiLineString"!==e.geometry.type&&error('Bad geoJSON object: type !=="MultiLineString"');let n=e.geometry.coordinates.map((function(n,i){let o=n.map((function(e){return new t.Point(e[0],e[1])}));return new t.Path(o).strokeWidth=e.geometry.properties.strokeWidths[i],new t.Path(o)})),i=new t.Group({children:n});i.fillColor=null,this.paperItem=i}static supportsGeoJSONType(t,e=null){return"multilinestring"===t.toLowerCase()&&null===e}getGeoJSONType(){return{type:"MultiLineString"}}getCoordinates(){return this.paperItem.children.map((function(t){return t.segments.map((function(t){return[t.point.x,t.point.y]}))}))}getProperties(){let t=this.paperItem;return{strokeColor:t.children.length>0?t.children[0].strokeColor:void 0,strokeWidths:t.children.map((t=>t.strokeWidth))}}getStyleProperties(){return this.paperItem.children[0].style.toJSON()}setStyle(t){Object.assign({},t),t.rescale&&delete t.rescale.strokeWidth,this._paperItem.style.set(t)}}class ie extends Q{constructor(e){super(e),"GeometryCollection"===e.geometry.type&&"Raster"===e.geometry.properties.subtype||error('Bad geoJSON object: type !=="GeometryCollection" or subtype !=="Raster"');let n,i=e.geometry.properties.raster,o=e.geometry.geometries;i||error("Bad input: geometry.properties.raster must hold raster data, or a paper.Raster object"),i.data instanceof t.Raster?n=i.data:(n=new t.Raster(i.data),n.translate(i.center[0],i.center[1]),n.scale(i.scaling[0],i.scaling[1]),n.rotate(i.rotation)),this._rasterSelectedColor=new t.Color(0,0,0,0),n.selectedColor=this._rasterSelectedColor;let r=new t.Group([n]);if(r.updateFillOpacity=function(){t.Group.prototype.updateFillOpacity.call(this),n.opacity=this.opacity*this._computedFillOpacity,r.clipped&&(r.children[0].fillColor=null)},o.length>0){let e=new t.Group;r.insertChild(0,e),r.clipped=!0,o.forEach((n=>{let i=n instanceof t.Item?t.Item.fromAnnotationItem(n):t.Item.fromGeoJSON(n);delete i.isGeoJSONFeature,i._annotationItem=i.annotationItem,delete i.annotationItem,setTimeout((()=>i.strokeColor=(n.properties||n).strokeColor)),i.strokeWidth=(n.properties||n).strokeWidth,i.rescale=(n.properties||n).rescale,e.addChild(i)}))}e.geometry.properties.transform&&(r.matrix=new t.Matrix(e.geometry.properties.transform)),r.on("selected",(()=>{r.clipped&&(r.children[0].selected=!1)})),this.paperItem=r}static supportsGeoJSONType(t,e){return"geometrycollection"===t.toLowerCase()&&"raster"===e?.toLowerCase()}getGeoJSONType(){return{type:"GeometryCollection",subtype:"Raster"}}toGeoJSONGeometry(){let t=this.paperItem,e=t.children[0],n=t.children[1],i={type:"GeometryCollection",properties:{subtype:"Raster",raster:{data:n.toDataURL(),center:[n.bounds.center.x,n.bounds.center.y],width:n.width,height:n.height,scaling:[n.matrix.scaling.x,n.matrix.scaling.y],rotation:n.matrix.rotation},transform:t.matrix.values},geometries:e.children.map((t=>{let e=t._annotationItem.toGeoJSONFeature(),n=e.geometry;return n.properties||(n.properties={}),n.properties.strokeColor=e.properties.strokeColor,n.properties.strokeWidth=e.properties.strokeWidth,n.properties.rescale=e.properties.rescale,n}))};return i}}class oe extends Q{constructor(e){super(e),"Point"===e.geometry.type&&"Rectangle"===e.geometry.properties.subtype||error('Bad geoJSON object: type !=="Point" or subtype !=="Rectangle"');let n=new t.CompoundPath({children:[],fillRule:"evenodd"});if(e.geometry.coordinates.length>1){let i=e.geometry.coordinates.slice(0,2),o=i[0]||0,r=i[1]||0,s=e.geometry.properties,a=s.width||0,l=s.height||0,h=s.angle||0,c=[[o-a/2,r-l/2],[o+a/2,r-l/2],[o+a/2,r+l/2],[o-a/2,r+l/2]].map((function(e){return new t.Point(e[0],e[1])})),u=new t.Path(c);n.addChild(u),n.closed=!0,n.rotate(h)}n.canBeBoundingElement=!0,this.paperItem=n}static supportsGeoJSONType(t,e){return"point"===t.toLowerCase()&&"rectangle"===e?.toLowerCase()}getGeoJSONType(){return{type:"Point",subtype:"Rectangle"}}getCoordinates(){let t=this.paperItem;return[t.position.x,t.position.y]}getProperties(){let t=this.paperItem.children[0].segments.map((t=>t.point)),e=t[1].subtract(t[0]),n=t[0].subtract(t[3]);return{width:e.length,height:n.length,angle:e.angleInDegrees}}static onTransform(){switch(arguments[0]){case"scale":{let t=this.layer.matrix.inverseTransform(arguments[1]),e=arguments[2],n=arguments[3];this.matrix.append(n.inverted());let i=this.children[0].segments;i.map(((t,e)=>{let n=t.point.transform(this.matrix),o=i[(e+1)%4],r=o.point.transform(this.matrix).subtract(n).divide(2),s=n.add(r);return s.normal=r.rotate(-90).normalize(),s.segments=[t,o],s})).forEach((i=>{let o=i.subtract(t),r=o.rotate(-e).multiply(n.scaling).rotate(e).subtract(o).project(i.normal);i.segments.forEach((t=>{let e=t.point.transform(this.matrix).add(r);t.point=this.matrix.inverseTransform(e)}))}));break}}}}class re extends Q{constructor(e){super(e),"Point"===e.geometry.type&&"Ellipse"===e.geometry.properties.subtype||error('Bad geoJSON object: type !=="Point" or subtype !=="Rectangle"');let n=new t.CompoundPath({children:[],fillRule:"evenodd"});if(e.geometry.coordinates.length>1){let i=e.geometry.coordinates.slice(0,2),o=i[0]||0,r=i[1]||0,s=e.geometry.properties,a=s.majorRadius||0,l=s.minorRadius||0,h=s.angle||0,c=new t.Path.Ellipse({center:new t.Point(o,r),radius:new t.Size(a,l)});n.addChild(c),n.rotate(h)}n.canBeBoundingElement=!0,this.paperItem=n}static supportsGeoJSONType(t,e){return"point"===t.toLowerCase()&&"ellipse"===e?.toLowerCase()}getGeoJSONType(){return{type:"Point",subtype:"Ellipse"}}getCoordinates(){let t=this.paperItem;return[t.position.x,t.position.y]}getProperties(){let t,e,n=this.paperItem.children[0].segments.map((t=>t.point)),i=n[2].subtract(n[0]),o=n[3].subtract(n[1]);i.length>o.length?(t=i,e=o):(t=o,e=i);let r=t.angle;return{majorRadius:t.length/2,minorRadius:e.length/2,angle:r}}static onTransform(){switch(arguments[0]){case"complete":{let e=this.children[0].curves,n=this.bounds.center,i=e.slice(0,2).map((t=>({curve:t,location:t.getNearestLocation(n)}))).sort(((t,e)=>t.location.distance-e.location.distance)),o=i[0].location.point;if(o.equals(i[0].curve.segment1.point)||o.equals(i[0].curve.segment2.point))return;let r=i[0].location.curve==i[0].curve?i[0].location.time:1,s=o.subtract(n),a=i[1].curve.getLocationAtTime(r).point.subtract(n),l=new t.Path.Ellipse({center:n,radius:[a.length,s.length]}).rotate(a.angle);this.children[0].set({segments:l.segments});break}}}}const se=function(t,e=0){let n=3735928559^e,i=1103547991^e;for(let e,o=0;o<t.length;o++)e=t.charCodeAt(o),n=Math.imul(n^e,2654435761),i=Math.imul(i^e,1597334677);return n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(n^n>>>13,3266489909),4294967296*(2097151&i)+(n>>>0)};Object.defineProperty(t.Item.prototype,"displayName",{set:function(t){Array.isArray(t)?(this._displayName=new String(t[0]),this._displayName.source=t[1]):this._displayName=t,this.name=this._displayName,this.emit("display-name-changed",{displayName:this._displayName})},get:function(){return this._displayName}}),Object.defineProperty(t.Item.prototype,"featureCollection",{get:function(){return this.hierarchy.filter((t=>t.isGeoJSONFeatureCollection))[0]}}),Object.defineProperty(t.TextItem.prototype,"content",function(){let e=t.TextItem.prototype._setContent||Object.getOwnPropertyDescriptor(t.TextItem.prototype,"content").set;return t.TextItem.prototype._setContent=e,{get:function(){return this._content},set:function(t){e.call(this,t),this.emit("content-changed")}}}()),Object.defineProperty(t.Project.prototype,"descendants",{get:function(){return this.layers?this.getItems({match:t=>t.isGeoJSONFeatureCollection}).map((t=>t.descendants)).flat():[this]}});let ae,le=t.Item.prototype.remove;t.Item.prototype.remove=function(){const t=this.getItems({match:t=>t.isGeoJSONFeatureCollection});(this.isGeoJSONFeature||this.isGeoJSONFeatureCollection)&&this.project.emit("item-removed",{item:this}),t.forEach((t=>this.project.emit("item-removed",{item:t}))),le.call(this),(this.isGeoJSONFeature||this.isGeoJSONFeatureCollection)&&this.emit("removed",{item:this}),t.forEach((t=>t.emit("removed",{item:t})))},t.Group.prototype.insertChildren=function(){let e=t.Group.prototype.insertChildren.original||t.Group.prototype.insertChildren;function n(){let t=e.apply(this,arguments),n=arguments[0],i=Array.from(arguments[1]);return i&&i.forEach(((t,e)=>{if(t.isGeoJSONFeature){let e=void 0!==n?n+1:-1;this.emit("child-added",{item:t,index:e})}})),t}return n.original=e,n}(),t.Color.prototype.toJSON=t.Color.prototype.toCSS,t.Style.prototype.toJSON=function(){let t={};return Object.keys(this._values).forEach((e=>{t[e]=this[e]})),t},t.View.prototype.getImageData=function(){return this.element.getContext("2d").getImageData(0,0,this.element.width,this.element.height)},t.PathItem.prototype.toCompoundPath=function(){if(this.constructor!==t.CompoundPath){let e=new t.CompoundPath({children:[this],fillRule:"evenodd"});return e.selected=this.selected,this.selected=!1,e}return this},t.PathItem.prototype.applyBounds=function(e){if(0==e.length)return;let n;if(1==e.length)n=e[0].intersect(this,{insert:!1});else if(e.length>1){let i=new t.CompoundPath(e.map((t=>t.clone().children)).flat());n=i.intersect(this,{insert:!1}),i.remove()}this.children?(this.removeChildren(),this.addChildren(n.children?n.children:[n])):this.segments=n.segments?n.segments:n.firstChild.segments},t.Item.prototype.select=function(t){t||this.project._scope.findSelectedItems().forEach((t=>t.deselect())),this.selected=!0,this.emit("selected"),this.project.emit("item-selected",{item:this})},t.Item.prototype.deselect=function(t){t?(this.selected=!1,this.emit("deselected"),this.project.emit("item-deselected",{item:this})):this.project._scope.findSelectedItems().forEach((t=>t.deselect(!0)))},t.Item.prototype.toggle=function(t){this.selected?this.deselect(t):this.select(t)},t.PaperScope.prototype.findSelectedNewItem=function(){return this.project.getItems({selected:!0,match:function(t){return t.isGeoJSONFeature&&t.initializeGeoJSONFeature}})[0]},t.PaperScope.prototype.findSelectedItems=function(){return this.project.getItems({selected:!0,match:function(t){return t.isGeoJSONFeature}})},t.PaperScope.prototype.findSelectedItem=function(){return this.findSelectedItems()[0]},t.PaperScope.prototype.scaleByCurrentZoom=function(t){return t/this.view.getZoom()},t.PaperScope.prototype.getActiveTool=function(){return this.tool?this.tool._toolObject:null};class he extends OpenSeadragon.EventSource{constructor(e,n={}){if(super(),n||(n={}),this._defaultOptions={addUI:!1,overlay:null,destroyOnViewerClose:!1,cacheAnnotations:!1},this.options=Object.assign({},this._defaultOptions,n),this._defaultStyle={fillColor:new t.Color("white"),strokeColor:new t.Color("black"),fillOpacity:1,strokeOpacity:1,strokeWidth:1,rescale:{strokeWidth:1}},this.viewer=e,this.options.overlay?this.options.overlay instanceof Kt&&(this.overlay=this.options.overlay):this.overlay=new Kt(this.viewer,{type:"image"}),this.paperScope.project.defaultStyle=new t.Style,this.paperScope.project.defaultStyle.set(this.defaultStyle),this.overlay.autoRescaleItems(!0),this.options.destroyOnViewerClose&&this.viewer.addOnceHandler("close",(()=>this.destroy())),this.viewer.annotationToolkit=this,this.paperScope.annotationToolkit=this,this.viewer.world.addHandler("add-item",(t=>{this.options.cacheAnnotations&&this._loadCachedAnnotations(t.item)})),this.viewer.world.addHandler("remove-item",(t=>{this.options.cacheAnnotations&&this._cacheAnnotations(t.item)}),!1,1),nt.register(te),nt.register(Pt),nt.register(ee),nt.register(ne),nt.register(ie),nt.register(ot),nt.register(at),nt.register(oe),nt.register(re),t.Item.fromGeoJSON=nt.itemFromGeoJSON,t.Item.fromAnnotationItem=nt.itemFromAnnotationItem,this._cached={},this.options.addUI){let t={};"object"==typeof n.addUI&&(t=this.options.addUI),this.addAnnotationUI(t)}}get defaultStyle(){return this._defaultStyle}get annotationUI(){return this._annotationUI}get paperScope(){return this.overlay.paperScope}clearCache(){this._cached={}}_cacheAnnotations(t){try{const e=se(JSON.stringify(t.source)),n=t.paperLayer.getItems({match:t=>t.isGeoJSONFeatureCollection});this._cached[e]=n}catch(t){console.error("Error with caching",t)}}_loadCachedAnnotations(t){try{const e=se(JSON.stringify(t.source)),n=this._cached[e]||[];for(const e of n)this._addFeatureCollectionGroupToLayer(e,t.paperLayer)}catch(t){console.error("Error with fetching from cache",t)}}addAnnotationUI(t={}){return this._annotationUI||(this._annotationUI=new Nt(this,t)),this._annotationUI}destroy(){this.raiseEvent("before-destroy");let t=this.paperScope&&this.paperScope.getActiveTool();t&&t.deactivate(!0),this.viewer.annotationToolkit=null,this._annotationUI&&this._annotationUI.destroy(),this.overlay.destroy(),this.raiseEvent("destroy")}close(){this.raiseEvent("before-close");let t=this.paperScope&&this.paperScope.getActiveTool();t&&t.deactivate(!0),this.addFeatureCollections([],!0)}setGlobalVisibility(t=!1){this.paperScope.view._element.setAttribute("style","visibility:"+(t?"visible;":"hidden;"))}addFeatureCollections(t,e,n){this.loadGeoJSON(t,e,n),this.overlay.rescaleItems(),this.paperScope.project.emit("items-changed")}getFeatureCollectionGroups(t){return this.paperScope.project.getItems({match:e=>e.isGeoJSONFeatureCollection&&(!t||e.layer===t)})}getFeatures(){return this.paperScope.project.getItems({match:t=>t.isGeoJSONFeature})}static registerFeature(t){t.isGeoJSONFeature=!0}static registerFeatureCollection(t){t.isGeoJSONFeatureCollection=!0}toGeoJSON(t){return((t=Object.assign({layer:null},t)).layer||this.paperScope.project).getItems({match:t=>t.isGeoJSONFeatureCollection}).map((t=>({type:"FeatureCollection",features:t.descendants.filter((t=>t.annotationItem)).map((t=>t.annotationItem.toGeoJSONFeature())),properties:{defaultStyle:t.defaultStyle.toJSON(),userdata:t.data.userdata},label:t.displayName})))}toGeoJSONString(t,e){return JSON.stringify(this.toGeoJSON(),t,e)}loadGeoJSON(e,n,i){let o=!!i&&i.paperLayer;n&&this.getFeatureCollectionGroups(i).forEach((t=>t.remove())),Array.isArray(e)||(e=[e]),e.forEach((e=>{if("FeatureCollection"==e.type){let n=this._createFeatureCollectionGroup({label:e.label,parent:o}),i=e.properties||{};n.data.userdata=Object.assign({},i.userdata),n.defaultStyle.set(i.defaultStyle),e.features.forEach((e=>{let i=t.Item.fromGeoJSON(e);n.addChild(i)}))}else console.warn("GeoJSON object not loaded: wrong type. Only FeatureCollection objects are currently supported")}))}addEmptyFeatureCollectionGroup(){return this._createFeatureCollectionGroup()}_createFeatureCollectionGroup(e={}){let n=(e=Object.assign({},{label:null,parent:null},e)).label,i=e.parent;if(!i){let t=this.viewer.world.getItemCount();1==t?i=this.viewer.world.getItemAt(0).paperLayer:0==t?i=this.viewer.viewport.paperLayer:(console.warn("Use of AnnotationToolkit with multi-image is not yet fully supported. All annotations will be added to the top-level tiled image."),i=this.viewer.world.getItemAt(t-1).paperLayer)}if(!i)return void console.error("Failed to create feature collection group: no parent could be found");let o=new t.Group;this._addFeatureCollectionGroupToLayer(o,i);let r=this.getFeatureCollectionGroups().length;return o.name=o.displayName=null!==n?n:`Annotation Group ${r}`,o.defaultStyle=new t.Style(this.paperScope.project.defaultStyle),o}_addFeatureCollectionGroupToLayer(t,e){e.addChild(t),he.registerFeatureCollection(t),this.paperScope.project.emit("feature-collection-added",{group:t}),t.children&&t.insertChildren(0,t.children)}makePlaceholderItem(t){return new Pt(t)}}class ce{constructor(t){let e=this.overlay=new Kt(t,{overlayType:"viewer"}),n=this.tool=new ue(this.overlay.paperScope,this);this.dummyTool=new this.overlay.paperScope.Tool,this.dummyTool.activate(),this._mouseNavEnabledAtActivation=!0;const i=e.addViewerButton({faIconClass:"fa-rotate",tooltip:"Rotate viewer",onClick:()=>{n.active?this.deactivate():this.activate()}});i.element.querySelector("svg.icon")?.style.setProperty("width","1em")}activate(){this._mouseNavEnabledAtActivation=this.overlay.viewer.isMouseNavEnabled(),this.tool.activate(),this.tool.active=!0,this.overlay.bringToFront()}deactivate(){this.tool.deactivate(!0),this.dummyTool.activate(),this.overlay.viewer.setMouseNavEnabled(this._mouseNavEnabledAtActivation),this.tool.active=!1,this.overlay.sendToBack()}}class ue extends y{constructor(e,n){super(e);let i=e.view.bounds,o=new de(e.view.bounds.center,(function(t,e){if(!e){let t=new OpenSeadragon.Point(o.item.position.x,o.item.position.y);e=r.viewport.pointFromPixel(t)}r.viewport.rotateTo(t,e,!0)}),(function(){n.deactivate()}));e.view.on("flip",(()=>{o.closeButton.scale(-1,1,o.item.bounds.center)}));let r=e.overlay.viewer;r.addHandler("rotate",(t=>o.setCurrentRotation(t.degrees))),e.view.on("resize",(function(n){let r=o.item.position,s=r.x/i.width,a=r.y/i.height;i=e.view.bounds,o.item.position=new t.Point(s*i.width,a*i.height)})),o.item.visible=!1,this.project.toolLayer.addChild(o.item),this.tool.onMouseDown=function(t){},this.tool.onMouseDrag=function(t){},this.tool.onMouseMove=function(t){o.setLineOrientation(t.point)},this.tool.onMouseUp=function(){},this.tool.extensions.onKeyDown=function(t){"escape"==t.key&&n.deactivate()},this.extensions.onActivate=function(){0==o.item.visible&&(o.item.position=e.view.bounds.center),o.item.visible=!0,o.item.opacity=1},this.extensions.onDeactivate=function(t){t&&(o.item.visible=!1),o.item.opacity=.3}}}function de(e,n,i){let o=2*e.x,r=2*e.y,s=Math.min(o/5,r/5,30),a=.3*s,l=new t.Point(0,-1).angle,h=new t.Group({insert:!1}),c=new t.Path.Circle({center:new t.Point(0,0),radius:s});c.fillColor=new t.Color(0,0,0,.01),c.strokeColor="black",c.strokeWidth=2,[0,90,180,270].map((e=>{let n=new t.Path.Line(new t.Point(0,a),new t.Point(0,s));n.rotate(e,new t.Point(0,0)),n.fillColor=null,n.strokeColor="black",n.strokeWidth=2,h.addChild(n)}));let u=[0,90,180,270].map((e=>{let n=new t.Path.Rectangle(new t.Point(-a,0),new t.Size(2*a,-1*(s+1.5*a))),i=n.subtract(c,{insert:!1});return n.remove(),i.rotate(e,new t.Point(0,0)),i.fillColor=new t.Color(100,100,100,.5),i.strokeColor="black",i._angle=e,h.addChild(i),i}));h.addChild(c);let d=new t.Path.Circle({center:new t.Point(0,-s),radius:a/1.5});d.set({fillColor:"yellow",strokeColor:"black",applyMatrix:!1}),h.addChild(d);let p=new t.Group({applyMatrix:!1}),g=new t.Group({applyMatrix:!1}),f=new t.Color(.3,.3,.3,.8),m=new t.Path.Line(new t.Point(0,-a),new t.Point(0,-Math.max(o,r)));m.strokeColor=f,m.strokeWidth=1,m.applyMatrix=!1,p.addChild(m),p.addChild(g);let v=new t.Path.RegularPolygon(new t.Point(1.2*-a,0),3,.8*a);v.rotate(-94);let _=new t.Path.RegularPolygon(new t.Point(1.2*a,0),3,.8*a);_.rotate(94);let y=new t.Path.Arc(new t.Point(1.2*-a,0),new t.Point(0,-a/4),new t.Point(1.2*a,0)),w=y.clone();g.addChildren([w,y,v,_]),g.fillColor="yellow",y.strokeWidth=a/2,w.strokeWidth=y.strokeWidth+2,w.strokeColor=f,v.strokeColor=f,_.strokeColor=f,y.strokeColor="yellow",y.fillColor=null,h.addChild(p);let A=new t.Group({insert:!1});A.addChild(new t.Path.Circle({radius:a})),A.addChild(new t.Path.Line(new t.Point(-a/2,-a/2),new t.Point(a/2,a/2))),A.addChild(new t.Path.Line(new t.Point(a/2,-a/2),new t.Point(-a/2,a/2))),A.set({fillColor:"red",strokeColor:"black",opacity:.7}),A.position=new t.Point(1.5*s,1.5*-s),h.addChild(A),h.pivot=c.bounds.center,h.position=e;let b={};return b.item=h,b.circle=c,b.cardinalControls=u,b.rotationLineControl=p,b.closeButton=A,b.setCurrentRotation=t=>{d.rotate(t-d.rotation,c.bounds.center)},b.setLineOrientation=(e,n=!1)=>{let i=e.subtract(c.bounds.center),o=i.angle-l,r=i.length;p.rotate(o-p.rotation,c.bounds.center),p.visible=n||r>s+1.5*a,g.position=new t.Point(0,-r),m.segments[1].point=new t.Point(0,-r)},u.forEach((t=>{t.onClick=function(){n(t._angle)}})),d.onMouseDrag=function(t){let e=t.point.subtract(c.bounds.center).angle;n(e-l)},g.onMouseDown=function(t){g._angleOffset=d.rotation-t.point.subtract(c.bounds.center).angle},g.onMouseDrag=function(t){let e,i=this.project.hitTestAll(t.point).filter((t=>u.includes(t.item)));i.length>0&&(t.point=i[0].item.bounds.center),e=t.point.subtract(c.bounds.center).angle+g._angleOffset,n(e),b.setLineOrientation(t.point,!0)},c.onMouseDrag=function(t){b.item.position=b.item.position.add(t.delta)},A.onClick=function(){i()},b}const pe="p".charCodeAt(0),ge="H".charCodeAt(0),fe="Y".charCodeAt(0),me="s".charCodeAt(0);function ve(t,e,n,i){if("image/jpeg"===n)return t[13]=1,t[14]=e>>8,t[15]=255&e,t[16]=e>>8,t[17]=255&e,t;if("image/png"===n){const n=new Uint8Array(13);e*=39.3701,n[0]=pe,n[1]=ge,n[2]=fe,n[3]=me,n[4]=e>>>24,n[5]=e>>>16,n[6]=e>>>8,n[7]=255&e,n[8]=n[4],n[9]=n[5],n[10]=n[6],n[11]=n[7],n[12]=1;const o=function(t){let e=-1;ae||(ae=function(){const t=new Int32Array(256);for(let e=0;e<256;e++){let n=e;for(let t=0;t<8;t++)n=1&n?3988292384^n>>>1:n>>>1;t[e]=n}return t}());for(let n=0;n<t.length;n++)e=ae[255&(e^t[n])]^e>>>8;return~e}(n),r=new Uint8Array(4);if(r[0]=o>>>24,r[1]=o>>>16,r[2]=o>>>8,r[3]=255&o,i){const e=function(t){for(let e=t.length-1;e>=4;e--)if(9===t[e-4]&&t[e-3]===pe&&t[e-2]===ge&&t[e-1]===fe&&t[e]===me)return e-3}(t);return t.set(n,e),t.set(r,e+13),t}{const e=new Uint8Array(4);e[0]=0,e[1]=0,e[2]=0,e[3]=9;const i=new Uint8Array(54);return i.set(t,0),i.set(e,33),i.set(n,37),i.set(r,50),i}}}class _e{constructor(t,e){this.viewer=t;let n=this.overlay=new Kt(t,{overlayType:"viewer"}),i=this.tool=new ye(this.overlay.paperScope,this);this.dummyTool=new this.overlay.paperScope.Tool,this.dummyTool.activate(),this._mouseNavEnabledAtActivation=!0;const o=n.addViewerButton({faIconClass:"fa-camera",tooltip:"Take Screenshot",onClick:()=>{i.active?this.deactivate():this.activate()}});o.element.querySelector("svg.icon")?.style.setProperty("width","1em"),this._makeDialog(e),this.tool.addEventListener("region-selected",(t=>this._setupScreenshotDialog(t)))}activate(){let t=this.overlay.setOSDMouseNavEnabled(!1);this._mouseNavEnabledAtActivation=this._mouseNavEnabledAtActivation||t,this.overlay.bringToFront(),this.tool.activate()}deactivate(){this.dialog.classList.add("hidden"),this.tool.deactivate(!0),this.dummyTool.activate(),this.overlay.setOSDMouseNavEnabled(this._mouseNavEnabledAtActivation),this._mouseNavEnabledAtActivation=!1,this.overlay.sendToBack()}_startRegion(){this.dialog.classList.add("hidden"),this.tool.activate()}_makeDialog(t){let e=`<div class="screenshot-dialog hidden">\n            <div class="size">\n                <h3>Aspect Ratio</h3>\n                <label>Lock</label><input class="lock-aspect-ratio" type="checkbox"/>\n                <input type="number" min="0" value="1" class="aspect-width"/> x <input type="number" min="0" value="1" class="aspect-height"/>\n                <button class="apply-aspect-ratio">Apply</button>\n            </div>\n            <hr>\n            <div>\n                <h3>Selected Region</h3>\n                <div class="size">\n                    <div><input class="region-width region-dim" type="number" min="0"/> x <input class="region-height region-dim" type="number" min="0"/> px \n                    (<span class="region-width-mm"></span> x <span class="region-height-mm"></span> mm)</div>\n                </div>\n                <div class="scalebar">\n                    <label>Include scale bar:</label> <input class="include-scalebar"type="checkbox">\n                    <div class="scalebar-opts">\n                    <p>Enter desired scale bar width in millimeters and height in pixels.<br>Width will be rounded to the nearest pixel.</p>\n                    <label>Width (mm):</label><input class="scalebar-width" type="number" min="0.001" step="0.01">\n                    <label>Height (px):</label><input class="scalebar-height" type="number" min="1" step="1">\n                    </div>\n                </div> \n            <div>\n            <hr>\n            <div class="screenshot-results">\n                <div class="instructions">\n                    <h3>Create your screenshot</h3>\n                    <div>\n                        <label>Select size:</label>\n                        <select class="select-size"></select>\n                        <button class="create-screenshot">Create</button>\n                    </div>\n                    \n                </div>\n                <div class="download">\n                    <h3>View/Download</h3>\n                    <div class="download-message">${t?.downloadMessage||""}</div>\n                    <div><a class="open-screenshot screenshot-link" target="_blank"><button>Open in new tab</button></a> | \n                    <a class="download-screenshot screenshot-link" download="screenshot.png"><button>Download</button></a></div>\n                    <div><button class="cancel-screenshot">Change size</button></div>\n                </div>\n                <div class="pending-message"><h3>View/Download</h3>\n                Creating your screenshot...\n                <div class="screenshot-progress">\n                    <progress></progress>\n                    <div>Loaded <span class="loaded"></span> of <span class="total"><span> tiles</div>\n                </div>\n                <div><button class="cancel-screenshot">Change size</button></div>\n                </div>\n            </div>\n            <hr>\n            <button class='rect'>Select a new area</button> | <button class='close'>Close</button>\n        </div>`;document.querySelector('style[data-type="screenshot-tool"]')||document.querySelector("head").appendChild(St('<style data-type="screenshot-tool">\n            .screenshot-dialog{\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                padding: 1em;\n                border: thin black solid;\n                background-color: white;\n                color: black;\n            }\n            .screenshot-dialog.hidden{\n                display:none;\n            }\n            .screenshot-dialog h3{\n                margin: 0.1em 0;\n            }\n            .screenshot-dialog input[type=number]{\n                width: 5em;\n            }\n            .screenshot-results>*{\n                display:none;\n                min-height:6em;\n            }\n            .screenshot-results.created .download{\n                display:block;\n            }\n            .screenshot-results.pending .pending-message{\n                display:block;\n            }\n            .screenshot-results:not(.created):not(.pending) .instructions{\n                display:block;\n            }\n            .screenshot-link{\n                display:inline-block;\n                margin-bottom: 0.5em;\n            }\n            .screenshot-dialog .download-message:not(:empty){\n                margin-bottom:1em;\n            }\n            .scalebar-opts.hidden{\n                visibility:hidden;\n            }\n        </style>'));const n=St(e);this.viewer.container.appendChild(n),n.addEventListener("mousemove",(t=>t.stopPropagation())),n.querySelectorAll(".close").forEach((t=>t.addEventListener("click",(()=>this.deactivate())))),n.querySelectorAll(".rect").forEach((t=>t.addEventListener("click",(()=>this._startRegion())))),n.querySelectorAll(".cancel-screenshot").forEach((t=>t.addEventListener("click",(()=>n.querySelector(".screenshot-results").classList.remove("pending","created"))))),n.querySelectorAll(".create-screenshot").forEach((t=>t.addEventListener("click",(()=>{const t=n.querySelector(".select-size"),e=t.options[t.selectedIndex],i=JSON.parse(e.getAttribute("data-dims"));this.dialog.querySelector(".screenshot-results").classList.add("pending"),this._createScreenshot(i).then((t=>{const e=this.dialog.querySelector(".screenshot-results");e.classList.remove("pending"),e.classList.add("created"),this.dialog.querySelector(".screenshot-link").href=this.blobURL})).catch((t=>{alert("There was a problem creating the screenshot. "+t)}))})))),n.querySelectorAll("button.download-screenshot").forEach((t=>t.addEventListener("click",(()=>{n.querySelectorAll("a.download-screenshot").dispatchEvent(new Event("change"))})))),n.querySelectorAll(".aspect-width").forEach((t=>{t.addEventListener("change",(t=>this.tool.setAspectWidth(Number(t.target.value)))),t.dispatchEvent(new Event("change"))})),n.querySelectorAll(".aspect-height").forEach((t=>{t.addEventListener("change",(t=>this.tool.setAspectHeight(Number(t.target.value)))),t.dispatchEvent(new Event("change"))})),n.querySelectorAll(".lock-aspect-ratio").forEach((t=>{t.addEventListener("change",(t=>this.tool.setAspectLocked(t.target.checked))),t.dispatchEvent(new Event("change"))})),n.querySelectorAll(".apply-aspect-ratio").forEach((t=>t.addEventListener("click",(t=>this._applyAspectRatio())))),n.querySelectorAll(".region-dim").forEach((t=>t.addEventListener("change",(()=>this._updateROI())))),n.querySelectorAll(".scalebar-width").forEach((t=>{t.addEventListener("change",(t=>this._scalebarWidth=Number(t.target.value)),this._resetScreenshotResults()),t.dispatchEvent(new Event("change"))})),n.querySelectorAll(".scalebar-height").forEach((t=>{t.addEventListener("change",(t=>this._scalebarHeight=Number(t.target.value)),this._resetScreenshotResults()),t.dispatchEvent(new Event("change"))})),n.querySelectorAll(".include-scalebar").forEach((t=>{t.addEventListener("change",(t=>{this._includeScalebar=t.target.checked;let e=n.querySelector(".scalebar-opts");this._includeScalebar?e.classList.remove("hidden"):e.classList.add("hidden"),this._resetScreenshotResults()})),t.dispatchEvent(new Event("change"))})),this.dialog=n}_updateROI(){let t=this.dialog.querySelector(".region-width").value,e=this.dialog.querySelector(".region-height").value;this._currentBounds.width=Number(t),this._currentBounds.height=Number(e),this._setupScreenshotDialog(this._currentBounds),this.dialog.querySelector(".lock-aspect-ratio").checked&&this._applyAspectRatio()}_applyAspectRatio(){let t=this._currentBounds.width/this._currentBounds.height,e=this.tool._aspectWidth/this.tool._aspectHeight;t/e>1?(this._currentBounds.width=Math.round(this._currentBounds.height*e),this._setupScreenshotDialog(this._currentBounds)):t/e<1&&(this._currentBounds.height=Math.round(this._currentBounds.width/e),this._setupScreenshotDialog(this._currentBounds))}_setupScreenshotDialog(t){this._resetScreenshotResults(),this._currentBounds=t,this.dialog.querySelector(".region-width").value=t.width,this.dialog.querySelector(".region-height").value=t.height;let e=this.viewer.viewport,n=(this.viewer.world.getItemAt(this.viewer.currentPage()),new OpenSeadragon.Rect(t.x,t.y,t.width,t.height)),i=e.viewerElementToViewportRectangle(n),o=e.viewportToImageRectangle(i);const r=Math.max(o.width,o.height)/Math.max(n.width,n.height);let s={width:n.width*r,height:n.height*r},a=!1;if(this._mpp=null,this.dialog.querySelector(".include-scalebar").disabled=!0,1===this.viewer.world.getItemCount()){let t=this.viewer.world.getItemAt(0).source.mpp;t&&(this.dialog.querySelector(".region-width-mm").textContent=""+(t.x/1e3*s.width).toFixed(3),this.dialog.querySelector(".region-height-mm").textContent=""+(t.y/1e3*s.height).toFixed(3),a=!0,this.dialog.querySelector(".include-scalebar").disabled=!1,this._mpp=t)}a||this.dialog.querySelectorAll(".region-width-mm, .region-height-mm").forEach((t=>t.textContent="??"));let l=this.dialog.querySelector(".select-size");l.textContent="";let h=s.width,c=s.height;for(;h>t.width&&c>t.height;){let t={w:Math.round(h),h:Math.round(c),imageBounds:o,scaleFactor:h/s.width},e=document.createElement("option");l.appendChild(e),e.textContent=`${Math.round(h)} x ${Math.round(c)}`,e.setAttribute("data-dims",JSON.stringify(t)),(h>23767||c>23767||h*c>268435456)&&e.setAttribute("disabled",!0),h/=2,c/=2}let u={w:t.width,h:t.height,imageBounds:o,scaleFactor:t.width/s.width},d=document.createElement("option");l.appendChild(d),d.textContent=`${Math.round(h)} x ${Math.round(c)}`,d.setAttribute("data-dims",JSON.stringify(u)),this.dialog.classList.remove("hidden")}_resetScreenshotResults(){this.dialog?.querySelector(".screenshot-results").classList.remove("created","pending")}_setProgress(t,e){if(this.dialog){const n=this.dialog.querySelector("progress");n.value=t,n.max=e,this.dialog.querySelector(".loaded").textContent=t,this.dialog.querySelector(".total").textContent=e}}_createScreenshot(t){let e=t.w,n=t.h,i=t.imageBounds,o=new OpenSeadragon.Rect(i.x,i.y,i.width,i.height,i.degrees),r=t.scaleFactor;return new Promise(((t,i)=>{try{let i=OpenSeadragon.pixelDensityRatio;e/=i,n/=i;const s=document.createElement("div");document.body.appendChild(s),s.style.cssText=`width:${e}px;height:${n}px;position:fixed;left:-${2*e}px;`;let a=this.viewer.tileSources[this.viewer.currentPage()],l=this.viewer.world.getItemAt(this.viewer.currentPage()),h=OpenSeadragon({element:s,tileSources:[a],crossOriginPolicy:this.viewer.crossOriginPolicy,prefixUrl:this.viewer.prefixUrl,immediateRender:!0});h.viewport.setRotation(this.viewer.viewport.getRotation(!0),!0),h.addHandler("tile-drawn",(t=>{let e=t.tiledImage.coverage,n=Object.keys(e),i=n[n.length-1];if(t.tile.level==i){let t=e[i],n=Object.values(t).map((t=>Object.values(t))).flat();this._setProgress(n.filter((t=>t)).length,n.length)}})),h.addHandler("open",(()=>{h.world.getItemAt(0).setRotation(l.getRotation(!0),!0),h.world.getItemAt(0).addOnceHandler("fully-loaded-change",(e=>{if(this._includeScalebar&&this._mpp){let t=Math.round(1e3*this._scalebarWidth/this._mpp.x*r),e=Math.round(this._scalebarHeight),n=h.drawer.canvas,i=n.getContext("2d"),o=n.width,s=n.height;i.fillRect(o-e,s-e,-t,-e)}h.drawer.canvas.toBlob((async e=>{1!=i&&(e=await function(t,e){const n=t.slice(0,33);return new Promise(((i,o)=>{const r=new FileReader;r.onload=()=>{const n=new Uint8Array(r.result),o=t.slice(33),s=ve(n,e,t.type);i(new Blob([s,o],{type:t.type}))},r.readAsArrayBuffer(n)}))}(e,96*i)),this.blobURL&&URL.revokeObjectURL(this.blobURL),this.blobURL=URL.createObjectURL(e),t(this.blobURL);let n=h.element;h.destroy(),n.remove()}))}));let e=h.viewport.imageToViewportRectangle(o);h.viewport.fitBounds(e)}))}catch(t){i(t)}}))}}class ye extends y{constructor(e,n){super(e);let i=this;this._ps=e,this.compoundPath=new t.CompoundPath({children:[],fillRule:"evenodd"}),this.compoundPath.visible=!1,this.compoundPath.fillColor="black",this.compoundPath.opacity=.3,this.project.toolLayer.addChild(this.compoundPath),this.crosshairTool=new t.Group;let o=new t.Path({segments:[new t.Point(0,0),new t.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"black"}),r=new t.Path({segments:[new t.Point(0,0),new t.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"white",dashArray:[6,6]}),s=new t.Path({segments:[new t.Point(0,0),new t.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"black"}),a=new t.Path({segments:[new t.Point(0,0),new t.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"white",dashArray:[6,6]});this.crosshairTool.addChildren([o,r,s,a]),this.project.toolLayer.addChild(this.crosshairTool),this.crosshairTool.visible=!1,this._aspectHeight=1,this._aspectWidth=1,this._aspectLocked=!1,this.tool.onMouseDown=e=>{this.crosshairTool.visible=!1,this.compoundPath.visible=!0,this.compoundPath.removeChildren(),this.compoundPath.addChild(new t.Path.Rectangle(this._ps.view.bounds)),window.cp=this.compoundPath},this.tool.onMouseDrag=e=>{this.compoundPath.removeChildren(1);let n=this.getPoint(e);this.compoundPath.addChild(new t.Path.Rectangle(e.downPoint,n))},this.tool.onMouseMove=e=>{this.crosshairTool.visible=!0,function(e,n){let i=e.view.projectToView(n),l=e.view.viewToProject(new t.Point(0,i.y)),h=e.view.viewToProject(new t.Point(e.view.viewSize.width,i.y)),c=e.view.viewToProject(new t.Point(i.x,0)),u=e.view.viewToProject(new t.Point(i.x,e.view.viewSize.height));o.segments[0].point=l,r.segments[0].point=l,o.segments[1].point=h,r.segments[1].point=h,s.segments[0].point=c,a.segments[0].point=c,s.segments[1].point=u,a.segments[1].point=u}(i.tool,e.point)},this.tool.onMouseUp=e=>{let n=this.getPoint(e);this.broadcast("region-selected",new t.Rectangle(e.downPoint,n))},this.tool.extensions.onKeyDown=function(t){"escape"==t.key&&n.deactivate()},this.extensions.onActivate=()=>{this.crosshairTool.visible=!0,this.compoundPath.visible=!1},this.extensions.onDeactivate=t=>{this.crosshairTool.visible=!1,this.compoundPath.visible=!1}}activate(){this.tool.activate(),this.crosshairTool.visible=!0,this.compoundPath.visible=!1}deactivate(){this.crosshairTool.visible=!1,this.compoundPath.visible=!1}setAspectHeight(t){this._aspectHeight=t}setAspectWidth(t){this._aspectWidth=t}setAspectLocked(t){this._aspectLocked=t}getPoint(t){let e=t.point;if(this._aspectLocked){let n=t.point.subtract(t.downPoint);Math.abs(n.x)>Math.abs(n.y)?e.y=t.downPoint.y+(n.y<0?-1:1)*Math.abs(n.x)*this._aspectHeight/this._aspectWidth:e.x=t.downPoint.x+(n.x<0?-1:1)*Math.abs(n.y)*this._aspectWidth/this._aspectHeight}return e}}const we={AnnotationToolkit:he,AnnotationToolbar:xt,FeatureCollectionUI:Ot,FeatureUI:Tt,FileDialog:Mt,LayerUI:Bt,PaperOffset:X,PaperOverlay:Kt,RotationControlOverlay:ce,ScreenshotOverlay:_e,AnnotationUITool:A,ToolBase:y,BrushTool:$,DefaultTool:T,EllipseTool:dt,LinestringTool:mt,PointTool:rt,PointTextTool:lt,PolygonTool:gt,RasterTool:bt,RectangleTool:ct,SelectTool:_t,StyleTool:P,TransformTool:wt,WandTool:R}})(),i})()));
//# sourceMappingURL=main.js.map